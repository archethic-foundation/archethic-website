import{d as tt,G as Ie,_ as Rw,o as tl,s as xw,bP as Ho,m as Tw}from"./index-Bibw8odz.js";import{s as U,y as Vo,g as el,p as rl,G as Cw,L as nl,R as $i}from"./index-WS886V6v-C4YDggU_.js";import{$ as Mi,p as Li,S as zi,_ as Gt,a as re,y as vr,O as Dw,E as zr,m as il,V as Re,L as ki,W as tr,U as Ko,T as Bo,I as Lu,g as $w,t as Ee,r as fe,R as jw,X as qw,v as zu,i as Uw,w as Mw,A as Lw,P as zw,c as kw,b as ku,d as Hw,u as Hu,l as Vw,h as Kw,e as Bw,f as Ww,j as Fw}from"./browser-D59zAjl0-Cas1Em44.js";var ht={};Object.defineProperty(ht,"__esModule",{value:!0});ht.getLocalStorage=ht.getLocalStorageOrThrow=ht.getCrypto=ht.getCryptoOrThrow=ht.getLocation=ht.getLocationOrThrow=ht.getNavigator=ht.getNavigatorOrThrow=ht.getDocument=ht.getDocumentOrThrow=ht.getFromWindowOrThrow=ht.getFromWindow=void 0;function mr(o){let e;return typeof window<"u"&&typeof window[o]<"u"&&(e=window[o]),e}ht.getFromWindow=mr;function Vr(o){const e=mr(o);if(!e)throw new Error(`${o} is not defined in Window`);return e}ht.getFromWindowOrThrow=Vr;function Gw(){return Vr("document")}ht.getDocumentOrThrow=Gw;function Qw(){return mr("document")}ht.getDocument=Qw;function Yw(){return Vr("navigator")}ht.getNavigatorOrThrow=Yw;function Jw(){return mr("navigator")}ht.getNavigator=Jw;function Xw(){return Vr("location")}ht.getLocationOrThrow=Xw;function Zw(){return mr("location")}ht.getLocation=Zw;function t_(){return Vr("crypto")}ht.getCryptoOrThrow=t_;function e_(){return mr("crypto")}ht.getCrypto=e_;function r_(){return Vr("localStorage")}ht.getLocalStorageOrThrow=r_;function n_(){return mr("localStorage")}ht.getLocalStorage=n_;var Wo={};Object.defineProperty(Wo,"__esModule",{value:!0});Wo.getWindowMetadata=void 0;const Vu=ht;function i_(){let o,e;try{o=Vu.getDocumentOrThrow(),e=Vu.getLocationOrThrow()}catch{return null}function r(){const A=o.getElementsByTagName("link"),O=[];for(let R=0;R<A.length;R++){const M=A[R],x=M.getAttribute("rel");if(x&&x.toLowerCase().indexOf("icon")>-1){const $=M.getAttribute("href");if($)if($.toLowerCase().indexOf("https:")===-1&&$.toLowerCase().indexOf("http:")===-1&&$.indexOf("//")!==0){let F=e.protocol+"//"+e.host;if($.indexOf("/")===0)F+=$;else{const Z=e.pathname.split("/");Z.pop();const _t=Z.join("/");F+=_t+"/"+$}O.push(F)}else if($.indexOf("//")===0){const F=e.protocol+$;O.push(F)}else O.push($)}}return O}function i(...A){const O=o.getElementsByTagName("meta");for(let R=0;R<O.length;R++){const M=O[R],x=["itemprop","property","name"].map($=>M.getAttribute($)).filter($=>$?A.includes($):!1);if(x.length&&x){const $=M.getAttribute("content");if($)return $}}return""}function a(){let A=i("name","og:site_name","og:title","twitter:title");return A||(A=o.title),A}function u(){return i("description","og:description","twitter:description","keywords")}const l=a(),d=u(),w=e.origin,b=r();return{description:d,url:w,icons:b,name:l}}Wo.getWindowMetadata=i_;function s_(o,e=[]){const r=[];return Object.keys(o).forEach(i=>{if(e.length&&!e.includes(i))return;const a=o[i];r.push(...a.accounts)}),r}const o_={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function a_(o,e){const{message:r,code:i}=o_[o];return{message:r,code:i}}function No(o,e){return!!Array.isArray(o)}const c_=o=>JSON.stringify(o,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),u_=o=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=o.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,a)=>typeof a=="string"&&a.match(/^\d+n$/)?BigInt(a.substring(0,a.length-1)):a)};function Fo(o){if(typeof o!="string")throw new Error(`Cannot safe json parse value of type ${typeof o}`);try{return u_(o)}catch{return o}}function Go(o){return typeof o=="string"?o:c_(o)||""}const h_="idb-keyval";var l_=(o={})=>{const e=o.base&&o.base.length>0?`${o.base}:`:"",r=a=>e+a;let i;return o.dbName&&o.storeName&&(i=Hw(o.dbName,o.storeName)),{name:h_,options:o,async hasItem(a){return!(typeof await Hu(r(a),i)>"u")},async getItem(a){return await Hu(r(a),i)??null},setItem(a,u){return Vw(r(a),u,i)},removeItem(a){return Kw(r(a),i)},getKeys(){return Bw(i)},clear(){return Ww(i)}}};const p_="WALLET_CONNECT_V2_INDEXED_DB",f_="keyvaluestorage";let d_=class{constructor(){this.indexedDb=kw({driver:l_({dbName:p_,storeName:f_})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(o=>[o.key,o.value])}async getItem(o){const e=await this.indexedDb.getItem(o);if(e!==null)return e}async setItem(o,e){await this.indexedDb.setItem(o,Go(e))}async removeItem(o){await this.indexedDb.removeItem(o)}};var go=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof tt.global<"u"?tt.global:typeof self<"u"?self:{},Ti={exports:{}};(function(){let o;function e(){}o=e,o.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},o.prototype.setItem=function(r,i){this[r]=String(i)},o.prototype.removeItem=function(r){delete this[r]},o.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},o.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},o.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof go<"u"&&go.localStorage?Ti.exports=go.localStorage:typeof window<"u"&&window.localStorage?Ti.exports=window.localStorage:Ti.exports=new e})();function g_(o){var e;return[o[0],Fo((e=o[1])!=null?e:"")]}let y_=class{constructor(){this.localStorage=Ti.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(g_)}async getItem(o){const e=this.localStorage.getItem(o);if(e!==null)return Fo(e)}async setItem(o,e){this.localStorage.setItem(o,Go(e))}async removeItem(o){this.localStorage.removeItem(o)}};const v_="wc_storage_version",Ku=1,m_=async(o,e,r)=>{const i=v_,a=await e.getItem(i);if(a&&a>=Ku){r(e);return}const u=await o.getKeys();if(!u.length){r(e);return}const l=[];for(;u.length;){const d=u.shift();if(!d)continue;const w=d.toLowerCase();if(w.includes("wc@")||w.includes("walletconnect")||w.includes("wc_")||w.includes("wallet_connect")){const b=await o.getItem(d);await e.setItem(d,b),l.push(d)}}await e.setItem(i,Ku),r(e),w_(o,l)},w_=async(o,e)=>{e.length&&e.forEach(async r=>{await o.removeItem(r)})};let __=class{constructor(){this.initialized=!1,this.setInitialized=e=>{this.storage=e,this.initialized=!0};const o=new y_;this.storage=o;try{const e=new d_;m_(o,e,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(o){return await this.initialize(),this.storage.getItem(o)}async setItem(o,e){return await this.initialize(),this.storage.setItem(o,e)}async removeItem(o){return await this.initialize(),this.storage.removeItem(o)}async initialize(){this.initialized||await new Promise(o=>{const e=setInterval(()=>{this.initialized&&(clearInterval(e),o())},20)})}};var Kr={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ao=function(o,e){return Ao=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var a in i)i.hasOwnProperty(a)&&(r[a]=i[a])},Ao(o,e)};function b_(o,e){Ao(o,e);function r(){this.constructor=o}o.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Ro=function(){return Ro=Object.assign||function(o){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(o[a]=e[a])}return o},Ro.apply(this,arguments)};function E_(o,e){var r={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&e.indexOf(i)<0&&(r[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,i=Object.getOwnPropertySymbols(o);a<i.length;a++)e.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(o,i[a])&&(r[i[a]]=o[i[a]]);return r}function I_(o,e,r,i){var a=arguments.length,u=a<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,e,r,i);else for(var d=o.length-1;d>=0;d--)(l=o[d])&&(u=(a<3?l(u):a>3?l(e,r,u):l(e,r))||u);return a>3&&u&&Object.defineProperty(e,r,u),u}function P_(o,e){return function(r,i){e(r,i,o)}}function S_(o,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,e)}function O_(o,e,r,i){function a(u){return u instanceof r?u:new r(function(l){l(u)})}return new(r||(r=Promise))(function(u,l){function d(A){try{b(i.next(A))}catch(O){l(O)}}function w(A){try{b(i.throw(A))}catch(O){l(O)}}function b(A){A.done?u(A.value):a(A.value).then(d,w)}b((i=i.apply(o,e||[])).next())})}function N_(o,e){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},i,a,u,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(b){return function(A){return w([b,A])}}function w(b){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,a&&(u=b[0]&2?a.return:b[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,b[1])).done)return u;switch(a=0,u&&(b=[b[0]&2,u.value]),b[0]){case 0:case 1:u=b;break;case 4:return r.label++,{value:b[1],done:!1};case 5:r.label++,a=b[1],b=[0];continue;case 7:b=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(b[0]===6||b[0]===2)){r=0;continue}if(b[0]===3&&(!u||b[1]>u[0]&&b[1]<u[3])){r.label=b[1];break}if(b[0]===6&&r.label<u[1]){r.label=u[1],u=b;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(b);break}u[2]&&r.ops.pop(),r.trys.pop();continue}b=e.call(o,r)}catch(A){b=[6,A],a=0}finally{i=u=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}function A_(o,e,r,i){i===void 0&&(i=r),o[i]=e[r]}function R_(o,e){for(var r in o)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=o[r])}function xo(o){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&o[e],i=0;if(r)return r.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function sl(o,e){var r=typeof Symbol=="function"&&o[Symbol.iterator];if(!r)return o;var i=r.call(o),a,u=[],l;try{for(;(e===void 0||e-- >0)&&!(a=i.next()).done;)u.push(a.value)}catch(d){l={error:d}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(l)throw l.error}}return u}function x_(){for(var o=[],e=0;e<arguments.length;e++)o=o.concat(sl(arguments[e]));return o}function T_(){for(var o=0,e=0,r=arguments.length;e<r;e++)o+=arguments[e].length;for(var i=Array(o),a=0,e=0;e<r;e++)for(var u=arguments[e],l=0,d=u.length;l<d;l++,a++)i[a]=u[l];return i}function xn(o){return this instanceof xn?(this.v=o,this):new xn(o)}function C_(o,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(o,e||[]),a,u=[];return a={},l("next"),l("throw"),l("return"),a[Symbol.asyncIterator]=function(){return this},a;function l(R){i[R]&&(a[R]=function(M){return new Promise(function(x,$){u.push([R,M,x,$])>1||d(R,M)})})}function d(R,M){try{w(i[R](M))}catch(x){O(u[0][3],x)}}function w(R){R.value instanceof xn?Promise.resolve(R.value.v).then(b,A):O(u[0][2],R)}function b(R){d("next",R)}function A(R){d("throw",R)}function O(R,M){R(M),u.shift(),u.length&&d(u[0][0],u[0][1])}}function D_(o){var e,r;return e={},i("next"),i("throw",function(a){throw a}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(a,u){e[a]=o[a]?function(l){return(r=!r)?{value:xn(o[a](l)),done:a==="return"}:u?u(l):l}:u}}function $_(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=o[Symbol.asyncIterator],r;return e?e.call(o):(o=typeof xo=="function"?xo(o):o[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(u){r[u]=o[u]&&function(l){return new Promise(function(d,w){l=o[u](l),a(d,w,l.done,l.value)})}}function a(u,l,d,w){Promise.resolve(w).then(function(b){u({value:b,done:d})},l)}}function j_(o,e){return Object.defineProperty?Object.defineProperty(o,"raw",{value:e}):o.raw=e,o}function q_(o){if(o&&o.__esModule)return o;var e={};if(o!=null)for(var r in o)Object.hasOwnProperty.call(o,r)&&(e[r]=o[r]);return e.default=o,e}function U_(o){return o&&o.__esModule?o:{default:o}}function M_(o,e){if(!e.has(o))throw new TypeError("attempted to get private field on non-instance");return e.get(o)}function L_(o,e,r){if(!e.has(o))throw new TypeError("attempted to set private field on non-instance");return e.set(o,r),r}const z_=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Ro},__asyncDelegator:D_,__asyncGenerator:C_,__asyncValues:$_,__await:xn,__awaiter:O_,__classPrivateFieldGet:M_,__classPrivateFieldSet:L_,__createBinding:A_,__decorate:I_,__exportStar:R_,__extends:b_,__generator:N_,__importDefault:U_,__importStar:q_,__makeTemplateObject:j_,__metadata:S_,__param:P_,__read:sl,__rest:E_,__spread:x_,__spreadArrays:T_,__values:xo},Symbol.toStringTag,{value:"Module"})),Hi=tl(z_);var _n={},Bu={},bn={};const k_=Object.freeze(Object.defineProperty({__proto__:null,IEvents:vr},Symbol.toStringTag,{value:"Module"})),H_=tl(k_);var Wu;function V_(){if(Wu)return bn;Wu=1,Object.defineProperty(bn,"__esModule",{value:!0}),bn.IHeartBeat=void 0;const o=H_;class e extends o.IEvents{constructor(i){super()}}return bn.IHeartBeat=e,bn}var Fu;function ol(){return Fu||(Fu=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Hi.__exportStar(V_(),o)}(Bu)),Bu}var Gu={},dr={},Qu;function K_(){if(Qu)return dr;Qu=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.HEARTBEAT_EVENTS=dr.HEARTBEAT_INTERVAL=void 0;const o=U;return dr.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,dr.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},dr}var Yu;function al(){return Yu||(Yu=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Hi.__exportStar(K_(),o)}(Gu)),Gu}var Ju;function B_(){if(Ju)return _n;Ju=1,Object.defineProperty(_n,"__esModule",{value:!0}),_n.HeartBeat=void 0;const o=Hi,e=Ie,r=U,i=ol(),a=al();class u extends i.IHeartBeat{constructor(d){super(d),this.events=new e.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(d==null?void 0:d.interval)||a.HEARTBEAT_INTERVAL}static init(d){return o.__awaiter(this,void 0,void 0,function*(){const w=new u(d);return yield w.init(),w})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(d,w){this.events.on(d,w)}once(d,w){this.events.once(d,w)}off(d,w){this.events.off(d,w)}removeListener(d,w){this.events.removeListener(d,w)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return _n.HeartBeat=u,_n}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const e=Hi;e.__exportStar(B_(),o),e.__exportStar(ol(),o),e.__exportStar(al(),o)})(Kr);class W_ extends vr{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let F_=class extends vr{constructor(o,e){super(),this.core=o,this.logger=e,this.records=new Map}};class G_{constructor(e,r){this.logger=e,this.core=r}}let Q_=class extends vr{constructor(o,e){super(),this.relayer=o,this.logger=e}},Y_=class extends vr{constructor(o){super()}},J_=class{constructor(o,e,r,i){this.core=o,this.logger=e,this.name=r}},X_=class extends vr{constructor(o,e){super(),this.relayer=o,this.logger=e}},Z_=class extends vr{constructor(o,e){super(),this.core=o,this.logger=e}},tb=class{constructor(o,e){this.projectId=o,this.logger=e}},eb=class{constructor(o,e){this.projectId=o,this.logger=e}},rb=class{constructor(o){this.opts=o,this.protocol="wc",this.version=2}},nb=class{constructor(o){this.client=o}};var Xu=function(o,e,r){for(var i=0,a=e.length,u;i<a;i++)(u||!(i in e))&&(u||(u=Array.prototype.slice.call(e,0,i)),u[i]=e[i]);return o.concat(u||Array.prototype.slice.call(e))},ib=function(){function o(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return o}(),sb=function(){function o(e){this.version=e,this.type="node",this.name="node",this.os=tt.process.platform}return o}(),ob=function(){function o(e,r,i,a){this.name=e,this.version=r,this.os=i,this.bot=a,this.type="bot-device"}return o}(),ab=function(){function o(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return o}(),cb=function(){function o(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return o}(),ub=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,hb=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Zu=3,lb=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",ub]],th=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function pb(o){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new cb:typeof navigator<"u"?db(navigator.userAgent):yb()}function fb(o){return o!==""&&lb.reduce(function(e,r){var i=r[0],a=r[1];if(e)return e;var u=a.exec(o);return!!u&&[i,u]},!1)}function db(o){var e=fb(o);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new ab;var a=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);a?a.length<Zu&&(a=Xu(Xu([],a,!0),vb(Zu-a.length))):a=[];var u=a.join("."),l=gb(o),d=hb.exec(o);return d&&d[1]?new ob(r,u,l,d[1]):new ib(r,u,l)}function gb(o){for(var e=0,r=th.length;e<r;e++){var i=th[e],a=i[0],u=i[1],l=u.exec(o);if(l)return a}return null}function yb(){var o=typeof tt.process<"u"&&tt.process.version;return o?new sb(tt.process.version.slice(1)):null}function vb(o){for(var e=[],r=0;r<o;r++)e.push("0");return e}var lt={};Object.defineProperty(lt,"__esModule",{value:!0});lt.getLocalStorage=lt.getLocalStorageOrThrow=lt.getCrypto=lt.getCryptoOrThrow=cl=lt.getLocation=lt.getLocationOrThrow=Yo=lt.getNavigator=lt.getNavigatorOrThrow=Qo=lt.getDocument=lt.getDocumentOrThrow=lt.getFromWindowOrThrow=lt.getFromWindow=void 0;function wr(o){let e;return typeof window<"u"&&typeof window[o]<"u"&&(e=window[o]),e}lt.getFromWindow=wr;function Br(o){const e=wr(o);if(!e)throw new Error(`${o} is not defined in Window`);return e}lt.getFromWindowOrThrow=Br;function mb(){return Br("document")}lt.getDocumentOrThrow=mb;function wb(){return wr("document")}var Qo=lt.getDocument=wb;function _b(){return Br("navigator")}lt.getNavigatorOrThrow=_b;function bb(){return wr("navigator")}var Yo=lt.getNavigator=bb;function Eb(){return Br("location")}lt.getLocationOrThrow=Eb;function Ib(){return wr("location")}var cl=lt.getLocation=Ib;function Pb(){return Br("crypto")}lt.getCryptoOrThrow=Pb;function Sb(){return wr("crypto")}lt.getCrypto=Sb;function Ob(){return Br("localStorage")}lt.getLocalStorageOrThrow=Ob;function Nb(){return wr("localStorage")}lt.getLocalStorage=Nb;var Jo={};Object.defineProperty(Jo,"__esModule",{value:!0});var ul=Jo.getWindowMetadata=void 0;const eh=lt;function Ab(){let o,e;try{o=eh.getDocumentOrThrow(),e=eh.getLocationOrThrow()}catch{return null}function r(){const A=o.getElementsByTagName("link"),O=[];for(let R=0;R<A.length;R++){const M=A[R],x=M.getAttribute("rel");if(x&&x.toLowerCase().indexOf("icon")>-1){const $=M.getAttribute("href");if($)if($.toLowerCase().indexOf("https:")===-1&&$.toLowerCase().indexOf("http:")===-1&&$.indexOf("//")!==0){let F=e.protocol+"//"+e.host;if($.indexOf("/")===0)F+=$;else{const Z=e.pathname.split("/");Z.pop();const _t=Z.join("/");F+=_t+"/"+$}O.push(F)}else if($.indexOf("//")===0){const F=e.protocol+$;O.push(F)}else O.push($)}}return O}function i(...A){const O=o.getElementsByTagName("meta");for(let R=0;R<O.length;R++){const M=O[R],x=["itemprop","property","name"].map($=>M.getAttribute($)).filter($=>$?A.includes($):!1);if(x.length&&x){const $=M.getAttribute("content");if($)return $}}return""}function a(){let A=i("name","og:site_name","og:title","twitter:title");return A||(A=o.title),A}function u(){return i("description","og:description","twitter:description","keywords")}const l=a(),d=u(),w=e.origin,b=r();return{description:d,url:w,icons:b,name:l}}ul=Jo.getWindowMetadata=Ab;const Rb=":";function xb(o){const[e,r]=o.split(Rb);return{namespace:e,reference:r}}function hl(o,e){return o.includes(":")?[o]:e.chains||[]}const ll="base10",zt="base16",To="base64pad",Xo="utf8",pl=0,_r=1,Tb=0,rh=1,Co=12,Zo=32;function Cb(){const o=el.generateKeyPair();return{privateKey:fe(o.secretKey,zt),publicKey:fe(o.publicKey,zt)}}function Do(){const o=rl.randomBytes(Zo);return fe(o,zt)}function Db(o,e){const r=el.sharedKey(Ee(o,zt),Ee(e,zt),!0),i=new Cw(Vo.SHA256,r).expand(Zo);return fe(i,zt)}function $b(o){const e=Vo.hash(Ee(o,zt));return fe(e,zt)}function kr(o){const e=Vo.hash(Ee(o,Xo));return fe(e,zt)}function jb(o){return Ee(`${o}`,ll)}function Cn(o){return Number(fe(o,ll))}function qb(o){const e=jb(typeof o.type<"u"?o.type:pl);if(Cn(e)===_r&&typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof o.senderPublicKey<"u"?Ee(o.senderPublicKey,zt):void 0,i=typeof o.iv<"u"?Ee(o.iv,zt):rl.randomBytes(Co),a=new nl.ChaCha20Poly1305(Ee(o.symKey,zt)).seal(i,Ee(o.message,Xo));return Mb({type:e,sealed:a,iv:i,senderPublicKey:r})}function Ub(o){const e=new nl.ChaCha20Poly1305(Ee(o.symKey,zt)),{sealed:r,iv:i}=ji(o.encoded),a=e.open(i,r);if(a===null)throw new Error("Failed to decrypt");return fe(a,Xo)}function Mb(o){if(Cn(o.type)===_r){if(typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return fe(ku([o.type,o.senderPublicKey,o.iv,o.sealed]),To)}return fe(ku([o.type,o.iv,o.sealed]),To)}function ji(o){const e=Ee(o,To),r=e.slice(Tb,rh),i=rh;if(Cn(r)===_r){const d=i+Zo,w=d+Co,b=e.slice(i,d),A=e.slice(d,w),O=e.slice(w);return{type:r,sealed:O,iv:A,senderPublicKey:b}}const a=i+Co,u=e.slice(i,a),l=e.slice(a);return{type:r,sealed:l,iv:u}}function Lb(o,e){const r=ji(o);return fl({type:Cn(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?fe(r.senderPublicKey,zt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function fl(o){const e=(o==null?void 0:o.type)||pl;if(e===_r){if(typeof(o==null?void 0:o.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(o==null?void 0:o.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:o==null?void 0:o.senderPublicKey,receiverPublicKey:o==null?void 0:o.receiverPublicKey}}function nh(o){return o.type===_r&&typeof o.senderPublicKey=="string"&&typeof o.receiverPublicKey=="string"}var zb=Object.defineProperty,ih=Object.getOwnPropertySymbols,kb=Object.prototype.hasOwnProperty,Hb=Object.prototype.propertyIsEnumerable,sh=(o,e,r)=>e in o?zb(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,oh=(o,e)=>{for(var r in e||(e={}))kb.call(e,r)&&sh(o,r,e[r]);if(ih)for(var r of ih(e))Hb.call(e,r)&&sh(o,r,e[r]);return o};const Vb="ReactNative",ee={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Kb="js";function ta(){return typeof tt.process<"u"&&typeof tt.process.versions<"u"&&typeof tt.process.versions.node<"u"}function Wr(){return!Qo()&&!!Yo()&&navigator.product===Vb}function Fr(){return!ta()&&!!Yo()&&!!Qo()}function Dn(){return Wr()?ee.reactNative:ta()?ee.node:Fr()?ee.browser:ee.unknown}function Bb(){var o;try{return Wr()&&typeof tt.global<"u"&&typeof(tt.global==null?void 0:tt.global.Application)<"u"?(o=tt.global.Application)==null?void 0:o.applicationId:void 0}catch{return}}function Wb(o,e){let r=$i.parse(o);return r=oh(oh({},r),e),o=$i.stringify(r),o}function Fb(){return ul()||{name:"",description:"",url:"",icons:[""]}}function Gb(){if(Dn()===ee.reactNative&&typeof tt.global<"u"&&typeof(tt.global==null?void 0:tt.global.Platform)<"u"){const{OS:r,Version:i}=tt.global.Platform;return[r,i].join("-")}const o=pb();if(o===null)return"unknown";const e=o.os?o.os.replace(" ","").toLowerCase():"unknown";return o.type==="browser"?[e,o.name,o.version].join("-"):[e,o.version].join("-")}function Qb(){var o;const e=Dn();return e===ee.browser?[e,((o=cl())==null?void 0:o.host)||"unknown"].join(":"):e}function Yb(o,e,r){const i=Gb(),a=Qb();return[[o,e].join("-"),[Kb,r].join("-"),i,a].join("/")}function Jb({protocol:o,version:e,relayUrl:r,sdkVersion:i,auth:a,projectId:u,useOnCloseEvent:l,bundleId:d}){const w=r.split("?"),b=Yb(o,e,i),A={auth:a,ua:b,projectId:u,useOnCloseEvent:l||void 0,origin:d||void 0},O=Wb(w[1]||"",A);return w[0]+"?"+O}function gr(o,e){return o.filter(r=>e.includes(r)).length===o.length}function dl(o){return Object.fromEntries(o.entries())}function gl(o){return new Map(Object.entries(o))}function Mr(o=U.FIVE_MINUTES,e){const r=U.toMiliseconds(o||U.FIVE_MINUTES);let i,a,u;return{resolve:l=>{u&&i&&(clearTimeout(u),i(l))},reject:l=>{u&&a&&(clearTimeout(u),a(l))},done:()=>new Promise((l,d)=>{u=setTimeout(()=>{d(new Error(e))},r),i=l,a=d})}}function Tn(o,e,r){return new Promise(async(i,a)=>{const u=setTimeout(()=>a(new Error(r)),e);try{const l=await o;i(l)}catch(l){a(l)}clearTimeout(u)})}function yl(o,e){if(typeof e=="string"&&e.startsWith(`${o}:`))return e;if(o.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(o.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${o}`)}function Xb(o){return yl("topic",o)}function Zb(o){return yl("id",o)}function vl(o){const[e,r]=o.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function be(o,e){return U.fromMiliseconds(Date.now()+U.toMiliseconds(o))}function er(o){return Date.now()>=U.toMiliseconds(o)}function Pt(o,e){return`${o}${e?`:${e}`:""}`}function yo(o=[],e=[]){return[...new Set([...o,...e])]}async function t0({id:o,topic:e,wcDeepLink:r}){try{if(!r)return;const i=typeof r=="string"?JSON.parse(r):r;let a=i==null?void 0:i.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const u=`${a}/wc?requestId=${o}&sessionTopic=${e}`,l=Dn();l===ee.browser?u.startsWith("https://")?window.open(u,"_blank","noreferrer noopener"):window.open(u,"_self","noreferrer noopener"):l===ee.reactNative&&typeof(tt.global==null?void 0:tt.global.Linking)<"u"&&await tt.global.Linking.openURL(u)}catch(i){console.error(i)}}async function e0(o,e){try{return await o.getItem(e)||(Fr()?localStorage.getItem(e):void 0)}catch(r){console.error(r)}}const r0="irn";function $o(o){return(o==null?void 0:o.relay)||{protocol:r0}}function Ci(o){const e=Fw[o];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${o}`);return e}var n0=Object.defineProperty,ah=Object.getOwnPropertySymbols,i0=Object.prototype.hasOwnProperty,s0=Object.prototype.propertyIsEnumerable,ch=(o,e,r)=>e in o?n0(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,o0=(o,e)=>{for(var r in e||(e={}))i0.call(e,r)&&ch(o,r,e[r]);if(ah)for(var r of ah(e))s0.call(e,r)&&ch(o,r,e[r]);return o};function a0(o,e="-"){const r={},i="relay"+e;return Object.keys(o).forEach(a=>{if(a.startsWith(i)){const u=a.replace(i,""),l=o[a];r[u]=l}}),r}function uh(o){o=o.includes("wc://")?o.replace("wc://",""):o,o=o.includes("wc:")?o.replace("wc:",""):o;const e=o.indexOf(":"),r=o.indexOf("?")!==-1?o.indexOf("?"):void 0,i=o.substring(0,e),a=o.substring(e+1,r).split("@"),u=typeof r<"u"?o.substring(r):"",l=$i.parse(u);return{protocol:i,topic:c0(a[0]),version:parseInt(a[1],10),symKey:l.symKey,relay:a0(l)}}function c0(o){return o.startsWith("//")?o.substring(2):o}function u0(o,e="-"){const r="relay",i={};return Object.keys(o).forEach(a=>{const u=r+e+a;o[a]&&(i[u]=o[a])}),i}function h0(o){return`${o.protocol}:${o.topic}@${o.version}?`+$i.stringify(o0({symKey:o.symKey},u0(o.relay)))}function Gr(o){const e=[];return o.forEach(r=>{const[i,a]=r.split(":");e.push(`${i}:${a}`)}),e}function l0(o){const e=[];return Object.values(o).forEach(r=>{e.push(...Gr(r.accounts))}),e}function p0(o,e){const r=[];return Object.values(o).forEach(i=>{Gr(i.accounts).includes(e)&&r.push(...i.methods)}),r}function f0(o,e){const r=[];return Object.values(o).forEach(i=>{Gr(i.accounts).includes(e)&&r.push(...i.events)}),r}function d0(o,e){const r=Di(o,e);if(r)throw new Error(r.message);const i={};for(const[a,u]of Object.entries(o))i[a]={methods:u.methods,events:u.events,chains:u.accounts.map(l=>`${l.split(":")[0]}:${l.split(":")[1]}`)};return i}function ea(o){return o.includes(":")}function Nn(o){return ea(o)?o.split(":")[0]:o}const g0={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},y0={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function C(o,e){const{message:r,code:i}=y0[o];return{message:e?`${r} ${e}`:r,code:i}}function It(o,e){const{message:r,code:i}=g0[o];return{message:e?`${r} ${e}`:r,code:i}}function yr(o,e){return!!Array.isArray(o)}function Hr(o){return Object.getPrototypeOf(o)===Object.prototype&&Object.keys(o).length}function Ft(o){return typeof o>"u"}function At(o,e){return e&&Ft(o)?!0:typeof o=="string"&&!!o.trim().length}function ra(o,e){return typeof o=="number"&&!isNaN(o)}function v0(o,e){const{requiredNamespaces:r}=e,i=Object.keys(o.namespaces),a=Object.keys(r);let u=!0;return gr(a,i)?(i.forEach(l=>{const{accounts:d,methods:w,events:b}=o.namespaces[l],A=Gr(d),O=r[l];(!gr(hl(l,O),A)||!gr(O.methods,w)||!gr(O.events,b))&&(u=!1)}),u):!1}function qi(o){return At(o,!1)&&o.includes(":")?o.split(":").length===2:!1}function m0(o){if(At(o,!1)&&o.includes(":")){const e=o.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&qi(r)}}return!1}function w0(o){if(At(o,!1))try{return typeof new URL(o)<"u"}catch{return!1}return!1}function _0(o){var e;return(e=o==null?void 0:o.proposer)==null?void 0:e.publicKey}function b0(o){return o==null?void 0:o.topic}function E0(o,e){let r=null;return At(o==null?void 0:o.publicKey,!1)||(r=C("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function hh(o){let e=!0;return yr(o)?o.length&&(e=o.every(r=>At(r,!1))):e=!1,e}function I0(o,e,r){let i=null;return yr(e)&&e.length?e.forEach(a=>{i||qi(a)||(i=It("UNSUPPORTED_CHAINS",`${r}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):qi(o)||(i=It("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function P0(o,e,r){let i=null;return Object.entries(o).forEach(([a,u])=>{if(i)return;const l=I0(a,hl(a,u),`${e} ${r}`);l&&(i=l)}),i}function S0(o,e){let r=null;return yr(o)?o.forEach(i=>{r||m0(i)||(r=It("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=It("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function O0(o,e){let r=null;return Object.values(o).forEach(i=>{if(r)return;const a=S0(i==null?void 0:i.accounts,`${e} namespace`);a&&(r=a)}),r}function N0(o,e){let r=null;return hh(o==null?void 0:o.methods)?hh(o==null?void 0:o.events)||(r=It("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=It("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function ml(o,e){let r=null;return Object.values(o).forEach(i=>{if(r)return;const a=N0(i,`${e}, namespace`);a&&(r=a)}),r}function A0(o,e,r){let i=null;if(o&&Hr(o)){const a=ml(o,e);a&&(i=a);const u=P0(o,e,r);u&&(i=u)}else i=C("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function Di(o,e){let r=null;if(o&&Hr(o)){const i=ml(o,e);i&&(r=i);const a=O0(o,e);a&&(r=a)}else r=C("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function wl(o){return At(o.protocol,!0)}function R0(o,e){let r=!1;return o?o&&yr(o)&&o.length&&o.forEach(i=>{r=wl(i)}):r=!0,r}function x0(o){return typeof o=="number"}function Wt(o){return typeof o<"u"&&typeof o!==null}function T0(o){return!(!o||typeof o!="object"||!o.code||!ra(o.code)||!o.message||!At(o.message,!1))}function C0(o){return!(Ft(o)||!At(o.method,!1))}function D0(o){return!(Ft(o)||Ft(o.result)&&Ft(o.error)||!ra(o.id)||!At(o.jsonrpc,!1))}function $0(o){return!(Ft(o)||!At(o.name,!1))}function lh(o,e){return!(!qi(e)||!l0(o).includes(e))}function j0(o,e,r){return At(r,!1)?p0(o,e).includes(r):!1}function q0(o,e,r){return At(r,!1)?f0(o,e).includes(r):!1}function ph(o,e,r){let i=null;const a=U0(o),u=M0(e),l=Object.keys(a),d=Object.keys(u),w=fh(Object.keys(o)),b=fh(Object.keys(e)),A=w.filter(O=>!b.includes(O));return A.length&&(i=C("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${A.toString()}
      Received: ${Object.keys(e).toString()}`)),gr(l,d)||(i=C("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${l.toString()}
      Approved: ${d.toString()}`)),Object.keys(e).forEach(O=>{if(!O.includes(":")||i)return;const R=Gr(e[O].accounts);R.includes(O)||(i=C("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${O}
        Required: ${O}
        Approved: ${R.toString()}`))}),l.forEach(O=>{i||(gr(a[O].methods,u[O].methods)?gr(a[O].events,u[O].events)||(i=C("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${O}`)):i=C("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${O}`))}),i}function U0(o){const e={};return Object.keys(o).forEach(r=>{var i;r.includes(":")?e[r]=o[r]:(i=o[r].chains)==null||i.forEach(a=>{e[a]={methods:o[r].methods,events:o[r].events}})}),e}function fh(o){return[...new Set(o.map(e=>e.includes(":")?e.split(":")[0]:e))]}function M0(o){const e={};return Object.keys(o).forEach(r=>{if(r.includes(":"))e[r]=o[r];else{const i=Gr(o[r].accounts);i==null||i.forEach(a=>{e[a]={accounts:o[r].accounts.filter(u=>u.includes(`${a}:`)),methods:o[r].methods,events:o[r].events}})}}),e}function L0(o,e){return ra(o)&&o<=e.max&&o>=e.min}function dh(){const o=Dn();return new Promise(e=>{switch(o){case ee.browser:e(z0());break;case ee.reactNative:e(k0());break;case ee.node:e(H0());break;default:e(!0)}})}function z0(){return Fr()&&(navigator==null?void 0:navigator.onLine)}async function k0(){if(Wr()&&typeof tt.global<"u"&&tt.global!=null&&tt.global.NetInfo){const o=await(tt.global==null?void 0:tt.global.NetInfo.fetch());return o==null?void 0:o.isConnected}return!0}function H0(){return!0}function V0(o){switch(Dn()){case ee.browser:K0(o);break;case ee.reactNative:B0(o);break}}function K0(o){!Wr()&&Fr()&&(window.addEventListener("online",()=>o(!0)),window.addEventListener("offline",()=>o(!1)))}function B0(o){var e;Wr()&&typeof tt.global<"u"&&tt.global!=null&&tt.global.NetInfo&&((e=tt.global)==null||e.NetInfo.addEventListener(r=>o(r==null?void 0:r.isConnected)))}const vo={};let Ni=class{static get(o){return vo[o]}static set(o,e){vo[o]=e}static delete(o){delete vo[o]}};class Ve extends Dw{constructor(e){super(e),this.events=new Ie.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(zr(e.method,e.params||[],e.id||il().toString()),r)}async requestStrict(e,r){return new Promise(async(i,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${e.id}`,u=>{Re(u)?a(u.error):i(u.result)});try{await this.connection.send(e,r)}catch(u){a(u)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),ki(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}function W0(o,e){if(o.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var a=0;a<o.length;a++){var u=o.charAt(a),l=u.charCodeAt(0);if(r[l]!==255)throw new TypeError(u+" is ambiguous");r[l]=a}var d=o.length,w=o.charAt(0),b=Math.log(d)/Math.log(256),A=Math.log(256)/Math.log(d);function O(x){if(x instanceof Uint8Array||(ArrayBuffer.isView(x)?x=new Uint8Array(x.buffer,x.byteOffset,x.byteLength):Array.isArray(x)&&(x=Uint8Array.from(x))),!(x instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(x.length===0)return"";for(var $=0,F=0,Z=0,_t=x.length;Z!==_t&&x[Z]===0;)Z++,$++;for(var rt=(_t-Z)*A+1>>>0,X=new Uint8Array(rt);Z!==_t;){for(var ot=x[Z],Rt=0,gt=rt-1;(ot!==0||Rt<F)&&gt!==-1;gt--,Rt++)ot+=256*X[gt]>>>0,X[gt]=ot%d>>>0,ot=ot/d>>>0;if(ot!==0)throw new Error("Non-zero carry");F=Rt,Z++}for(var yt=rt-F;yt!==rt&&X[yt]===0;)yt++;for(var Pe=w.repeat($);yt<rt;++yt)Pe+=o.charAt(X[yt]);return Pe}function R(x){if(typeof x!="string")throw new TypeError("Expected String");if(x.length===0)return new Uint8Array;var $=0;if(x[$]!==" "){for(var F=0,Z=0;x[$]===w;)F++,$++;for(var _t=(x.length-$)*b+1>>>0,rt=new Uint8Array(_t);x[$];){var X=r[x.charCodeAt($)];if(X===255)return;for(var ot=0,Rt=_t-1;(X!==0||ot<Z)&&Rt!==-1;Rt--,ot++)X+=d*rt[Rt]>>>0,rt[Rt]=X%256>>>0,X=X/256>>>0;if(X!==0)throw new Error("Non-zero carry");Z=ot,$++}if(x[$]!==" "){for(var gt=_t-Z;gt!==_t&&rt[gt]===0;)gt++;for(var yt=new Uint8Array(F+(_t-gt)),Pe=F;gt!==_t;)yt[Pe++]=rt[gt++];return yt}}}function M(x){var $=R(x);if($)return $;throw new Error(`Non-${e} character`)}return{encode:O,decodeUnsafe:R,decode:M}}var F0=W0,G0=F0;const _l=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},Q0=o=>new TextEncoder().encode(o),Y0=o=>new TextDecoder().decode(o);class J0{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class X0{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return bl(this,e)}}class Z0{constructor(e){this.decoders=e}or(e){return bl(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const bl=(o,e)=>new Z0({...o.decoders||{[o.prefix]:o},...e.decoders||{[e.prefix]:e}});class tE{constructor(e,r,i,a){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=a,this.encoder=new J0(e,r,i),this.decoder=new X0(e,r,a)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Vi=({name:o,prefix:e,encode:r,decode:i})=>new tE(o,e,r,i),$n=({prefix:o,name:e,alphabet:r})=>{const{encode:i,decode:a}=G0(r,e);return Vi({prefix:o,name:e,encode:i,decode:u=>_l(a(u))})},eE=(o,e,r,i)=>{const a={};for(let A=0;A<e.length;++A)a[e[A]]=A;let u=o.length;for(;o[u-1]==="=";)--u;const l=new Uint8Array(u*r/8|0);let d=0,w=0,b=0;for(let A=0;A<u;++A){const O=a[o[A]];if(O===void 0)throw new SyntaxError(`Non-${i} character`);w=w<<r|O,d+=r,d>=8&&(d-=8,l[b++]=255&w>>d)}if(d>=r||255&w<<8-d)throw new SyntaxError("Unexpected end of data");return l},rE=(o,e,r)=>{const i=e[e.length-1]==="=",a=(1<<r)-1;let u="",l=0,d=0;for(let w=0;w<o.length;++w)for(d=d<<8|o[w],l+=8;l>r;)l-=r,u+=e[a&d>>l];if(l&&(u+=e[a&d<<r-l]),i)for(;u.length*r&7;)u+="=";return u},Ct=({name:o,prefix:e,bitsPerChar:r,alphabet:i})=>Vi({prefix:e,name:o,encode(a){return rE(a,i,r)},decode(a){return eE(a,i,r,o)}}),nE=Vi({prefix:"\0",name:"identity",encode:o=>Y0(o),decode:o=>Q0(o)});var iE=Object.freeze({__proto__:null,identity:nE});const sE=Ct({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var oE=Object.freeze({__proto__:null,base2:sE});const aE=Ct({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var cE=Object.freeze({__proto__:null,base8:aE});const uE=$n({prefix:"9",name:"base10",alphabet:"0123456789"});var hE=Object.freeze({__proto__:null,base10:uE});const lE=Ct({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),pE=Ct({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var fE=Object.freeze({__proto__:null,base16:lE,base16upper:pE});const dE=Ct({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),gE=Ct({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),yE=Ct({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),vE=Ct({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),mE=Ct({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),wE=Ct({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),_E=Ct({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),bE=Ct({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),EE=Ct({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var IE=Object.freeze({__proto__:null,base32:dE,base32upper:gE,base32pad:yE,base32padupper:vE,base32hex:mE,base32hexupper:wE,base32hexpad:_E,base32hexpadupper:bE,base32z:EE});const PE=$n({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),SE=$n({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var OE=Object.freeze({__proto__:null,base36:PE,base36upper:SE});const NE=$n({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),AE=$n({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var RE=Object.freeze({__proto__:null,base58btc:NE,base58flickr:AE});const xE=Ct({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),TE=Ct({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),CE=Ct({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),DE=Ct({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var $E=Object.freeze({__proto__:null,base64:xE,base64pad:TE,base64url:CE,base64urlpad:DE});const El=Array.from(""),jE=El.reduce((o,e,r)=>(o[r]=e,o),[]),qE=El.reduce((o,e,r)=>(o[e.codePointAt(0)]=r,o),[]);function UE(o){return o.reduce((e,r)=>(e+=jE[r],e),"")}function ME(o){const e=[];for(const r of o){const i=qE[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const LE=Vi({prefix:"",name:"base256emoji",encode:UE,decode:ME});var zE=Object.freeze({__proto__:null,base256emoji:LE}),kE=Il,gh=128,HE=127,VE=~HE,KE=Math.pow(2,31);function Il(o,e,r){e=e||[],r=r||0;for(var i=r;o>=KE;)e[r++]=o&255|gh,o/=128;for(;o&VE;)e[r++]=o&255|gh,o>>>=7;return e[r]=o|0,Il.bytes=r-i+1,e}var BE=jo,WE=128,yh=127;function jo(o,i){var r=0,i=i||0,a=0,u=i,l,d=o.length;do{if(u>=d)throw jo.bytes=0,new RangeError("Could not decode varint");l=o[u++],r+=a<28?(l&yh)<<a:(l&yh)*Math.pow(2,a),a+=7}while(l>=WE);return jo.bytes=u-i,r}var FE=Math.pow(2,7),GE=Math.pow(2,14),QE=Math.pow(2,21),YE=Math.pow(2,28),JE=Math.pow(2,35),XE=Math.pow(2,42),ZE=Math.pow(2,49),tI=Math.pow(2,56),eI=Math.pow(2,63),rI=function(o){return o<FE?1:o<GE?2:o<QE?3:o<YE?4:o<JE?5:o<XE?6:o<ZE?7:o<tI?8:o<eI?9:10},nI={encode:kE,decode:BE,encodingLength:rI},Pl=nI;const vh=(o,e,r=0)=>(Pl.encode(o,e,r),e),mh=o=>Pl.encodingLength(o),qo=(o,e)=>{const r=e.byteLength,i=mh(o),a=i+mh(r),u=new Uint8Array(a+r);return vh(o,u,0),vh(r,u,i),u.set(e,a),new iI(o,r,e,u)};class iI{constructor(e,r,i,a){this.code=e,this.size=r,this.digest=i,this.bytes=a}}const Sl=({name:o,code:e,encode:r})=>new sI(o,e,r);class sI{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?qo(this.code,r):r.then(i=>qo(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Ol=o=>async e=>new Uint8Array(await crypto.subtle.digest(o,e)),oI=Sl({name:"sha2-256",code:18,encode:Ol("SHA-256")}),aI=Sl({name:"sha2-512",code:19,encode:Ol("SHA-512")});var cI=Object.freeze({__proto__:null,sha256:oI,sha512:aI});const Nl=0,uI="identity",Al=_l,hI=o=>qo(Nl,Al(o)),lI={code:Nl,name:uI,encode:Al,digest:hI};var pI=Object.freeze({__proto__:null,identity:lI});new TextEncoder,new TextDecoder;const wh={...iE,...oE,...cE,...hE,...fE,...IE,...OE,...RE,...$E,...zE};({...cI,...pI});function Rl(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function fI(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Rl(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function xl(o,e,r,i){return{name:o,prefix:e,encoder:{name:o,prefix:e,encode:r},decoder:{decode:i}}}const _h=xl("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),mo=xl("ascii","a",o=>{let e="a";for(let r=0;r<o.length;r++)e+=String.fromCharCode(o[r]);return e},o=>{o=o.substring(1);const e=fI(o.length);for(let r=0;r<o.length;r++)e[r]=o.charCodeAt(r);return e}),dI={utf8:_h,"utf-8":_h,hex:wh.base16,latin1:mo,ascii:mo,binary:mo,...wh};function gI(o,e="utf8"){const r=dI[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Rl(globalThis.Buffer.from(o,"utf-8")):r.decoder.decode(`${r.prefix}${o}`)}const Tl="wc",yI=2,na="core",rr=`${Tl}@2:${na}:`,vI={name:na,logger:"error"},mI={database:":memory:"},wI="crypto",bh="client_ed25519_seed",_I=U.ONE_DAY,bI="keychain",EI="0.3",II="messages",PI="0.3",SI=U.SIX_HOURS,OI="publisher",Cl="irn",NI="error",Dl="wss://relay.walletconnect.com",Eh="wss://relay.walletconnect.org",AI="relayer",qt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},RI="_subscription",ke={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},xI=U.ONE_SECOND,TI="2.11.0",CI=1e4,DI="0.3",$I="WALLETCONNECT_CLIENT_ID",_e={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},jI="subscription",qI="0.3",UI=U.FIVE_SECONDS*1e3,MI="pairing",LI="0.3",En={wc_pairingDelete:{req:{ttl:U.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:U.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:U.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:U.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:U.ONE_DAY,prompt:!1,tag:0},res:{ttl:U.ONE_DAY,prompt:!1,tag:0}}},An={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Ae={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},zI="history",kI="0.3",HI="expirer",pe={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},VI="0.3",wo="verify-api",Lr="https://verify.walletconnect.com",Uo="https://verify.walletconnect.org",KI=[Lr,Uo],BI="echo",WI="https://echo.walletconnect.com";class FI{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=bI,this.version=EI,this.initialized=!1,this.storagePrefix=rr,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,a)=>{this.isInitialized(),this.keychain.set(i,a),await this.persist()},this.get=i=>{this.isInitialized();const a=this.keychain.get(i);if(typeof a>"u"){const{message:u}=C("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(u)}return a},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=Gt(r,this.name)}get context(){return re(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,dl(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?gl(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class GI{constructor(e,r,i){this.core=e,this.logger=r,this.name=wI,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=zu(a);return Uw(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=Cb();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),l=zu(u),d=Do();return await Mw(d,a,_I,l)},this.generateSharedKey=(a,u,l)=>{this.isInitialized();const d=this.getPrivateKey(a),w=Db(d,u);return this.setSymKey(w,l)},this.setSymKey=async(a,u)=>{this.isInitialized();const l=u||$b(a);return await this.keychain.set(l,a),l},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,l)=>{this.isInitialized();const d=fl(l),w=Go(u);if(nh(d)){const R=d.senderPublicKey,M=d.receiverPublicKey;a=await this.generateSharedKey(R,M)}const b=this.getSymKey(a),{type:A,senderPublicKey:O}=d;return qb({type:A,symKey:b,message:w,senderPublicKey:O})},this.decode=async(a,u,l)=>{this.isInitialized();const d=Lb(u,l);if(nh(d)){const w=d.receiverPublicKey,b=d.senderPublicKey;a=await this.generateSharedKey(w,b)}try{const w=this.getSymKey(a),b=Ub({symKey:w,encoded:u});return Fo(b)}catch(w){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(w)}},this.getPayloadType=a=>{const u=ji(a);return Cn(u.type)},this.getPayloadSenderPublicKey=a=>{const u=ji(a);return u.senderPublicKey?fe(u.senderPublicKey,zt):void 0},this.core=e,this.logger=Gt(r,this.name),this.keychain=i||new FI(this.core,this.logger)}get context(){return re(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(bh)}catch{e=Do(),await this.keychain.set(bh,e)}return gI(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class QI extends G_{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=II,this.version=PI,this.initialized=!1,this.storagePrefix=rr,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,a)=>{this.isInitialized();const u=kr(a);let l=this.messages.get(i);return typeof l>"u"&&(l={}),typeof l[u]<"u"||(l[u]=a,this.messages.set(i,l),await this.persist()),u},this.get=i=>{this.isInitialized();let a=this.messages.get(i);return typeof a>"u"&&(a={}),a},this.has=(i,a)=>{this.isInitialized();const u=this.get(i),l=kr(a);return typeof u[l]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=Gt(e,this.name),this.core=r}get context(){return re(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,dl(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?gl(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class YI extends Q_{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new Ie.EventEmitter,this.name=OI,this.queue=new Map,this.publishTimeout=U.toMiliseconds(U.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(i,a,u)=>{var l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:a,opts:u}});try{const d=(u==null?void 0:u.ttl)||SI,w=$o(u),b=(u==null?void 0:u.prompt)||!1,A=(u==null?void 0:u.tag)||0,O=(u==null?void 0:u.id)||il().toString(),R={topic:i,message:a,opts:{ttl:d,relay:w,prompt:b,tag:A,id:O}},M=setTimeout(()=>this.queue.set(O,R),this.publishTimeout);try{await await Tn(this.rpcPublish(i,a,d,w,b,A,O),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(O),this.relayer.events.emit(qt.publish,R)}catch(x){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(l=u==null?void 0:u.internal)!=null&&l.throwOnFailedPublish)throw this.removeRequestFromQueue(O),x;return}finally{clearTimeout(M)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:a,opts:u}})}catch(d){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(d),d}},this.on=(i,a)=>{this.events.on(i,a)},this.once=(i,a)=>{this.events.once(i,a)},this.off=(i,a)=>{this.events.off(i,a)},this.removeListener=(i,a)=>{this.events.removeListener(i,a)},this.relayer=e,this.logger=Gt(r,this.name),this.registerEventListeners()}get context(){return re(this.logger)}rpcPublish(e,r,i,a,u,l,d){var w,b,A,O;const R={method:Ci(a.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:u,tag:l},id:d};return Ft((w=R.params)==null?void 0:w.prompt)&&((b=R.params)==null||delete b.prompt),Ft((A=R.params)==null?void 0:A.tag)&&((O=R.params)==null||delete O.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:R}),this.relayer.request(R)}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:a}=e;await this.publish(r,i,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(Kr.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(qt.connection_stalled);return}this.checkQueue()}),this.relayer.on(qt.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}class JI{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const a=i.filter(u=>u!==r);if(!a.length){this.map.delete(e);return}this.map.set(e,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var XI=Object.defineProperty,ZI=Object.defineProperties,tP=Object.getOwnPropertyDescriptors,Ih=Object.getOwnPropertySymbols,eP=Object.prototype.hasOwnProperty,rP=Object.prototype.propertyIsEnumerable,Ph=(o,e,r)=>e in o?XI(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,In=(o,e)=>{for(var r in e||(e={}))eP.call(e,r)&&Ph(o,r,e[r]);if(Ih)for(var r of Ih(e))rP.call(e,r)&&Ph(o,r,e[r]);return o},_o=(o,e)=>ZI(o,tP(e));class nP extends X_{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new JI,this.events=new Ie.EventEmitter,this.name=jI,this.version=qI,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=rr,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(i,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:a}});try{const u=$o(a),l={topic:i,relay:u};this.pending.set(i,l);const d=await this.rpcSubscribe(i,u);return this.onSubscribe(d,l),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:a}}),d}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(i,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(i,a.id,a):await this.unsubscribeByTopic(i,a)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((a,u)=>{const l=new U.Watch;l.start(this.pendingSubscriptionWatchLabel);const d=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(d),l.stop(this.pendingSubscriptionWatchLabel),a(!0)),l.elapsed(this.pendingSubscriptionWatchLabel)>=UI&&(clearInterval(d),l.stop(this.pendingSubscriptionWatchLabel),u(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(i,a)=>{this.events.on(i,a)},this.once=(i,a)=>{this.events.once(i,a)},this.off=(i,a)=>{this.events.off(i,a)},this.removeListener=(i,a)=>{this.events.removeListener(i,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=Gt(r,this.name),this.clientId=""}get context(){return re(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async a=>await this.unsubscribeById(e,a,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const a=$o(i);await this.rpcUnsubscribe(e,r,a);const u=It("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(e,r){const i={method:Ci(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await Tn(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(qt.connection_stalled)}return kr(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:Ci(r.protocol).batchSubscribe,params:{topics:e.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await await Tn(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(qt.connection_stalled)}}rpcUnsubscribe(e,r,i){const a={method:Ci(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(e,r){this.setSubscription(e,_o(In({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,In({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,In({},r)),this.topicMap.set(r.topic,e),this.events.emit(_e.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=C("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(_e.deleted,_o(In({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(_e.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<e;r++){const i=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(_e.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const r=await this.rpcBatchSubscribe(e);yr(r)&&this.onBatchSubscribe(r.map((i,a)=>_o(In({},e[a]),{id:i})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(r=>{e.push(r)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(Kr.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(qt.connect,async()=>{await this.onConnect()}),this.relayer.on(qt.disconnect,()=>{this.onDisconnect()}),this.events.on(_e.created,async e=>{const r=_e.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(_e.deleted,async e=>{const r=_e.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),e())},this.pollingInterval)})}}var iP=Object.defineProperty,Sh=Object.getOwnPropertySymbols,sP=Object.prototype.hasOwnProperty,oP=Object.prototype.propertyIsEnumerable,Oh=(o,e,r)=>e in o?iP(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,aP=(o,e)=>{for(var r in e||(e={}))sP.call(e,r)&&Oh(o,r,e[r]);if(Sh)for(var r of Sh(e))oP.call(e,r)&&Oh(o,r,e[r]);return o};class cP extends Y_{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new Ie.EventEmitter,this.name=AI,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(i){throw this.logger.debug("Failed to Publish Request"),this.logger.error(i),i}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(qt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(qt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ke.payload,this.onPayloadHandler),this.provider.on(ke.connect,this.onConnectHandler),this.provider.on(ke.disconnect,this.onDisconnectHandler),this.provider.on(ke.error,this.onProviderErrorHandler)},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Gt(e.logger,this.name):Mi(Li({level:e.logger||NI})),this.messages=new QI(this.logger,e.core),this.subscriber=new nP(this,this.logger),this.publisher=new YI(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Dl,this.projectId=e.projectId,this.bundleId=Bb(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Eh}...`),await this.restartTransport(Eh)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},CI)}get context(){return re(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now()})}async subscribe(e,r){var i;this.isInitialized();let a=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"";if(a)return a;let u;const l=d=>{d.topic===e&&(this.subscriber.off(_e.created,l),u())};return await Promise.all([new Promise(d=>{u=d,this.subscriber.on(_e.created,l)}),new Promise(async d=>{a=await this.subscriber.subscribe(e,r),d()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Tn(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(e){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(_e.resubscribed,()=>{r()})}),new Promise(async(r,i)=>{try{await Tn(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){i(a);return}r()})])}catch(r){this.logger.error(r);const i=r;if(!this.isConnectionStalled(i.message))throw r;this.provider.events.emit(ke.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(e){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await dh())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(e){return this.staleConnectionErrors.some(r=>e.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Ve(new Lw(Jb({sdkVersion:TI,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,i);return a&&this.logger.debug(`Ignoring duplicate message: ${i}`),a}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Bo(e)){if(!e.method.endsWith(RI))return;const r=e.params,{topic:i,message:a,publishedAt:u}=r.data,l={topic:i,message:a,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(aP({type:"event",event:r.id},l)),this.events.emit(r.id,l),await this.acknowledgePayload(e),await this.onMessageEvent(l)}else ki(e)&&this.events.emit(qt.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(qt.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=zi(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ke.payload,this.onPayloadHandler),this.provider.off(ke.connect,this.onConnectHandler),this.provider.off(ke.disconnect,this.onDisconnectHandler),this.provider.off(ke.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(qt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let e=await dh();V0(async r=>{this.initialized&&e!==r&&(e=r,r?await this.restartTransport().catch(i=>this.logger.error(i)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(i=>this.logger.error(i))))})}onProviderDisconnect(){this.events.emit(qt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(e=>this.logger.error(e))},U.toMiliseconds(xI)))}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(e=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var uP=Object.defineProperty,Nh=Object.getOwnPropertySymbols,hP=Object.prototype.hasOwnProperty,lP=Object.prototype.propertyIsEnumerable,Ah=(o,e,r)=>e in o?uP(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,Rh=(o,e)=>{for(var r in e||(e={}))hP.call(e,r)&&Ah(o,r,e[r]);if(Nh)for(var r of Nh(e))lP.call(e,r)&&Ah(o,r,e[r]);return o};class Ki extends J_{constructor(e,r,i,a=rr,u=void 0){super(e,r,i,a),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=DI,this.cached=[],this.initialized=!1,this.storagePrefix=rr,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(l=>{this.getKey&&l!==null&&!Ft(l)?this.map.set(this.getKey(l),l):_0(l)?this.map.set(l.id,l):b0(l)&&this.map.set(l.topic,l)}),this.cached=[],this.initialized=!0)},this.set=async(l,d)=>{this.isInitialized(),this.map.has(l)?await this.update(l,d):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:l,value:d}),this.map.set(l,d),await this.persist())},this.get=l=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:l}),this.getData(l)),this.getAll=l=>(this.isInitialized(),l?this.values.filter(d=>Object.keys(l).every(w=>jw(d[w],l[w]))):this.values),this.update=async(l,d)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:l,update:d});const w=Rh(Rh({},this.getData(l)),d);this.map.set(l,w),await this.persist()},this.delete=async(l,d)=>{this.isInitialized(),this.map.has(l)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:l,reason:d}),this.map.delete(l),await this.persist())},this.logger=Gt(r,this.name),this.storagePrefix=a,this.getKey=u}get context(){return re(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:i}=C("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class pP{constructor(e,r){this.core=e,this.logger=r,this.name=MI,this.version=LI,this.events=new Ho,this.initialized=!1,this.storagePrefix=rr,this.ignoredPayloadTypes=[_r],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=Do(),a=await this.core.crypto.setSymKey(i),u=be(U.FIVE_MINUTES),l={protocol:Cl},d={topic:a,expiry:u,relay:l,active:!1},w=h0({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:i,relay:l});return await this.pairings.set(a,d),await this.core.relayer.subscribe(a),this.core.expirer.set(a,u),{topic:a,uri:w}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:a,symKey:u,relay:l}=uh(i.uri);let d;if(this.pairings.keys.includes(a)&&(d=this.pairings.get(a),d.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const w=be(U.FIVE_MINUTES),b={topic:a,relay:l,expiry:w,active:!1};return await this.pairings.set(a,b),this.core.expirer.set(a,w),i.activatePairing&&await this.activate({topic:a}),this.events.emit(An.create,b),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(u,a),await this.core.relayer.subscribe(a,{relay:l})),b},this.activate=async({topic:i})=>{this.isInitialized();const a=be(U.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:a}),this.core.expirer.set(i,a)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:a}=i;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:l,resolve:d,reject:w}=Mr();this.events.once(Pt("pairing_ping",u),({error:b})=>{b?w(b):d()}),await l()}},this.updateExpiry=async({topic:i,expiry:a})=>{this.isInitialized(),await this.pairings.update(i,{expiry:a})},this.updateMetadata=async({topic:i,metadata:a})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:a}=i;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",It("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(i,a,u)=>{const l=zr(a,u),d=await this.core.crypto.encode(i,l),w=En[a].req;return this.core.history.set(i,l),this.core.relayer.publish(i,d,w),l.id},this.sendResult=async(i,a,u)=>{const l=zi(i,u),d=await this.core.crypto.encode(a,l),w=await this.core.history.get(a,i),b=En[w.request.method].res;await this.core.relayer.publish(a,d,b),await this.core.history.resolve(l)},this.sendError=async(i,a,u)=>{const l=Ko(i,u),d=await this.core.crypto.encode(a,l),w=await this.core.history.get(a,i),b=En[w.request.method]?En[w.request.method].res:En.unregistered_method.res;await this.core.relayer.publish(a,d,b),await this.core.history.resolve(l)},this.deletePairing=async(i,a)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,It("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),a?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(a=>er(a.expiry));await Promise.all(i.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=i=>{const{topic:a,payload:u}=i;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async i=>{const{topic:a,payload:u}=i,l=(await this.core.history.get(a,u.id)).request.method;switch(l){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(l)}},this.onPairingPingRequest=async(i,a)=>{const{id:u}=a;try{this.isValidPing({topic:i}),await this.sendResult(u,i,!0),this.events.emit(An.ping,{id:u,topic:i})}catch(l){await this.sendError(u,i,l),this.logger.error(l)}},this.onPairingPingResponse=(i,a)=>{const{id:u}=a;setTimeout(()=>{tr(a)?this.events.emit(Pt("pairing_ping",u),{}):Re(a)&&this.events.emit(Pt("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(i,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(An.delete,{id:u,topic:i})}catch(l){await this.sendError(u,i,l),this.logger.error(l)}},this.onUnknownRpcMethodRequest=async(i,a)=>{const{id:u,method:l}=a;try{if(this.registeredMethods.includes(l))return;const d=It("WC_METHOD_UNSUPPORTED",l);await this.sendError(u,i,d),this.logger.error(d)}catch(d){await this.sendError(u,i,d),this.logger.error(d)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(It("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{var a;if(!Wt(i)){const{message:l}=C("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(l)}if(!w0(i.uri)){const{message:l}=C("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(l)}const u=uh(i.uri);if(!((a=u==null?void 0:u.relay)!=null&&a.protocol)){const{message:l}=C("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(l)}if(!(u!=null&&u.symKey)){const{message:l}=C("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(l)}},this.isValidPing=async i=>{if(!Wt(i)){const{message:u}=C("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(u)}const{topic:a}=i;await this.isValidPairingTopic(a)},this.isValidDisconnect=async i=>{if(!Wt(i)){const{message:u}=C("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(u)}const{topic:a}=i;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async i=>{if(!At(i,!1)){const{message:a}=C("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(a)}if(!this.pairings.keys.includes(i)){const{message:a}=C("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(a)}if(er(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:a}=C("EXPIRED",`pairing topic: ${i}`);throw new Error(a)}},this.core=e,this.logger=Gt(r,this.name),this.pairings=new Ki(this.core,this.logger,this.name,this.storagePrefix)}get context(){return re(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(qt.message,async e=>{const{topic:r,message:i}=e;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const a=await this.core.crypto.decode(r,i);try{Bo(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):ki(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on(pe.expired,async e=>{const{topic:r}=vl(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(An.expire,{topic:r}))})}}class fP extends F_{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new Ie.EventEmitter,this.name=zI,this.version=kI,this.cached=[],this.initialized=!1,this.storagePrefix=rr,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:a,chainId:u}),this.records.has(a.id))return;const l={id:a.id,topic:i,request:{method:a.method,params:a.params||null},chainId:u,expiry:be(U.THIRTY_DAYS)};this.records.set(l.id,l),this.events.emit(Ae.created,l)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const a=await this.getRecord(i.id);typeof a.response>"u"&&(a.response=Re(i)?{error:i.error}:{result:i.result},this.records.set(a.id,a),this.events.emit(Ae.updated,a))},this.get=async(i,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:a}),await this.getRecord(a)),this.delete=(i,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===i){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(Ae.deleted,u)}})},this.exists=async(i,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===i:!1),this.on=(i,a)=>{this.events.on(i,a)},this.once=(i,a)=>{this.events.once(i,a)},this.off=(i,a)=>{this.events.off(i,a)},this.removeListener=(i,a)=>{this.events.removeListener(i,a)},this.logger=Gt(r,this.name)}get context(){return re(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:zr(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=C("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Ae.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Ae.created,e=>{const r=Ae.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Ae.updated,e=>{const r=Ae.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Ae.deleted,e=>{const r=Ae.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.core.heartbeat.on(Kr.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{U.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class dP extends Z_{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new Ie.EventEmitter,this.name=HI,this.version=VI,this.cached=[],this.initialized=!1,this.storagePrefix=rr,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const a=this.formatTarget(i);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(i,a)=>{this.isInitialized();const u=this.formatTarget(i),l={target:u,expiry:a};this.expirations.set(u,l),this.checkExpiry(u,l),this.events.emit(pe.created,{target:u,expiration:l})},this.get=i=>{this.isInitialized();const a=this.formatTarget(i);return this.getExpiration(a)},this.del=i=>{if(this.isInitialized(),this.has(i)){const a=this.formatTarget(i),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit(pe.deleted,{target:a,expiration:u})}},this.on=(i,a)=>{this.events.on(i,a)},this.once=(i,a)=>{this.events.once(i,a)},this.off=(i,a)=>{this.events.off(i,a)},this.removeListener=(i,a)=>{this.events.removeListener(i,a)},this.logger=Gt(r,this.name)}get context(){return re(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Xb(e);if(typeof e=="number")return Zb(e);const{message:r}=C("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(pe.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=C("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;U.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(pe.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Kr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(pe.created,e=>{const r=pe.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(pe.expired,e=>{const r=pe.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(pe.deleted,e=>{const r=pe.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class gP extends tb{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.name=wo,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async i=>{if(this.verifyDisabled||Wr()||!Fr())return;const a=this.getVerifyUrl(i==null?void 0:i.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Uo;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u),this.verifyDisabled=!0}}},this.register=async i=>{this.initialized?this.sendPost(i.attestationId):(this.addToQueue(i.attestationId),await this.init())},this.resolve=async i=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(i==null?void 0:i.verifyUrl);let u;try{u=await this.fetchAttestation(i.attestationId,a)}catch(l){this.logger.info(`failed to resolve attestation: ${i.attestationId} from url: ${a}`),this.logger.info(l),u=await this.fetchAttestation(i.attestationId,Uo)}return u},this.fetchAttestation=async(i,a)=>{this.logger.info(`resolving attestation: ${i} from url: ${a}`);const u=this.startAbortTimer(U.ONE_SECOND*2),l=await fetch(`${a}/attestation/${i}`,{signal:this.abortController.signal});return clearTimeout(u),l.status===200?await l.json():void 0},this.addToQueue=i=>{this.queue.push(i)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(i=>this.sendPost(i)),this.queue=[])},this.sendPost=i=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(i,"*"),this.logger.info(`postMessage sent: ${i} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let i;const a=u=>{u.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),i())};await Promise.race([new Promise(u=>{if(document.getElementById(wo))return u();window.addEventListener("message",a);const l=document.createElement("iframe");l.id=wo,l.src=`${this.verifyUrl}/${this.projectId}`,l.style.display="none",document.body.append(l),this.iframe=l,i=u}),new Promise((u,l)=>setTimeout(()=>{window.removeEventListener("message",a),l("verify iframe load timeout")},U.toMiliseconds(U.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=i=>{let a=i||Lr;return KI.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${Lr}`),a=Lr),a},this.logger=Gt(r,this.name),this.verifyUrl=Lr,this.abortController=new AbortController,this.isDevEnv=ta()&&tt.process.env.IS_VITEST}get context(){return re(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),U.toMiliseconds(e))}}class yP extends eb{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.context=BI,this.registerDeviceToken=async i=>{const{clientId:a,token:u,notificationType:l,enableEncrypted:d=!1}=i,w=`${WI}/${this.projectId}/clients`;await zw(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:l,token:u,always_raw:d})})},this.logger=Gt(r,this.context)}}var vP=Object.defineProperty,xh=Object.getOwnPropertySymbols,mP=Object.prototype.hasOwnProperty,wP=Object.prototype.propertyIsEnumerable,Th=(o,e,r)=>e in o?vP(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,Ch=(o,e)=>{for(var r in e||(e={}))mP.call(e,r)&&Th(o,r,e[r]);if(xh)for(var r of xh(e))wP.call(e,r)&&Th(o,r,e[r]);return o};class ia extends W_{constructor(e){super(e),this.protocol=Tl,this.version=yI,this.name=na,this.events=new Ie.EventEmitter,this.initialized=!1,this.on=(i,a)=>this.events.on(i,a),this.once=(i,a)=>this.events.once(i,a),this.off=(i,a)=>this.events.off(i,a),this.removeListener=(i,a)=>this.events.removeListener(i,a),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Dl,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Mi(Li({level:(e==null?void 0:e.logger)||vI.logger}));this.logger=Gt(r,this.name),this.heartbeat=new Kr.HeartBeat,this.crypto=new GI(this,this.logger,e==null?void 0:e.keychain),this.history=new fP(this,this.logger),this.expirer=new dP(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new __(Ch(Ch({},mI),e==null?void 0:e.storageOptions)),this.relayer=new cP({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new pP(this,this.logger),this.verify=new gP(this.projectId||"",this.logger),this.echoClient=new yP(this.projectId||"",this.logger)}static async init(e){const r=new ia(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem($I,i),r}get context(){return re(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const _P=ia,$l="wc",jl=2,ql="client",sa=`${$l}@${jl}:${ql}:`,bo={name:ql,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Dh="WALLETCONNECT_DEEPLINK_CHOICE",bP="proposal",Ul="Proposal expired",EP="session",Ai=U.SEVEN_DAYS,IP="engine",Pn={wc_sessionPropose:{req:{ttl:U.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:U.ONE_DAY,prompt:!1,tag:1104},res:{ttl:U.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:U.ONE_DAY,prompt:!1,tag:1106},res:{ttl:U.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:U.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:U.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:U.ONE_DAY,prompt:!1,tag:1112},res:{ttl:U.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:U.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:U.THIRTY_SECONDS,prompt:!1,tag:1115}}},Eo={min:U.FIVE_MINUTES,max:U.SEVEN_DAYS},He={idle:"IDLE",active:"ACTIVE"},PP="request",SP=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var OP=Object.defineProperty,NP=Object.defineProperties,AP=Object.getOwnPropertyDescriptors,$h=Object.getOwnPropertySymbols,RP=Object.prototype.hasOwnProperty,xP=Object.prototype.propertyIsEnumerable,jh=(o,e,r)=>e in o?OP(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,Bt=(o,e)=>{for(var r in e||(e={}))RP.call(e,r)&&jh(o,r,e[r]);if($h)for(var r of $h(e))xP.call(e,r)&&jh(o,r,e[r]);return o},Sn=(o,e)=>NP(o,AP(e));class TP extends nb{constructor(e){super(e),this.name=IP,this.events=new Ho,this.initialized=!1,this.ignoredPayloadTypes=[_r],this.requestQueue={state:He.idle,queue:[]},this.sessionRequestQueue={state:He.idle,queue:[]},this.requestQueueDelay=U.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Pn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},U.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const i=Sn(Bt({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:l,sessionProperties:d,relays:w}=i;let b=a,A,O=!1;if(b&&(O=this.client.core.pairing.pairings.get(b).active),!b||!O){const{topic:rt,uri:X}=await this.client.core.pairing.create();b=rt,A=X}const R=await this.client.core.crypto.generateKeyPair(),M=Bt({requiredNamespaces:u,optionalNamespaces:l,relays:w??[{protocol:Cl}],proposer:{publicKey:R,metadata:this.client.metadata}},d&&{sessionProperties:d}),{reject:x,resolve:$,done:F}=Mr(U.FIVE_MINUTES,Ul);if(this.events.once(Pt("session_connect"),async({error:rt,session:X})=>{if(rt)x(rt);else if(X){X.self.publicKey=R;const ot=Sn(Bt({},X),{requiredNamespaces:X.requiredNamespaces,optionalNamespaces:X.optionalNamespaces});await this.client.session.set(X.topic,ot),await this.setExpiry(X.topic,X.expiry),b&&await this.client.core.pairing.updateMetadata({topic:b,metadata:X.peer.metadata}),$(ot)}}),!b){const{message:rt}=C("NO_MATCHING_KEY",`connect() pairing topic: ${b}`);throw new Error(rt)}const Z=await this.sendRequest({topic:b,method:"wc_sessionPropose",params:M}),_t=be(U.FIVE_MINUTES);return await this.setProposal(Z,Bt({id:Z,expiry:_t},M)),{uri:A,approval:F}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:i,relayProtocol:a,namespaces:u,sessionProperties:l}=r,d=this.client.proposal.get(i);let{pairingTopic:w,proposer:b,requiredNamespaces:A,optionalNamespaces:O}=d;w=w||"",Hr(A)||(A=d0(u,"approve()"));const R=await this.client.core.crypto.generateKeyPair(),M=b.publicKey,x=await this.client.core.crypto.generateSharedKey(R,M);w&&i&&(await this.client.core.pairing.updateMetadata({topic:w,metadata:b.metadata}),await this.sendResult({id:i,topic:w,result:{relay:{protocol:a??"irn"},responderPublicKey:R}}),await this.client.proposal.delete(i,It("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}));const $=Bt({relay:{protocol:a??"irn"},namespaces:u,requiredNamespaces:A,optionalNamespaces:O,pairingTopic:w,controller:{publicKey:R,metadata:this.client.metadata},expiry:be(Ai)},l&&{sessionProperties:l});await this.client.core.relayer.subscribe(x),await this.sendRequest({topic:x,method:"wc_sessionSettle",params:$,throwOnFailedPublish:!0});const F=Sn(Bt({},$),{topic:x,pairingTopic:w,acknowledged:!1,self:$.controller,peer:{publicKey:b.publicKey,metadata:b.metadata},controller:R});return await this.client.session.set(x,F),await this.setExpiry(x,be(Ai)),{topic:x,acknowledged:()=>new Promise(Z=>setTimeout(()=>Z(this.client.session.get(x)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:i,reason:a}=r,{pairingTopic:u}=this.client.proposal.get(i);u&&(await this.sendError(i,u,a),await this.client.proposal.delete(i,It("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:i,namespaces:a}=r,u=await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:l,resolve:d,reject:w}=Mr();return this.events.once(Pt("session_update",u),({error:b})=>{b?w(b):d()}),await this.client.session.update(i,{namespaces:a}),{acknowledged:l}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:i}=r,a=await this.sendRequest({topic:i,method:"wc_sessionExtend",params:{}}),{done:u,resolve:l,reject:d}=Mr();return this.events.once(Pt("session_extend",a),({error:w})=>{w?d(w):l()}),await this.setExpiry(i,be(Ai)),{acknowledged:u}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:i,request:a,topic:u,expiry:l}=r,d=qw(),{done:w,resolve:b,reject:A}=Mr(l,"Request expired. Please try again.");return this.events.once(Pt("session_request",d),({error:O,result:R})=>{O?A(O):b(R)}),await Promise.all([new Promise(async O=>{await this.sendRequest({clientRpcId:d,topic:u,method:"wc_sessionRequest",params:{request:a,chainId:i},expiry:l,throwOnFailedPublish:!0}).catch(R=>A(R)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:i,id:d}),O()}),new Promise(async O=>{const R=await e0(this.client.core.storage,Dh);t0({id:d,topic:u,wcDeepLink:R}),O()}),w()]).then(O=>O[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:a}=r,{id:u}=a;tr(a)?await this.sendResult({id:u,topic:i,result:a.result,throwOnFailedPublish:!0}):Re(a)&&await this.sendError(u,i,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const a=await this.sendRequest({topic:i,method:"wc_sessionPing",params:{}}),{done:u,resolve:l,reject:d}=Mr();this.events.once(Pt("session_ping",a),({error:w})=>{w?d(w):l()}),await u()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:a,chainId:u}=r;await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:a,chainId:u}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.client.session.keys.includes(i)?(await this.sendRequest({topic:i,method:"wc_sessionDelete",params:It("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>v0(i,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var l,d;return((l=u.peerMetadata)==null?void 0:l.url)&&((d=u.peerMetadata)==null?void 0:d.url)===r.peer.metadata.url&&u.topic&&u.topic!==i.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}},this.deleteSession=async(r,i)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,It("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),i||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Dh).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===r&&this.deletePendingSessionRequest(u.id,It("USER_DISCONNECTED"))})},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,It("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,i,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==r),a&&(this.sessionRequestQueue.state=He.idle)},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,i.expiry)},this.setPendingSessionRequest=async r=>{const i=Pn.wc_sessionRequest.req.ttl,{id:a,topic:u,params:l,verifyContext:d}=r;await this.client.pendingRequest.set(a,{id:a,topic:u,params:l,verifyContext:d}),i&&this.client.core.expirer.set(a,be(i))},this.sendRequest=async r=>{const{topic:i,method:a,params:u,expiry:l,relayRpcId:d,clientRpcId:w,throwOnFailedPublish:b}=r,A=zr(a,u,w);if(Fr()&&SP.includes(a)){const M=kr(JSON.stringify(A));this.client.core.verify.register({attestationId:M})}const O=await this.client.core.crypto.encode(i,A),R=Pn[a].req;return l&&(R.ttl=l),d&&(R.id=d),this.client.core.history.set(i,A),b?(R.internal=Sn(Bt({},R.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,O,R)):this.client.core.relayer.publish(i,O,R).catch(M=>this.client.logger.error(M)),A.id},this.sendResult=async r=>{const{id:i,topic:a,result:u,throwOnFailedPublish:l}=r,d=zi(i,u),w=await this.client.core.crypto.encode(a,d),b=await this.client.core.history.get(a,i),A=Pn[b.request.method].res;l?(A.internal=Sn(Bt({},A.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,w,A)):this.client.core.relayer.publish(a,w,A).catch(O=>this.client.logger.error(O)),await this.client.core.history.resolve(d)},this.sendError=async(r,i,a)=>{const u=Ko(r,a),l=await this.client.core.crypto.encode(i,u),d=await this.client.core.history.get(i,r),w=Pn[d.request.method].res;this.client.core.relayer.publish(i,l,w),await this.client.core.history.resolve(u)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(a=>{er(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{er(a.expiry)&&i.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...i.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===He.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=He.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(i=>setTimeout(i,300))}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=He.idle},this.processRequest=r=>{const{topic:i,payload:a}=r,u=a.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(i,a);case"wc_sessionSettle":return this.onSessionSettleRequest(i,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,a);case"wc_sessionExtend":return this.onSessionExtendRequest(i,a);case"wc_sessionPing":return this.onSessionPingRequest(i,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,a);case"wc_sessionRequest":return this.onSessionRequest(i,a);case"wc_sessionEvent":return this.onSessionEventRequest(i,a);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:a}=r,u=(await this.client.core.history.get(i,a.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(i,a);case"wc_sessionSettle":return this.onSessionSettleResponse(i,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,a);case"wc_sessionExtend":return this.onSessionExtendResponse(i,a);case"wc_sessionPing":return this.onSessionPingResponse(i,a);case"wc_sessionRequest":return this.onSessionRequestResponse(i,a);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:i}=r,{message:a}=C("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,i)=>{const{params:a,id:u}=i;try{this.isValidConnect(Bt({},i.params));const l=be(U.FIVE_MINUTES),d=Bt({id:u,pairingTopic:r,expiry:l},a);await this.setProposal(u,d);const w=kr(JSON.stringify(i)),b=await this.getVerifyContext(w,d.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:d,verifyContext:b})}catch(l){await this.sendError(u,r,l),this.client.logger.error(l)}},this.onSessionProposeResponse=async(r,i)=>{const{id:a}=i;if(tr(i)){const{result:u}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const l=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:l});const d=l.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:d});const w=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const b=await this.client.core.crypto.generateSharedKey(d,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:b});const A=await this.client.core.relayer.subscribe(b);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:A}),await this.client.core.pairing.activate({topic:r})}else Re(i)&&(await this.client.proposal.delete(a,It("USER_DISCONNECTED")),this.events.emit(Pt("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(r,i)=>{const{id:a,params:u}=i;try{this.isValidSessionSettleRequest(u);const{relay:l,controller:d,expiry:w,namespaces:b,requiredNamespaces:A,optionalNamespaces:O,sessionProperties:R,pairingTopic:M}=i.params,x=Bt({topic:r,relay:l,expiry:w,namespaces:b,acknowledged:!0,pairingTopic:M,requiredNamespaces:A,optionalNamespaces:O,controller:d.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:d.publicKey,metadata:d.metadata}},R&&{sessionProperties:R});await this.sendResult({id:i.id,topic:r,result:!0}),this.events.emit(Pt("session_connect"),{session:x}),this.cleanupDuplicatePairings(x)}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.onSessionSettleResponse=async(r,i)=>{const{id:a}=i;tr(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Pt("session_approve",a),{})):Re(i)&&(await this.client.session.delete(r,It("USER_DISCONNECTED")),this.events.emit(Pt("session_approve",a),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:a,id:u}=i;try{const l=`${r}_session_update`,d=Ni.get(l);if(d&&this.isRequestOutOfSync(d,u)){this.client.logger.info(`Discarding out of sync request - ${u}`);return}this.isValidUpdate(Bt({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:u,topic:r,result:!0}),this.client.events.emit("session_update",{id:u,topic:r,params:a}),Ni.set(l,u)}catch(l){await this.sendError(u,r,l),this.client.logger.error(l)}},this.isRequestOutOfSync=(r,i)=>parseInt(i.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,i)=>{const{id:a}=i;tr(i)?this.events.emit(Pt("session_update",a),{}):Re(i)&&this.events.emit(Pt("session_update",a),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:a}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,be(Ai)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionExtendResponse=(r,i)=>{const{id:a}=i;tr(i)?this.events.emit(Pt("session_extend",a),{}):Re(i)&&this.events.emit(Pt("session_extend",a),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:a}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionPingResponse=(r,i)=>{const{id:a}=i;setTimeout(()=>{tr(i)?this.events.emit(Pt("session_ping",a),{}):Re(i)&&this.events.emit(Pt("session_ping",a),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:a}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(qt.publish,async()=>{u(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(r,i)=>{const{id:a,params:u}=i;try{this.isValidRequest(Bt({topic:r},u));const l=kr(JSON.stringify(zr("wc_sessionRequest",u,a))),d=this.client.session.get(r),w=await this.getVerifyContext(l,d.peer.metadata),b={id:a,topic:r,params:u,verifyContext:w};await this.setPendingSessionRequest(b),this.addSessionRequestToSessionRequestQueue(b),this.processSessionRequestQueue()}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.onSessionRequestResponse=(r,i)=>{const{id:a}=i;tr(i)?this.events.emit(Pt("session_request",a),{result:i.result}):Re(i)&&this.events.emit(Pt("session_request",a),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:a,params:u}=i;try{const l=`${r}_session_event_${u.event.name}`,d=Ni.get(l);if(d&&this.isRequestOutOfSync(d,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(Bt({topic:r},u)),this.client.events.emit("session_event",{id:a,topic:r,params:u}),Ni.set(l,a)}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=He.idle,this.processSessionRequestQueue()},U.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===He.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=He.active,this.client.events.emit("session_request",r)}catch(i){this.client.logger.error(i)}},this.onPairingCreated=r=>{if(r.active)return;const i=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);i&&this.onSessionProposeRequest(r.topic,zr("wc_sessionPropose",{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties},i.id))},this.isValidConnect=async r=>{if(!Wt(r)){const{message:w}=C("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(w)}const{pairingTopic:i,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:l,relays:d}=r;if(Ft(i)||await this.isValidPairingTopic(i),!R0(d)){const{message:w}=C("MISSING_OR_INVALID",`connect() relays: ${d}`);throw new Error(w)}!Ft(a)&&Hr(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!Ft(u)&&Hr(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),Ft(l)||this.validateSessionProps(l,"sessionProperties")},this.validateNamespaces=(r,i)=>{const a=A0(r,"connect()",i);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!Wt(r))throw new Error(C("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:a,relayProtocol:u,sessionProperties:l}=r;await this.isValidProposalId(i);const d=this.client.proposal.get(i),w=Di(a,"approve()");if(w)throw new Error(w.message);const b=ph(d.requiredNamespaces,a,"approve()");if(b)throw new Error(b.message);if(!At(u,!0)){const{message:A}=C("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(A)}Ft(l)||this.validateSessionProps(l,"sessionProperties")},this.isValidReject=async r=>{if(!Wt(r)){const{message:u}=C("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(u)}const{id:i,reason:a}=r;if(await this.isValidProposalId(i),!T0(a)){const{message:u}=C("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=r=>{if(!Wt(r)){const{message:b}=C("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(b)}const{relay:i,controller:a,namespaces:u,expiry:l}=r;if(!wl(i)){const{message:b}=C("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(b)}const d=E0(a,"onSessionSettleRequest()");if(d)throw new Error(d.message);const w=Di(u,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(er(l)){const{message:b}=C("EXPIRED","onSessionSettleRequest()");throw new Error(b)}},this.isValidUpdate=async r=>{if(!Wt(r)){const{message:w}=C("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(w)}const{topic:i,namespaces:a}=r;await this.isValidSessionTopic(i);const u=this.client.session.get(i),l=Di(a,"update()");if(l)throw new Error(l.message);const d=ph(u.requiredNamespaces,a,"update()");if(d)throw new Error(d.message)},this.isValidExtend=async r=>{if(!Wt(r)){const{message:a}=C("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:i}=r;await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!Wt(r)){const{message:w}=C("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(w)}const{topic:i,request:a,chainId:u,expiry:l}=r;await this.isValidSessionTopic(i);const{namespaces:d}=this.client.session.get(i);if(!lh(d,u)){const{message:w}=C("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(w)}if(!C0(a)){const{message:w}=C("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(w)}if(!j0(d,u,a.method)){const{message:w}=C("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(w)}if(l&&!L0(l,Eo)){const{message:w}=C("MISSING_OR_INVALID",`request() expiry: ${l}. Expiry must be a number (in seconds) between ${Eo.min} and ${Eo.max}`);throw new Error(w)}},this.isValidRespond=async r=>{var i;if(!Wt(r)){const{message:l}=C("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(l)}const{topic:a,response:u}=r;try{await this.isValidSessionTopic(a)}catch(l){throw(i=r==null?void 0:r.response)!=null&&i.id&&this.cleanupAfterResponse(r),l}if(!D0(u)){const{message:l}=C("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(u)}`);throw new Error(l)}},this.isValidPing=async r=>{if(!Wt(r)){const{message:a}=C("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!Wt(r)){const{message:d}=C("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(d)}const{topic:i,event:a,chainId:u}=r;await this.isValidSessionTopic(i);const{namespaces:l}=this.client.session.get(i);if(!lh(l,u)){const{message:d}=C("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(d)}if(!$0(a)){const{message:d}=C("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(d)}if(!q0(l,u,a.name)){const{message:d}=C("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(d)}},this.isValidDisconnect=async r=>{if(!Wt(r)){const{message:a}=C("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.getVerifyContext=async(r,i)=>{const a={verified:{verifyUrl:i.verifyUrl||Lr,validation:"UNKNOWN",origin:i.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:r,verifyUrl:i.verifyUrl});u&&(a.verified.origin=u.origin,a.verified.isScam=u.isScam,a.verified.validation=u.origin===new URL(i.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.info(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,i)=>{Object.values(r).forEach(a=>{if(!At(a,!1)){const{message:u}=C("MISSING_OR_INVALID",`${i} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})}}async isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(qt.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const a=await this.client.core.crypto.decode(r,i);try{Bo(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):ki(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(u){this.client.logger.error(u)}})}registerExpirerEvents(){this.client.core.expirer.on(pe.expired,async e=>{const{topic:r,id:i}=vl(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,C("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(An.create,e=>this.onPairingCreated(e))}isValidPairingTopic(e){if(!At(e,!1)){const{message:r}=C("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=C("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(er(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=C("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!At(e,!1)){const{message:r}=C("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=C("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(er(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=C("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(At(e,!1)){const{message:r}=C("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=C("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!x0(e)){const{message:r}=C("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=C("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(er(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=C("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class CP extends Ki{constructor(e,r){super(e,r,bP,sa),this.core=e,this.logger=r}}class DP extends Ki{constructor(e,r){super(e,r,EP,sa),this.core=e,this.logger=r}}class $P extends Ki{constructor(e,r){super(e,r,PP,sa,i=>i.id),this.core=e,this.logger=r}}let jP=class Ml extends rb{constructor(e){super(e),this.protocol=$l,this.version=jl,this.name=bo.name,this.events=new Ie.EventEmitter,this.on=(i,a)=>this.events.on(i,a),this.once=(i,a)=>this.events.once(i,a),this.off=(i,a)=>this.events.off(i,a),this.removeListener=(i,a)=>this.events.removeListener(i,a),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(a){throw this.logger.error(a.message),a}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(a){throw this.logger.error(a.message),a}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(a){throw this.logger.error(a.message),a}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(a){throw this.logger.error(a.message),a}},this.update=async i=>{try{return await this.engine.update(i)}catch(a){throw this.logger.error(a.message),a}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(a){throw this.logger.error(a.message),a}},this.request=async i=>{try{return await this.engine.request(i)}catch(a){throw this.logger.error(a.message),a}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(a){throw this.logger.error(a.message),a}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(a){throw this.logger.error(a.message),a}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(a){throw this.logger.error(a.message),a}},this.find=i=>{try{return this.engine.find(i)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||bo.name,this.metadata=(e==null?void 0:e.metadata)||Fb();const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Mi(Li({level:(e==null?void 0:e.logger)||bo.logger}));this.core=(e==null?void 0:e.core)||new _P(e),this.logger=Gt(r,this.name),this.session=new DP(this.core,this.logger),this.proposal=new CP(this.core,this.logger),this.pendingRequest=new $P(this.core,this.logger),this.engine=new TP(this)}static async init(e){const r=new Ml(e);return await r.initialize(),r}get context(){return re(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var Mo={exports:{}};(function(o,e){var r=typeof self<"u"?self:xw,i=function(){function u(){this.fetch=!1,this.DOMException=r.DOMException}return u.prototype=r,new u}();(function(u){(function(l){var d={searchParams:"URLSearchParams"in u,iterable:"Symbol"in u&&"iterator"in Symbol,blob:"FileReader"in u&&"Blob"in u&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in u,arrayBuffer:"ArrayBuffer"in u};function w(E){return E&&DataView.prototype.isPrototypeOf(E)}if(d.arrayBuffer)var b=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],A=ArrayBuffer.isView||function(E){return E&&b.indexOf(Object.prototype.toString.call(E))>-1};function O(E){if(typeof E!="string"&&(E=String(E)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(E))throw new TypeError("Invalid character in header field name");return E.toLowerCase()}function R(E){return typeof E!="string"&&(E=String(E)),E}function M(E){var T={next:function(){var B=E.shift();return{done:B===void 0,value:B}}};return d.iterable&&(T[Symbol.iterator]=function(){return T}),T}function x(E){this.map={},E instanceof x?E.forEach(function(T,B){this.append(B,T)},this):Array.isArray(E)?E.forEach(function(T){this.append(T[0],T[1])},this):E&&Object.getOwnPropertyNames(E).forEach(function(T){this.append(T,E[T])},this)}x.prototype.append=function(E,T){E=O(E),T=R(T);var B=this.map[E];this.map[E]=B?B+", "+T:T},x.prototype.delete=function(E){delete this.map[O(E)]},x.prototype.get=function(E){return E=O(E),this.has(E)?this.map[E]:null},x.prototype.has=function(E){return this.map.hasOwnProperty(O(E))},x.prototype.set=function(E,T){this.map[O(E)]=R(T)},x.prototype.forEach=function(E,T){for(var B in this.map)this.map.hasOwnProperty(B)&&E.call(T,this.map[B],B,this)},x.prototype.keys=function(){var E=[];return this.forEach(function(T,B){E.push(B)}),M(E)},x.prototype.values=function(){var E=[];return this.forEach(function(T){E.push(T)}),M(E)},x.prototype.entries=function(){var E=[];return this.forEach(function(T,B){E.push([B,T])}),M(E)},d.iterable&&(x.prototype[Symbol.iterator]=x.prototype.entries);function $(E){if(E.bodyUsed)return Promise.reject(new TypeError("Already read"));E.bodyUsed=!0}function F(E){return new Promise(function(T,B){E.onload=function(){T(E.result)},E.onerror=function(){B(E.error)}})}function Z(E){var T=new FileReader,B=F(T);return T.readAsArrayBuffer(E),B}function _t(E){var T=new FileReader,B=F(T);return T.readAsText(E),B}function rt(E){for(var T=new Uint8Array(E),B=new Array(T.length),mt=0;mt<T.length;mt++)B[mt]=String.fromCharCode(T[mt]);return B.join("")}function X(E){if(E.slice)return E.slice(0);var T=new Uint8Array(E.byteLength);return T.set(new Uint8Array(E)),T.buffer}function ot(){return this.bodyUsed=!1,this._initBody=function(E){this._bodyInit=E,E?typeof E=="string"?this._bodyText=E:d.blob&&Blob.prototype.isPrototypeOf(E)?this._bodyBlob=E:d.formData&&FormData.prototype.isPrototypeOf(E)?this._bodyFormData=E:d.searchParams&&URLSearchParams.prototype.isPrototypeOf(E)?this._bodyText=E.toString():d.arrayBuffer&&d.blob&&w(E)?(this._bodyArrayBuffer=X(E.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):d.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(E)||A(E))?this._bodyArrayBuffer=X(E):this._bodyText=E=Object.prototype.toString.call(E):this._bodyText="",this.headers.get("content-type")||(typeof E=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):d.searchParams&&URLSearchParams.prototype.isPrototypeOf(E)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},d.blob&&(this.blob=function(){var E=$(this);if(E)return E;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?$(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(Z)}),this.text=function(){var E=$(this);if(E)return E;if(this._bodyBlob)return _t(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(rt(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},d.formData&&(this.formData=function(){return this.text().then(Pe)}),this.json=function(){return this.text().then(JSON.parse)},this}var Rt=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function gt(E){var T=E.toUpperCase();return Rt.indexOf(T)>-1?T:E}function yt(E,T){T=T||{};var B=T.body;if(E instanceof yt){if(E.bodyUsed)throw new TypeError("Already read");this.url=E.url,this.credentials=E.credentials,T.headers||(this.headers=new x(E.headers)),this.method=E.method,this.mode=E.mode,this.signal=E.signal,!B&&E._bodyInit!=null&&(B=E._bodyInit,E.bodyUsed=!0)}else this.url=String(E);if(this.credentials=T.credentials||this.credentials||"same-origin",(T.headers||!this.headers)&&(this.headers=new x(T.headers)),this.method=gt(T.method||this.method||"GET"),this.mode=T.mode||this.mode||null,this.signal=T.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&B)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(B)}yt.prototype.clone=function(){return new yt(this,{body:this._bodyInit})};function Pe(E){var T=new FormData;return E.trim().split("&").forEach(function(B){if(B){var mt=B.split("="),ct=mt.shift().replace(/\+/g," "),it=mt.join("=").replace(/\+/g," ");T.append(decodeURIComponent(ct),decodeURIComponent(it))}}),T}function Bi(E){var T=new x,B=E.replace(/\r?\n[\t ]+/g," ");return B.split(/\r?\n/).forEach(function(mt){var ct=mt.split(":"),it=ct.shift().trim();if(it){var xe=ct.join(":").trim();T.append(it,xe)}}),T}ot.call(yt.prototype);function ne(E,T){T||(T={}),this.type="default",this.status=T.status===void 0?200:T.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in T?T.statusText:"OK",this.headers=new x(T.headers),this.url=T.url||"",this._initBody(E)}ot.call(ne.prototype),ne.prototype.clone=function(){return new ne(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new x(this.headers),url:this.url})},ne.error=function(){var E=new ne(null,{status:0,statusText:""});return E.type="error",E};var Wi=[301,302,303,307,308];ne.redirect=function(E,T){if(Wi.indexOf(T)===-1)throw new RangeError("Invalid status code");return new ne(null,{status:T,headers:{location:E}})},l.DOMException=u.DOMException;try{new l.DOMException}catch{l.DOMException=function(E,T){this.message=E,this.name=T;var B=Error(E);this.stack=B.stack},l.DOMException.prototype=Object.create(Error.prototype),l.DOMException.prototype.constructor=l.DOMException}function Qr(E,T){return new Promise(function(B,mt){var ct=new yt(E,T);if(ct.signal&&ct.signal.aborted)return mt(new l.DOMException("Aborted","AbortError"));var it=new XMLHttpRequest;function xe(){it.abort()}it.onload=function(){var Dt={status:it.status,statusText:it.statusText,headers:Bi(it.getAllResponseHeaders()||"")};Dt.url="responseURL"in it?it.responseURL:Dt.headers.get("X-Request-URL");var Yr="response"in it?it.response:it.responseText;B(new ne(Yr,Dt))},it.onerror=function(){mt(new TypeError("Network request failed"))},it.ontimeout=function(){mt(new TypeError("Network request failed"))},it.onabort=function(){mt(new l.DOMException("Aborted","AbortError"))},it.open(ct.method,ct.url,!0),ct.credentials==="include"?it.withCredentials=!0:ct.credentials==="omit"&&(it.withCredentials=!1),"responseType"in it&&d.blob&&(it.responseType="blob"),ct.headers.forEach(function(Dt,Yr){it.setRequestHeader(Yr,Dt)}),ct.signal&&(ct.signal.addEventListener("abort",xe),it.onreadystatechange=function(){it.readyState===4&&ct.signal.removeEventListener("abort",xe)}),it.send(typeof ct._bodyInit>"u"?null:ct._bodyInit)})}return Qr.polyfill=!0,u.fetch||(u.fetch=Qr,u.Headers=x,u.Request=yt,u.Response=ne),l.Headers=x,l.Request=yt,l.Response=ne,l.fetch=Qr,Object.defineProperty(l,"__esModule",{value:!0}),l})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var a=i;e=a.fetch,e.default=a.fetch,e.fetch=a.fetch,e.Headers=a.Headers,e.Request=a.Request,e.Response=a.Response,o.exports=e})(Mo,Mo.exports);var qP=Mo.exports;const qh=Tw(qP),UP=o=>JSON.stringify(o,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),MP=o=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=o.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,a)=>typeof a=="string"&&a.match(/^\d+n$/)?BigInt(a.substring(0,a.length-1)):a)};function LP(o){if(typeof o!="string")throw new Error(`Cannot safe json parse value of type ${typeof o}`);try{return MP(o)}catch{return o}}function Uh(o){return typeof o=="string"?o:UP(o)||""}var zP=Object.defineProperty,kP=Object.defineProperties,HP=Object.getOwnPropertyDescriptors,Mh=Object.getOwnPropertySymbols,VP=Object.prototype.hasOwnProperty,KP=Object.prototype.propertyIsEnumerable,Lh=(o,e,r)=>e in o?zP(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,zh=(o,e)=>{for(var r in e||(e={}))VP.call(e,r)&&Lh(o,r,e[r]);if(Mh)for(var r of Mh(e))KP.call(e,r)&&Lh(o,r,e[r]);return o},kh=(o,e)=>kP(o,HP(e));const BP={Accept:"application/json","Content-Type":"application/json"},WP="POST",Hh={headers:BP,method:WP},Vh=10;let ir=class{constructor(o,e=!1){if(this.url=o,this.disableProviderPing=e,this.events=new Ie.EventEmitter,this.isAvailable=!1,this.registering=!1,!Lu(o))throw new Error(`Provided URL is not compatible with HTTP connection: ${o}`);this.url=o,this.disableProviderPing=e}get connected(){return this.isAvailable}get connecting(){return this.registering}on(o,e){this.events.on(o,e)}once(o,e){this.events.once(o,e)}off(o,e){this.events.off(o,e)}removeListener(o,e){this.events.removeListener(o,e)}async open(o=this.url){await this.register(o)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(o){this.isAvailable||await this.register();try{const e=Uh(o),r=await(await qh(this.url,kh(zh({},Hh),{body:e}))).json();this.onPayload({data:r})}catch(e){this.onError(o.id,e)}}async register(o=this.url){if(!Lu(o))throw new Error(`Provided URL is not compatible with HTTP connection: ${o}`);if(this.registering){const e=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=e||this.events.listenerCount("open")>=e)&&this.events.setMaxListeners(e+1),new Promise((r,i)=>{this.events.once("register_error",a=>{this.resetMaxListeners(),i(a)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return i(new Error("HTTP connection is missing or invalid"));r()})})}this.url=o,this.registering=!0;try{if(!this.disableProviderPing){const e=Uh({id:1,jsonrpc:"2.0",method:"test",params:[]});await qh(o,kh(zh({},Hh),{body:e}))}this.onOpen()}catch(e){const r=this.parseError(e);throw this.events.emit("register_error",r),this.onClose(),r}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(o){if(typeof o.data>"u")return;const e=typeof o.data=="string"?LP(o.data):o.data;this.events.emit("payload",e)}onError(o,e){const r=this.parseError(e),i=r.message||r.toString(),a=Ko(o,i);this.events.emit("payload",a)}parseError(o,e=this.url){return $w(o,e,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Vh&&this.events.setMaxListeners(Vh)}};const Kh="error",FP="wss://relay.walletconnect.com",GP="wc",QP="universal_provider",Bh=`${GP}@2:${QP}:`,YP="https://rpc.walletconnect.com/v1/",Ke={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var On=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof tt.global<"u"?tt.global:typeof self<"u"?self:{},Lo={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,e){(function(){var r,i="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",d="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",b=500,A="__lodash_placeholder__",O=1,R=2,M=4,x=1,$=2,F=1,Z=2,_t=4,rt=8,X=16,ot=32,Rt=64,gt=128,yt=256,Pe=512,Bi=30,ne="...",Wi=800,Qr=16,E=1,T=2,B=3,mt=1/0,ct=9007199254740991,it=17976931348623157e292,xe=NaN,Dt=4294967295,Yr=Dt-1,kl=Dt>>>1,Hl=[["ary",gt],["bind",F],["bindKey",Z],["curry",rt],["curryRight",X],["flip",Pe],["partial",ot],["partialRight",Rt],["rearg",yt]],Er="[object Arguments]",jn="[object Array]",Vl="[object AsyncFunction]",Jr="[object Boolean]",Xr="[object Date]",Kl="[object DOMException]",qn="[object Error]",Un="[object Function]",ca="[object GeneratorFunction]",de="[object Map]",Zr="[object Number]",Bl="[object Null]",Te="[object Object]",ua="[object Promise]",Wl="[object Proxy]",tn="[object RegExp]",ge="[object Set]",en="[object String]",Mn="[object Symbol]",Fl="[object Undefined]",rn="[object WeakMap]",Gl="[object WeakSet]",nn="[object ArrayBuffer]",Ir="[object DataView]",Fi="[object Float32Array]",Gi="[object Float64Array]",Qi="[object Int8Array]",Yi="[object Int16Array]",Ji="[object Int32Array]",Xi="[object Uint8Array]",Zi="[object Uint8ClampedArray]",ts="[object Uint16Array]",es="[object Uint32Array]",Ql=/\b__p \+= '';/g,Yl=/\b(__p \+=) '' \+/g,Jl=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ha=/&(?:amp|lt|gt|quot|#39);/g,la=/[&<>"']/g,Xl=RegExp(ha.source),Zl=RegExp(la.source),tp=/<%-([\s\S]+?)%>/g,ep=/<%([\s\S]+?)%>/g,pa=/<%=([\s\S]+?)%>/g,rp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,np=/^\w*$/,ip=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,rs=/[\\^$.*+?()[\]{}|]/g,sp=RegExp(rs.source),ns=/^\s+/,op=/\s/,ap=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,cp=/\{\n\/\* \[wrapped with (.+)\] \*/,up=/,? & /,hp=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,lp=/[()=,{}\[\]\/\s]/,pp=/\\(\\)?/g,fp=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,fa=/\w*$/,dp=/^[-+]0x[0-9a-f]+$/i,gp=/^0b[01]+$/i,yp=/^\[object .+?Constructor\]$/,vp=/^0o[0-7]+$/i,mp=/^(?:0|[1-9]\d*)$/,wp=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ln=/($^)/,_p=/['\n\r\u2028\u2029\\]/g,zn="\\ud800-\\udfff",bp="\\u0300-\\u036f",Ep="\\ufe20-\\ufe2f",Ip="\\u20d0-\\u20ff",da=bp+Ep+Ip,ga="\\u2700-\\u27bf",ya="a-z\\xdf-\\xf6\\xf8-\\xff",Pp="\\xac\\xb1\\xd7\\xf7",Sp="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Op="\\u2000-\\u206f",Np=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",va="A-Z\\xc0-\\xd6\\xd8-\\xde",ma="\\ufe0e\\ufe0f",wa=Pp+Sp+Op+Np,is="[']",Ap="["+zn+"]",_a="["+wa+"]",kn="["+da+"]",ba="\\d+",Rp="["+ga+"]",Ea="["+ya+"]",Ia="[^"+zn+wa+ba+ga+ya+va+"]",ss="\\ud83c[\\udffb-\\udfff]",xp="(?:"+kn+"|"+ss+")",Pa="[^"+zn+"]",os="(?:\\ud83c[\\udde6-\\uddff]){2}",as="[\\ud800-\\udbff][\\udc00-\\udfff]",Pr="["+va+"]",Sa="\\u200d",Oa="(?:"+Ea+"|"+Ia+")",Tp="(?:"+Pr+"|"+Ia+")",Na="(?:"+is+"(?:d|ll|m|re|s|t|ve))?",Aa="(?:"+is+"(?:D|LL|M|RE|S|T|VE))?",Ra=xp+"?",xa="["+ma+"]?",Cp="(?:"+Sa+"(?:"+[Pa,os,as].join("|")+")"+xa+Ra+")*",Dp="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",$p="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ta=xa+Ra+Cp,jp="(?:"+[Rp,os,as].join("|")+")"+Ta,qp="(?:"+[Pa+kn+"?",kn,os,as,Ap].join("|")+")",Up=RegExp(is,"g"),Mp=RegExp(kn,"g"),cs=RegExp(ss+"(?="+ss+")|"+qp+Ta,"g"),Lp=RegExp([Pr+"?"+Ea+"+"+Na+"(?="+[_a,Pr,"$"].join("|")+")",Tp+"+"+Aa+"(?="+[_a,Pr+Oa,"$"].join("|")+")",Pr+"?"+Oa+"+"+Na,Pr+"+"+Aa,$p,Dp,ba,jp].join("|"),"g"),zp=RegExp("["+Sa+zn+da+ma+"]"),kp=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Hp=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Vp=-1,pt={};pt[Fi]=pt[Gi]=pt[Qi]=pt[Yi]=pt[Ji]=pt[Xi]=pt[Zi]=pt[ts]=pt[es]=!0,pt[Er]=pt[jn]=pt[nn]=pt[Jr]=pt[Ir]=pt[Xr]=pt[qn]=pt[Un]=pt[de]=pt[Zr]=pt[Te]=pt[tn]=pt[ge]=pt[en]=pt[rn]=!1;var ut={};ut[Er]=ut[jn]=ut[nn]=ut[Ir]=ut[Jr]=ut[Xr]=ut[Fi]=ut[Gi]=ut[Qi]=ut[Yi]=ut[Ji]=ut[de]=ut[Zr]=ut[Te]=ut[tn]=ut[ge]=ut[en]=ut[Mn]=ut[Xi]=ut[Zi]=ut[ts]=ut[es]=!0,ut[qn]=ut[Un]=ut[rn]=!1;var Kp={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},Bp={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Wp={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Fp={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Gp=parseFloat,Qp=parseInt,Ca=typeof On=="object"&&On&&On.Object===Object&&On,Yp=typeof self=="object"&&self&&self.Object===Object&&self,xt=Ca||Yp||Function("return this")(),us=e&&!e.nodeType&&e,sr=us&&!0&&o&&!o.nodeType&&o,Da=sr&&sr.exports===us,hs=Da&&Ca.process,ie=function(){try{var v=sr&&sr.require&&sr.require("util").types;return v||hs&&hs.binding&&hs.binding("util")}catch{}}(),$a=ie&&ie.isArrayBuffer,ja=ie&&ie.isDate,qa=ie&&ie.isMap,Ua=ie&&ie.isRegExp,Ma=ie&&ie.isSet,La=ie&&ie.isTypedArray;function Qt(v,I,_){switch(_.length){case 0:return v.call(I);case 1:return v.call(I,_[0]);case 2:return v.call(I,_[0],_[1]);case 3:return v.call(I,_[0],_[1],_[2])}return v.apply(I,_)}function Jp(v,I,_,j){for(var H=-1,et=v==null?0:v.length;++H<et;){var St=v[H];I(j,St,_(St),v)}return j}function se(v,I){for(var _=-1,j=v==null?0:v.length;++_<j&&I(v[_],_,v)!==!1;);return v}function Xp(v,I){for(var _=v==null?0:v.length;_--&&I(v[_],_,v)!==!1;);return v}function za(v,I){for(var _=-1,j=v==null?0:v.length;++_<j;)if(!I(v[_],_,v))return!1;return!0}function Be(v,I){for(var _=-1,j=v==null?0:v.length,H=0,et=[];++_<j;){var St=v[_];I(St,_,v)&&(et[H++]=St)}return et}function Hn(v,I){var _=v==null?0:v.length;return!!_&&Sr(v,I,0)>-1}function ls(v,I,_){for(var j=-1,H=v==null?0:v.length;++j<H;)if(_(I,v[j]))return!0;return!1}function ft(v,I){for(var _=-1,j=v==null?0:v.length,H=Array(j);++_<j;)H[_]=I(v[_],_,v);return H}function We(v,I){for(var _=-1,j=I.length,H=v.length;++_<j;)v[H+_]=I[_];return v}function ps(v,I,_,j){var H=-1,et=v==null?0:v.length;for(j&&et&&(_=v[++H]);++H<et;)_=I(_,v[H],H,v);return _}function Zp(v,I,_,j){var H=v==null?0:v.length;for(j&&H&&(_=v[--H]);H--;)_=I(_,v[H],H,v);return _}function fs(v,I){for(var _=-1,j=v==null?0:v.length;++_<j;)if(I(v[_],_,v))return!0;return!1}var tf=ds("length");function ef(v){return v.split("")}function rf(v){return v.match(hp)||[]}function ka(v,I,_){var j;return _(v,function(H,et,St){if(I(H,et,St))return j=et,!1}),j}function Vn(v,I,_,j){for(var H=v.length,et=_+(j?1:-1);j?et--:++et<H;)if(I(v[et],et,v))return et;return-1}function Sr(v,I,_){return I===I?gf(v,I,_):Vn(v,Ha,_)}function nf(v,I,_,j){for(var H=_-1,et=v.length;++H<et;)if(j(v[H],I))return H;return-1}function Ha(v){return v!==v}function Va(v,I){var _=v==null?0:v.length;return _?ys(v,I)/_:xe}function ds(v){return function(I){return I==null?r:I[v]}}function gs(v){return function(I){return v==null?r:v[I]}}function Ka(v,I,_,j,H){return H(v,function(et,St,at){_=j?(j=!1,et):I(_,et,St,at)}),_}function sf(v,I){var _=v.length;for(v.sort(I);_--;)v[_]=v[_].value;return v}function ys(v,I){for(var _,j=-1,H=v.length;++j<H;){var et=I(v[j]);et!==r&&(_=_===r?et:_+et)}return _}function vs(v,I){for(var _=-1,j=Array(v);++_<v;)j[_]=I(_);return j}function of(v,I){return ft(I,function(_){return[_,v[_]]})}function Ba(v){return v&&v.slice(0,Qa(v)+1).replace(ns,"")}function Yt(v){return function(I){return v(I)}}function ms(v,I){return ft(I,function(_){return v[_]})}function sn(v,I){return v.has(I)}function Wa(v,I){for(var _=-1,j=v.length;++_<j&&Sr(I,v[_],0)>-1;);return _}function Fa(v,I){for(var _=v.length;_--&&Sr(I,v[_],0)>-1;);return _}function af(v,I){for(var _=v.length,j=0;_--;)v[_]===I&&++j;return j}var cf=gs(Kp),uf=gs(Bp);function hf(v){return"\\"+Fp[v]}function lf(v,I){return v==null?r:v[I]}function Or(v){return zp.test(v)}function pf(v){return kp.test(v)}function ff(v){for(var I,_=[];!(I=v.next()).done;)_.push(I.value);return _}function ws(v){var I=-1,_=Array(v.size);return v.forEach(function(j,H){_[++I]=[H,j]}),_}function Ga(v,I){return function(_){return v(I(_))}}function Fe(v,I){for(var _=-1,j=v.length,H=0,et=[];++_<j;){var St=v[_];(St===I||St===A)&&(v[_]=A,et[H++]=_)}return et}function Kn(v){var I=-1,_=Array(v.size);return v.forEach(function(j){_[++I]=j}),_}function df(v){var I=-1,_=Array(v.size);return v.forEach(function(j){_[++I]=[j,j]}),_}function gf(v,I,_){for(var j=_-1,H=v.length;++j<H;)if(v[j]===I)return j;return-1}function yf(v,I,_){for(var j=_+1;j--;)if(v[j]===I)return j;return j}function Nr(v){return Or(v)?mf(v):tf(v)}function ye(v){return Or(v)?wf(v):ef(v)}function Qa(v){for(var I=v.length;I--&&op.test(v.charAt(I)););return I}var vf=gs(Wp);function mf(v){for(var I=cs.lastIndex=0;cs.test(v);)++I;return I}function wf(v){return v.match(cs)||[]}function _f(v){return v.match(Lp)||[]}var bf=function v(I){I=I==null?xt:Ar.defaults(xt.Object(),I,Ar.pick(xt,Hp));var _=I.Array,j=I.Date,H=I.Error,et=I.Function,St=I.Math,at=I.Object,_s=I.RegExp,Ef=I.String,oe=I.TypeError,Bn=_.prototype,If=et.prototype,Rr=at.prototype,Wn=I["__core-js_shared__"],Fn=If.toString,st=Rr.hasOwnProperty,Pf=0,Ya=function(){var t=/[^.]+$/.exec(Wn&&Wn.keys&&Wn.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Gn=Rr.toString,Sf=Fn.call(at),Of=xt._,Nf=_s("^"+Fn.call(st).replace(rs,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Qn=Da?I.Buffer:r,Ge=I.Symbol,Yn=I.Uint8Array,Ja=Qn?Qn.allocUnsafe:r,Jn=Ga(at.getPrototypeOf,at),Xa=at.create,Za=Rr.propertyIsEnumerable,Xn=Bn.splice,tc=Ge?Ge.isConcatSpreadable:r,on=Ge?Ge.iterator:r,or=Ge?Ge.toStringTag:r,Zn=function(){try{var t=lr(at,"defineProperty");return t({},"",{}),t}catch{}}(),Af=I.clearTimeout!==xt.clearTimeout&&I.clearTimeout,Rf=j&&j.now!==xt.Date.now&&j.now,xf=I.setTimeout!==xt.setTimeout&&I.setTimeout,ti=St.ceil,ei=St.floor,bs=at.getOwnPropertySymbols,Tf=Qn?Qn.isBuffer:r,ec=I.isFinite,Cf=Bn.join,Df=Ga(at.keys,at),Ot=St.max,$t=St.min,$f=j.now,jf=I.parseInt,rc=St.random,qf=Bn.reverse,Es=lr(I,"DataView"),an=lr(I,"Map"),Is=lr(I,"Promise"),xr=lr(I,"Set"),cn=lr(I,"WeakMap"),un=lr(at,"create"),ri=cn&&new cn,Tr={},Uf=pr(Es),Mf=pr(an),Lf=pr(Is),zf=pr(xr),kf=pr(cn),ni=Ge?Ge.prototype:r,hn=ni?ni.valueOf:r,nc=ni?ni.toString:r;function p(t){if(wt(t)&&!V(t)&&!(t instanceof Y)){if(t instanceof ae)return t;if(st.call(t,"__wrapped__"))return iu(t)}return new ae(t)}var Cr=function(){function t(){}return function(n){if(!vt(n))return{};if(Xa)return Xa(n);t.prototype=n;var s=new t;return t.prototype=r,s}}();function ii(){}function ae(t,n){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!n,this.__index__=0,this.__values__=r}p.templateSettings={escape:tp,evaluate:ep,interpolate:pa,variable:"",imports:{_:p}},p.prototype=ii.prototype,p.prototype.constructor=p,ae.prototype=Cr(ii.prototype),ae.prototype.constructor=ae;function Y(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Dt,this.__views__=[]}function Hf(){var t=new Y(this.__wrapped__);return t.__actions__=kt(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=kt(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=kt(this.__views__),t}function Vf(){if(this.__filtered__){var t=new Y(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Kf(){var t=this.__wrapped__.value(),n=this.__dir__,s=V(t),c=n<0,h=s?t.length:0,f=rg(0,h,this.__views__),g=f.start,y=f.end,m=y-g,P=c?y:g-1,S=this.__iteratees__,N=S.length,D=0,q=$t(m,this.__takeCount__);if(!s||!c&&h==m&&q==m)return Nc(t,this.__actions__);var z=[];t:for(;m--&&D<q;){P+=n;for(var W=-1,k=t[P];++W<N;){var Q=S[W],J=Q.iteratee,Zt=Q.type,Lt=J(k);if(Zt==T)k=Lt;else if(!Lt){if(Zt==E)continue t;break t}}z[D++]=k}return z}Y.prototype=Cr(ii.prototype),Y.prototype.constructor=Y;function ar(t){var n=-1,s=t==null?0:t.length;for(this.clear();++n<s;){var c=t[n];this.set(c[0],c[1])}}function Bf(){this.__data__=un?un(null):{},this.size=0}function Wf(t){var n=this.has(t)&&delete this.__data__[t];return this.size-=n?1:0,n}function Ff(t){var n=this.__data__;if(un){var s=n[t];return s===w?r:s}return st.call(n,t)?n[t]:r}function Gf(t){var n=this.__data__;return un?n[t]!==r:st.call(n,t)}function Qf(t,n){var s=this.__data__;return this.size+=this.has(t)?0:1,s[t]=un&&n===r?w:n,this}ar.prototype.clear=Bf,ar.prototype.delete=Wf,ar.prototype.get=Ff,ar.prototype.has=Gf,ar.prototype.set=Qf;function Ce(t){var n=-1,s=t==null?0:t.length;for(this.clear();++n<s;){var c=t[n];this.set(c[0],c[1])}}function Yf(){this.__data__=[],this.size=0}function Jf(t){var n=this.__data__,s=si(n,t);if(s<0)return!1;var c=n.length-1;return s==c?n.pop():Xn.call(n,s,1),--this.size,!0}function Xf(t){var n=this.__data__,s=si(n,t);return s<0?r:n[s][1]}function Zf(t){return si(this.__data__,t)>-1}function td(t,n){var s=this.__data__,c=si(s,t);return c<0?(++this.size,s.push([t,n])):s[c][1]=n,this}Ce.prototype.clear=Yf,Ce.prototype.delete=Jf,Ce.prototype.get=Xf,Ce.prototype.has=Zf,Ce.prototype.set=td;function De(t){var n=-1,s=t==null?0:t.length;for(this.clear();++n<s;){var c=t[n];this.set(c[0],c[1])}}function ed(){this.size=0,this.__data__={hash:new ar,map:new(an||Ce),string:new ar}}function rd(t){var n=vi(this,t).delete(t);return this.size-=n?1:0,n}function nd(t){return vi(this,t).get(t)}function id(t){return vi(this,t).has(t)}function sd(t,n){var s=vi(this,t),c=s.size;return s.set(t,n),this.size+=s.size==c?0:1,this}De.prototype.clear=ed,De.prototype.delete=rd,De.prototype.get=nd,De.prototype.has=id,De.prototype.set=sd;function cr(t){var n=-1,s=t==null?0:t.length;for(this.__data__=new De;++n<s;)this.add(t[n])}function od(t){return this.__data__.set(t,w),this}function ad(t){return this.__data__.has(t)}cr.prototype.add=cr.prototype.push=od,cr.prototype.has=ad;function ve(t){var n=this.__data__=new Ce(t);this.size=n.size}function cd(){this.__data__=new Ce,this.size=0}function ud(t){var n=this.__data__,s=n.delete(t);return this.size=n.size,s}function hd(t){return this.__data__.get(t)}function ld(t){return this.__data__.has(t)}function pd(t,n){var s=this.__data__;if(s instanceof Ce){var c=s.__data__;if(!an||c.length<a-1)return c.push([t,n]),this.size=++s.size,this;s=this.__data__=new De(c)}return s.set(t,n),this.size=s.size,this}ve.prototype.clear=cd,ve.prototype.delete=ud,ve.prototype.get=hd,ve.prototype.has=ld,ve.prototype.set=pd;function ic(t,n){var s=V(t),c=!s&&fr(t),h=!s&&!c&&Ze(t),f=!s&&!c&&!h&&qr(t),g=s||c||h||f,y=g?vs(t.length,Ef):[],m=y.length;for(var P in t)(n||st.call(t,P))&&!(g&&(P=="length"||h&&(P=="offset"||P=="parent")||f&&(P=="buffer"||P=="byteLength"||P=="byteOffset")||Ue(P,m)))&&y.push(P);return y}function sc(t){var n=t.length;return n?t[$s(0,n-1)]:r}function fd(t,n){return mi(kt(t),ur(n,0,t.length))}function dd(t){return mi(kt(t))}function Ps(t,n,s){(s!==r&&!me(t[n],s)||s===r&&!(n in t))&&$e(t,n,s)}function ln(t,n,s){var c=t[n];(!(st.call(t,n)&&me(c,s))||s===r&&!(n in t))&&$e(t,n,s)}function si(t,n){for(var s=t.length;s--;)if(me(t[s][0],n))return s;return-1}function gd(t,n,s,c){return Qe(t,function(h,f,g){n(c,h,s(h),g)}),c}function oc(t,n){return t&&Oe(n,Nt(n),t)}function yd(t,n){return t&&Oe(n,Vt(n),t)}function $e(t,n,s){n=="__proto__"&&Zn?Zn(t,n,{configurable:!0,enumerable:!0,value:s,writable:!0}):t[n]=s}function Ss(t,n){for(var s=-1,c=n.length,h=_(c),f=t==null;++s<c;)h[s]=f?r:so(t,n[s]);return h}function ur(t,n,s){return t===t&&(s!==r&&(t=t<=s?t:s),n!==r&&(t=t>=n?t:n)),t}function ce(t,n,s,c,h,f){var g,y=n&O,m=n&R,P=n&M;if(s&&(g=h?s(t,c,h,f):s(t)),g!==r)return g;if(!vt(t))return t;var S=V(t);if(S){if(g=ig(t),!y)return kt(t,g)}else{var N=jt(t),D=N==Un||N==ca;if(Ze(t))return xc(t,y);if(N==Te||N==Er||D&&!h){if(g=m||D?{}:Qc(t),!y)return m?Fd(t,yd(g,t)):Wd(t,oc(g,t))}else{if(!ut[N])return h?t:{};g=sg(t,N,y)}}f||(f=new ve);var q=f.get(t);if(q)return q;f.set(t,g),Pu(t)?t.forEach(function(k){g.add(ce(k,n,s,k,t,f))}):Eu(t)&&t.forEach(function(k,Q){g.set(Q,ce(k,n,s,Q,t,f))});var z=P?m?Bs:Ks:m?Vt:Nt,W=S?r:z(t);return se(W||t,function(k,Q){W&&(Q=k,k=t[Q]),ln(g,Q,ce(k,n,s,Q,t,f))}),g}function vd(t){var n=Nt(t);return function(s){return ac(s,t,n)}}function ac(t,n,s){var c=s.length;if(t==null)return!c;for(t=at(t);c--;){var h=s[c],f=n[h],g=t[h];if(g===r&&!(h in t)||!f(g))return!1}return!0}function cc(t,n,s){if(typeof t!="function")throw new oe(l);return mn(function(){t.apply(r,s)},n)}function pn(t,n,s,c){var h=-1,f=Hn,g=!0,y=t.length,m=[],P=n.length;if(!y)return m;s&&(n=ft(n,Yt(s))),c?(f=ls,g=!1):n.length>=a&&(f=sn,g=!1,n=new cr(n));t:for(;++h<y;){var S=t[h],N=s==null?S:s(S);if(S=c||S!==0?S:0,g&&N===N){for(var D=P;D--;)if(n[D]===N)continue t;m.push(S)}else f(n,N,c)||m.push(S)}return m}var Qe=jc(Se),uc=jc(Ns,!0);function md(t,n){var s=!0;return Qe(t,function(c,h,f){return s=!!n(c,h,f),s}),s}function oi(t,n,s){for(var c=-1,h=t.length;++c<h;){var f=t[c],g=n(f);if(g!=null&&(y===r?g===g&&!Xt(g):s(g,y)))var y=g,m=f}return m}function wd(t,n,s,c){var h=t.length;for(s=K(s),s<0&&(s=-s>h?0:h+s),c=c===r||c>h?h:K(c),c<0&&(c+=h),c=s>c?0:Ou(c);s<c;)t[s++]=n;return t}function hc(t,n){var s=[];return Qe(t,function(c,h,f){n(c,h,f)&&s.push(c)}),s}function Tt(t,n,s,c,h){var f=-1,g=t.length;for(s||(s=ag),h||(h=[]);++f<g;){var y=t[f];n>0&&s(y)?n>1?Tt(y,n-1,s,c,h):We(h,y):c||(h[h.length]=y)}return h}var Os=qc(),lc=qc(!0);function Se(t,n){return t&&Os(t,n,Nt)}function Ns(t,n){return t&&lc(t,n,Nt)}function ai(t,n){return Be(n,function(s){return Me(t[s])})}function hr(t,n){n=Je(n,t);for(var s=0,c=n.length;t!=null&&s<c;)t=t[Ne(n[s++])];return s&&s==c?t:r}function pc(t,n,s){var c=n(t);return V(t)?c:We(c,s(t))}function Ut(t){return t==null?t===r?Fl:Bl:or&&or in at(t)?eg(t):dg(t)}function As(t,n){return t>n}function _d(t,n){return t!=null&&st.call(t,n)}function bd(t,n){return t!=null&&n in at(t)}function Ed(t,n,s){return t>=$t(n,s)&&t<Ot(n,s)}function Rs(t,n,s){for(var c=s?ls:Hn,h=t[0].length,f=t.length,g=f,y=_(f),m=1/0,P=[];g--;){var S=t[g];g&&n&&(S=ft(S,Yt(n))),m=$t(S.length,m),y[g]=!s&&(n||h>=120&&S.length>=120)?new cr(g&&S):r}S=t[0];var N=-1,D=y[0];t:for(;++N<h&&P.length<m;){var q=S[N],z=n?n(q):q;if(q=s||q!==0?q:0,!(D?sn(D,z):c(P,z,s))){for(g=f;--g;){var W=y[g];if(!(W?sn(W,z):c(t[g],z,s)))continue t}D&&D.push(z),P.push(q)}}return P}function Id(t,n,s,c){return Se(t,function(h,f,g){n(c,s(h),f,g)}),c}function fn(t,n,s){n=Je(n,t),t=Zc(t,n);var c=t==null?t:t[Ne(he(n))];return c==null?r:Qt(c,t,s)}function fc(t){return wt(t)&&Ut(t)==Er}function Pd(t){return wt(t)&&Ut(t)==nn}function Sd(t){return wt(t)&&Ut(t)==Xr}function dn(t,n,s,c,h){return t===n?!0:t==null||n==null||!wt(t)&&!wt(n)?t!==t&&n!==n:Od(t,n,s,c,dn,h)}function Od(t,n,s,c,h,f){var g=V(t),y=V(n),m=g?jn:jt(t),P=y?jn:jt(n);m=m==Er?Te:m,P=P==Er?Te:P;var S=m==Te,N=P==Te,D=m==P;if(D&&Ze(t)){if(!Ze(n))return!1;g=!0,S=!1}if(D&&!S)return f||(f=new ve),g||qr(t)?Wc(t,n,s,c,h,f):Zd(t,n,m,s,c,h,f);if(!(s&x)){var q=S&&st.call(t,"__wrapped__"),z=N&&st.call(n,"__wrapped__");if(q||z){var W=q?t.value():t,k=z?n.value():n;return f||(f=new ve),h(W,k,s,c,f)}}return D?(f||(f=new ve),tg(t,n,s,c,h,f)):!1}function Nd(t){return wt(t)&&jt(t)==de}function xs(t,n,s,c){var h=s.length,f=h,g=!c;if(t==null)return!f;for(t=at(t);h--;){var y=s[h];if(g&&y[2]?y[1]!==t[y[0]]:!(y[0]in t))return!1}for(;++h<f;){y=s[h];var m=y[0],P=t[m],S=y[1];if(g&&y[2]){if(P===r&&!(m in t))return!1}else{var N=new ve;if(c)var D=c(P,S,m,t,n,N);if(!(D===r?dn(S,P,x|$,c,N):D))return!1}}return!0}function dc(t){if(!vt(t)||ug(t))return!1;var n=Me(t)?Nf:yp;return n.test(pr(t))}function Ad(t){return wt(t)&&Ut(t)==tn}function Rd(t){return wt(t)&&jt(t)==ge}function xd(t){return wt(t)&&Pi(t.length)&&!!pt[Ut(t)]}function gc(t){return typeof t=="function"?t:t==null?Kt:typeof t=="object"?V(t)?mc(t[0],t[1]):vc(t):Uu(t)}function Ts(t){if(!vn(t))return Df(t);var n=[];for(var s in at(t))st.call(t,s)&&s!="constructor"&&n.push(s);return n}function Td(t){if(!vt(t))return fg(t);var n=vn(t),s=[];for(var c in t)c=="constructor"&&(n||!st.call(t,c))||s.push(c);return s}function Cs(t,n){return t<n}function yc(t,n){var s=-1,c=Ht(t)?_(t.length):[];return Qe(t,function(h,f,g){c[++s]=n(h,f,g)}),c}function vc(t){var n=Fs(t);return n.length==1&&n[0][2]?Jc(n[0][0],n[0][1]):function(s){return s===t||xs(s,t,n)}}function mc(t,n){return Qs(t)&&Yc(n)?Jc(Ne(t),n):function(s){var c=so(s,t);return c===r&&c===n?oo(s,t):dn(n,c,x|$)}}function ci(t,n,s,c,h){t!==n&&Os(n,function(f,g){if(h||(h=new ve),vt(f))Cd(t,n,g,s,ci,c,h);else{var y=c?c(Js(t,g),f,g+"",t,n,h):r;y===r&&(y=f),Ps(t,g,y)}},Vt)}function Cd(t,n,s,c,h,f,g){var y=Js(t,s),m=Js(n,s),P=g.get(m);if(P){Ps(t,s,P);return}var S=f?f(y,m,s+"",t,n,g):r,N=S===r;if(N){var D=V(m),q=!D&&Ze(m),z=!D&&!q&&qr(m);S=m,D||q||z?V(y)?S=y:bt(y)?S=kt(y):q?(N=!1,S=xc(m,!0)):z?(N=!1,S=Tc(m,!0)):S=[]:wn(m)||fr(m)?(S=y,fr(y)?S=Nu(y):(!vt(y)||Me(y))&&(S=Qc(m))):N=!1}N&&(g.set(m,S),h(S,m,c,f,g),g.delete(m)),Ps(t,s,S)}function wc(t,n){var s=t.length;if(s)return n+=n<0?s:0,Ue(n,s)?t[n]:r}function _c(t,n,s){n.length?n=ft(n,function(f){return V(f)?function(g){return hr(g,f.length===1?f[0]:f)}:f}):n=[Kt];var c=-1;n=ft(n,Yt(L()));var h=yc(t,function(f,g,y){var m=ft(n,function(P){return P(f)});return{criteria:m,index:++c,value:f}});return sf(h,function(f,g){return Bd(f,g,s)})}function Dd(t,n){return bc(t,n,function(s,c){return oo(t,c)})}function bc(t,n,s){for(var c=-1,h=n.length,f={};++c<h;){var g=n[c],y=hr(t,g);s(y,g)&&gn(f,Je(g,t),y)}return f}function $d(t){return function(n){return hr(n,t)}}function Ds(t,n,s,c){var h=c?nf:Sr,f=-1,g=n.length,y=t;for(t===n&&(n=kt(n)),s&&(y=ft(t,Yt(s)));++f<g;)for(var m=0,P=n[f],S=s?s(P):P;(m=h(y,S,m,c))>-1;)y!==t&&Xn.call(y,m,1),Xn.call(t,m,1);return t}function Ec(t,n){for(var s=t?n.length:0,c=s-1;s--;){var h=n[s];if(s==c||h!==f){var f=h;Ue(h)?Xn.call(t,h,1):Us(t,h)}}return t}function $s(t,n){return t+ei(rc()*(n-t+1))}function jd(t,n,s,c){for(var h=-1,f=Ot(ti((n-t)/(s||1)),0),g=_(f);f--;)g[c?f:++h]=t,t+=s;return g}function js(t,n){var s="";if(!t||n<1||n>ct)return s;do n%2&&(s+=t),n=ei(n/2),n&&(t+=t);while(n);return s}function G(t,n){return Xs(Xc(t,n,Kt),t+"")}function qd(t){return sc(Ur(t))}function Ud(t,n){var s=Ur(t);return mi(s,ur(n,0,s.length))}function gn(t,n,s,c){if(!vt(t))return t;n=Je(n,t);for(var h=-1,f=n.length,g=f-1,y=t;y!=null&&++h<f;){var m=Ne(n[h]),P=s;if(m==="__proto__"||m==="constructor"||m==="prototype")return t;if(h!=g){var S=y[m];P=c?c(S,m,y):r,P===r&&(P=vt(S)?S:Ue(n[h+1])?[]:{})}ln(y,m,P),y=y[m]}return t}var Ic=ri?function(t,n){return ri.set(t,n),t}:Kt,Md=Zn?function(t,n){return Zn(t,"toString",{configurable:!0,enumerable:!1,value:co(n),writable:!0})}:Kt;function Ld(t){return mi(Ur(t))}function ue(t,n,s){var c=-1,h=t.length;n<0&&(n=-n>h?0:h+n),s=s>h?h:s,s<0&&(s+=h),h=n>s?0:s-n>>>0,n>>>=0;for(var f=_(h);++c<h;)f[c]=t[c+n];return f}function zd(t,n){var s;return Qe(t,function(c,h,f){return s=n(c,h,f),!s}),!!s}function ui(t,n,s){var c=0,h=t==null?c:t.length;if(typeof n=="number"&&n===n&&h<=kl){for(;c<h;){var f=c+h>>>1,g=t[f];g!==null&&!Xt(g)&&(s?g<=n:g<n)?c=f+1:h=f}return h}return qs(t,n,Kt,s)}function qs(t,n,s,c){var h=0,f=t==null?0:t.length;if(f===0)return 0;n=s(n);for(var g=n!==n,y=n===null,m=Xt(n),P=n===r;h<f;){var S=ei((h+f)/2),N=s(t[S]),D=N!==r,q=N===null,z=N===N,W=Xt(N);if(g)var k=c||z;else P?k=z&&(c||D):y?k=z&&D&&(c||!q):m?k=z&&D&&!q&&(c||!W):q||W?k=!1:k=c?N<=n:N<n;k?h=S+1:f=S}return $t(f,Yr)}function Pc(t,n){for(var s=-1,c=t.length,h=0,f=[];++s<c;){var g=t[s],y=n?n(g):g;if(!s||!me(y,m)){var m=y;f[h++]=g===0?0:g}}return f}function Sc(t){return typeof t=="number"?t:Xt(t)?xe:+t}function Jt(t){if(typeof t=="string")return t;if(V(t))return ft(t,Jt)+"";if(Xt(t))return nc?nc.call(t):"";var n=t+"";return n=="0"&&1/t==-mt?"-0":n}function Ye(t,n,s){var c=-1,h=Hn,f=t.length,g=!0,y=[],m=y;if(s)g=!1,h=ls;else if(f>=a){var P=n?null:Jd(t);if(P)return Kn(P);g=!1,h=sn,m=new cr}else m=n?[]:y;t:for(;++c<f;){var S=t[c],N=n?n(S):S;if(S=s||S!==0?S:0,g&&N===N){for(var D=m.length;D--;)if(m[D]===N)continue t;n&&m.push(N),y.push(S)}else h(m,N,s)||(m!==y&&m.push(N),y.push(S))}return y}function Us(t,n){return n=Je(n,t),t=Zc(t,n),t==null||delete t[Ne(he(n))]}function Oc(t,n,s,c){return gn(t,n,s(hr(t,n)),c)}function hi(t,n,s,c){for(var h=t.length,f=c?h:-1;(c?f--:++f<h)&&n(t[f],f,t););return s?ue(t,c?0:f,c?f+1:h):ue(t,c?f+1:0,c?h:f)}function Nc(t,n){var s=t;return s instanceof Y&&(s=s.value()),ps(n,function(c,h){return h.func.apply(h.thisArg,We([c],h.args))},s)}function Ms(t,n,s){var c=t.length;if(c<2)return c?Ye(t[0]):[];for(var h=-1,f=_(c);++h<c;)for(var g=t[h],y=-1;++y<c;)y!=h&&(f[h]=pn(f[h]||g,t[y],n,s));return Ye(Tt(f,1),n,s)}function Ac(t,n,s){for(var c=-1,h=t.length,f=n.length,g={};++c<h;){var y=c<f?n[c]:r;s(g,t[c],y)}return g}function Ls(t){return bt(t)?t:[]}function zs(t){return typeof t=="function"?t:Kt}function Je(t,n){return V(t)?t:Qs(t,n)?[t]:nu(nt(t))}var kd=G;function Xe(t,n,s){var c=t.length;return s=s===r?c:s,!n&&s>=c?t:ue(t,n,s)}var Rc=Af||function(t){return xt.clearTimeout(t)};function xc(t,n){if(n)return t.slice();var s=t.length,c=Ja?Ja(s):new t.constructor(s);return t.copy(c),c}function ks(t){var n=new t.constructor(t.byteLength);return new Yn(n).set(new Yn(t)),n}function Hd(t,n){var s=n?ks(t.buffer):t.buffer;return new t.constructor(s,t.byteOffset,t.byteLength)}function Vd(t){var n=new t.constructor(t.source,fa.exec(t));return n.lastIndex=t.lastIndex,n}function Kd(t){return hn?at(hn.call(t)):{}}function Tc(t,n){var s=n?ks(t.buffer):t.buffer;return new t.constructor(s,t.byteOffset,t.length)}function Cc(t,n){if(t!==n){var s=t!==r,c=t===null,h=t===t,f=Xt(t),g=n!==r,y=n===null,m=n===n,P=Xt(n);if(!y&&!P&&!f&&t>n||f&&g&&m&&!y&&!P||c&&g&&m||!s&&m||!h)return 1;if(!c&&!f&&!P&&t<n||P&&s&&h&&!c&&!f||y&&s&&h||!g&&h||!m)return-1}return 0}function Bd(t,n,s){for(var c=-1,h=t.criteria,f=n.criteria,g=h.length,y=s.length;++c<g;){var m=Cc(h[c],f[c]);if(m){if(c>=y)return m;var P=s[c];return m*(P=="desc"?-1:1)}}return t.index-n.index}function Dc(t,n,s,c){for(var h=-1,f=t.length,g=s.length,y=-1,m=n.length,P=Ot(f-g,0),S=_(m+P),N=!c;++y<m;)S[y]=n[y];for(;++h<g;)(N||h<f)&&(S[s[h]]=t[h]);for(;P--;)S[y++]=t[h++];return S}function $c(t,n,s,c){for(var h=-1,f=t.length,g=-1,y=s.length,m=-1,P=n.length,S=Ot(f-y,0),N=_(S+P),D=!c;++h<S;)N[h]=t[h];for(var q=h;++m<P;)N[q+m]=n[m];for(;++g<y;)(D||h<f)&&(N[q+s[g]]=t[h++]);return N}function kt(t,n){var s=-1,c=t.length;for(n||(n=_(c));++s<c;)n[s]=t[s];return n}function Oe(t,n,s,c){var h=!s;s||(s={});for(var f=-1,g=n.length;++f<g;){var y=n[f],m=c?c(s[y],t[y],y,s,t):r;m===r&&(m=t[y]),h?$e(s,y,m):ln(s,y,m)}return s}function Wd(t,n){return Oe(t,Gs(t),n)}function Fd(t,n){return Oe(t,Fc(t),n)}function li(t,n){return function(s,c){var h=V(s)?Jp:gd,f=n?n():{};return h(s,t,L(c,2),f)}}function Dr(t){return G(function(n,s){var c=-1,h=s.length,f=h>1?s[h-1]:r,g=h>2?s[2]:r;for(f=t.length>3&&typeof f=="function"?(h--,f):r,g&&Mt(s[0],s[1],g)&&(f=h<3?r:f,h=1),n=at(n);++c<h;){var y=s[c];y&&t(n,y,c,f)}return n})}function jc(t,n){return function(s,c){if(s==null)return s;if(!Ht(s))return t(s,c);for(var h=s.length,f=n?h:-1,g=at(s);(n?f--:++f<h)&&c(g[f],f,g)!==!1;);return s}}function qc(t){return function(n,s,c){for(var h=-1,f=at(n),g=c(n),y=g.length;y--;){var m=g[t?y:++h];if(s(f[m],m,f)===!1)break}return n}}function Gd(t,n,s){var c=n&F,h=yn(t);function f(){var g=this&&this!==xt&&this instanceof f?h:t;return g.apply(c?s:this,arguments)}return f}function Uc(t){return function(n){n=nt(n);var s=Or(n)?ye(n):r,c=s?s[0]:n.charAt(0),h=s?Xe(s,1).join(""):n.slice(1);return c[t]()+h}}function $r(t){return function(n){return ps(ju($u(n).replace(Up,"")),t,"")}}function yn(t){return function(){var n=arguments;switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3]);case 5:return new t(n[0],n[1],n[2],n[3],n[4]);case 6:return new t(n[0],n[1],n[2],n[3],n[4],n[5]);case 7:return new t(n[0],n[1],n[2],n[3],n[4],n[5],n[6])}var s=Cr(t.prototype),c=t.apply(s,n);return vt(c)?c:s}}function Qd(t,n,s){var c=yn(t);function h(){for(var f=arguments.length,g=_(f),y=f,m=jr(h);y--;)g[y]=arguments[y];var P=f<3&&g[0]!==m&&g[f-1]!==m?[]:Fe(g,m);if(f-=P.length,f<s)return Hc(t,n,pi,h.placeholder,r,g,P,r,r,s-f);var S=this&&this!==xt&&this instanceof h?c:t;return Qt(S,this,g)}return h}function Mc(t){return function(n,s,c){var h=at(n);if(!Ht(n)){var f=L(s,3);n=Nt(n),s=function(y){return f(h[y],y,h)}}var g=t(n,s,c);return g>-1?h[f?n[g]:g]:r}}function Lc(t){return qe(function(n){var s=n.length,c=s,h=ae.prototype.thru;for(t&&n.reverse();c--;){var f=n[c];if(typeof f!="function")throw new oe(l);if(h&&!g&&yi(f)=="wrapper")var g=new ae([],!0)}for(c=g?c:s;++c<s;){f=n[c];var y=yi(f),m=y=="wrapper"?Ws(f):r;m&&Ys(m[0])&&m[1]==(gt|rt|ot|yt)&&!m[4].length&&m[9]==1?g=g[yi(m[0])].apply(g,m[3]):g=f.length==1&&Ys(f)?g[y]():g.thru(f)}return function(){var P=arguments,S=P[0];if(g&&P.length==1&&V(S))return g.plant(S).value();for(var N=0,D=s?n[N].apply(this,P):S;++N<s;)D=n[N].call(this,D);return D}})}function pi(t,n,s,c,h,f,g,y,m,P){var S=n&gt,N=n&F,D=n&Z,q=n&(rt|X),z=n&Pe,W=D?r:yn(t);function k(){for(var Q=arguments.length,J=_(Q),Zt=Q;Zt--;)J[Zt]=arguments[Zt];if(q)var Lt=jr(k),te=af(J,Lt);if(c&&(J=Dc(J,c,h,q)),f&&(J=$c(J,f,g,q)),Q-=te,q&&Q<P){var Et=Fe(J,Lt);return Hc(t,n,pi,k.placeholder,s,J,Et,y,m,P-Q)}var we=N?s:this,ze=D?we[t]:t;return Q=J.length,y?J=gg(J,y):z&&Q>1&&J.reverse(),S&&m<Q&&(J.length=m),this&&this!==xt&&this instanceof k&&(ze=W||yn(ze)),ze.apply(we,J)}return k}function zc(t,n){return function(s,c){return Id(s,t,n(c),{})}}function fi(t,n){return function(s,c){var h;if(s===r&&c===r)return n;if(s!==r&&(h=s),c!==r){if(h===r)return c;typeof s=="string"||typeof c=="string"?(s=Jt(s),c=Jt(c)):(s=Sc(s),c=Sc(c)),h=t(s,c)}return h}}function Hs(t){return qe(function(n){return n=ft(n,Yt(L())),G(function(s){var c=this;return t(n,function(h){return Qt(h,c,s)})})})}function di(t,n){n=n===r?" ":Jt(n);var s=n.length;if(s<2)return s?js(n,t):n;var c=js(n,ti(t/Nr(n)));return Or(n)?Xe(ye(c),0,t).join(""):c.slice(0,t)}function Yd(t,n,s,c){var h=n&F,f=yn(t);function g(){for(var y=-1,m=arguments.length,P=-1,S=c.length,N=_(S+m),D=this&&this!==xt&&this instanceof g?f:t;++P<S;)N[P]=c[P];for(;m--;)N[P++]=arguments[++y];return Qt(D,h?s:this,N)}return g}function kc(t){return function(n,s,c){return c&&typeof c!="number"&&Mt(n,s,c)&&(s=c=r),n=Le(n),s===r?(s=n,n=0):s=Le(s),c=c===r?n<s?1:-1:Le(c),jd(n,s,c,t)}}function gi(t){return function(n,s){return typeof n=="string"&&typeof s=="string"||(n=le(n),s=le(s)),t(n,s)}}function Hc(t,n,s,c,h,f,g,y,m,P){var S=n&rt,N=S?g:r,D=S?r:g,q=S?f:r,z=S?r:f;n|=S?ot:Rt,n&=~(S?Rt:ot),n&_t||(n&=~(F|Z));var W=[t,n,h,q,N,z,D,y,m,P],k=s.apply(r,W);return Ys(t)&&tu(k,W),k.placeholder=c,eu(k,t,n)}function Vs(t){var n=St[t];return function(s,c){if(s=le(s),c=c==null?0:$t(K(c),292),c&&ec(s)){var h=(nt(s)+"e").split("e"),f=n(h[0]+"e"+(+h[1]+c));return h=(nt(f)+"e").split("e"),+(h[0]+"e"+(+h[1]-c))}return n(s)}}var Jd=xr&&1/Kn(new xr([,-0]))[1]==mt?function(t){return new xr(t)}:lo;function Vc(t){return function(n){var s=jt(n);return s==de?ws(n):s==ge?df(n):of(n,t(n))}}function je(t,n,s,c,h,f,g,y){var m=n&Z;if(!m&&typeof t!="function")throw new oe(l);var P=c?c.length:0;if(P||(n&=~(ot|Rt),c=h=r),g=g===r?g:Ot(K(g),0),y=y===r?y:K(y),P-=h?h.length:0,n&Rt){var S=c,N=h;c=h=r}var D=m?r:Ws(t),q=[t,n,s,c,h,S,N,f,g,y];if(D&&pg(q,D),t=q[0],n=q[1],s=q[2],c=q[3],h=q[4],y=q[9]=q[9]===r?m?0:t.length:Ot(q[9]-P,0),!y&&n&(rt|X)&&(n&=~(rt|X)),!n||n==F)var z=Gd(t,n,s);else n==rt||n==X?z=Qd(t,n,y):(n==ot||n==(F|ot))&&!h.length?z=Yd(t,n,s,c):z=pi.apply(r,q);var W=D?Ic:tu;return eu(W(z,q),t,n)}function Kc(t,n,s,c){return t===r||me(t,Rr[s])&&!st.call(c,s)?n:t}function Bc(t,n,s,c,h,f){return vt(t)&&vt(n)&&(f.set(n,t),ci(t,n,r,Bc,f),f.delete(n)),t}function Xd(t){return wn(t)?r:t}function Wc(t,n,s,c,h,f){var g=s&x,y=t.length,m=n.length;if(y!=m&&!(g&&m>y))return!1;var P=f.get(t),S=f.get(n);if(P&&S)return P==n&&S==t;var N=-1,D=!0,q=s&$?new cr:r;for(f.set(t,n),f.set(n,t);++N<y;){var z=t[N],W=n[N];if(c)var k=g?c(W,z,N,n,t,f):c(z,W,N,t,n,f);if(k!==r){if(k)continue;D=!1;break}if(q){if(!fs(n,function(Q,J){if(!sn(q,J)&&(z===Q||h(z,Q,s,c,f)))return q.push(J)})){D=!1;break}}else if(!(z===W||h(z,W,s,c,f))){D=!1;break}}return f.delete(t),f.delete(n),D}function Zd(t,n,s,c,h,f,g){switch(s){case Ir:if(t.byteLength!=n.byteLength||t.byteOffset!=n.byteOffset)return!1;t=t.buffer,n=n.buffer;case nn:return!(t.byteLength!=n.byteLength||!f(new Yn(t),new Yn(n)));case Jr:case Xr:case Zr:return me(+t,+n);case qn:return t.name==n.name&&t.message==n.message;case tn:case en:return t==n+"";case de:var y=ws;case ge:var m=c&x;if(y||(y=Kn),t.size!=n.size&&!m)return!1;var P=g.get(t);if(P)return P==n;c|=$,g.set(t,n);var S=Wc(y(t),y(n),c,h,f,g);return g.delete(t),S;case Mn:if(hn)return hn.call(t)==hn.call(n)}return!1}function tg(t,n,s,c,h,f){var g=s&x,y=Ks(t),m=y.length,P=Ks(n),S=P.length;if(m!=S&&!g)return!1;for(var N=m;N--;){var D=y[N];if(!(g?D in n:st.call(n,D)))return!1}var q=f.get(t),z=f.get(n);if(q&&z)return q==n&&z==t;var W=!0;f.set(t,n),f.set(n,t);for(var k=g;++N<m;){D=y[N];var Q=t[D],J=n[D];if(c)var Zt=g?c(J,Q,D,n,t,f):c(Q,J,D,t,n,f);if(!(Zt===r?Q===J||h(Q,J,s,c,f):Zt)){W=!1;break}k||(k=D=="constructor")}if(W&&!k){var Lt=t.constructor,te=n.constructor;Lt!=te&&"constructor"in t&&"constructor"in n&&!(typeof Lt=="function"&&Lt instanceof Lt&&typeof te=="function"&&te instanceof te)&&(W=!1)}return f.delete(t),f.delete(n),W}function qe(t){return Xs(Xc(t,r,au),t+"")}function Ks(t){return pc(t,Nt,Gs)}function Bs(t){return pc(t,Vt,Fc)}var Ws=ri?function(t){return ri.get(t)}:lo;function yi(t){for(var n=t.name+"",s=Tr[n],c=st.call(Tr,n)?s.length:0;c--;){var h=s[c],f=h.func;if(f==null||f==t)return h.name}return n}function jr(t){var n=st.call(p,"placeholder")?p:t;return n.placeholder}function L(){var t=p.iteratee||uo;return t=t===uo?gc:t,arguments.length?t(arguments[0],arguments[1]):t}function vi(t,n){var s=t.__data__;return cg(n)?s[typeof n=="string"?"string":"hash"]:s.map}function Fs(t){for(var n=Nt(t),s=n.length;s--;){var c=n[s],h=t[c];n[s]=[c,h,Yc(h)]}return n}function lr(t,n){var s=lf(t,n);return dc(s)?s:r}function eg(t){var n=st.call(t,or),s=t[or];try{t[or]=r;var c=!0}catch{}var h=Gn.call(t);return c&&(n?t[or]=s:delete t[or]),h}var Gs=bs?function(t){return t==null?[]:(t=at(t),Be(bs(t),function(n){return Za.call(t,n)}))}:po,Fc=bs?function(t){for(var n=[];t;)We(n,Gs(t)),t=Jn(t);return n}:po,jt=Ut;(Es&&jt(new Es(new ArrayBuffer(1)))!=Ir||an&&jt(new an)!=de||Is&&jt(Is.resolve())!=ua||xr&&jt(new xr)!=ge||cn&&jt(new cn)!=rn)&&(jt=function(t){var n=Ut(t),s=n==Te?t.constructor:r,c=s?pr(s):"";if(c)switch(c){case Uf:return Ir;case Mf:return de;case Lf:return ua;case zf:return ge;case kf:return rn}return n});function rg(t,n,s){for(var c=-1,h=s.length;++c<h;){var f=s[c],g=f.size;switch(f.type){case"drop":t+=g;break;case"dropRight":n-=g;break;case"take":n=$t(n,t+g);break;case"takeRight":t=Ot(t,n-g);break}}return{start:t,end:n}}function ng(t){var n=t.match(cp);return n?n[1].split(up):[]}function Gc(t,n,s){n=Je(n,t);for(var c=-1,h=n.length,f=!1;++c<h;){var g=Ne(n[c]);if(!(f=t!=null&&s(t,g)))break;t=t[g]}return f||++c!=h?f:(h=t==null?0:t.length,!!h&&Pi(h)&&Ue(g,h)&&(V(t)||fr(t)))}function ig(t){var n=t.length,s=new t.constructor(n);return n&&typeof t[0]=="string"&&st.call(t,"index")&&(s.index=t.index,s.input=t.input),s}function Qc(t){return typeof t.constructor=="function"&&!vn(t)?Cr(Jn(t)):{}}function sg(t,n,s){var c=t.constructor;switch(n){case nn:return ks(t);case Jr:case Xr:return new c(+t);case Ir:return Hd(t,s);case Fi:case Gi:case Qi:case Yi:case Ji:case Xi:case Zi:case ts:case es:return Tc(t,s);case de:return new c;case Zr:case en:return new c(t);case tn:return Vd(t);case ge:return new c;case Mn:return Kd(t)}}function og(t,n){var s=n.length;if(!s)return t;var c=s-1;return n[c]=(s>1?"& ":"")+n[c],n=n.join(s>2?", ":" "),t.replace(ap,`{
/* [wrapped with `+n+`] */
`)}function ag(t){return V(t)||fr(t)||!!(tc&&t&&t[tc])}function Ue(t,n){var s=typeof t;return n=n??ct,!!n&&(s=="number"||s!="symbol"&&mp.test(t))&&t>-1&&t%1==0&&t<n}function Mt(t,n,s){if(!vt(s))return!1;var c=typeof n;return(c=="number"?Ht(s)&&Ue(n,s.length):c=="string"&&n in s)?me(s[n],t):!1}function Qs(t,n){if(V(t))return!1;var s=typeof t;return s=="number"||s=="symbol"||s=="boolean"||t==null||Xt(t)?!0:np.test(t)||!rp.test(t)||n!=null&&t in at(n)}function cg(t){var n=typeof t;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?t!=="__proto__":t===null}function Ys(t){var n=yi(t),s=p[n];if(typeof s!="function"||!(n in Y.prototype))return!1;if(t===s)return!0;var c=Ws(s);return!!c&&t===c[0]}function ug(t){return!!Ya&&Ya in t}var hg=Wn?Me:fo;function vn(t){var n=t&&t.constructor,s=typeof n=="function"&&n.prototype||Rr;return t===s}function Yc(t){return t===t&&!vt(t)}function Jc(t,n){return function(s){return s==null?!1:s[t]===n&&(n!==r||t in at(s))}}function lg(t){var n=Ei(t,function(c){return s.size===b&&s.clear(),c}),s=n.cache;return n}function pg(t,n){var s=t[1],c=n[1],h=s|c,f=h<(F|Z|gt),g=c==gt&&s==rt||c==gt&&s==yt&&t[7].length<=n[8]||c==(gt|yt)&&n[7].length<=n[8]&&s==rt;if(!(f||g))return t;c&F&&(t[2]=n[2],h|=s&F?0:_t);var y=n[3];if(y){var m=t[3];t[3]=m?Dc(m,y,n[4]):y,t[4]=m?Fe(t[3],A):n[4]}return y=n[5],y&&(m=t[5],t[5]=m?$c(m,y,n[6]):y,t[6]=m?Fe(t[5],A):n[6]),y=n[7],y&&(t[7]=y),c&gt&&(t[8]=t[8]==null?n[8]:$t(t[8],n[8])),t[9]==null&&(t[9]=n[9]),t[0]=n[0],t[1]=h,t}function fg(t){var n=[];if(t!=null)for(var s in at(t))n.push(s);return n}function dg(t){return Gn.call(t)}function Xc(t,n,s){return n=Ot(n===r?t.length-1:n,0),function(){for(var c=arguments,h=-1,f=Ot(c.length-n,0),g=_(f);++h<f;)g[h]=c[n+h];h=-1;for(var y=_(n+1);++h<n;)y[h]=c[h];return y[n]=s(g),Qt(t,this,y)}}function Zc(t,n){return n.length<2?t:hr(t,ue(n,0,-1))}function gg(t,n){for(var s=t.length,c=$t(n.length,s),h=kt(t);c--;){var f=n[c];t[c]=Ue(f,s)?h[f]:r}return t}function Js(t,n){if(!(n==="constructor"&&typeof t[n]=="function")&&n!="__proto__")return t[n]}var tu=ru(Ic),mn=xf||function(t,n){return xt.setTimeout(t,n)},Xs=ru(Md);function eu(t,n,s){var c=n+"";return Xs(t,og(c,yg(ng(c),s)))}function ru(t){var n=0,s=0;return function(){var c=$f(),h=Qr-(c-s);if(s=c,h>0){if(++n>=Wi)return arguments[0]}else n=0;return t.apply(r,arguments)}}function mi(t,n){var s=-1,c=t.length,h=c-1;for(n=n===r?c:n;++s<n;){var f=$s(s,h),g=t[f];t[f]=t[s],t[s]=g}return t.length=n,t}var nu=lg(function(t){var n=[];return t.charCodeAt(0)===46&&n.push(""),t.replace(ip,function(s,c,h,f){n.push(h?f.replace(pp,"$1"):c||s)}),n});function Ne(t){if(typeof t=="string"||Xt(t))return t;var n=t+"";return n=="0"&&1/t==-mt?"-0":n}function pr(t){if(t!=null){try{return Fn.call(t)}catch{}try{return t+""}catch{}}return""}function yg(t,n){return se(Hl,function(s){var c="_."+s[0];n&s[1]&&!Hn(t,c)&&t.push(c)}),t.sort()}function iu(t){if(t instanceof Y)return t.clone();var n=new ae(t.__wrapped__,t.__chain__);return n.__actions__=kt(t.__actions__),n.__index__=t.__index__,n.__values__=t.__values__,n}function vg(t,n,s){(s?Mt(t,n,s):n===r)?n=1:n=Ot(K(n),0);var c=t==null?0:t.length;if(!c||n<1)return[];for(var h=0,f=0,g=_(ti(c/n));h<c;)g[f++]=ue(t,h,h+=n);return g}function mg(t){for(var n=-1,s=t==null?0:t.length,c=0,h=[];++n<s;){var f=t[n];f&&(h[c++]=f)}return h}function wg(){var t=arguments.length;if(!t)return[];for(var n=_(t-1),s=arguments[0],c=t;c--;)n[c-1]=arguments[c];return We(V(s)?kt(s):[s],Tt(n,1))}var _g=G(function(t,n){return bt(t)?pn(t,Tt(n,1,bt,!0)):[]}),bg=G(function(t,n){var s=he(n);return bt(s)&&(s=r),bt(t)?pn(t,Tt(n,1,bt,!0),L(s,2)):[]}),Eg=G(function(t,n){var s=he(n);return bt(s)&&(s=r),bt(t)?pn(t,Tt(n,1,bt,!0),r,s):[]});function Ig(t,n,s){var c=t==null?0:t.length;return c?(n=s||n===r?1:K(n),ue(t,n<0?0:n,c)):[]}function Pg(t,n,s){var c=t==null?0:t.length;return c?(n=s||n===r?1:K(n),n=c-n,ue(t,0,n<0?0:n)):[]}function Sg(t,n){return t&&t.length?hi(t,L(n,3),!0,!0):[]}function Og(t,n){return t&&t.length?hi(t,L(n,3),!0):[]}function Ng(t,n,s,c){var h=t==null?0:t.length;return h?(s&&typeof s!="number"&&Mt(t,n,s)&&(s=0,c=h),wd(t,n,s,c)):[]}function su(t,n,s){var c=t==null?0:t.length;if(!c)return-1;var h=s==null?0:K(s);return h<0&&(h=Ot(c+h,0)),Vn(t,L(n,3),h)}function ou(t,n,s){var c=t==null?0:t.length;if(!c)return-1;var h=c-1;return s!==r&&(h=K(s),h=s<0?Ot(c+h,0):$t(h,c-1)),Vn(t,L(n,3),h,!0)}function au(t){var n=t==null?0:t.length;return n?Tt(t,1):[]}function Ag(t){var n=t==null?0:t.length;return n?Tt(t,mt):[]}function Rg(t,n){var s=t==null?0:t.length;return s?(n=n===r?1:K(n),Tt(t,n)):[]}function xg(t){for(var n=-1,s=t==null?0:t.length,c={};++n<s;){var h=t[n];c[h[0]]=h[1]}return c}function cu(t){return t&&t.length?t[0]:r}function Tg(t,n,s){var c=t==null?0:t.length;if(!c)return-1;var h=s==null?0:K(s);return h<0&&(h=Ot(c+h,0)),Sr(t,n,h)}function Cg(t){var n=t==null?0:t.length;return n?ue(t,0,-1):[]}var Dg=G(function(t){var n=ft(t,Ls);return n.length&&n[0]===t[0]?Rs(n):[]}),$g=G(function(t){var n=he(t),s=ft(t,Ls);return n===he(s)?n=r:s.pop(),s.length&&s[0]===t[0]?Rs(s,L(n,2)):[]}),jg=G(function(t){var n=he(t),s=ft(t,Ls);return n=typeof n=="function"?n:r,n&&s.pop(),s.length&&s[0]===t[0]?Rs(s,r,n):[]});function qg(t,n){return t==null?"":Cf.call(t,n)}function he(t){var n=t==null?0:t.length;return n?t[n-1]:r}function Ug(t,n,s){var c=t==null?0:t.length;if(!c)return-1;var h=c;return s!==r&&(h=K(s),h=h<0?Ot(c+h,0):$t(h,c-1)),n===n?yf(t,n,h):Vn(t,Ha,h,!0)}function Mg(t,n){return t&&t.length?wc(t,K(n)):r}var Lg=G(uu);function uu(t,n){return t&&t.length&&n&&n.length?Ds(t,n):t}function zg(t,n,s){return t&&t.length&&n&&n.length?Ds(t,n,L(s,2)):t}function kg(t,n,s){return t&&t.length&&n&&n.length?Ds(t,n,r,s):t}var Hg=qe(function(t,n){var s=t==null?0:t.length,c=Ss(t,n);return Ec(t,ft(n,function(h){return Ue(h,s)?+h:h}).sort(Cc)),c});function Vg(t,n){var s=[];if(!(t&&t.length))return s;var c=-1,h=[],f=t.length;for(n=L(n,3);++c<f;){var g=t[c];n(g,c,t)&&(s.push(g),h.push(c))}return Ec(t,h),s}function Zs(t){return t==null?t:qf.call(t)}function Kg(t,n,s){var c=t==null?0:t.length;return c?(s&&typeof s!="number"&&Mt(t,n,s)?(n=0,s=c):(n=n==null?0:K(n),s=s===r?c:K(s)),ue(t,n,s)):[]}function Bg(t,n){return ui(t,n)}function Wg(t,n,s){return qs(t,n,L(s,2))}function Fg(t,n){var s=t==null?0:t.length;if(s){var c=ui(t,n);if(c<s&&me(t[c],n))return c}return-1}function Gg(t,n){return ui(t,n,!0)}function Qg(t,n,s){return qs(t,n,L(s,2),!0)}function Yg(t,n){var s=t==null?0:t.length;if(s){var c=ui(t,n,!0)-1;if(me(t[c],n))return c}return-1}function Jg(t){return t&&t.length?Pc(t):[]}function Xg(t,n){return t&&t.length?Pc(t,L(n,2)):[]}function Zg(t){var n=t==null?0:t.length;return n?ue(t,1,n):[]}function ty(t,n,s){return t&&t.length?(n=s||n===r?1:K(n),ue(t,0,n<0?0:n)):[]}function ey(t,n,s){var c=t==null?0:t.length;return c?(n=s||n===r?1:K(n),n=c-n,ue(t,n<0?0:n,c)):[]}function ry(t,n){return t&&t.length?hi(t,L(n,3),!1,!0):[]}function ny(t,n){return t&&t.length?hi(t,L(n,3)):[]}var iy=G(function(t){return Ye(Tt(t,1,bt,!0))}),sy=G(function(t){var n=he(t);return bt(n)&&(n=r),Ye(Tt(t,1,bt,!0),L(n,2))}),oy=G(function(t){var n=he(t);return n=typeof n=="function"?n:r,Ye(Tt(t,1,bt,!0),r,n)});function ay(t){return t&&t.length?Ye(t):[]}function cy(t,n){return t&&t.length?Ye(t,L(n,2)):[]}function uy(t,n){return n=typeof n=="function"?n:r,t&&t.length?Ye(t,r,n):[]}function to(t){if(!(t&&t.length))return[];var n=0;return t=Be(t,function(s){if(bt(s))return n=Ot(s.length,n),!0}),vs(n,function(s){return ft(t,ds(s))})}function hu(t,n){if(!(t&&t.length))return[];var s=to(t);return n==null?s:ft(s,function(c){return Qt(n,r,c)})}var hy=G(function(t,n){return bt(t)?pn(t,n):[]}),ly=G(function(t){return Ms(Be(t,bt))}),py=G(function(t){var n=he(t);return bt(n)&&(n=r),Ms(Be(t,bt),L(n,2))}),fy=G(function(t){var n=he(t);return n=typeof n=="function"?n:r,Ms(Be(t,bt),r,n)}),dy=G(to);function gy(t,n){return Ac(t||[],n||[],ln)}function yy(t,n){return Ac(t||[],n||[],gn)}var vy=G(function(t){var n=t.length,s=n>1?t[n-1]:r;return s=typeof s=="function"?(t.pop(),s):r,hu(t,s)});function lu(t){var n=p(t);return n.__chain__=!0,n}function my(t,n){return n(t),t}function wi(t,n){return n(t)}var wy=qe(function(t){var n=t.length,s=n?t[0]:0,c=this.__wrapped__,h=function(f){return Ss(f,t)};return n>1||this.__actions__.length||!(c instanceof Y)||!Ue(s)?this.thru(h):(c=c.slice(s,+s+(n?1:0)),c.__actions__.push({func:wi,args:[h],thisArg:r}),new ae(c,this.__chain__).thru(function(f){return n&&!f.length&&f.push(r),f}))});function _y(){return lu(this)}function by(){return new ae(this.value(),this.__chain__)}function Ey(){this.__values__===r&&(this.__values__=Su(this.value()));var t=this.__index__>=this.__values__.length,n=t?r:this.__values__[this.__index__++];return{done:t,value:n}}function Iy(){return this}function Py(t){for(var n,s=this;s instanceof ii;){var c=iu(s);c.__index__=0,c.__values__=r,n?h.__wrapped__=c:n=c;var h=c;s=s.__wrapped__}return h.__wrapped__=t,n}function Sy(){var t=this.__wrapped__;if(t instanceof Y){var n=t;return this.__actions__.length&&(n=new Y(this)),n=n.reverse(),n.__actions__.push({func:wi,args:[Zs],thisArg:r}),new ae(n,this.__chain__)}return this.thru(Zs)}function Oy(){return Nc(this.__wrapped__,this.__actions__)}var Ny=li(function(t,n,s){st.call(t,s)?++t[s]:$e(t,s,1)});function Ay(t,n,s){var c=V(t)?za:md;return s&&Mt(t,n,s)&&(n=r),c(t,L(n,3))}function Ry(t,n){var s=V(t)?Be:hc;return s(t,L(n,3))}var xy=Mc(su),Ty=Mc(ou);function Cy(t,n){return Tt(_i(t,n),1)}function Dy(t,n){return Tt(_i(t,n),mt)}function $y(t,n,s){return s=s===r?1:K(s),Tt(_i(t,n),s)}function pu(t,n){var s=V(t)?se:Qe;return s(t,L(n,3))}function fu(t,n){var s=V(t)?Xp:uc;return s(t,L(n,3))}var jy=li(function(t,n,s){st.call(t,s)?t[s].push(n):$e(t,s,[n])});function qy(t,n,s,c){t=Ht(t)?t:Ur(t),s=s&&!c?K(s):0;var h=t.length;return s<0&&(s=Ot(h+s,0)),Si(t)?s<=h&&t.indexOf(n,s)>-1:!!h&&Sr(t,n,s)>-1}var Uy=G(function(t,n,s){var c=-1,h=typeof n=="function",f=Ht(t)?_(t.length):[];return Qe(t,function(g){f[++c]=h?Qt(n,g,s):fn(g,n,s)}),f}),My=li(function(t,n,s){$e(t,s,n)});function _i(t,n){var s=V(t)?ft:yc;return s(t,L(n,3))}function Ly(t,n,s,c){return t==null?[]:(V(n)||(n=n==null?[]:[n]),s=c?r:s,V(s)||(s=s==null?[]:[s]),_c(t,n,s))}var zy=li(function(t,n,s){t[s?0:1].push(n)},function(){return[[],[]]});function ky(t,n,s){var c=V(t)?ps:Ka,h=arguments.length<3;return c(t,L(n,4),s,h,Qe)}function Hy(t,n,s){var c=V(t)?Zp:Ka,h=arguments.length<3;return c(t,L(n,4),s,h,uc)}function Vy(t,n){var s=V(t)?Be:hc;return s(t,Ii(L(n,3)))}function Ky(t){var n=V(t)?sc:qd;return n(t)}function By(t,n,s){(s?Mt(t,n,s):n===r)?n=1:n=K(n);var c=V(t)?fd:Ud;return c(t,n)}function Wy(t){var n=V(t)?dd:Ld;return n(t)}function Fy(t){if(t==null)return 0;if(Ht(t))return Si(t)?Nr(t):t.length;var n=jt(t);return n==de||n==ge?t.size:Ts(t).length}function Gy(t,n,s){var c=V(t)?fs:zd;return s&&Mt(t,n,s)&&(n=r),c(t,L(n,3))}var Qy=G(function(t,n){if(t==null)return[];var s=n.length;return s>1&&Mt(t,n[0],n[1])?n=[]:s>2&&Mt(n[0],n[1],n[2])&&(n=[n[0]]),_c(t,Tt(n,1),[])}),bi=Rf||function(){return xt.Date.now()};function Yy(t,n){if(typeof n!="function")throw new oe(l);return t=K(t),function(){if(--t<1)return n.apply(this,arguments)}}function du(t,n,s){return n=s?r:n,n=t&&n==null?t.length:n,je(t,gt,r,r,r,r,n)}function gu(t,n){var s;if(typeof n!="function")throw new oe(l);return t=K(t),function(){return--t>0&&(s=n.apply(this,arguments)),t<=1&&(n=r),s}}var eo=G(function(t,n,s){var c=F;if(s.length){var h=Fe(s,jr(eo));c|=ot}return je(t,c,n,s,h)}),yu=G(function(t,n,s){var c=F|Z;if(s.length){var h=Fe(s,jr(yu));c|=ot}return je(n,c,t,s,h)});function vu(t,n,s){n=s?r:n;var c=je(t,rt,r,r,r,r,r,n);return c.placeholder=vu.placeholder,c}function mu(t,n,s){n=s?r:n;var c=je(t,X,r,r,r,r,r,n);return c.placeholder=mu.placeholder,c}function wu(t,n,s){var c,h,f,g,y,m,P=0,S=!1,N=!1,D=!0;if(typeof t!="function")throw new oe(l);n=le(n)||0,vt(s)&&(S=!!s.leading,N="maxWait"in s,f=N?Ot(le(s.maxWait)||0,n):f,D="trailing"in s?!!s.trailing:D);function q(Et){var we=c,ze=h;return c=h=r,P=Et,g=t.apply(ze,we),g}function z(Et){return P=Et,y=mn(Q,n),S?q(Et):g}function W(Et){var we=Et-m,ze=Et-P,Mu=n-we;return N?$t(Mu,f-ze):Mu}function k(Et){var we=Et-m,ze=Et-P;return m===r||we>=n||we<0||N&&ze>=f}function Q(){var Et=bi();if(k(Et))return J(Et);y=mn(Q,W(Et))}function J(Et){return y=r,D&&c?q(Et):(c=h=r,g)}function Zt(){y!==r&&Rc(y),P=0,c=m=h=y=r}function Lt(){return y===r?g:J(bi())}function te(){var Et=bi(),we=k(Et);if(c=arguments,h=this,m=Et,we){if(y===r)return z(m);if(N)return Rc(y),y=mn(Q,n),q(m)}return y===r&&(y=mn(Q,n)),g}return te.cancel=Zt,te.flush=Lt,te}var Jy=G(function(t,n){return cc(t,1,n)}),Xy=G(function(t,n,s){return cc(t,le(n)||0,s)});function Zy(t){return je(t,Pe)}function Ei(t,n){if(typeof t!="function"||n!=null&&typeof n!="function")throw new oe(l);var s=function(){var c=arguments,h=n?n.apply(this,c):c[0],f=s.cache;if(f.has(h))return f.get(h);var g=t.apply(this,c);return s.cache=f.set(h,g)||f,g};return s.cache=new(Ei.Cache||De),s}Ei.Cache=De;function Ii(t){if(typeof t!="function")throw new oe(l);return function(){var n=arguments;switch(n.length){case 0:return!t.call(this);case 1:return!t.call(this,n[0]);case 2:return!t.call(this,n[0],n[1]);case 3:return!t.call(this,n[0],n[1],n[2])}return!t.apply(this,n)}}function tv(t){return gu(2,t)}var ev=kd(function(t,n){n=n.length==1&&V(n[0])?ft(n[0],Yt(L())):ft(Tt(n,1),Yt(L()));var s=n.length;return G(function(c){for(var h=-1,f=$t(c.length,s);++h<f;)c[h]=n[h].call(this,c[h]);return Qt(t,this,c)})}),ro=G(function(t,n){var s=Fe(n,jr(ro));return je(t,ot,r,n,s)}),_u=G(function(t,n){var s=Fe(n,jr(_u));return je(t,Rt,r,n,s)}),rv=qe(function(t,n){return je(t,yt,r,r,r,n)});function nv(t,n){if(typeof t!="function")throw new oe(l);return n=n===r?n:K(n),G(t,n)}function iv(t,n){if(typeof t!="function")throw new oe(l);return n=n==null?0:Ot(K(n),0),G(function(s){var c=s[n],h=Xe(s,0,n);return c&&We(h,c),Qt(t,this,h)})}function sv(t,n,s){var c=!0,h=!0;if(typeof t!="function")throw new oe(l);return vt(s)&&(c="leading"in s?!!s.leading:c,h="trailing"in s?!!s.trailing:h),wu(t,n,{leading:c,maxWait:n,trailing:h})}function ov(t){return du(t,1)}function av(t,n){return ro(zs(n),t)}function cv(){if(!arguments.length)return[];var t=arguments[0];return V(t)?t:[t]}function uv(t){return ce(t,M)}function hv(t,n){return n=typeof n=="function"?n:r,ce(t,M,n)}function lv(t){return ce(t,O|M)}function pv(t,n){return n=typeof n=="function"?n:r,ce(t,O|M,n)}function fv(t,n){return n==null||ac(t,n,Nt(n))}function me(t,n){return t===n||t!==t&&n!==n}var dv=gi(As),gv=gi(function(t,n){return t>=n}),fr=fc(function(){return arguments}())?fc:function(t){return wt(t)&&st.call(t,"callee")&&!Za.call(t,"callee")},V=_.isArray,yv=$a?Yt($a):Pd;function Ht(t){return t!=null&&Pi(t.length)&&!Me(t)}function bt(t){return wt(t)&&Ht(t)}function vv(t){return t===!0||t===!1||wt(t)&&Ut(t)==Jr}var Ze=Tf||fo,mv=ja?Yt(ja):Sd;function wv(t){return wt(t)&&t.nodeType===1&&!wn(t)}function _v(t){if(t==null)return!0;if(Ht(t)&&(V(t)||typeof t=="string"||typeof t.splice=="function"||Ze(t)||qr(t)||fr(t)))return!t.length;var n=jt(t);if(n==de||n==ge)return!t.size;if(vn(t))return!Ts(t).length;for(var s in t)if(st.call(t,s))return!1;return!0}function bv(t,n){return dn(t,n)}function Ev(t,n,s){s=typeof s=="function"?s:r;var c=s?s(t,n):r;return c===r?dn(t,n,r,s):!!c}function no(t){if(!wt(t))return!1;var n=Ut(t);return n==qn||n==Kl||typeof t.message=="string"&&typeof t.name=="string"&&!wn(t)}function Iv(t){return typeof t=="number"&&ec(t)}function Me(t){if(!vt(t))return!1;var n=Ut(t);return n==Un||n==ca||n==Vl||n==Wl}function bu(t){return typeof t=="number"&&t==K(t)}function Pi(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=ct}function vt(t){var n=typeof t;return t!=null&&(n=="object"||n=="function")}function wt(t){return t!=null&&typeof t=="object"}var Eu=qa?Yt(qa):Nd;function Pv(t,n){return t===n||xs(t,n,Fs(n))}function Sv(t,n,s){return s=typeof s=="function"?s:r,xs(t,n,Fs(n),s)}function Ov(t){return Iu(t)&&t!=+t}function Nv(t){if(hg(t))throw new H(u);return dc(t)}function Av(t){return t===null}function Rv(t){return t==null}function Iu(t){return typeof t=="number"||wt(t)&&Ut(t)==Zr}function wn(t){if(!wt(t)||Ut(t)!=Te)return!1;var n=Jn(t);if(n===null)return!0;var s=st.call(n,"constructor")&&n.constructor;return typeof s=="function"&&s instanceof s&&Fn.call(s)==Sf}var io=Ua?Yt(Ua):Ad;function xv(t){return bu(t)&&t>=-ct&&t<=ct}var Pu=Ma?Yt(Ma):Rd;function Si(t){return typeof t=="string"||!V(t)&&wt(t)&&Ut(t)==en}function Xt(t){return typeof t=="symbol"||wt(t)&&Ut(t)==Mn}var qr=La?Yt(La):xd;function Tv(t){return t===r}function Cv(t){return wt(t)&&jt(t)==rn}function Dv(t){return wt(t)&&Ut(t)==Gl}var $v=gi(Cs),jv=gi(function(t,n){return t<=n});function Su(t){if(!t)return[];if(Ht(t))return Si(t)?ye(t):kt(t);if(on&&t[on])return ff(t[on]());var n=jt(t),s=n==de?ws:n==ge?Kn:Ur;return s(t)}function Le(t){if(!t)return t===0?t:0;if(t=le(t),t===mt||t===-mt){var n=t<0?-1:1;return n*it}return t===t?t:0}function K(t){var n=Le(t),s=n%1;return n===n?s?n-s:n:0}function Ou(t){return t?ur(K(t),0,Dt):0}function le(t){if(typeof t=="number")return t;if(Xt(t))return xe;if(vt(t)){var n=typeof t.valueOf=="function"?t.valueOf():t;t=vt(n)?n+"":n}if(typeof t!="string")return t===0?t:+t;t=Ba(t);var s=gp.test(t);return s||vp.test(t)?Qp(t.slice(2),s?2:8):dp.test(t)?xe:+t}function Nu(t){return Oe(t,Vt(t))}function qv(t){return t?ur(K(t),-ct,ct):t===0?t:0}function nt(t){return t==null?"":Jt(t)}var Uv=Dr(function(t,n){if(vn(n)||Ht(n)){Oe(n,Nt(n),t);return}for(var s in n)st.call(n,s)&&ln(t,s,n[s])}),Au=Dr(function(t,n){Oe(n,Vt(n),t)}),Oi=Dr(function(t,n,s,c){Oe(n,Vt(n),t,c)}),Mv=Dr(function(t,n,s,c){Oe(n,Nt(n),t,c)}),Lv=qe(Ss);function zv(t,n){var s=Cr(t);return n==null?s:oc(s,n)}var kv=G(function(t,n){t=at(t);var s=-1,c=n.length,h=c>2?n[2]:r;for(h&&Mt(n[0],n[1],h)&&(c=1);++s<c;)for(var f=n[s],g=Vt(f),y=-1,m=g.length;++y<m;){var P=g[y],S=t[P];(S===r||me(S,Rr[P])&&!st.call(t,P))&&(t[P]=f[P])}return t}),Hv=G(function(t){return t.push(r,Bc),Qt(Ru,r,t)});function Vv(t,n){return ka(t,L(n,3),Se)}function Kv(t,n){return ka(t,L(n,3),Ns)}function Bv(t,n){return t==null?t:Os(t,L(n,3),Vt)}function Wv(t,n){return t==null?t:lc(t,L(n,3),Vt)}function Fv(t,n){return t&&Se(t,L(n,3))}function Gv(t,n){return t&&Ns(t,L(n,3))}function Qv(t){return t==null?[]:ai(t,Nt(t))}function Yv(t){return t==null?[]:ai(t,Vt(t))}function so(t,n,s){var c=t==null?r:hr(t,n);return c===r?s:c}function Jv(t,n){return t!=null&&Gc(t,n,_d)}function oo(t,n){return t!=null&&Gc(t,n,bd)}var Xv=zc(function(t,n,s){n!=null&&typeof n.toString!="function"&&(n=Gn.call(n)),t[n]=s},co(Kt)),Zv=zc(function(t,n,s){n!=null&&typeof n.toString!="function"&&(n=Gn.call(n)),st.call(t,n)?t[n].push(s):t[n]=[s]},L),tm=G(fn);function Nt(t){return Ht(t)?ic(t):Ts(t)}function Vt(t){return Ht(t)?ic(t,!0):Td(t)}function em(t,n){var s={};return n=L(n,3),Se(t,function(c,h,f){$e(s,n(c,h,f),c)}),s}function rm(t,n){var s={};return n=L(n,3),Se(t,function(c,h,f){$e(s,h,n(c,h,f))}),s}var nm=Dr(function(t,n,s){ci(t,n,s)}),Ru=Dr(function(t,n,s,c){ci(t,n,s,c)}),im=qe(function(t,n){var s={};if(t==null)return s;var c=!1;n=ft(n,function(f){return f=Je(f,t),c||(c=f.length>1),f}),Oe(t,Bs(t),s),c&&(s=ce(s,O|R|M,Xd));for(var h=n.length;h--;)Us(s,n[h]);return s});function sm(t,n){return xu(t,Ii(L(n)))}var om=qe(function(t,n){return t==null?{}:Dd(t,n)});function xu(t,n){if(t==null)return{};var s=ft(Bs(t),function(c){return[c]});return n=L(n),bc(t,s,function(c,h){return n(c,h[0])})}function am(t,n,s){n=Je(n,t);var c=-1,h=n.length;for(h||(h=1,t=r);++c<h;){var f=t==null?r:t[Ne(n[c])];f===r&&(c=h,f=s),t=Me(f)?f.call(t):f}return t}function cm(t,n,s){return t==null?t:gn(t,n,s)}function um(t,n,s,c){return c=typeof c=="function"?c:r,t==null?t:gn(t,n,s,c)}var Tu=Vc(Nt),Cu=Vc(Vt);function hm(t,n,s){var c=V(t),h=c||Ze(t)||qr(t);if(n=L(n,4),s==null){var f=t&&t.constructor;h?s=c?new f:[]:vt(t)?s=Me(f)?Cr(Jn(t)):{}:s={}}return(h?se:Se)(t,function(g,y,m){return n(s,g,y,m)}),s}function lm(t,n){return t==null?!0:Us(t,n)}function pm(t,n,s){return t==null?t:Oc(t,n,zs(s))}function fm(t,n,s,c){return c=typeof c=="function"?c:r,t==null?t:Oc(t,n,zs(s),c)}function Ur(t){return t==null?[]:ms(t,Nt(t))}function dm(t){return t==null?[]:ms(t,Vt(t))}function gm(t,n,s){return s===r&&(s=n,n=r),s!==r&&(s=le(s),s=s===s?s:0),n!==r&&(n=le(n),n=n===n?n:0),ur(le(t),n,s)}function ym(t,n,s){return n=Le(n),s===r?(s=n,n=0):s=Le(s),t=le(t),Ed(t,n,s)}function vm(t,n,s){if(s&&typeof s!="boolean"&&Mt(t,n,s)&&(n=s=r),s===r&&(typeof n=="boolean"?(s=n,n=r):typeof t=="boolean"&&(s=t,t=r)),t===r&&n===r?(t=0,n=1):(t=Le(t),n===r?(n=t,t=0):n=Le(n)),t>n){var c=t;t=n,n=c}if(s||t%1||n%1){var h=rc();return $t(t+h*(n-t+Gp("1e-"+((h+"").length-1))),n)}return $s(t,n)}var mm=$r(function(t,n,s){return n=n.toLowerCase(),t+(s?Du(n):n)});function Du(t){return ao(nt(t).toLowerCase())}function $u(t){return t=nt(t),t&&t.replace(wp,cf).replace(Mp,"")}function wm(t,n,s){t=nt(t),n=Jt(n);var c=t.length;s=s===r?c:ur(K(s),0,c);var h=s;return s-=n.length,s>=0&&t.slice(s,h)==n}function _m(t){return t=nt(t),t&&Zl.test(t)?t.replace(la,uf):t}function bm(t){return t=nt(t),t&&sp.test(t)?t.replace(rs,"\\$&"):t}var Em=$r(function(t,n,s){return t+(s?"-":"")+n.toLowerCase()}),Im=$r(function(t,n,s){return t+(s?" ":"")+n.toLowerCase()}),Pm=Uc("toLowerCase");function Sm(t,n,s){t=nt(t),n=K(n);var c=n?Nr(t):0;if(!n||c>=n)return t;var h=(n-c)/2;return di(ei(h),s)+t+di(ti(h),s)}function Om(t,n,s){t=nt(t),n=K(n);var c=n?Nr(t):0;return n&&c<n?t+di(n-c,s):t}function Nm(t,n,s){t=nt(t),n=K(n);var c=n?Nr(t):0;return n&&c<n?di(n-c,s)+t:t}function Am(t,n,s){return s||n==null?n=0:n&&(n=+n),jf(nt(t).replace(ns,""),n||0)}function Rm(t,n,s){return(s?Mt(t,n,s):n===r)?n=1:n=K(n),js(nt(t),n)}function xm(){var t=arguments,n=nt(t[0]);return t.length<3?n:n.replace(t[1],t[2])}var Tm=$r(function(t,n,s){return t+(s?"_":"")+n.toLowerCase()});function Cm(t,n,s){return s&&typeof s!="number"&&Mt(t,n,s)&&(n=s=r),s=s===r?Dt:s>>>0,s?(t=nt(t),t&&(typeof n=="string"||n!=null&&!io(n))&&(n=Jt(n),!n&&Or(t))?Xe(ye(t),0,s):t.split(n,s)):[]}var Dm=$r(function(t,n,s){return t+(s?" ":"")+ao(n)});function $m(t,n,s){return t=nt(t),s=s==null?0:ur(K(s),0,t.length),n=Jt(n),t.slice(s,s+n.length)==n}function jm(t,n,s){var c=p.templateSettings;s&&Mt(t,n,s)&&(n=r),t=nt(t),n=Oi({},n,c,Kc);var h=Oi({},n.imports,c.imports,Kc),f=Nt(h),g=ms(h,f),y,m,P=0,S=n.interpolate||Ln,N="__p += '",D=_s((n.escape||Ln).source+"|"+S.source+"|"+(S===pa?fp:Ln).source+"|"+(n.evaluate||Ln).source+"|$","g"),q="//# sourceURL="+(st.call(n,"sourceURL")?(n.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Vp+"]")+`
`;t.replace(D,function(k,Q,J,Zt,Lt,te){return J||(J=Zt),N+=t.slice(P,te).replace(_p,hf),Q&&(y=!0,N+=`' +
__e(`+Q+`) +
'`),Lt&&(m=!0,N+=`';
`+Lt+`;
__p += '`),J&&(N+=`' +
((__t = (`+J+`)) == null ? '' : __t) +
'`),P=te+k.length,k}),N+=`';
`;var z=st.call(n,"variable")&&n.variable;if(!z)N=`with (obj) {
`+N+`
}
`;else if(lp.test(z))throw new H(d);N=(m?N.replace(Ql,""):N).replace(Yl,"$1").replace(Jl,"$1;"),N="function("+(z||"obj")+`) {
`+(z?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(y?", __e = _.escape":"")+(m?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+N+`return __p
}`;var W=qu(function(){return et(f,q+"return "+N).apply(r,g)});if(W.source=N,no(W))throw W;return W}function qm(t){return nt(t).toLowerCase()}function Um(t){return nt(t).toUpperCase()}function Mm(t,n,s){if(t=nt(t),t&&(s||n===r))return Ba(t);if(!t||!(n=Jt(n)))return t;var c=ye(t),h=ye(n),f=Wa(c,h),g=Fa(c,h)+1;return Xe(c,f,g).join("")}function Lm(t,n,s){if(t=nt(t),t&&(s||n===r))return t.slice(0,Qa(t)+1);if(!t||!(n=Jt(n)))return t;var c=ye(t),h=Fa(c,ye(n))+1;return Xe(c,0,h).join("")}function zm(t,n,s){if(t=nt(t),t&&(s||n===r))return t.replace(ns,"");if(!t||!(n=Jt(n)))return t;var c=ye(t),h=Wa(c,ye(n));return Xe(c,h).join("")}function km(t,n){var s=Bi,c=ne;if(vt(n)){var h="separator"in n?n.separator:h;s="length"in n?K(n.length):s,c="omission"in n?Jt(n.omission):c}t=nt(t);var f=t.length;if(Or(t)){var g=ye(t);f=g.length}if(s>=f)return t;var y=s-Nr(c);if(y<1)return c;var m=g?Xe(g,0,y).join(""):t.slice(0,y);if(h===r)return m+c;if(g&&(y+=m.length-y),io(h)){if(t.slice(y).search(h)){var P,S=m;for(h.global||(h=_s(h.source,nt(fa.exec(h))+"g")),h.lastIndex=0;P=h.exec(S);)var N=P.index;m=m.slice(0,N===r?y:N)}}else if(t.indexOf(Jt(h),y)!=y){var D=m.lastIndexOf(h);D>-1&&(m=m.slice(0,D))}return m+c}function Hm(t){return t=nt(t),t&&Xl.test(t)?t.replace(ha,vf):t}var Vm=$r(function(t,n,s){return t+(s?" ":"")+n.toUpperCase()}),ao=Uc("toUpperCase");function ju(t,n,s){return t=nt(t),n=s?r:n,n===r?pf(t)?_f(t):rf(t):t.match(n)||[]}var qu=G(function(t,n){try{return Qt(t,r,n)}catch(s){return no(s)?s:new H(s)}}),Km=qe(function(t,n){return se(n,function(s){s=Ne(s),$e(t,s,eo(t[s],t))}),t});function Bm(t){var n=t==null?0:t.length,s=L();return t=n?ft(t,function(c){if(typeof c[1]!="function")throw new oe(l);return[s(c[0]),c[1]]}):[],G(function(c){for(var h=-1;++h<n;){var f=t[h];if(Qt(f[0],this,c))return Qt(f[1],this,c)}})}function Wm(t){return vd(ce(t,O))}function co(t){return function(){return t}}function Fm(t,n){return t==null||t!==t?n:t}var Gm=Lc(),Qm=Lc(!0);function Kt(t){return t}function uo(t){return gc(typeof t=="function"?t:ce(t,O))}function Ym(t){return vc(ce(t,O))}function Jm(t,n){return mc(t,ce(n,O))}var Xm=G(function(t,n){return function(s){return fn(s,t,n)}}),Zm=G(function(t,n){return function(s){return fn(t,s,n)}});function ho(t,n,s){var c=Nt(n),h=ai(n,c);s==null&&!(vt(n)&&(h.length||!c.length))&&(s=n,n=t,t=this,h=ai(n,Nt(n)));var f=!(vt(s)&&"chain"in s)||!!s.chain,g=Me(t);return se(h,function(y){var m=n[y];t[y]=m,g&&(t.prototype[y]=function(){var P=this.__chain__;if(f||P){var S=t(this.__wrapped__),N=S.__actions__=kt(this.__actions__);return N.push({func:m,args:arguments,thisArg:t}),S.__chain__=P,S}return m.apply(t,We([this.value()],arguments))})}),t}function tw(){return xt._===this&&(xt._=Of),this}function lo(){}function ew(t){return t=K(t),G(function(n){return wc(n,t)})}var rw=Hs(ft),nw=Hs(za),iw=Hs(fs);function Uu(t){return Qs(t)?ds(Ne(t)):$d(t)}function sw(t){return function(n){return t==null?r:hr(t,n)}}var ow=kc(),aw=kc(!0);function po(){return[]}function fo(){return!1}function cw(){return{}}function uw(){return""}function hw(){return!0}function lw(t,n){if(t=K(t),t<1||t>ct)return[];var s=Dt,c=$t(t,Dt);n=L(n),t-=Dt;for(var h=vs(c,n);++s<t;)n(s);return h}function pw(t){return V(t)?ft(t,Ne):Xt(t)?[t]:kt(nu(nt(t)))}function fw(t){var n=++Pf;return nt(t)+n}var dw=fi(function(t,n){return t+n},0),gw=Vs("ceil"),yw=fi(function(t,n){return t/n},1),vw=Vs("floor");function mw(t){return t&&t.length?oi(t,Kt,As):r}function ww(t,n){return t&&t.length?oi(t,L(n,2),As):r}function _w(t){return Va(t,Kt)}function bw(t,n){return Va(t,L(n,2))}function Ew(t){return t&&t.length?oi(t,Kt,Cs):r}function Iw(t,n){return t&&t.length?oi(t,L(n,2),Cs):r}var Pw=fi(function(t,n){return t*n},1),Sw=Vs("round"),Ow=fi(function(t,n){return t-n},0);function Nw(t){return t&&t.length?ys(t,Kt):0}function Aw(t,n){return t&&t.length?ys(t,L(n,2)):0}return p.after=Yy,p.ary=du,p.assign=Uv,p.assignIn=Au,p.assignInWith=Oi,p.assignWith=Mv,p.at=Lv,p.before=gu,p.bind=eo,p.bindAll=Km,p.bindKey=yu,p.castArray=cv,p.chain=lu,p.chunk=vg,p.compact=mg,p.concat=wg,p.cond=Bm,p.conforms=Wm,p.constant=co,p.countBy=Ny,p.create=zv,p.curry=vu,p.curryRight=mu,p.debounce=wu,p.defaults=kv,p.defaultsDeep=Hv,p.defer=Jy,p.delay=Xy,p.difference=_g,p.differenceBy=bg,p.differenceWith=Eg,p.drop=Ig,p.dropRight=Pg,p.dropRightWhile=Sg,p.dropWhile=Og,p.fill=Ng,p.filter=Ry,p.flatMap=Cy,p.flatMapDeep=Dy,p.flatMapDepth=$y,p.flatten=au,p.flattenDeep=Ag,p.flattenDepth=Rg,p.flip=Zy,p.flow=Gm,p.flowRight=Qm,p.fromPairs=xg,p.functions=Qv,p.functionsIn=Yv,p.groupBy=jy,p.initial=Cg,p.intersection=Dg,p.intersectionBy=$g,p.intersectionWith=jg,p.invert=Xv,p.invertBy=Zv,p.invokeMap=Uy,p.iteratee=uo,p.keyBy=My,p.keys=Nt,p.keysIn=Vt,p.map=_i,p.mapKeys=em,p.mapValues=rm,p.matches=Ym,p.matchesProperty=Jm,p.memoize=Ei,p.merge=nm,p.mergeWith=Ru,p.method=Xm,p.methodOf=Zm,p.mixin=ho,p.negate=Ii,p.nthArg=ew,p.omit=im,p.omitBy=sm,p.once=tv,p.orderBy=Ly,p.over=rw,p.overArgs=ev,p.overEvery=nw,p.overSome=iw,p.partial=ro,p.partialRight=_u,p.partition=zy,p.pick=om,p.pickBy=xu,p.property=Uu,p.propertyOf=sw,p.pull=Lg,p.pullAll=uu,p.pullAllBy=zg,p.pullAllWith=kg,p.pullAt=Hg,p.range=ow,p.rangeRight=aw,p.rearg=rv,p.reject=Vy,p.remove=Vg,p.rest=nv,p.reverse=Zs,p.sampleSize=By,p.set=cm,p.setWith=um,p.shuffle=Wy,p.slice=Kg,p.sortBy=Qy,p.sortedUniq=Jg,p.sortedUniqBy=Xg,p.split=Cm,p.spread=iv,p.tail=Zg,p.take=ty,p.takeRight=ey,p.takeRightWhile=ry,p.takeWhile=ny,p.tap=my,p.throttle=sv,p.thru=wi,p.toArray=Su,p.toPairs=Tu,p.toPairsIn=Cu,p.toPath=pw,p.toPlainObject=Nu,p.transform=hm,p.unary=ov,p.union=iy,p.unionBy=sy,p.unionWith=oy,p.uniq=ay,p.uniqBy=cy,p.uniqWith=uy,p.unset=lm,p.unzip=to,p.unzipWith=hu,p.update=pm,p.updateWith=fm,p.values=Ur,p.valuesIn=dm,p.without=hy,p.words=ju,p.wrap=av,p.xor=ly,p.xorBy=py,p.xorWith=fy,p.zip=dy,p.zipObject=gy,p.zipObjectDeep=yy,p.zipWith=vy,p.entries=Tu,p.entriesIn=Cu,p.extend=Au,p.extendWith=Oi,ho(p,p),p.add=dw,p.attempt=qu,p.camelCase=mm,p.capitalize=Du,p.ceil=gw,p.clamp=gm,p.clone=uv,p.cloneDeep=lv,p.cloneDeepWith=pv,p.cloneWith=hv,p.conformsTo=fv,p.deburr=$u,p.defaultTo=Fm,p.divide=yw,p.endsWith=wm,p.eq=me,p.escape=_m,p.escapeRegExp=bm,p.every=Ay,p.find=xy,p.findIndex=su,p.findKey=Vv,p.findLast=Ty,p.findLastIndex=ou,p.findLastKey=Kv,p.floor=vw,p.forEach=pu,p.forEachRight=fu,p.forIn=Bv,p.forInRight=Wv,p.forOwn=Fv,p.forOwnRight=Gv,p.get=so,p.gt=dv,p.gte=gv,p.has=Jv,p.hasIn=oo,p.head=cu,p.identity=Kt,p.includes=qy,p.indexOf=Tg,p.inRange=ym,p.invoke=tm,p.isArguments=fr,p.isArray=V,p.isArrayBuffer=yv,p.isArrayLike=Ht,p.isArrayLikeObject=bt,p.isBoolean=vv,p.isBuffer=Ze,p.isDate=mv,p.isElement=wv,p.isEmpty=_v,p.isEqual=bv,p.isEqualWith=Ev,p.isError=no,p.isFinite=Iv,p.isFunction=Me,p.isInteger=bu,p.isLength=Pi,p.isMap=Eu,p.isMatch=Pv,p.isMatchWith=Sv,p.isNaN=Ov,p.isNative=Nv,p.isNil=Rv,p.isNull=Av,p.isNumber=Iu,p.isObject=vt,p.isObjectLike=wt,p.isPlainObject=wn,p.isRegExp=io,p.isSafeInteger=xv,p.isSet=Pu,p.isString=Si,p.isSymbol=Xt,p.isTypedArray=qr,p.isUndefined=Tv,p.isWeakMap=Cv,p.isWeakSet=Dv,p.join=qg,p.kebabCase=Em,p.last=he,p.lastIndexOf=Ug,p.lowerCase=Im,p.lowerFirst=Pm,p.lt=$v,p.lte=jv,p.max=mw,p.maxBy=ww,p.mean=_w,p.meanBy=bw,p.min=Ew,p.minBy=Iw,p.stubArray=po,p.stubFalse=fo,p.stubObject=cw,p.stubString=uw,p.stubTrue=hw,p.multiply=Pw,p.nth=Mg,p.noConflict=tw,p.noop=lo,p.now=bi,p.pad=Sm,p.padEnd=Om,p.padStart=Nm,p.parseInt=Am,p.random=vm,p.reduce=ky,p.reduceRight=Hy,p.repeat=Rm,p.replace=xm,p.result=am,p.round=Sw,p.runInContext=v,p.sample=Ky,p.size=Fy,p.snakeCase=Tm,p.some=Gy,p.sortedIndex=Bg,p.sortedIndexBy=Wg,p.sortedIndexOf=Fg,p.sortedLastIndex=Gg,p.sortedLastIndexBy=Qg,p.sortedLastIndexOf=Yg,p.startCase=Dm,p.startsWith=$m,p.subtract=Ow,p.sum=Nw,p.sumBy=Aw,p.template=jm,p.times=lw,p.toFinite=Le,p.toInteger=K,p.toLength=Ou,p.toLower=qm,p.toNumber=le,p.toSafeInteger=qv,p.toString=nt,p.toUpper=Um,p.trim=Mm,p.trimEnd=Lm,p.trimStart=zm,p.truncate=km,p.unescape=Hm,p.uniqueId=fw,p.upperCase=Vm,p.upperFirst=ao,p.each=pu,p.eachRight=fu,p.first=cu,ho(p,function(){var t={};return Se(p,function(n,s){st.call(p.prototype,s)||(t[s]=n)}),t}(),{chain:!1}),p.VERSION=i,se(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){p[t].placeholder=p}),se(["drop","take"],function(t,n){Y.prototype[t]=function(s){s=s===r?1:Ot(K(s),0);var c=this.__filtered__&&!n?new Y(this):this.clone();return c.__filtered__?c.__takeCount__=$t(s,c.__takeCount__):c.__views__.push({size:$t(s,Dt),type:t+(c.__dir__<0?"Right":"")}),c},Y.prototype[t+"Right"]=function(s){return this.reverse()[t](s).reverse()}}),se(["filter","map","takeWhile"],function(t,n){var s=n+1,c=s==E||s==B;Y.prototype[t]=function(h){var f=this.clone();return f.__iteratees__.push({iteratee:L(h,3),type:s}),f.__filtered__=f.__filtered__||c,f}}),se(["head","last"],function(t,n){var s="take"+(n?"Right":"");Y.prototype[t]=function(){return this[s](1).value()[0]}}),se(["initial","tail"],function(t,n){var s="drop"+(n?"":"Right");Y.prototype[t]=function(){return this.__filtered__?new Y(this):this[s](1)}}),Y.prototype.compact=function(){return this.filter(Kt)},Y.prototype.find=function(t){return this.filter(t).head()},Y.prototype.findLast=function(t){return this.reverse().find(t)},Y.prototype.invokeMap=G(function(t,n){return typeof t=="function"?new Y(this):this.map(function(s){return fn(s,t,n)})}),Y.prototype.reject=function(t){return this.filter(Ii(L(t)))},Y.prototype.slice=function(t,n){t=K(t);var s=this;return s.__filtered__&&(t>0||n<0)?new Y(s):(t<0?s=s.takeRight(-t):t&&(s=s.drop(t)),n!==r&&(n=K(n),s=n<0?s.dropRight(-n):s.take(n-t)),s)},Y.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Y.prototype.toArray=function(){return this.take(Dt)},Se(Y.prototype,function(t,n){var s=/^(?:filter|find|map|reject)|While$/.test(n),c=/^(?:head|last)$/.test(n),h=p[c?"take"+(n=="last"?"Right":""):n],f=c||/^find/.test(n);h&&(p.prototype[n]=function(){var g=this.__wrapped__,y=c?[1]:arguments,m=g instanceof Y,P=y[0],S=m||V(g),N=function(Q){var J=h.apply(p,We([Q],y));return c&&D?J[0]:J};S&&s&&typeof P=="function"&&P.length!=1&&(m=S=!1);var D=this.__chain__,q=!!this.__actions__.length,z=f&&!D,W=m&&!q;if(!f&&S){g=W?g:new Y(this);var k=t.apply(g,y);return k.__actions__.push({func:wi,args:[N],thisArg:r}),new ae(k,D)}return z&&W?t.apply(this,y):(k=this.thru(N),z?c?k.value()[0]:k.value():k)})}),se(["pop","push","shift","sort","splice","unshift"],function(t){var n=Bn[t],s=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",c=/^(?:pop|shift)$/.test(t);p.prototype[t]=function(){var h=arguments;if(c&&!this.__chain__){var f=this.value();return n.apply(V(f)?f:[],h)}return this[s](function(g){return n.apply(V(g)?g:[],h)})}}),Se(Y.prototype,function(t,n){var s=p[n];if(s){var c=s.name+"";st.call(Tr,c)||(Tr[c]=[]),Tr[c].push({name:n,func:s})}}),Tr[pi(r,Z).name]=[{name:"wrapper",func:r}],Y.prototype.clone=Hf,Y.prototype.reverse=Vf,Y.prototype.value=Kf,p.prototype.at=wy,p.prototype.chain=_y,p.prototype.commit=by,p.prototype.next=Ey,p.prototype.plant=Py,p.prototype.reverse=Sy,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=Oy,p.prototype.first=p.prototype.head,on&&(p.prototype[on]=Iy),p},Ar=bf();sr?((sr.exports=Ar)._=Ar,us._=Ar):xt._=Ar}).call(On)})(Lo,Lo.exports);var JP=Object.defineProperty,XP=Object.defineProperties,ZP=Object.getOwnPropertyDescriptors,Wh=Object.getOwnPropertySymbols,tS=Object.prototype.hasOwnProperty,eS=Object.prototype.propertyIsEnumerable,Fh=(o,e,r)=>e in o?JP(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,Ri=(o,e)=>{for(var r in e||(e={}))tS.call(e,r)&&Fh(o,r,e[r]);if(Wh)for(var r of Wh(e))eS.call(e,r)&&Fh(o,r,e[r]);return o},rS=(o,e)=>XP(o,ZP(e));function nr(o,e,r){var i;const a=xb(o);return((i=e.rpcMap)==null?void 0:i[a.reference])||`${YP}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function br(o){return o.includes(":")?o.split(":")[1]:o}function Ll(o){return o.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function nS(o,e){const r=Object.keys(e.namespaces).filter(a=>a.includes(o));if(!r.length)return[];const i=[];return r.forEach(a=>{const u=e.namespaces[a].accounts;i.push(...u)}),i}function iS(o={},e={}){const r=Gh(o),i=Gh(e);return Lo.exports.merge(r,i)}function Gh(o){var e,r,i,a;const u={};if(!Hr(o))return u;for(const[l,d]of Object.entries(o)){const w=ea(l)?[l]:d.chains,b=d.methods||[],A=d.events||[],O=d.rpcMap||{},R=Nn(l);u[R]=rS(Ri(Ri({},u[R]),d),{chains:yo(w,(e=u[R])==null?void 0:e.chains),methods:yo(b,(r=u[R])==null?void 0:r.methods),events:yo(A,(i=u[R])==null?void 0:i.events),rpcMap:Ri(Ri({},O),(a=u[R])==null?void 0:a.rpcMap)})}return u}function sS(o){return o.includes(":")?o.split(":")[2]:o}function oS(o){const e={};for(const[r,i]of Object.entries(o)){const a=i.methods||[],u=i.events||[],l=i.accounts||[],d=ea(r)?[r]:i.chains?i.chains:Ll(i.accounts);e[r]={chains:d,methods:a,events:u,accounts:l}}return e}function Io(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const zl={},dt=o=>zl[o],Po=(o,e)=>{zl[o]=e};class aS{constructor(e){this.name="polkadot",this.namespace=e.namespace,this.events=dt("events"),this.client=dt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Ke.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const a=br(r);e[a]=this.createHttpProvider(a,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||nr(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ve(new ir(i,dt("disableProviderPing")))}}class cS{constructor(e){this.name="eip155",this.namespace=e.namespace,this.events=dt("events"),this.client=dt("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r),this.chainId=parseInt(e),this.events.emit(Ke.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){const i=r||nr(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ve(new ir(i,dt("disableProviderPing")))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const a=parseInt(br(r));e[a]=this.createHttpProvider(a,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}async handleSwitchChain(e){var r,i;let a=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:a}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}}class uS{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=dt("events"),this.client=dt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Ke.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const a=br(r);e[a]=this.createHttpProvider(a,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||nr(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ve(new ir(i,dt("disableProviderPing")))}}class hS{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=dt("events"),this.client=dt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Ke.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const a=br(r);e[a]=this.createHttpProvider(a,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||nr(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ve(new ir(i,dt("disableProviderPing")))}}class lS{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=dt("events"),this.client=dt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Ke.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{const i=this.getCardanoRPCUrl(r),a=br(r);e[a]=this.createHttpProvider(a,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}getCardanoRPCUrl(e){const r=this.namespace.rpcMap;if(r)return r[e]}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ve(new ir(i,dt("disableProviderPing")))}}class pS{constructor(e){this.name="elrond",this.namespace=e.namespace,this.events=dt("events"),this.client=dt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Ke.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const a=br(r);e[a]=this.createHttpProvider(a,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||nr(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ve(new ir(i,dt("disableProviderPing")))}}class fS{constructor(e){this.name="multiversx",this.namespace=e.namespace,this.events=dt("events"),this.client=dt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Ke.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const a=br(r);e[a]=this.createHttpProvider(a,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||nr(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ve(new ir(i,dt("disableProviderPing")))}}class dS{constructor(e){this.name="near",this.namespace=e.namespace,this.events=dt("events"),this.client=dt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||nr(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(Ke.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||nr(e,this.namespace);return typeof i>"u"?void 0:new Ve(new ir(i,dt("disableProviderPing")))}}var gS=Object.defineProperty,yS=Object.defineProperties,vS=Object.getOwnPropertyDescriptors,Qh=Object.getOwnPropertySymbols,mS=Object.prototype.hasOwnProperty,wS=Object.prototype.propertyIsEnumerable,Yh=(o,e,r)=>e in o?gS(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,xi=(o,e)=>{for(var r in e||(e={}))mS.call(e,r)&&Yh(o,r,e[r]);if(Qh)for(var r of Qh(e))wS.call(e,r)&&Yh(o,r,e[r]);return o},So=(o,e)=>yS(o,vS(e));class oa{constructor(e){this.events=new Ho,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Mi(Li({level:(e==null?void 0:e.logger)||Kh})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const r=new oa(e);return await r.initialize(),r}async request(e,r){const[i,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:xi({},e),chainId:`${i}:${a}`,topic:this.session.topic})}sendAsync(e,r,i){const a=new Date().getTime();this.request(e,i).then(u=>r(null,zi(a,u))).catch(u=>r(u,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:It("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:i,approval:a}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});i&&(this.uri=i,this.events.emit("display_uri",i)),await a().then(u=>{this.session=u,this.namespaces||(this.namespaces=oS(u.namespaces),this.persist("namespaces",this.namespaces))}).catch(u=>{if(u.message!==Ul)throw u;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;const[i,a]=this.validateChain(e);this.getProvider(i).setDefaultChain(a,r)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(yr(r)){for(const i of r)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await jP.init({logger:this.providerOpts.logger||Kh,relayUrl:this.providerOpts.relayUrl||FP,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(r=>Nn(r)))];Po("client",this.client),Po("events",this.events),Po("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;const i=nS(r,this.session),a=Ll(i),u=iS(this.namespaces,this.optionalNamespaces),l=So(xi({},u[r]),{accounts:i,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new cS({namespace:l});break;case"solana":this.rpcProviders[r]=new uS({namespace:l});break;case"cosmos":this.rpcProviders[r]=new hS({namespace:l});break;case"polkadot":this.rpcProviders[r]=new aS({namespace:l});break;case"cip34":this.rpcProviders[r]=new lS({namespace:l});break;case"elrond":this.rpcProviders[r]=new pS({namespace:l});break;case"multiversx":this.rpcProviders[r]=new fS({namespace:l});break;case"near":this.rpcProviders[r]=new dS({namespace:l});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:r}=e,{event:i}=r;if(i.name==="accountsChanged"){const a=i.data;a&&yr(a)&&this.events.emit("accountsChanged",a.map(sS))}else if(i.name==="chainChanged"){const a=r.chainId,u=r.event.data,l=Nn(a),d=Io(a)!==Io(u)?`${l}:${Io(u)}`:a;this.onChainChanged(d)}else this.events.emit(i.name,i.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i;const{namespaces:a}=r,u=(i=this.client)==null?void 0:i.session.get(e);this.session=So(xi({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",So(xi({},It("USER_DISCONNECTED")),{data:e.topic}))}),this.on(Ke.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){const{namespaces:r,optionalNamespaces:i,sessionProperties:a}=e;r&&Object.keys(r).length&&(this.namespaces=r),i&&Object.keys(i).length&&(this.optionalNamespaces=i),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",i)}validateChain(e){const[r,i]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,i];if(r&&!Object.keys(this.namespaces||{}).map(l=>Nn(l)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&i)return[r,i];const a=Nn(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,r=!1){var i;if(!this.namespaces)return;const[a,u]=this.validateChain(e);r||this.getProvider(a).setDefaultChain(u),((i=this.namespaces[a])!=null?i:this.namespaces[`${a}:${u}`]).defaultChain=u,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",u)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(e,r){this.client.core.storage.setItem(`${Bh}/${e}`,r)}async getFromStore(e){return await this.client.core.storage.getItem(`${Bh}/${e}`)}}const _S=oa,bS="wc",ES="ethereum_provider",IS=`${bS}@2:${ES}:`,PS="https://rpc.walletconnect.com/v1/",zo=["eth_sendTransaction","personal_sign"],SS=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],ko=["chainChanged","accountsChanged"],OS=["chainChanged","accountsChanged","message","disconnect","connect"];var NS=Object.defineProperty,AS=Object.defineProperties,RS=Object.getOwnPropertyDescriptors,Jh=Object.getOwnPropertySymbols,xS=Object.prototype.hasOwnProperty,TS=Object.prototype.propertyIsEnumerable,Xh=(o,e,r)=>e in o?NS(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,Rn=(o,e)=>{for(var r in e||(e={}))xS.call(e,r)&&Xh(o,r,e[r]);if(Jh)for(var r of Jh(e))TS.call(e,r)&&Xh(o,r,e[r]);return o},Zh=(o,e)=>AS(o,RS(e));function Ui(o){return Number(o[0].split(":")[1])}function Oo(o){return`0x${o.toString(16)}`}function CS(o){const{chains:e,optionalChains:r,methods:i,optionalMethods:a,events:u,optionalEvents:l,rpcMap:d}=o;if(!No(e))throw new Error("Invalid chains");const w={chains:e,methods:i||zo,events:u||ko,rpcMap:Rn({},e.length?{[Ui(e)]:d[Ui(e)]}:{})},b=u==null?void 0:u.filter(M=>!ko.includes(M)),A=i==null?void 0:i.filter(M=>!zo.includes(M));if(!r&&!l&&!a&&!(b!=null&&b.length)&&!(A!=null&&A.length))return{required:e.length?w:void 0};const O=(b==null?void 0:b.length)&&(A==null?void 0:A.length)||!r,R={chains:[...new Set(O?w.chains.concat(r||[]):r)],methods:[...new Set(w.methods.concat(a!=null&&a.length?a:SS))],events:[...new Set(w.events.concat(l!=null&&l.length?l:OS))],rpcMap:d};return{required:e.length?w:void 0,optional:r.length?R:void 0}}class aa{constructor(){this.events=new Ie.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=IS,this.on=(e,r)=>(this.events.on(e,r),this),this.once=(e,r)=>(this.events.once(e,r),this),this.removeListener=(e,r)=>(this.events.removeListener(e,r),this),this.off=(e,r)=>(this.events.off(e,r),this),this.parseAccount=e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e,this.signer={},this.rpc={}}static async init(e){const r=new aa;return await r.initialize(e),r}async request(e){return await this.signer.request(e,this.formatChainId(this.chainId))}sendAsync(e,r){this.signer.sendAsync(e,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:r,optional:i}=CS(this.rpc);try{const a=await new Promise(async(l,d)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(b=>{!b.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),d(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Zh(Rn({namespaces:Rn({},r&&{[this.namespace]:r})},i&&{optionalNamespaces:{[this.namespace]:i}}),{pairingTopic:e==null?void 0:e.pairingTopic})).then(b=>{l(b)}).catch(b=>{d(new Error(b.message))})});if(!a)return;const u=s_(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:Oo(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:r}=e,{event:i}=r;i.name==="accountsChanged"?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):i.name==="chainChanged"?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("chainChanged",e=>{const r=parseInt(e);this.chainId=r,this.events.emit("chainChanged",Oo(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",Zh(Rn({},a_("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{var r,i;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(i=this.modal)==null||i.openModal({uri:e})),this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const r=e.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Oo(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const r=this.parseChainId(e);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(e){const[r,i,a]=e.split(":");return{chainId:`${r}:${i}`,address:a}}setAccounts(e){this.accounts=e.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var r,i;const a=(r=e==null?void 0:e.chains)!=null?r:[],u=(i=e==null?void 0:e.optionalChains)!=null?i:[],l=a.concat(u);if(!l.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const d=a.length?(e==null?void 0:e.methods)||zo:[],w=a.length?(e==null?void 0:e.events)||ko:[],b=(e==null?void 0:e.optionalMethods)||[],A=(e==null?void 0:e.optionalEvents)||[],O=(e==null?void 0:e.rpcMap)||this.buildRpcMap(l,e.projectId),R=(e==null?void 0:e.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(M=>this.formatChainId(M)),optionalChains:u.map(M=>this.formatChainId(M)),methods:d,events:w,optionalMethods:b,optionalEvents:A,rpcMap:O,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:R,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,r){const i={};return e.forEach(a=>{i[a]=this.getRpcUrl(a,r)}),i}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?Ui(this.rpc.chains):Ui(this.rpc.optionalChains),this.signer=await _S.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storageOptions:e.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:i}=await Rw(async()=>{const{WalletConnectModal:a}=await import("./index-B5nox38C-DRkh3O-B.js");return{WalletConnectModal:a}},[]).then(a=>a.i);r=i}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Rn({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(i){throw this.signer.logger.error(i),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:r,optionalChains:i,rpcMap:a}=e;r&&No(r)&&(this.rpc.chains=r.map(u=>this.formatChainId(u)),r.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)})),i&&No(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i==null?void 0:i.map(u=>this.formatChainId(u)),i.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)}))}getRpcUrl(e,r){var i;return((i=this.rpc.rpcMap)==null?void 0:i[e])||`${PS}?chainId=eip155:${e}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(r=>this.parseAccount(r))}}const qS=aa;export{qS as EthereumProvider,OS as OPTIONAL_EVENTS,SS as OPTIONAL_METHODS,ko as REQUIRED_EVENTS,zo as REQUIRED_METHODS,aa as default};
