"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[191],{2029:function(e,t,r){let i,n,a,s,o,l;r.d(t,{EPV:function(){return e5},_wu:function(){return ln},z$f:function(){return ls}});var c,u,h,d,f,p,m,A,g,v,T,C,y,E,B,R,x,M,S,b,I=r(6376);r(3730);var w=r(1680),_=r(5940);r(4202);var F=Object.defineProperty,P=(e,t,r)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,D=(e,t,r)=>(P(e,"symbol"!=typeof t?t+"":t,r),r);function N(e,t){if(t===I.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t!==I.TriangleFanDrawMode&&t!==I.TriangleStripDrawMode)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e;{let r=e.getIndex();if(null===r){let t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}let i=r.count-2,n=[];if(r){if(t===I.TriangleFanDrawMode)for(let e=1;e<=i;e++)n.push(r.getX(0)),n.push(r.getX(e)),n.push(r.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(n.push(r.getX(e)),n.push(r.getX(e+1)),n.push(r.getX(e+2))):(n.push(r.getX(e+2)),n.push(r.getX(e+1)),n.push(r.getX(e)))}n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let a=e.clone();return a.setIndex(n),a.clearGroups(),a}}function O(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n||(n=new I.PlaneGeometry(2,2,1,1)),a||(a=new I.ShaderMaterial({uniforms:{blitTexture:new I.Uniform(e)},vertexShader:"\n        varying vec2 vUv;\n        void main(){\n            vUv = uv;\n            gl_Position = vec4(position.xy * 1.0,0.,.999999);\n        }\n      ",fragmentShader:"\n          uniform sampler2D blitTexture; \n          varying vec2 vUv;\n\n          void main(){ \n              gl_FragColor = vec4(vUv.xy, 0, 1);\n              \n              #ifdef IS_SRGB\n              gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );\n              #else\n              gl_FragColor = texture2D( blitTexture, vUv);\n              #endif\n          }\n      "})),a.uniforms.blitTexture.value=e,a.defines.IS_SRGB="colorSpace"in e?"srgb"===e.colorSpace:3001===e.encoding,a.needsUpdate=!0,s||((s=new I.Mesh(n,a)).frustrumCulled=!1);let o=new I.PerspectiveCamera,l=new I.Scene;l.add(s),r||(r=i=new I.WebGLRenderer({antialias:!1})),r.setSize(Math.min(e.image.width,t),Math.min(e.image.height,t)),r.clear(),r.render(l,o);let c=new I.Texture(r.domElement);return c.minFilter=e.minFilter,c.magFilter=e.magFilter,c.wrapS=e.wrapS,c.wrapT=e.wrapT,c.name=e.name,i&&(i.dispose(),i=null),c}let L={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class U{register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i){let n=new X,a=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)a.push(this.pluginCallbacks[e](n));n.setPlugins(a),n.write(e,t,i).catch(r)}parseAsync(e,t){let r=this;return new Promise(function(i,n){r.parse(e,i,n,t)})}constructor(){this.pluginCallbacks=[],this.register(function(e){return new Y(e)}),this.register(function(e){return new Z(e)}),this.register(function(e){return new ee(e)}),this.register(function(e){return new et(e)}),this.register(function(e){return new er(e)}),this.register(function(e){return new ei(e)}),this.register(function(e){return new q(e)}),this.register(function(e){return new $(e)}),this.register(function(e){return new en(e)}),this.register(function(e){return new ea(e)}),this.register(function(e){return new es(e)})}}let k={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},G="KHR_mesh_quantization",H={};H[I.NearestFilter]=k.NEAREST,H[I.NearestMipmapNearestFilter]=k.NEAREST_MIPMAP_NEAREST,H[I.NearestMipmapLinearFilter]=k.NEAREST_MIPMAP_LINEAR,H[I.LinearFilter]=k.LINEAR,H[I.LinearMipmapNearestFilter]=k.LINEAR_MIPMAP_NEAREST,H[I.LinearMipmapLinearFilter]=k.LINEAR_MIPMAP_LINEAR,H[I.ClampToEdgeWrapping]=k.CLAMP_TO_EDGE,H[I.RepeatWrapping]=k.REPEAT,H[I.MirroredRepeatWrapping]=k.MIRRORED_REPEAT;let V={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},J=new I.Color;function K(e,t){return e.length===t.length&&e.every(function(e,r){return e===t[r]})}function j(e){return 4*Math.ceil(e/4)}function W(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=j(e.byteLength);if(r!==e.byteLength){let i=new Uint8Array(r);if(i.set(new Uint8Array(e)),0!==t)for(let n=e.byteLength;n<r;n++)i[n]=t;return i.buffer}return e}function z(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function Q(e,t){let r;return void 0!==e.toBlob?new Promise(r=>e.toBlob(r,t)):("image/jpeg"===t?r=.92:"image/webp"===t&&(r=.8),e.convertToBlob({type:t,quality:r}))}class X{setPlugins(e){this.plugins=e}async write(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},r),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);let i=this.buffers,n=this.json;r=this.options;let a=this.extensionsUsed,s=this.extensionsRequired,o=new Blob(i,{type:"application/octet-stream"}),l=Object.keys(a),c=Object.keys(s);if(l.length>0&&(n.extensionsUsed=l),c.length>0&&(n.extensionsRequired=c),n.buffers&&n.buffers.length>0&&(n.buffers[0].byteLength=o.size),!0===r.binary){let e=new FileReader;e.readAsArrayBuffer(o),e.onloadend=function(){var r;let i=W(e.result),a=new DataView(new ArrayBuffer(8));a.setUint32(0,i.byteLength,!0),a.setUint32(4,5130562,!0);let s=W((r=JSON.stringify(n),new TextEncoder().encode(r).buffer),32),o=new DataView(new ArrayBuffer(8));o.setUint32(0,s.byteLength,!0),o.setUint32(4,1313821514,!0);let l=new ArrayBuffer(12),c=new DataView(l);c.setUint32(0,1179937895,!0),c.setUint32(4,2,!0);let u=12+o.byteLength+s.byteLength+a.byteLength+i.byteLength;c.setUint32(8,u,!0);let h=new Blob([l,o,s,a,i],{type:"application/octet-stream"}),d=new FileReader;d.readAsArrayBuffer(h),d.onloadend=function(){t(d.result)}}}else if(n.buffers&&n.buffers.length>0){let e=new FileReader;e.readAsDataURL(o),e.onloadend=function(){let r=e.result;n.buffers[0].uri=r,t(n)}}else t(n)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;let r=this.options,i=this.extensionsUsed;try{let n=JSON.parse(JSON.stringify(e.userData));if(r.includeCustomExtensions&&n.gltfExtensions){for(let e in void 0===t.extensions&&(t.extensions={}),n.gltfExtensions)t.extensions[e]=n.gltfExtensions[e],i[e]=!0;delete n.gltfExtensions}Object.keys(n).length>0&&(t.extras=n)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}getUID(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!1===this.uids.has(e)){let t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;let t=new I.Vector3;for(let r=0,i=e.count;r<i;r++)if(Math.abs(t.fromBufferAttribute(e,r).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){let t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);let r=e.clone(),i=new I.Vector3;for(let e=0,t=r.count;e<t;e++)i.fromBufferAttribute(r,e),0===i.x&&0===i.y&&0===i.z?i.setX(1):i.normalize(),r.setXYZ(e,i.x,i.y,i.z);return t.attributesNormalized.set(e,r),r}applyTextureTransform(e,t){let r=!1,i={};(0!==t.offset.x||0!==t.offset.y)&&(i.offset=t.offset.toArray(),r=!0),0!==t.rotation&&(i.rotation=t.rotation,r=!0),(1!==t.repeat.x||1!==t.repeat.y)&&(i.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function r(e){return("colorSpace"in e?"srgb"===e.colorSpace:3001===e.encoding)?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof I.CompressedTexture&&(e=O(e)),t instanceof I.CompressedTexture&&(t=O(t));let i=e?e.image:null,n=t?t.image:null,a=Math.max(i?i.width:0,n?n.width:0),s=Math.max(i?i.height:0,n?n.height:0),o=z();o.width=a,o.height=s;let l=o.getContext("2d");l.fillStyle="#00ffff",l.fillRect(0,0,a,s);let c=l.getImageData(0,0,a,s);if(i){l.drawImage(i,0,0,a,s);let t=r(e),n=l.getImageData(0,0,a,s).data;for(let e=2;e<n.length;e+=4)c.data[e]=256*t(n[e]/256)}if(n){l.drawImage(n,0,0,a,s);let e=r(t),i=l.getImageData(0,0,a,s).data;for(let t=1;t<i.length;t+=4)c.data[t]=256*e(i[t]/256)}l.putImageData(c,0,0);let u=(e||t).clone();return u.source=new I.Texture(o).source,"colorSpace"in u?u.colorSpace="":u.encoding=3e3,u.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),u}processBuffer(e){let t=this.json,r=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),r.push(e),0}processBufferView(e,t,r,i,n){let a;let s=this.json;switch(s.bufferViews||(s.bufferViews=[]),t){case k.BYTE:case k.UNSIGNED_BYTE:a=1;break;case k.SHORT:case k.UNSIGNED_SHORT:a=2;break;default:a=4}let o=j(i*e.itemSize*a),l=new DataView(new ArrayBuffer(o)),c=0;for(let n=r;n<r+i;n++)for(let r=0;r<e.itemSize;r++){let i;e.itemSize>4?i=e.array[n*e.itemSize+r]:(0===r?i=e.getX(n):1===r?i=e.getY(n):2===r?i=e.getZ(n):3===r&&(i=e.getW(n)),!0===e.normalized&&(i=I.MathUtils.normalize(i,e.array))),t===k.FLOAT?l.setFloat32(c,i,!0):t===k.INT?l.setInt32(c,i,!0):t===k.UNSIGNED_INT?l.setUint32(c,i,!0):t===k.SHORT?l.setInt16(c,i,!0):t===k.UNSIGNED_SHORT?l.setUint16(c,i,!0):t===k.BYTE?l.setInt8(c,i):t===k.UNSIGNED_BYTE&&l.setUint8(c,i),c+=a}let u={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:o};return void 0!==n&&(u.target=n),n===k.ARRAY_BUFFER&&(u.byteStride=e.itemSize*a),this.byteOffset+=o,s.bufferViews.push(u),{id:s.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){let t=this,r=t.json;return r.bufferViews||(r.bufferViews=[]),new Promise(function(i){let n=new FileReader;n.readAsArrayBuffer(e),n.onloadend=function(){let e=W(n.result),a={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,i(r.bufferViews.push(a)-1)}})}processAccessor(e,t,r,i){let n,a;let s=this.json;if(e.array.constructor===Float32Array)n=k.FLOAT;else if(e.array.constructor===Int32Array)n=k.INT;else if(e.array.constructor===Uint32Array)n=k.UNSIGNED_INT;else if(e.array.constructor===Int16Array)n=k.SHORT;else if(e.array.constructor===Uint16Array)n=k.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)n=k.BYTE;else if(e.array.constructor===Uint8Array)n=k.UNSIGNED_BYTE;else throw Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(void 0===r&&(r=0),void 0===i&&(i=e.count),0===i)return null;let o=function(e,t,r){let i={min:Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=t;n<t+r;n++)for(let t=0;t<e.itemSize;t++){let r;e.itemSize>4?r=e.array[n*e.itemSize+t]:(0===t?r=e.getX(n):1===t?r=e.getY(n):2===t?r=e.getZ(n):3===t&&(r=e.getW(n)),!0===e.normalized&&(r=I.MathUtils.normalize(r,e.array))),i.min[t]=Math.min(i.min[t],r),i.max[t]=Math.max(i.max[t],r)}return i}(e,r,i);void 0!==t&&(a=e===t.index?k.ELEMENT_ARRAY_BUFFER:k.ARRAY_BUFFER);let l=this.processBufferView(e,n,r,i,a),c={bufferView:l.id,byteOffset:l.byteOffset,componentType:n,count:i,max:o.max,min:o.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(c.normalized=!0),s.accessors||(s.accessors=[]),s.accessors.push(c)-1}processImage(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png";if(null!==e){let n=this,a=n.cache,s=n.json,o=n.options,l=n.pending;a.images.has(e)||a.images.set(e,{});let c=a.images.get(e),u=i+":flipY/"+r.toString();if(void 0!==c[u])return c[u];s.images||(s.images=[]);let h={mimeType:i},d=z();d.width=Math.min(e.width,o.maxTextureSize),d.height=Math.min(e.height,o.maxTextureSize);let f=d.getContext("2d");if(!0===r&&(f.translate(0,d.height),f.scale(1,-1)),void 0!==e.data){t!==I.RGBAFormat&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>o.maxTextureSize||e.height>o.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);let r=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<r.length;t+=4)r[t+0]=e.data[t+0],r[t+1]=e.data[t+1],r[t+2]=e.data[t+2],r[t+3]=e.data[t+3];f.putImageData(new ImageData(r,e.width,e.height),0,0)}else f.drawImage(e,0,0,d.width,d.height);!0===o.binary?l.push(Q(d,i).then(e=>n.processBufferViewImage(e)).then(e=>{h.bufferView=e})):void 0!==d.toDataURL?h.uri=d.toDataURL(i):l.push(Q(d,i).then(e=>new FileReader().readAsDataURL(e)).then(e=>{h.uri=e}));let p=s.images.push(h)-1;return c[u]=p,p}throw Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){let t=this.json;t.samplers||(t.samplers=[]);let r={magFilter:H[e.magFilter],minFilter:H[e.minFilter],wrapS:H[e.wrapS],wrapT:H[e.wrapT]};return t.samplers.push(r)-1}processTexture(e){let t=this.options,r=this.cache,i=this.json;if(r.textures.has(e))return r.textures.get(e);i.textures||(i.textures=[]),e instanceof I.CompressedTexture&&(e=O(e,t.maxTextureSize));let n=e.userData.mimeType;"image/webp"===n&&(n="image/png");let a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,n)};e.name&&(a.name=e.name),this._invokeAll(function(t){t.writeTexture&&t.writeTexture(e,a)});let s=i.textures.push(a)-1;return r.textures.set(e,s),s}processMaterial(e){let t=this.cache,r=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;r.materials||(r.materials=[]);let i={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");let n=e.color.toArray().concat([e.opacity]);if(K(n,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=n),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){let t=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),r={index:this.processTexture(t),channel:t.channel};this.applyTextureTransform(r,t),i.pbrMetallicRoughness.metallicRoughnessTexture=r}if(e.map){let t={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),i.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){let t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(i.emissiveFactor=e.emissive.toArray()),e.emissiveMap){let t={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),i.emissiveTexture=t}}if(e.normalMap){let t={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),i.normalTexture=t}if(e.aoMap){let t={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),i.occlusionTexture=t}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===I.DoubleSide&&(i.doubleSided=!0),""!==e.name&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll(function(t){t.writeMaterial&&t.writeMaterial(e,i)});let a=r.materials.push(i)-1;return t.materials.set(e,a),a}processMesh(e){let t;let r=this.cache,i=this.json,n=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,r=e.material.length;t<r;t++)n.push(e.material[t].uuid);else n.push(e.material.uuid);let a=n.join(":");if(r.meshes.has(a))return r.meshes.get(a);let s=e.geometry;t=e.isLineSegments?k.LINES:e.isLineLoop?k.LINE_LOOP:e.isLine?k.LINE_STRIP:e.isPoints?k.POINTS:e.material.wireframe?k.LINES:k.TRIANGLES;let o={},l={},c=[],u=[],h={uv:"TEXCOORD_0",[I.REVISION.replace(/\D+/g,"")>=152?"uv1":"uv2"]:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},d=s.getAttribute("normal");void 0===d||this.isNormalizedNormalAttribute(d)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),s.setAttribute("normal",this.createNormalizedNormalAttribute(d)));let f=null;for(let e in s.attributes){if("morph"===e.slice(0,5))continue;let t=s.attributes[e];if(e=h[e]||e.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(e)||(e="_"+e),r.attributes.has(this.getUID(t))){l[e]=r.attributes.get(this.getUID(t));continue}f=null;let i=t.array;"JOINTS_0"!==e||i instanceof Uint16Array||i instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),f=new I.BufferAttribute(new Uint16Array(i),t.itemSize,t.normalized));let n=this.processAccessor(f||t,s);null!==n&&(e.startsWith("_")||this.detectMeshQuantization(e,t),l[e]=n,r.attributes.set(this.getUID(t),n))}if(void 0!==d&&s.setAttribute("normal",d),0===Object.keys(l).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){let t=[],i=[],n={};if(void 0!==e.morphTargetDictionary)for(let t in e.morphTargetDictionary)n[e.morphTargetDictionary[t]]=t;for(let a=0;a<e.morphTargetInfluences.length;++a){let o={},l=!1;for(let e in s.morphAttributes){if("position"!==e&&"normal"!==e){l||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),l=!0);continue}let t=s.morphAttributes[e][a],i=e.toUpperCase(),n=s.attributes[e];if(r.attributes.has(this.getUID(t,!0))){o[i]=r.attributes.get(this.getUID(t,!0));continue}let c=t.clone();if(!s.morphTargetsRelative)for(let e=0,r=t.count;e<r;e++)for(let r=0;r<t.itemSize;r++)0===r&&c.setX(e,t.getX(e)-n.getX(e)),1===r&&c.setY(e,t.getY(e)-n.getY(e)),2===r&&c.setZ(e,t.getZ(e)-n.getZ(e)),3===r&&c.setW(e,t.getW(e)-n.getW(e));o[i]=this.processAccessor(c,s),r.attributes.set(this.getUID(n,!0),o[i])}u.push(o),t.push(e.morphTargetInfluences[a]),void 0!==e.morphTargetDictionary&&i.push(n[a])}o.weights=t,i.length>0&&(o.extras={},o.extras.targetNames=i)}let p=Array.isArray(e.material);if(p&&0===s.groups.length)return null;let m=p?e.material:[e.material],A=p?s.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,i=A.length;e<i;e++){let i={mode:t,attributes:l};if(this.serializeUserData(s,i),u.length>0&&(i.targets=u),null!==s.index){let t=this.getUID(s.index);(void 0!==A[e].start||void 0!==A[e].count)&&(t+=":"+A[e].start+":"+A[e].count),r.attributes.has(t)?i.indices=r.attributes.get(t):(i.indices=this.processAccessor(s.index,s,A[e].start,A[e].count),r.attributes.set(t,i.indices)),null===i.indices&&delete i.indices}let n=this.processMaterial(m[A[e].materialIndex]);null!==n&&(i.material=n),c.push(i)}o.primitives=c,i.meshes||(i.meshes=[]),this._invokeAll(function(t){t.writeMesh&&t.writeMesh(e,o)});let g=i.meshes.push(o)-1;return r.meshes.set(a,g),g}detectMeshQuantization(e,t){let r;if(this.extensionsUsed[G])return;switch(t.array.constructor){case Int8Array:r="byte";break;case Uint8Array:r="unsigned byte";break;case Int16Array:r="short";break;case Uint16Array:r="unsigned short";break;default:return}t.normalized&&(r+=" normalized");let i=e.split("_",1)[0];L[i]&&L[i].includes(r)&&(this.extensionsUsed[G]=!0,this.extensionsRequired[G]=!0)}processCamera(e){let t=this.json;t.cameras||(t.cameras=[]);let r=e.isOrthographicCamera,i={type:r?"orthographic":"perspective"};return r?i.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:I.MathUtils.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,t){let r=this.json,i=this.nodeMap;r.animations||(r.animations=[]);let n=(e=U.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,a=[],s=[];for(let e=0;e<n.length;++e){let r;let o=n[e],l=I.PropertyBinding.parseTrackName(o.name),c=I.PropertyBinding.findNode(t,l.nodeName),u=V[l.propertyName];if("bones"===l.objectName&&(c=!0===c.isSkinnedMesh?c.skeleton.getBoneByName(l.objectIndex):void 0),!c||!u)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',o.name),null;let h=o.values.length/o.times.length;u===V.morphTargetInfluences&&(h/=c.morphTargetInfluences.length),!0===o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(r="CUBICSPLINE",h/=3):r=o.getInterpolation()===I.InterpolateDiscrete?"STEP":"LINEAR",s.push({input:this.processAccessor(new I.BufferAttribute(o.times,1)),output:this.processAccessor(new I.BufferAttribute(o.values,h)),interpolation:r}),a.push({sampler:s.length-1,target:{node:i.get(c),path:u}})}return r.animations.push({name:e.name||"clip_"+r.animations.length,samplers:s,channels:a}),r.animations.length-1}processSkin(e){let t=this.json,r=this.nodeMap,i=t.nodes[r.get(e)],n=e.skeleton;if(void 0===n)return null;let a=e.skeleton.bones[0];if(void 0===a)return null;let s=[],o=new Float32Array(16*n.bones.length),l=new I.Matrix4;for(let t=0;t<n.bones.length;++t)s.push(r.get(n.bones[t])),l.copy(n.boneInverses[t]),l.multiply(e.bindMatrix).toArray(o,16*t);return void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new I.BufferAttribute(o,16)),joints:s,skeleton:r.get(a)}),i.skin=t.skins.length-1}processNode(e){let t=this.json,r=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);let n={};if(r.trs){let t=e.quaternion.toArray(),r=e.position.toArray(),i=e.scale.toArray();K(t,[0,0,0,1])||(n.rotation=t),K(r,[0,0,0])||(n.translation=r),K(i,[1,1,1])||(n.scale=i)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===K(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(n.matrix=e.matrix.elements);if(""!==e.name&&(n.name=String(e.name)),this.serializeUserData(e,n),e.isMesh||e.isLine||e.isPoints){let t=this.processMesh(e);null!==t&&(n.mesh=t)}else e.isCamera&&(n.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){let t=[];for(let i=0,n=e.children.length;i<n;i++){let n=e.children[i];if(n.visible||!1===r.onlyVisible){let e=this.processNode(n);null!==e&&t.push(e)}}t.length>0&&(n.children=t)}this._invokeAll(function(t){t.writeNode&&t.writeNode(e,n)});let a=t.nodes.push(n)-1;return i.set(e,a),a}processScene(e){let t=this.json,r=this.options;t.scenes||(t.scenes=[],t.scene=0);let i={};""!==e.name&&(i.name=e.name),t.scenes.push(i);let n=[];for(let t=0,i=e.children.length;t<i;t++){let i=e.children[t];if(i.visible||!1===r.onlyVisible){let e=this.processNode(i);null!==e&&n.push(e)}}n.length>0&&(i.nodes=n),this.serializeUserData(e,i)}processObjects(e){let t=new I.Scene;t.name="AuxScene";for(let r=0;r<e.length;r++)t.children.push(e[r]);this.processScene(t)}processInput(e){let t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(t){t.beforeParse&&t.beforeParse(e)});let r=[];for(let t=0;t<e.length;t++)e[t]instanceof I.Scene?this.processScene(e[t]):r.push(e[t]);r.length>0&&this.processObjects(r);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let r=0;r<t.animations.length;++r)this.processAnimation(t.animations[r],e[0]);this._invokeAll(function(t){t.afterParse&&t.afterParse(e)})}_invokeAll(e){for(let t=0,r=this.plugins.length;t<r;t++)e(this.plugins[t])}constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}}class Y{writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}let r=this.writer,i=r.json,n=r.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=-((e.penumbra-1)*e.angle*1),a.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||0!==e.target.position.x||0!==e.target.position.y||-1!==e.target.position.z)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),n[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},n[this.name]=!0);let s=i.extensions[this.name].lights;s.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:s.length-1}}constructor(e){this.writer=e,this.name="KHR_lights_punctual"}}let Z=class{writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;let r=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},r[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}constructor(e){this.writer=e,this.name="KHR_materials_unlit"}},q=class{writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;let r=this.writer,i=r.extensionsUsed,n={};if(n.clearcoatFactor=e.clearcoat,e.clearcoatMap){let t={index:r.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};r.applyTextureTransform(t,e.clearcoatMap),n.clearcoatTexture=t}if(n.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){let t={index:r.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};r.applyTextureTransform(t,e.clearcoatRoughnessMap),n.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){let t={index:r.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};r.applyTextureTransform(t,e.clearcoatNormalMap),n.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}},$=class{writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;let r=this.writer,i=r.extensionsUsed,n={};if(n.iridescenceFactor=e.iridescence,e.iridescenceMap){let t={index:r.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};r.applyTextureTransform(t,e.iridescenceMap),n.iridescenceTexture=t}if(n.iridescenceIor=e.iridescenceIOR,n.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){let t={index:r.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};r.applyTextureTransform(t,e.iridescenceThicknessMap),n.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}},ee=class{writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;let r=this.writer,i=r.extensionsUsed,n={};if(n.transmissionFactor=e.transmission,e.transmissionMap){let t={index:r.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};r.applyTextureTransform(t,e.transmissionMap),n.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}constructor(e){this.writer=e,this.name="KHR_materials_transmission"}},et=class{writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;let r=this.writer,i=r.extensionsUsed,n={};if(n.thicknessFactor=e.thickness,e.thicknessMap){let t={index:r.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};r.applyTextureTransform(t,e.thicknessMap),n.thicknessTexture=t}n.attenuationDistance=e.attenuationDistance,n.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}constructor(e){this.writer=e,this.name="KHR_materials_volume"}},er=class{writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;let r=this.writer.extensionsUsed,i={};i.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}constructor(e){this.writer=e,this.name="KHR_materials_ior"}},ei=class{writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(J)&&!e.specularIntensityMap&&!e.specularColorTexture)return;let r=this.writer,i=r.extensionsUsed,n={};if(e.specularIntensityMap){let t={index:r.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};r.applyTextureTransform(t,e.specularIntensityMap),n.specularTexture=t}if(e.specularColorMap){let t={index:r.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};r.applyTextureTransform(t,e.specularColorMap),n.specularColorTexture=t}n.specularFactor=e.specularIntensity,n.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}constructor(e){this.writer=e,this.name="KHR_materials_specular"}},en=class{writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.sheen)return;let r=this.writer,i=r.extensionsUsed,n={};if(e.sheenRoughnessMap){let t={index:r.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};r.applyTextureTransform(t,e.sheenRoughnessMap),n.sheenRoughnessTexture=t}if(e.sheenColorMap){let t={index:r.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};r.applyTextureTransform(t,e.sheenColorMap),n.sheenColorTexture=t}n.sheenRoughnessFactor=e.sheenRoughness,n.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}constructor(e){this.writer=e,this.name="KHR_materials_sheen"}},ea=class{writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;let r=this.writer,i=r.extensionsUsed,n={};if(e.anisotropyMap){let t={index:r.processTexture(e.anisotropyMap)};r.applyTextureTransform(t,e.anisotropyMap),n.anisotropyTexture=t}n.anisotropyStrength=e.anisotropy,n.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}},es=class{writeMaterial(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;let r=this.writer.extensionsUsed,i={};i.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}};U.Utils={insertKeyframe:function(e,t){let r;let i=e.getValueSize(),n=new e.TimeBufferType(e.times.length+1),a=new e.ValueBufferType(e.values.length+i),s=e.createInterpolant(new e.ValueBufferType(i));if(0===e.times.length){n[0]=t;for(let e=0;e<i;e++)a[e]=0;r=0}else if(t<e.times[0]){if(.001>Math.abs(e.times[0]-t))return 0;n[0]=t,n.set(e.times,1),a.set(s.evaluate(t),0),a.set(e.values,i),r=0}else if(t>e.times[e.times.length-1]){if(.001>Math.abs(e.times[e.times.length-1]-t))return e.times.length-1;n[n.length-1]=t,n.set(e.times,0),a.set(e.values,0),a.set(s.evaluate(t),e.values.length),r=n.length-1}else for(let o=0;o<e.times.length;o++){if(.001>Math.abs(e.times[o]-t))return o;if(e.times[o]<t&&e.times[o+1]>t){n.set(e.times.slice(0,o+1),0),n[o+1]=t,n.set(e.times.slice(o+1),o+2),a.set(e.values.slice(0,(o+1)*i),0),a.set(s.evaluate(t),(o+1)*i),a.set(e.values.slice((o+1)*i),(o+2)*i),r=o+1;break}}return e.times=n,e.values=a,r},mergeMorphTargetTracks:function(e,t){let r=[],i={},n=e.tracks;for(let e=0;e<n.length;++e){let a,s=n[e],o=I.PropertyBinding.parseTrackName(s.name),l=I.PropertyBinding.findNode(t,o.nodeName);if("morphTargetInfluences"!==o.propertyName||void 0===o.propertyIndex){r.push(s);continue}if(s.createInterpolant!==s.InterpolantFactoryMethodDiscrete&&s.createInterpolant!==s.InterpolantFactoryMethodLinear){if(s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(s=s.clone()).setInterpolation(I.InterpolateLinear)}let c=l.morphTargetInfluences.length,u=l.morphTargetDictionary[o.propertyIndex];if(void 0===u)throw Error("THREE.GLTFExporter: Morph target name not found: "+o.propertyIndex);if(void 0===i[l.uuid]){let e=new(a=s.clone()).ValueBufferType(c*a.times.length);for(let t=0;t<a.times.length;t++)e[t*c+u]=a.values[t];a.name=(o.nodeName||"")+".morphTargetInfluences",a.values=e,i[l.uuid]=a,r.push(a);continue}let h=s.createInterpolant(new s.ValueBufferType(1));a=i[l.uuid];for(let e=0;e<a.times.length;e++)a.values[e*c+u]=h.evaluate(a.times[e]);for(let e=0;e<s.times.length;e++){let t=this.insertKeyframe(a,s.times[e]);a.values[t*c+u]=s.values[e]}}return e.tracks=r,e}};let eo=class{parse(e){let t,r,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{decodeSpeed:5,encodeSpeed:5,encoderMethod:eo.MESH_EDGEBREAKER_ENCODING,quantization:[16,8,8,8,8],exportUvs:!0,exportNormals:!0,exportColor:!1};if(e instanceof I.BufferGeometry&&e.isBufferGeometry)throw Error("DRACOExporter: The first parameter of parse() is now an instance of Mesh or Points.");if(void 0===DracoEncoderModule)throw Error("THREE.DRACOExporter: required the draco_encoder to work.");let a=e.geometry,s=DracoEncoderModule(),o=new s.Encoder;if(!a.isBufferGeometry)throw Error("THREE.DRACOExporter.parse(geometry, options): geometry is not a THREE.BufferGeometry instance.");if(e instanceof I.Mesh&&e.isMesh){t=new s.MeshBuilder,r=new s.Mesh;let e=a.getAttribute("position");t.AddFloatAttributeToMesh(r,s.POSITION,e.count,e.itemSize,e.array);let i=a.getIndex();if(null!==i)t.AddFacesToMesh(r,i.count/3,i.array);else{let i=new(e.count>65535?Uint32Array:Uint16Array)(e.count);for(let e=0;e<i.length;e++)i[e]=e;t.AddFacesToMesh(r,e.count,i)}if(n.exportNormals){let e=a.getAttribute("normal");void 0!==e&&t.AddFloatAttributeToMesh(r,s.NORMAL,e.count,e.itemSize,e.array)}if(n.exportUvs){let e=a.getAttribute("uv");void 0!==e&&t.AddFloatAttributeToMesh(r,s.TEX_COORD,e.count,e.itemSize,e.array)}if(n.exportColor){let e=a.getAttribute("color");void 0!==e&&t.AddFloatAttributeToMesh(r,s.COLOR,e.count,e.itemSize,e.array)}}else if(e instanceof I.Points&&e.isPoints){t=new s.PointCloudBuilder,r=new s.PointCloud;let e=a.getAttribute("position");if(t.AddFloatAttribute(r,s.POSITION,e.count,e.itemSize,e.array),n.exportColor){let e=a.getAttribute("color");void 0!==e&&t.AddFloatAttribute(r,s.COLOR,e.count,e.itemSize,e.array)}}else throw Error("DRACOExporter: Unsupported object type.");let l=new s.DracoInt8Array,c=void 0!==n.encodeSpeed?n.encodeSpeed:5,u=void 0!==n.decodeSpeed?n.decodeSpeed:5;if(o.SetSpeedOptions(c,u),void 0!==n.encoderMethod&&o.SetEncodingMethod(n.encoderMethod),void 0!==n.quantization)for(let e=0;e<5;e++)void 0!==n.quantization[e]&&o.SetAttributeQuantization(e,n.quantization[e]);if(i=e instanceof I.Mesh&&e.isMesh?o.EncodeMeshToDracoBuffer(r,l):o.EncodePointCloudToDracoBuffer(r,!0,l),s.destroy(r),0===i)throw Error("THREE.DRACOExporter: Draco encoding failed.");let h=new Int8Array(new ArrayBuffer(i));for(let e=0;e<i;e++)h[e]=l.GetValue(e);return s.destroy(l),s.destroy(o),s.destroy(t),h}};D(eo,"MESH_EDGEBREAKER_ENCODING",1),D(eo,"MESH_SEQUENTIAL_ENCODING",0),D(eo,"POINT_CLOUD",0),D(eo,"TRIANGULAR_MESH",1),D(eo,"INVALID",-1),D(eo,"POSITION",0),D(eo,"NORMAL",1),D(eo,"COLOR",2),D(eo,"TEX_COORD",3),D(eo,"GENERIC",4);let el=class extends I.Mesh{constructor(e,t={}){super(e),this.isReflector=!0,this.type="Reflector",this.camera=new I.PerspectiveCamera;let r=this,i=new I.Color(void 0!==t.color?t.color:8355711),n=t.textureWidth||512,a=t.textureHeight||512,s=t.clipBias||0,o=t.shader||el.ReflectorShader,l=void 0!==t.multisample?t.multisample:4,c=new I.Plane,u=new I.Vector3,h=new I.Vector3,d=new I.Vector3,f=new I.Matrix4,p=new I.Vector3(0,0,-1),m=new I.Vector4,A=new I.Vector3,g=new I.Vector3,v=new I.Vector4,T=new I.Matrix4,C=this.camera,y=new I.WebGLRenderTarget(n,a,{samples:l,type:I.HalfFloatType}),E=new I.ShaderMaterial({uniforms:I.UniformsUtils.clone(o.uniforms),fragmentShader:o.fragmentShader,vertexShader:o.vertexShader});E.uniforms.tDiffuse.value=y.texture,E.uniforms.color.value=i,E.uniforms.textureMatrix.value=T,this.material=E,this.onBeforeRender=function(e,t,i){if(h.setFromMatrixPosition(r.matrixWorld),d.setFromMatrixPosition(i.matrixWorld),f.extractRotation(r.matrixWorld),u.set(0,0,1),u.applyMatrix4(f),A.subVectors(h,d),A.dot(u)>0)return;A.reflect(u).negate(),A.add(h),f.extractRotation(i.matrixWorld),p.set(0,0,-1),p.applyMatrix4(f),p.add(d),g.subVectors(h,p),g.reflect(u).negate(),g.add(h),C.position.copy(A),C.up.set(0,1,0),C.up.applyMatrix4(f),C.up.reflect(u),C.lookAt(g),C.far=i.far,C.updateMatrixWorld(),C.projectionMatrix.copy(i.projectionMatrix),T.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),T.multiply(C.projectionMatrix),T.multiply(C.matrixWorldInverse),T.multiply(r.matrixWorld),c.setFromNormalAndCoplanarPoint(u,h),c.applyMatrix4(C.matrixWorldInverse),m.set(c.normal.x,c.normal.y,c.normal.z,c.constant);let n=C.projectionMatrix;v.x=(Math.sign(m.x)+n.elements[8])/n.elements[0],v.y=(Math.sign(m.y)+n.elements[9])/n.elements[5],v.z=-1,v.w=(1+n.elements[10])/n.elements[14],m.multiplyScalar(2/m.dot(v)),n.elements[2]=m.x,n.elements[6]=m.y,n.elements[10]=m.z+1-s,n.elements[14]=m.w,r.visible=!1;let a=e.getRenderTarget(),o=e.xr.enabled,l=e.shadowMap.autoUpdate,E=e.toneMapping,B=!1;B="outputColorSpace"in e?"srgb"===e.outputColorSpace:3001===e.outputEncoding,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,"outputColorSpace"in e?e.outputColorSpace="linear-srgb":e.outputEncoding=3e3,e.toneMapping=I.NoToneMapping,e.setRenderTarget(y),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,C),e.xr.enabled=o,e.shadowMap.autoUpdate=l,e.toneMapping=E,"outputColorSpace"in e?e.outputColorSpace=B?"srgb":"srgb-linear":e.outputEncoding=B?3001:3e3,e.setRenderTarget(a);let R=i.viewport;void 0!==R&&e.state.viewport(R),r.visible=!0},this.getRenderTarget=function(){return y},this.dispose=function(){y.dispose(),r.material.dispose()}}};D(el,"ReflectorShader",{uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:"\n		uniform mat4 textureMatrix;\n		varying vec4 vUv;\n\n		#include <common>\n		#include <logdepthbuf_pars_vertex>\n\n		void main() {\n\n			vUv = textureMatrix * vec4( position, 1.0 );\n\n			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n			#include <logdepthbuf_vertex>\n\n		}",fragmentShader:"\n		uniform vec3 color;\n		uniform sampler2D tDiffuse;\n		varying vec4 vUv;\n\n		#include <logdepthbuf_pars_fragment>\n\n		float blendOverlay( float base, float blend ) {\n\n			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n		}\n\n		vec3 blendOverlay( vec3 base, vec3 blend ) {\n\n			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n		}\n\n		void main() {\n\n			#include <logdepthbuf_fragment>\n\n			vec4 base = texture2DProj( tDiffuse, vUv );\n			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n			#include <tonemapping_fragment>\n			#include <".concat(parseInt(I.REVISION.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment",">\n\n		}")});let ec=class extends I.Mesh{constructor(e,t={}){super(e),this.isRefractor=!0,this.type="Refractor",this.camera=new I.PerspectiveCamera;let r=this,i=new I.Color(void 0!==t.color?t.color:8355711),n=t.textureWidth||512,a=t.textureHeight||512,s=t.clipBias||0,o=t.shader||ec.RefractorShader,l=void 0!==t.multisample?t.multisample:4,c=this.camera;c.matrixAutoUpdate=!1,c.userData.refractor=!0;let u=new I.Plane,h=new I.Matrix4,d=new I.WebGLRenderTarget(n,a,{samples:l,type:I.HalfFloatType});this.material=new I.ShaderMaterial({uniforms:I.UniformsUtils.clone(o.uniforms),vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,transparent:!0}),this.material.uniforms.color.value=i,this.material.uniforms.tDiffuse.value=d.texture,this.material.uniforms.textureMatrix.value=h;let f=function(){let e=new I.Vector3,t=new I.Vector3,i=new I.Matrix4,n=new I.Vector3,a=new I.Vector3;return function(s){return e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(s.matrixWorld),n.subVectors(e,t),i.extractRotation(r.matrixWorld),a.set(0,0,1),a.applyMatrix4(i),0>n.dot(a)}}(),p=function(){let e=new I.Vector3,t=new I.Vector3,i=new I.Quaternion,n=new I.Vector3;return function(){r.matrixWorld.decompose(t,i,n),e.set(0,0,1).applyQuaternion(i).normalize(),e.negate(),u.setFromNormalAndCoplanarPoint(e,t)}}(),m=function(){let e=new I.Plane,t=new I.Vector4,r=new I.Vector4;return function(i){c.matrixWorld.copy(i.matrixWorld),c.matrixWorldInverse.copy(c.matrixWorld).invert(),c.projectionMatrix.copy(i.projectionMatrix),c.far=i.far,e.copy(u),e.applyMatrix4(c.matrixWorldInverse),t.set(e.normal.x,e.normal.y,e.normal.z,e.constant);let n=c.projectionMatrix;r.x=(Math.sign(t.x)+n.elements[8])/n.elements[0],r.y=(Math.sign(t.y)+n.elements[9])/n.elements[5],r.z=-1,r.w=(1+n.elements[10])/n.elements[14],t.multiplyScalar(2/t.dot(r)),n.elements[2]=t.x,n.elements[6]=t.y,n.elements[10]=t.z+1-s,n.elements[14]=t.w}}();this.onBeforeRender=function(e,t,i){!0!==i.userData.refractor&&!0!=!f(i)&&(p(),h.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),h.multiply(i.projectionMatrix),h.multiply(i.matrixWorldInverse),h.multiply(r.matrixWorld),m(i),function(e,t,i){r.visible=!1;let n=e.getRenderTarget(),a=e.xr.enabled,s=e.shadowMap.autoUpdate,o=e.toneMapping,l=!1;l="outputColorSpace"in e?"srgb"===e.outputColorSpace:3001===e.outputEncoding,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,"outputColorSpace"in e?e.outputColorSpace="linear-srgb":e.outputEncoding=3e3,e.toneMapping=I.NoToneMapping,e.setRenderTarget(d),!1===e.autoClear&&e.clear(),e.render(t,c),e.xr.enabled=a,e.shadowMap.autoUpdate=s,e.toneMapping=o,e.setRenderTarget(n),"outputColorSpace"in e?e.outputColorSpace=l?"srgb":"srgb-linear":e.outputEncoding=l?3001:3e3;let u=i.viewport;void 0!==u&&e.state.viewport(u),r.visible=!0}(e,t,i))},this.getRenderTarget=function(){return d},this.dispose=function(){d.dispose(),r.material.dispose()}}};D(ec,"RefractorShader",{uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:"\n\n		uniform mat4 textureMatrix;\n\n		varying vec4 vUv;\n\n		void main() {\n\n			vUv = textureMatrix * vec4( position, 1.0 );\n			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n		}",fragmentShader:"\n\n		uniform vec3 color;\n		uniform sampler2D tDiffuse;\n\n		varying vec4 vUv;\n\n		float blendOverlay( float base, float blend ) {\n\n			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n		}\n\n		vec3 blendOverlay( vec3 base, vec3 blend ) {\n\n			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n		}\n\n		void main() {\n\n			vec4 base = texture2DProj( tDiffuse, vUv );\n			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n			#include <tonemapping_fragment>\n			#include <".concat(parseInt(I.REVISION.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment",">\n\n		}")});let eu=new I.BufferGeometry,eh=class extends I.Mesh{constructor(){super(eh.Geometry,new I.MeshBasicMaterial({opacity:0,transparent:!0})),this.isLensflare=!0,this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;let e=new I.Vector3,t=new I.Vector3,r=new I.DataTexture(new Uint8Array(768),16,16,I.RGBAFormat);r.minFilter=I.NearestFilter,r.magFilter=I.NearestFilter,r.wrapS=I.ClampToEdgeWrapping,r.wrapT=I.ClampToEdgeWrapping;let i=new I.DataTexture(new Uint8Array(768),16,16,I.RGBAFormat);i.minFilter=I.NearestFilter,i.magFilter=I.NearestFilter,i.wrapS=I.ClampToEdgeWrapping,i.wrapT=I.ClampToEdgeWrapping;let n=eh.Geometry,a=new I.RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n				precision highp float;\n\n				uniform vec3 screenPosition;\n				uniform vec2 scale;\n\n				attribute vec3 position;\n\n				void main() {\n\n					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );\n\n				}",fragmentShader:"\n\n				precision highp float;\n\n				void main() {\n\n					gl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );\n\n				}",depthTest:!0,depthWrite:!1,transparent:!1}),s=new I.RawShaderMaterial({uniforms:{map:{value:r},scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n				precision highp float;\n\n				uniform vec3 screenPosition;\n				uniform vec2 scale;\n\n				attribute vec3 position;\n				attribute vec2 uv;\n\n				varying vec2 vUV;\n\n				void main() {\n\n					vUV = uv;\n\n					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );\n\n				}",fragmentShader:"\n\n				precision highp float;\n\n				uniform sampler2D map;\n\n				varying vec2 vUV;\n\n				void main() {\n\n					gl_FragColor = texture2D( map, vUV );\n\n				}",depthTest:!1,depthWrite:!1,transparent:!1}),o=new I.Mesh(n,a),l=[],c=ed.Shader,u=new I.RawShaderMaterial({uniforms:{map:{value:null},occlusionMap:{value:i},color:{value:new I.Color(16777215)},scale:{value:new I.Vector2},screenPosition:{value:new I.Vector3}},vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:I.AdditiveBlending,transparent:!0,depthWrite:!1}),h=new I.Mesh(n,u);this.addElement=function(e){l.push(e)};let d=new I.Vector2,f=new I.Vector2,p=new I.Box2,m=new I.Vector4;this.onBeforeRender=function(c,A,g){c.getCurrentViewport(m);let v=m.w/m.z,T=m.z/2,C=m.w/2,y=16/m.w;if(d.set(y*v,y),p.min.set(m.x,m.y),p.max.set(m.x+(m.z-16),m.y+(m.w-16)),t.setFromMatrixPosition(this.matrixWorld),t.applyMatrix4(g.matrixWorldInverse),!(t.z>0)&&(e.copy(t).applyMatrix4(g.projectionMatrix),f.x=m.x+e.x*T+T-8,f.y=m.y+e.y*C+C-8,p.containsPoint(f))){c.copyFramebufferToTexture(f,r);let t=a.uniforms;t.scale.value=d,t.screenPosition.value=e,c.renderBufferDirect(g,null,n,a,o,null),c.copyFramebufferToTexture(f,i),(t=s.uniforms).scale.value=d,t.screenPosition.value=e,c.renderBufferDirect(g,null,n,s,o,null);let p=-(2*e.x),A=-(2*e.y);for(let t=0,r=l.length;t<r;t++){let r=l[t],i=u.uniforms;i.color.value.copy(r.color),i.map.value=r.texture,i.screenPosition.value.x=e.x+p*r.distance,i.screenPosition.value.y=e.y+A*r.distance,y=r.size/m.w;let a=m.w/m.z;i.scale.value.set(y*a,y),u.uniformsNeedUpdate=!0,c.renderBufferDirect(g,null,n,u,h,null)}}},this.dispose=function(){a.dispose(),s.dispose(),u.dispose(),r.dispose(),i.dispose();for(let e=0,t=l.length;e<t;e++)l[e].texture.dispose()}}};D(eh,"Geometry",eu);class ed{constructor(e,t=1,r=0,i=new I.Color(16777215)){this.texture=e,this.size=t,this.distance=r,this.color=i}}D(ed,"Shader",{uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n		precision highp float;\n\n		uniform vec3 screenPosition;\n		uniform vec2 scale;\n\n		uniform sampler2D occlusionMap;\n\n		attribute vec3 position;\n		attribute vec2 uv;\n\n		varying vec2 vUV;\n		varying float vVisibility;\n\n		void main() {\n\n			vUV = uv;\n\n			vec2 pos = position.xy;\n\n			vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\n			visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\n			visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\n			visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\n			visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\n			visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\n			visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\n			visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\n			visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\n\n			vVisibility =        visibility.r / 9.0;\n			vVisibility *= 1.0 - visibility.g / 9.0;\n			vVisibility *=       visibility.b / 9.0;\n\n			gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n\n		}",fragmentShader:"\n\n		precision highp float;\n\n		uniform sampler2D map;\n		uniform vec3 color;\n\n		varying vec2 vUV;\n		varying float vVisibility;\n\n		void main() {\n\n			vec4 texture = texture2D( map, vUV );\n			texture.a *= vVisibility;\n			gl_FragColor = texture;\n			gl_FragColor.rgb *= color;\n\n		}"}),new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);class ef{constructor(e=Math){D(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),D(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),D(this,"p",[]),D(this,"perm",[]),D(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),D(this,"dot",(e,t,r)=>e[0]*t+e[1]*r),D(this,"dot3",(e,t,r,i)=>e[0]*t+e[1]*r+e[2]*i),D(this,"dot4",(e,t,r,i,n)=>e[0]*t+e[1]*r+e[2]*i+e[3]*n),D(this,"noise",(e,t)=>{let r,i,n;let a=.5*(Math.sqrt(3)-1)*(e+t),s=Math.floor(e+a),o=Math.floor(t+a),l=(3-Math.sqrt(3))/6,c=(s+o)*l,u=e-(s-c),h=t-(o-c),d=0,f=1;u>h&&(d=1,f=0);let p=u-d+l,m=h-f+l,A=u-1+2*l,g=h-1+2*l,v=255&s,T=255&o,C=this.perm[v+this.perm[T]]%12,y=this.perm[v+d+this.perm[T+f]]%12,E=this.perm[v+1+this.perm[T+1]]%12,B=.5-u*u-h*h;B<0?r=0:(B*=B,r=B*B*this.dot(this.grad3[C],u,h));let R=.5-p*p-m*m;R<0?i=0:(R*=R,i=R*R*this.dot(this.grad3[y],p,m));let x=.5-A*A-g*g;return x<0?n=0:(x*=x,n=x*x*this.dot(this.grad3[E],A,g)),70*(r+i+n)}),D(this,"noise3d",(e,t,r)=>{let i,n,a,s,o,l,c,u,h,d;let f=1/3*(e+t+r),p=Math.floor(e+f),m=Math.floor(t+f),A=Math.floor(r+f),g=1/6*(p+m+A),v=e-(p-g),T=t-(m-g),C=r-(A-g);v>=T?T>=C?(o=1,l=0,c=0,u=1,h=1,d=0):(v>=C?(o=1,l=0,c=0):(o=0,l=0,c=1),u=1,h=0,d=1):T<C?(o=0,l=0,c=1,u=0,h=1,d=1):v<C?(o=0,l=1,c=0,u=0,h=1,d=1):(o=0,l=1,c=0,u=1,h=1,d=0);let y=v-o+1/6,E=T-l+1/6,B=C-c+1/6,R=v-u+1/6*2,x=T-h+1/6*2,M=C-d+1/6*2,S=v-1+1/6*3,b=T-1+1/6*3,I=C-1+1/6*3,w=255&p,_=255&m,F=255&A,P=this.perm[w+this.perm[_+this.perm[F]]]%12,D=this.perm[w+o+this.perm[_+l+this.perm[F+c]]]%12,N=this.perm[w+u+this.perm[_+h+this.perm[F+d]]]%12,O=this.perm[w+1+this.perm[_+1+this.perm[F+1]]]%12,L=.6-v*v-T*T-C*C;L<0?i=0:(L*=L,i=L*L*this.dot3(this.grad3[P],v,T,C));let U=.6-y*y-E*E-B*B;U<0?n=0:(U*=U,n=U*U*this.dot3(this.grad3[D],y,E,B));let k=.6-R*R-x*x-M*M;k<0?a=0:(k*=k,a=k*k*this.dot3(this.grad3[N],R,x,M));let G=.6-S*S-b*b-I*I;return G<0?s=0:(G*=G,s=G*G*this.dot3(this.grad3[O],S,b,I)),32*(i+n+a+s)}),D(this,"noise4d",(e,t,r,i)=>{let n,a,s,o,l,c,u,h,d,f,p,m,A,g,v,T,C;let y=this.grad4,E=this.simplex,B=this.perm,R=(5-Math.sqrt(5))/20,x=(Math.sqrt(5)-1)/4*(e+t+r+i),M=Math.floor(e+x),S=Math.floor(t+x),b=Math.floor(r+x),I=Math.floor(i+x),w=(M+S+b+I)*R,_=e-(M-w),F=t-(S-w),P=r-(b-w),D=i-(I-w),N=(_>F?32:0)+(_>P?16:0)+(F>P?8:0)+(_>D?4:0)+(F>D?2:0)+(P>D?1:0);c=E[N][0]>=3?1:0,u=E[N][1]>=3?1:0,h=E[N][2]>=3?1:0,d=E[N][3]>=3?1:0,f=E[N][0]>=2?1:0,p=E[N][1]>=2?1:0,m=E[N][2]>=2?1:0,A=E[N][3]>=2?1:0,g=E[N][0]>=1?1:0,v=E[N][1]>=1?1:0,T=E[N][2]>=1?1:0,C=E[N][3]>=1?1:0;let O=_-c+R,L=F-u+R,U=P-h+R,k=D-d+R,G=_-f+2*R,H=F-p+2*R,V=P-m+2*R,J=D-A+2*R,K=_-g+3*R,j=F-v+3*R,W=P-T+3*R,z=D-C+3*R,Q=_-1+4*R,X=F-1+4*R,Y=P-1+4*R,Z=D-1+4*R,q=255&M,$=255&S,ee=255&b,et=255&I,er=B[q+B[$+B[ee+B[et]]]]%32,ei=B[q+c+B[$+u+B[ee+h+B[et+d]]]]%32,en=B[q+f+B[$+p+B[ee+m+B[et+A]]]]%32,ea=B[q+g+B[$+v+B[ee+T+B[et+C]]]]%32,es=B[q+1+B[$+1+B[ee+1+B[et+1]]]]%32,eo=.6-_*_-F*F-P*P-D*D;eo<0?n=0:(eo*=eo,n=eo*eo*this.dot4(y[er],_,F,P,D));let el=.6-O*O-L*L-U*U-k*k;el<0?a=0:(el*=el,a=el*el*this.dot4(y[ei],O,L,U,k));let ec=.6-G*G-H*H-V*V-J*J;ec<0?s=0:(ec*=ec,s=ec*ec*this.dot4(y[en],G,H,V,J));let eu=.6-K*K-j*j-W*W-z*z;eu<0?o=0:(eu*=eu,o=eu*eu*this.dot4(y[ea],K,j,W,z));let eh=.6-Q*Q-X*X-Y*Y-Z*Z;return eh<0?l=0:(eh*=eh,l=eh*eh*this.dot4(y[es],Q,X,Y,Z)),27*(n+a+s+o+l)});for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());for(let e=0;e<512;e++)this.perm[e]=this.p[255&e]}}let ep=class extends I.BufferGeometry{static createRandomGenerator(){let e=[];for(let t=0;t<2053;t++)e.push(Math.random());let t={currentSeed:0,random:function(){let r=e[t.currentSeed];return t.currentSeed=(t.currentSeed+1)%2053,r},getSeed:function(){return t.currentSeed/2053},setSeed:function(e){t.currentSeed=Math.floor(2053*e)%2053}};return t}static copyParameters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=function(r){return t===e?r:r.clone()};return e.sourceOffset=void 0!==t.sourceOffset?r(t.sourceOffset):new I.Vector3(0,100,0),e.destOffset=void 0!==t.destOffset?r(t.destOffset):new I.Vector3(0,0,0),e.timeScale=void 0!==t.timeScale?t.timeScale:1,e.roughness=void 0!==t.roughness?t.roughness:.9,e.straightness=void 0!==t.straightness?t.straightness:.7,e.up0=void 0!==t.up0?r(t.up0):new I.Vector3(0,0,1),e.up1=void 0!==t.up1?r(t.up1):new I.Vector3(0,0,1),e.radius0=void 0!==t.radius0?t.radius0:1,e.radius1=void 0!==t.radius1?t.radius1:1,e.radius0Factor=void 0!==t.radius0Factor?t.radius0Factor:.5,e.radius1Factor=void 0!==t.radius1Factor?t.radius1Factor:.2,e.minRadius=void 0!==t.minRadius?t.minRadius:.2,e.isEternal=void 0!==t.isEternal?t.isEternal:void 0===t.birthTime||void 0===t.deathTime,e.birthTime=t.birthTime,e.deathTime=t.deathTime,e.propagationTimeFactor=void 0!==t.propagationTimeFactor?t.propagationTimeFactor:.1,e.vanishingTimeFactor=void 0!==t.vanishingTimeFactor?t.vanishingTimeFactor:.9,e.subrayPeriod=void 0!==t.subrayPeriod?t.subrayPeriod:4,e.subrayDutyCycle=void 0!==t.subrayDutyCycle?t.subrayDutyCycle:.6,e.maxIterations=void 0!==t.maxIterations?t.maxIterations:9,e.isStatic=void 0!==t.isStatic&&t.isStatic,e.ramification=void 0!==t.ramification?t.ramification:5,e.maxSubrayRecursion=void 0!==t.maxSubrayRecursion?t.maxSubrayRecursion:3,e.recursionProbability=void 0!==t.recursionProbability?t.recursionProbability:.6,e.generateUVs=void 0!==t.generateUVs&&t.generateUVs,e.randomGenerator=t.randomGenerator,e.noiseSeed=t.noiseSeed,e.onDecideSubrayCreation=t.onDecideSubrayCreation,e.onSubrayCreation=t.onSubrayCreation,e}update(e){this.isStatic||(this.rayParameters.isEternal||this.rayParameters.birthTime<=e&&e<=this.rayParameters.deathTime?(this.updateMesh(e),e<this.subrays[0].endPropagationTime?this.state=ep.RAY_PROPAGATING:e>this.subrays[0].beginVanishingTime?this.state=ep.RAY_VANISHING:this.state=ep.RAY_STEADY,this.visible=!0):(this.visible=!1,e<this.rayParameters.birthTime?this.state=ep.RAY_UNBORN:this.state=ep.RAY_EXTINGUISHED))}init(e){this.rayParameters=e,this.maxIterations=void 0!==e.maxIterations?Math.floor(e.maxIterations):9,e.maxIterations=this.maxIterations,this.isStatic=void 0!==e.isStatic&&e.isStatic,e.isStatic=this.isStatic,this.ramification=void 0!==e.ramification?Math.floor(e.ramification):5,e.ramification=this.ramification,this.maxSubrayRecursion=void 0!==e.maxSubrayRecursion?Math.floor(e.maxSubrayRecursion):3,e.maxSubrayRecursion=this.maxSubrayRecursion,this.recursionProbability=void 0!==e.recursionProbability?e.recursionProbability:.6,e.recursionProbability=this.recursionProbability,this.generateUVs=void 0!==e.generateUVs&&e.generateUVs,e.generateUVs=this.generateUVs,void 0!==e.randomGenerator?(this.randomGenerator=e.randomGenerator,this.seedGenerator=e.randomGenerator,void 0!==e.noiseSeed&&this.seedGenerator.setSeed(e.noiseSeed)):(this.randomGenerator=ep.createRandomGenerator(),this.seedGenerator=Math),void 0!==e.onDecideSubrayCreation?this.onDecideSubrayCreation=e.onDecideSubrayCreation:(this.createDefaultSubrayCreationCallbacks(),void 0!==e.onSubrayCreation&&(this.onSubrayCreation=e.onSubrayCreation)),this.state=ep.RAY_INITIALIZED,this.maxSubrays=Math.ceil(1+Math.pow(this.ramification,Math.max(0,this.maxSubrayRecursion-1))),e.maxSubrays=this.maxSubrays,this.maxRaySegments=2*(1<<this.maxIterations),this.subrays=[];for(let e=0;e<this.maxSubrays;e++)this.subrays.push(this.createSubray());this.raySegments=[];for(let e=0;e<this.maxRaySegments;e++)this.raySegments.push(this.createSegment());this.time=0,this.timeFraction=0,this.currentSegmentCallback=null,this.currentCreateTriangleVertices=this.generateUVs?this.createTriangleVerticesWithUVs:this.createTriangleVerticesWithoutUVs,this.numSubrays=0,this.currentSubray=null,this.currentSegmentIndex=0,this.isInitialSegment=!1,this.subrayProbability=0,this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.vertices=null,this.uvs=null,this.indices=null,this.positionAttribute=null,this.uvsAttribute=null,this.simplexX=new ef(this.seedGenerator),this.simplexY=new ef(this.seedGenerator),this.simplexZ=new ef(this.seedGenerator),this.forwards=new I.Vector3,this.forwardsFill=new I.Vector3,this.side=new I.Vector3,this.down=new I.Vector3,this.middlePos=new I.Vector3,this.middleLinPos=new I.Vector3,this.newPos=new I.Vector3,this.vPos=new I.Vector3,this.cross1=new I.Vector3}createMesh(){let e=1<<this.maxIterations,t=3*(e+1)*this.maxSubrays,r=18*e*this.maxSubrays;this.vertices=new Float32Array(3*t),this.indices=new Uint32Array(r),this.generateUVs&&(this.uvs=new Float32Array(2*t)),this.fillMesh(0),this.setIndex(new I.Uint32BufferAttribute(this.indices,1)),this.positionAttribute=new I.Float32BufferAttribute(this.vertices,3),this.setAttribute("position",this.positionAttribute),this.generateUVs&&(this.uvsAttribute=new I.Float32BufferAttribute(new Float32Array(this.uvs),2),this.setAttribute("uv",this.uvsAttribute)),!this.isStatic&&(this.index.usage=I.DynamicDrawUsage,this.positionAttribute.usage=I.DynamicDrawUsage,this.generateUVs&&(this.uvsAttribute.usage=I.DynamicDrawUsage)),this.vertices=this.positionAttribute.array,this.indices=this.index.array,this.generateUVs&&(this.uvs=this.uvsAttribute.array)}updateMesh(e){this.fillMesh(e),this.drawRange.count=this.currentIndex,this.index.needsUpdate=!0,this.positionAttribute.needsUpdate=!0,this.generateUVs&&(this.uvsAttribute.needsUpdate=!0)}fillMesh(e){let t=this;this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.fractalRay(e,function(r){let i=t.currentSubray;!(e<i.birthTime)&&(this.rayParameters.isEternal&&0==t.currentSubray.recursion?(t.createPrism(r),t.onDecideSubrayCreation(r,t)):e<i.endPropagationTime?t.timeFraction>=r.fraction0*i.propagationTimeFactor&&(t.createPrism(r),t.onDecideSubrayCreation(r,t)):(e<i.beginVanishingTime?t.createPrism(r):t.timeFraction<=i.vanishingTimeFactor+r.fraction1*(1-i.vanishingTimeFactor)&&t.createPrism(r),t.onDecideSubrayCreation(r,t)))})}addNewSubray(){return this.subrays[this.numSubrays++]}initSubray(e,t){e.pos0.copy(t.sourceOffset),e.pos1.copy(t.destOffset),e.up0.copy(t.up0),e.up1.copy(t.up1),e.radius0=t.radius0,e.radius1=t.radius1,e.birthTime=t.birthTime,e.deathTime=t.deathTime,e.timeScale=t.timeScale,e.roughness=t.roughness,e.straightness=t.straightness,e.propagationTimeFactor=t.propagationTimeFactor,e.vanishingTimeFactor=t.vanishingTimeFactor,e.maxIterations=this.maxIterations,e.seed=void 0!==t.noiseSeed?t.noiseSeed:0,e.recursion=0}fractalRay(e,t){this.time=e,this.currentSegmentCallback=t,this.numSubrays=0,this.initSubray(this.addNewSubray(),this.rayParameters);for(let t=0;t<this.numSubrays;t++){let r=this.subrays[t];this.currentSubray=r,this.randomGenerator.setSeed(r.seed),r.endPropagationTime=I.MathUtils.lerp(r.birthTime,r.deathTime,r.propagationTimeFactor),r.beginVanishingTime=I.MathUtils.lerp(r.deathTime,r.birthTime,1-r.vanishingTimeFactor);let i=this.randomGenerator.random;r.linPos0.set(i(),i(),i()).multiplyScalar(1e3),r.linPos1.set(i(),i(),i()).multiplyScalar(1e3),this.timeFraction=(e-r.birthTime)/(r.deathTime-r.birthTime),this.currentSegmentIndex=0,this.isInitialSegment=!0;let n=this.getNewSegment();n.iteration=0,n.pos0.copy(r.pos0),n.pos1.copy(r.pos1),n.linPos0.copy(r.linPos0),n.linPos1.copy(r.linPos1),n.up0.copy(r.up0),n.up1.copy(r.up1),n.radius0=r.radius0,n.radius1=r.radius1,n.fraction0=0,n.fraction1=1,n.positionVariationFactor=1-r.straightness,this.subrayProbability=this.ramification*Math.pow(this.recursionProbability,r.recursion)/(1<<r.maxIterations),this.fractalRayRecursive(n)}this.currentSegmentCallback=null,this.currentSubray=null}fractalRayRecursive(e){if(e.iteration>=this.currentSubray.maxIterations){this.currentSegmentCallback(e);return}this.forwards.subVectors(e.pos1,e.pos0);let t=this.forwards.length();t<1e-6&&(this.forwards.set(0,0,.01),t=this.forwards.length());let r=(e.radius0+e.radius1)*.5,i=(e.fraction0+e.fraction1)*.5,n=this.time*this.currentSubray.timeScale*Math.pow(2,e.iteration);this.middlePos.lerpVectors(e.pos0,e.pos1,.5),this.middleLinPos.lerpVectors(e.linPos0,e.linPos1,.5);let a=this.middleLinPos;this.newPos.set(this.simplexX.noise4d(a.x,a.y,a.z,n),this.simplexY.noise4d(a.x,a.y,a.z,n),this.simplexZ.noise4d(a.x,a.y,a.z,n)),this.newPos.multiplyScalar(e.positionVariationFactor*t),this.newPos.add(this.middlePos);let s=this.getNewSegment();s.pos0.copy(e.pos0),s.pos1.copy(this.newPos),s.linPos0.copy(e.linPos0),s.linPos1.copy(this.middleLinPos),s.up0.copy(e.up0),s.up1.copy(e.up1),s.radius0=e.radius0,s.radius1=r,s.fraction0=e.fraction0,s.fraction1=i,s.positionVariationFactor=e.positionVariationFactor*this.currentSubray.roughness,s.iteration=e.iteration+1;let o=this.getNewSegment();o.pos0.copy(this.newPos),o.pos1.copy(e.pos1),o.linPos0.copy(this.middleLinPos),o.linPos1.copy(e.linPos1),this.cross1.crossVectors(e.up0,this.forwards.normalize()),o.up0.crossVectors(this.forwards,this.cross1).normalize(),o.up1.copy(e.up1),o.radius0=r,o.radius1=e.radius1,o.fraction0=i,o.fraction1=e.fraction1,o.positionVariationFactor=e.positionVariationFactor*this.currentSubray.roughness,o.iteration=e.iteration+1,this.fractalRayRecursive(s),this.fractalRayRecursive(o)}createPrism(e){this.forwardsFill.subVectors(e.pos1,e.pos0).normalize(),this.isInitialSegment&&(this.currentCreateTriangleVertices(e.pos0,e.up0,this.forwardsFill,e.radius0,0),this.isInitialSegment=!1),this.currentCreateTriangleVertices(e.pos1,e.up0,this.forwardsFill,e.radius1,e.fraction1),this.createPrismFaces()}createTriangleVerticesWithoutUVs(e,t,r,i){this.side.crossVectors(t,r).multiplyScalar(i*ep.COS30DEG),this.down.copy(t).multiplyScalar(-i*ep.SIN30DEG);let n=this.vPos,a=this.vertices;n.copy(e).sub(this.side).add(this.down),a[this.currentCoordinate++]=n.x,a[this.currentCoordinate++]=n.y,a[this.currentCoordinate++]=n.z,n.copy(e).add(this.side).add(this.down),a[this.currentCoordinate++]=n.x,a[this.currentCoordinate++]=n.y,a[this.currentCoordinate++]=n.z,n.copy(t).multiplyScalar(i).add(e),a[this.currentCoordinate++]=n.x,a[this.currentCoordinate++]=n.y,a[this.currentCoordinate++]=n.z,this.currentVertex+=3}createTriangleVerticesWithUVs(e,t,r,i,n){this.side.crossVectors(t,r).multiplyScalar(i*ep.COS30DEG),this.down.copy(t).multiplyScalar(-i*ep.SIN30DEG);let a=this.vPos,s=this.vertices,o=this.uvs;a.copy(e).sub(this.side).add(this.down),s[this.currentCoordinate++]=a.x,s[this.currentCoordinate++]=a.y,s[this.currentCoordinate++]=a.z,o[this.currentUVCoordinate++]=n,o[this.currentUVCoordinate++]=0,a.copy(e).add(this.side).add(this.down),s[this.currentCoordinate++]=a.x,s[this.currentCoordinate++]=a.y,s[this.currentCoordinate++]=a.z,o[this.currentUVCoordinate++]=n,o[this.currentUVCoordinate++]=.5,a.copy(t).multiplyScalar(i).add(e),s[this.currentCoordinate++]=a.x,s[this.currentCoordinate++]=a.y,s[this.currentCoordinate++]=a.z,o[this.currentUVCoordinate++]=n,o[this.currentUVCoordinate++]=1,this.currentVertex+=3}createPrismFaces(e){let t=this.indices;e=this.currentVertex-6,t[this.currentIndex++]=e+1,t[this.currentIndex++]=e+2,t[this.currentIndex++]=e+5,t[this.currentIndex++]=e+1,t[this.currentIndex++]=e+5,t[this.currentIndex++]=e+4,t[this.currentIndex++]=e+0,t[this.currentIndex++]=e+1,t[this.currentIndex++]=e+4,t[this.currentIndex++]=e+0,t[this.currentIndex++]=e+4,t[this.currentIndex++]=e+3,t[this.currentIndex++]=e+2,t[this.currentIndex++]=e+0,t[this.currentIndex++]=e+3,t[this.currentIndex++]=e+2,t[this.currentIndex++]=e+3,t[this.currentIndex++]=e+5}createDefaultSubrayCreationCallbacks(){let e=this.randomGenerator.random;this.onDecideSubrayCreation=function(t,r){let i=r.currentSubray,n=r.rayParameters.subrayPeriod,a=r.rayParameters.subrayDutyCycle,s=r.rayParameters.isEternal&&0==i.recursion?-e()*n:I.MathUtils.lerp(i.birthTime,i.endPropagationTime,t.fraction0)-e()*n,o=r.time-s,l=Math.floor(o/n),c=e()*(l+1),u=0;if(o%n<=a*n&&(u=r.subrayProbability),i.recursion<r.maxSubrayRecursion&&r.numSubrays<r.maxSubrays&&e()<u){let o=r.addNewSubray(),u=r.randomGenerator.getSeed();o.seed=c,r.randomGenerator.setSeed(c),o.recursion=i.recursion+1,o.maxIterations=Math.max(1,i.maxIterations-1),o.linPos0.set(e(),e(),e()).multiplyScalar(1e3),o.linPos1.set(e(),e(),e()).multiplyScalar(1e3),o.up0.copy(i.up0),o.up1.copy(i.up1),o.radius0=t.radius0*r.rayParameters.radius0Factor,o.radius1=Math.min(r.rayParameters.minRadius,t.radius1*r.rayParameters.radius1Factor),o.birthTime=s+l*n,o.deathTime=o.birthTime+n*a,r.rayParameters.isEternal||0!=i.recursion||(o.birthTime=Math.max(o.birthTime,i.birthTime),o.deathTime=Math.min(o.deathTime,i.deathTime)),o.timeScale=2*i.timeScale,o.roughness=i.roughness,o.straightness=i.straightness,o.propagationTimeFactor=i.propagationTimeFactor,o.vanishingTimeFactor=i.vanishingTimeFactor,r.onSubrayCreation(t,i,o,r),r.randomGenerator.setSeed(u)}};let t=new I.Vector3,r=new I.Vector3,i=new I.Vector3,n=new I.Vector3;this.onSubrayCreation=function(e,t,r,i){i.subrayCylinderPosition(e,t,r,.5,.6,.2)},this.subrayConePosition=function(a,s,o,l,c,u){o.pos0.copy(a.pos0),t.subVectors(s.pos1,s.pos0),r.copy(t).normalize(),t.multiplyScalar(a.fraction0+(1-a.fraction0)*(e()*l));let h=t.length();i.crossVectors(s.up0,r);let d=2*Math.PI*e();i.multiplyScalar(Math.cos(d)),n.copy(s.up0).multiplyScalar(Math.sin(d)),o.pos1.copy(i).add(n).multiplyScalar(h*c*(u+e()*(1-u))).add(t).add(s.pos0)},this.subrayCylinderPosition=function(a,s,o,l,c,u){o.pos0.copy(a.pos0),t.subVectors(s.pos1,s.pos0),r.copy(t).normalize(),t.multiplyScalar(a.fraction0+(1-a.fraction0)*((2*e()-1)*l));let h=t.length();i.crossVectors(s.up0,r);let d=2*Math.PI*e();i.multiplyScalar(Math.cos(d)),n.copy(s.up0).multiplyScalar(Math.sin(d)),o.pos1.copy(i).add(n).multiplyScalar(h*c*(u+e()*(1-u))).add(t).add(s.pos0)}}createSubray(){return{seed:0,maxIterations:0,recursion:0,pos0:new I.Vector3,pos1:new I.Vector3,linPos0:new I.Vector3,linPos1:new I.Vector3,up0:new I.Vector3,up1:new I.Vector3,radius0:0,radius1:0,birthTime:0,deathTime:0,timeScale:0,roughness:0,straightness:0,propagationTimeFactor:0,vanishingTimeFactor:0,endPropagationTime:0,beginVanishingTime:0}}createSegment(){return{iteration:0,pos0:new I.Vector3,pos1:new I.Vector3,linPos0:new I.Vector3,linPos1:new I.Vector3,up0:new I.Vector3,up1:new I.Vector3,radius0:0,radius1:0,fraction0:0,fraction1:0,positionVariationFactor:0}}getNewSegment(){return this.raySegments[this.currentSegmentIndex++]}copy(e){return super.copy(e),this.init(ep.copyParameters({},e.rayParameters)),this}clone(){return new this.constructor(ep.copyParameters({},this.rayParameters))}constructor(e={}){super(),this.isLightningStrike=!0,this.type="LightningStrike",this.init(ep.copyParameters(e,e)),this.createMesh()}};D(ep,"RAY_INITIALIZED",0),D(ep,"RAY_UNBORN",1),D(ep,"RAY_PROPAGATING",2),D(ep,"RAY_STEADY",3),D(ep,"RAY_VANISHING",4),D(ep,"RAY_EXTINGUISHED",5),D(ep,"COS30DEG",Math.cos(30*Math.PI/180)),D(ep,"SIN30DEG",Math.sin(30*Math.PI/180));let em=class extends I.Mesh{constructor(e,t={}){let r;super(e),this.isReflectorForSSRPass=!0,this.type="ReflectorForSSRPass";let i=this,n=new I.Color(void 0!==t.color?t.color:8355711),a=t.textureWidth||512,s=t.textureHeight||512,o=t.clipBias||0,l=t.shader||em.ReflectorShader,c=!0===t.useDepthTexture,u=new I.Vector3(0,1,0),h=new I.Vector3,d=new I.Vector3;i.needsUpdate=!1,i.maxDistance=em.ReflectorShader.uniforms.maxDistance.value,i.opacity=em.ReflectorShader.uniforms.opacity.value,i.color=n,i.resolution=t.resolution||new I.Vector2(window.innerWidth,window.innerHeight),i._distanceAttenuation=em.ReflectorShader.defines.DISTANCE_ATTENUATION,Object.defineProperty(i,"distanceAttenuation",{get:()=>i._distanceAttenuation,set(e){i._distanceAttenuation!==e&&(i._distanceAttenuation=e,i.material.defines.DISTANCE_ATTENUATION=e,i.material.needsUpdate=!0)}}),i._fresnel=em.ReflectorShader.defines.FRESNEL,Object.defineProperty(i,"fresnel",{get:()=>i._fresnel,set(e){i._fresnel!==e&&(i._fresnel=e,i.material.defines.FRESNEL=e,i.material.needsUpdate=!0)}});let f=new I.Vector3,p=new I.Vector3,m=new I.Vector3,A=new I.Matrix4,g=new I.Vector3(0,0,-1),v=new I.Vector3,T=new I.Vector3,C=new I.Matrix4,y=new I.PerspectiveCamera;c&&((r=new I.DepthTexture).type=I.UnsignedShortType,r.minFilter=I.NearestFilter,r.magFilter=I.NearestFilter);let E={depthTexture:c?r:null,type:I.HalfFloatType},B=new I.WebGLRenderTarget(a,s,E),R=new I.ShaderMaterial({transparent:c,defines:Object.assign({},em.ReflectorShader.defines,{useDepthTexture:c}),uniforms:I.UniformsUtils.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});R.uniforms.tDiffuse.value=B.texture,R.uniforms.color.value=i.color,R.uniforms.textureMatrix.value=C,c&&(R.uniforms.tDepth.value=B.depthTexture),this.material=R;let x=[new I.Plane(new I.Vector3(0,1,0),o)];this.doRender=function(e,t,r){if(R.uniforms.maxDistance.value=i.maxDistance,R.uniforms.color.value=i.color,R.uniforms.opacity.value=i.opacity,h.copy(r.position).normalize(),d.copy(h).reflect(u),R.uniforms.fresnelCoe.value=(h.dot(d)+1)/2,p.setFromMatrixPosition(i.matrixWorld),m.setFromMatrixPosition(r.matrixWorld),A.extractRotation(i.matrixWorld),f.set(0,0,1),f.applyMatrix4(A),v.subVectors(p,m),v.dot(f)>0)return;v.reflect(f).negate(),v.add(p),A.extractRotation(r.matrixWorld),g.set(0,0,-1),g.applyMatrix4(A),g.add(m),T.subVectors(p,g),T.reflect(f).negate(),T.add(p),y.position.copy(v),y.up.set(0,1,0),y.up.applyMatrix4(A),y.up.reflect(f),y.lookAt(T),y.far=r.far,y.updateMatrixWorld(),y.projectionMatrix.copy(r.projectionMatrix),R.uniforms.virtualCameraNear.value=r.near,R.uniforms.virtualCameraFar.value=r.far,R.uniforms.virtualCameraMatrixWorld.value=y.matrixWorld,R.uniforms.virtualCameraProjectionMatrix.value=r.projectionMatrix,R.uniforms.virtualCameraProjectionMatrixInverse.value=r.projectionMatrixInverse,R.uniforms.resolution.value=i.resolution,C.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),C.multiply(y.projectionMatrix),C.multiply(y.matrixWorldInverse),C.multiply(i.matrixWorld);let n=e.getRenderTarget(),a=e.xr.enabled,s=e.shadowMap.autoUpdate,o=e.clippingPlanes;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.clippingPlanes=x,e.setRenderTarget(B),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,y),e.xr.enabled=a,e.shadowMap.autoUpdate=s,e.clippingPlanes=o,e.setRenderTarget(n);let l=r.viewport;void 0!==l&&e.state.viewport(l)},this.getRenderTarget=function(){return B}}};D(em,"ReflectorShader",{defines:{DISTANCE_ATTENUATION:!0,FRESNEL:!0},uniforms:{color:{value:null},tDiffuse:{value:null},tDepth:{value:null},textureMatrix:{value:new I.Matrix4},maxDistance:{value:180},opacity:{value:.5},fresnelCoe:{value:null},virtualCameraNear:{value:null},virtualCameraFar:{value:null},virtualCameraProjectionMatrix:{value:new I.Matrix4},virtualCameraMatrixWorld:{value:new I.Matrix4},virtualCameraProjectionMatrixInverse:{value:new I.Matrix4},resolution:{value:new I.Vector2}},vertexShader:"\n		uniform mat4 textureMatrix;\n		varying vec4 vUv;\n\n		void main() {\n\n			vUv = textureMatrix * vec4( position, 1.0 );\n\n			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n		}",fragmentShader:"\n		uniform vec3 color;\n		uniform sampler2D tDiffuse;\n		uniform sampler2D tDepth;\n		uniform float maxDistance;\n		uniform float opacity;\n		uniform float fresnelCoe;\n		uniform float virtualCameraNear;\n		uniform float virtualCameraFar;\n		uniform mat4 virtualCameraProjectionMatrix;\n		uniform mat4 virtualCameraProjectionMatrixInverse;\n		uniform mat4 virtualCameraMatrixWorld;\n		uniform vec2 resolution;\n		varying vec4 vUv;\n		#include <packing>\n		float blendOverlay( float base, float blend ) {\n			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n		}\n		vec3 blendOverlay( vec3 base, vec3 blend ) {\n			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n		}\n		float getDepth( const in vec2 uv ) {\n			return texture2D( tDepth, uv ).x;\n		}\n		float getViewZ( const in float depth ) {\n			return perspectiveDepthToViewZ( depth, virtualCameraNear, virtualCameraFar );\n		}\n		vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {\n			vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc\n			clipPosition *= clipW; //clip\n			return ( virtualCameraProjectionMatrixInverse * clipPosition ).xyz;//view\n		}\n		void main() {\n			vec4 base = texture2DProj( tDiffuse, vUv );\n			#ifdef useDepthTexture\n				vec2 uv=(gl_FragCoord.xy-.5)/resolution.xy;\n				uv.x=1.-uv.x;\n				float depth = texture2DProj( tDepth, vUv ).r;\n				float viewZ = getViewZ( depth );\n				float clipW = virtualCameraProjectionMatrix[2][3] * viewZ+virtualCameraProjectionMatrix[3][3];\n				vec3 viewPosition=getViewPosition( uv, depth, clipW );\n				vec3 worldPosition=(virtualCameraMatrixWorld*vec4(viewPosition,1)).xyz;\n				if(worldPosition.y>maxDistance) discard;\n				float op=opacity;\n				#ifdef DISTANCE_ATTENUATION\n					float ratio=1.-(worldPosition.y/maxDistance);\n					float attenuation=ratio*ratio;\n					op=opacity*attenuation;\n				#endif\n				#ifdef FRESNEL\n					op*=fresnelCoe;\n				#endif\n				gl_FragColor = vec4( blendOverlay( base.rgb, color ), op );\n			#else\n				gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n			#endif\n		}\n	"});let eA={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new I.Vector3},up:{value:new I.Vector3(0,1,0)}},vertexShader:"\n      uniform vec3 sunPosition;\n      uniform float rayleigh;\n      uniform float turbidity;\n      uniform float mieCoefficient;\n      uniform vec3 up;\n\n      varying vec3 vWorldPosition;\n      varying vec3 vSunDirection;\n      varying float vSunfade;\n      varying vec3 vBetaR;\n      varying vec3 vBetaM;\n      varying float vSunE;\n\n      // constants for atmospheric scattering\n      const float e = 2.71828182845904523536028747135266249775724709369995957;\n      const float pi = 3.141592653589793238462643383279502884197169;\n\n      // wavelength of used primaries, according to preetham\n      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\n      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\n      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\n      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\n\n      // mie stuff\n      // K coefficient for the primaries\n      const float v = 4.0;\n      const vec3 K = vec3( 0.686, 0.678, 0.666 );\n      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\n      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\n\n      // earth shadow hack\n      // cutoffAngle = pi / 1.95;\n      const float cutoffAngle = 1.6110731556870734;\n      const float steepness = 1.5;\n      const float EE = 1000.0;\n\n      float sunIntensity( float zenithAngleCos ) {\n        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\n        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\n      }\n\n      vec3 totalMie( float T ) {\n        float c = ( 0.2 * T ) * 10E-18;\n        return 0.434 * c * MieConst;\n      }\n\n      void main() {\n\n        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n        vWorldPosition = worldPosition.xyz;\n\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        gl_Position.z = gl_Position.w; // set z to camera.far\n\n        vSunDirection = normalize( sunPosition );\n\n        vSunE = sunIntensity( dot( vSunDirection, up ) );\n\n        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );\n\n        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\n\n      // extinction (absorbtion + out scattering)\n      // rayleigh coefficients\n        vBetaR = totalRayleigh * rayleighCoefficient;\n\n      // mie coefficients\n        vBetaM = totalMie( turbidity ) * mieCoefficient;\n\n      }\n    ",fragmentShader:"\n      varying vec3 vWorldPosition;\n      varying vec3 vSunDirection;\n      varying float vSunfade;\n      varying vec3 vBetaR;\n      varying vec3 vBetaM;\n      varying float vSunE;\n\n      uniform float mieDirectionalG;\n      uniform vec3 up;\n\n      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );\n\n      // constants for atmospheric scattering\n      const float pi = 3.141592653589793238462643383279502884197169;\n\n      const float n = 1.0003; // refractive index of air\n      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)\n\n      // optical length at zenith for molecules\n      const float rayleighZenithLength = 8.4E3;\n      const float mieZenithLength = 1.25E3;\n      // 66 arc seconds -> degrees, and the cosine of that\n      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\n\n      // 3.0 / ( 16.0 * pi )\n      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;\n      // 1.0 / ( 4.0 * pi )\n      const float ONE_OVER_FOURPI = 0.07957747154594767;\n\n      float rayleighPhase( float cosTheta ) {\n        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\n      }\n\n      float hgPhase( float cosTheta, float g ) {\n        float g2 = pow( g, 2.0 );\n        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\n        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\n      }\n\n      void main() {\n\n        vec3 direction = normalize( vWorldPosition - cameraPos );\n\n      // optical length\n      // cutoff angle at 90 to avoid singularity in next formula.\n        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );\n        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\n        float sR = rayleighZenithLength * inverse;\n        float sM = mieZenithLength * inverse;\n\n      // combined extinction factor\n        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\n\n      // in scattering\n        float cosTheta = dot( direction, vSunDirection );\n\n        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\n        vec3 betaRTheta = vBetaR * rPhase;\n\n        float mPhase = hgPhase( cosTheta, mieDirectionalG );\n        vec3 betaMTheta = vBetaM * mPhase;\n\n        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\n        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\n\n      // nightsky\n        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]\n        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]\n        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\n        vec3 L0 = vec3( 0.1 ) * Fex;\n\n      // composition + solar disc\n        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\n        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;\n\n        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\n\n        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\n\n        gl_FragColor = vec4( retColor, 1.0 );\n\n      #include <tonemapping_fragment>\n      #include <".concat(parseInt(I.REVISION.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment",">\n\n      }\n    ")},eg=new I.ShaderMaterial({name:"SkyShader",fragmentShader:eA.fragmentShader,vertexShader:eA.vertexShader,uniforms:I.UniformsUtils.clone(eA.uniforms),side:I.BackSide,depthWrite:!1});class ev extends I.Mesh{constructor(){super(new I.BoxGeometry(1,1,1),eg)}}D(ev,"SkyShader",eA),D(ev,"material",eg);let eT=class extends I.Mesh{constructor(e,t={}){super(e),this.isWater=!0,this.type="Water";let r=this,i=new I.Color(void 0!==t.color?t.color:16777215),n=t.textureWidth||512,a=t.textureHeight||512,s=t.clipBias||0,o=t.flowDirection||new I.Vector2(1,0),l=t.flowSpeed||.03,c=t.reflectivity||.02,u=t.scale||1,h=t.shader||eT.WaterShader,d=void 0!==t.encoding?t.encoding:3e3,f=t.flowMap||void 0,p=t.normalMap0,m=t.normalMap1,A=new I.Matrix4,g=new I.Clock;if(void 0===el){console.error("THREE.Water: Required component Reflector not found.");return}if(void 0===ec){console.error("THREE.Water: Required component Refractor not found.");return}let v=new el(e,{textureWidth:n,textureHeight:a,clipBias:s,encoding:d}),T=new ec(e,{textureWidth:n,textureHeight:a,clipBias:s,encoding:d});v.matrixAutoUpdate=!1,T.matrixAutoUpdate=!1,this.material=new I.ShaderMaterial({uniforms:I.UniformsUtils.merge([I.UniformsLib.fog,h.uniforms]),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,transparent:!0,fog:!0}),void 0!==f?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:f}):this.material.uniforms.flowDirection={type:"v2",value:o},p.wrapS=p.wrapT=I.RepeatWrapping,m.wrapS=m.wrapT=I.RepeatWrapping,this.material.uniforms.tReflectionMap.value=v.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=T.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=p,this.material.uniforms.tNormalMap1.value=m,this.material.uniforms.color.value=i,this.material.uniforms.reflectivity.value=c,this.material.uniforms.textureMatrix.value=A,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=.075,this.material.uniforms.config.value.z=.075,this.material.uniforms.config.value.w=u,this.onBeforeRender=function(e,t,i){A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(i.projectionMatrix),A.multiply(i.matrixWorldInverse),A.multiply(r.matrixWorld),function(){let e=g.getDelta(),t=r.material.uniforms.config;t.value.x+=l*e,t.value.y=t.value.x+.075,t.value.x>=.15?(t.value.x=0,t.value.y=.075):t.value.y>=.15&&(t.value.y=t.value.y-.15)}(),r.visible=!1,v.matrixWorld.copy(r.matrixWorld),T.matrixWorld.copy(r.matrixWorld),v.onBeforeRender(e,t,i),T.onBeforeRender(e,t,i),r.visible=!0}}};D(eT,"WaterShader",{uniforms:{color:{value:null},reflectivity:{value:0},tReflectionMap:{value:null},tRefractionMap:{value:null},tNormalMap0:{value:null},tNormalMap1:{value:null},textureMatrix:{value:null},config:{value:new I.Vector4}},vertexShader:"\n\n		#include <common>\n		#include <fog_pars_vertex>\n		#include <logdepthbuf_pars_vertex>\n\n		uniform mat4 textureMatrix;\n\n		varying vec4 vCoord;\n		varying vec2 vUv;\n		varying vec3 vToEye;\n\n		void main() {\n\n			vUv = uv;\n			vCoord = textureMatrix * vec4( position, 1.0 );\n\n			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n			vToEye = cameraPosition - worldPosition.xyz;\n\n			vec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex\n			gl_Position = projectionMatrix * mvPosition;\n\n			#include <logdepthbuf_vertex>\n			#include <fog_vertex>\n\n		}",fragmentShader:"\n\n		#include <common>\n		#include <fog_pars_fragment>\n		#include <logdepthbuf_pars_fragment>\n\n		uniform sampler2D tReflectionMap;\n		uniform sampler2D tRefractionMap;\n		uniform sampler2D tNormalMap0;\n		uniform sampler2D tNormalMap1;\n\n		#ifdef USE_FLOWMAP\n			uniform sampler2D tFlowMap;\n		#else\n			uniform vec2 flowDirection;\n		#endif\n\n		uniform vec3 color;\n		uniform float reflectivity;\n		uniform vec4 config;\n\n		varying vec4 vCoord;\n		varying vec2 vUv;\n		varying vec3 vToEye;\n\n		void main() {\n\n			#include <logdepthbuf_fragment>\n\n			float flowMapOffset0 = config.x;\n			float flowMapOffset1 = config.y;\n			float halfCycle = config.z;\n			float scale = config.w;\n\n			vec3 toEye = normalize( vToEye );\n\n			// determine flow direction\n			vec2 flow;\n			#ifdef USE_FLOWMAP\n				flow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;\n			#else\n				flow = flowDirection;\n			#endif\n			flow.x *= - 1.0;\n\n			// sample normal maps (distort uvs with flowdata)\n			vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );\n			vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );\n\n			// linear interpolate to get the final normal color\n			float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;\n			vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\n\n			// calculate normal vector\n			vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n\n			// calculate the fresnel term to blend reflection and refraction maps\n			float theta = max( dot( toEye, normal ), 0.0 );\n			float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );\n\n			// calculate final uv coords\n			vec3 coord = vCoord.xyz / vCoord.w;\n			vec2 uv = coord.xy + coord.z * normal.xz * 0.05;\n\n			vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );\n			vec4 refractColor = texture2D( tRefractionMap, uv );\n\n			// multiply water color with the mix of both textures\n			gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );\n\n			#include <tonemapping_fragment>\n			#include <".concat(parseInt(I.REVISION.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment",">\n			#include <fog_fragment>\n\n		}")});let eC={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\n#include <packing>\nvoid main() {\n	float depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );\n	gl_FragColor = vec4( vec3( depth ), opacity );\n}"},ey={c:null,u:[new I.Vector3,new I.Vector3,new I.Vector3],e:[]},eE={c:null,u:[new I.Vector3,new I.Vector3,new I.Vector3],e:[]},eB=[[],[],[]],eR=[[],[],[]],ex=[],eM=new I.Vector3,eS=new I.Vector3,eb=new I.Vector3,eI=new I.Vector3,ew=new I.Vector3,e_=new I.Vector3,eF=new I.Matrix3,eP=new I.Box3,eD=new I.Matrix4,eN=new I.Matrix4,eO=new I.Ray;class eL{set(e,t,r){return this.center=e,this.halfSize=t,this.rotation=r,this}copy(e){return this.center.copy(e.center),this.halfSize.copy(e.halfSize),this.rotation.copy(e.rotation),this}clone(){return new this.constructor().copy(this)}getSize(e){return e.copy(this.halfSize).multiplyScalar(2)}clampPoint(e,t){let r=this.halfSize;eI.subVectors(e,this.center),this.rotation.extractBasis(eM,eS,eb),t.copy(this.center);let i=I.MathUtils.clamp(eI.dot(eM),-r.x,r.x);t.add(eM.multiplyScalar(i));let n=I.MathUtils.clamp(eI.dot(eS),-r.y,r.y);t.add(eS.multiplyScalar(n));let a=I.MathUtils.clamp(eI.dot(eb),-r.z,r.z);return t.add(eb.multiplyScalar(a)),t}containsPoint(e){return eI.subVectors(e,this.center),this.rotation.extractBasis(eM,eS,eb),Math.abs(eI.dot(eM))<=this.halfSize.x&&Math.abs(eI.dot(eS))<=this.halfSize.y&&Math.abs(eI.dot(eb))<=this.halfSize.z}intersectsBox3(e){return this.intersectsOBB(eU.fromBox3(e))}intersectsSphere(e){return this.clampPoint(e.center,e_),e_.distanceToSquared(e.center)<=e.radius*e.radius}intersectsOBB(e){let t,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.EPSILON;ey.c=this.center,ey.e[0]=this.halfSize.x,ey.e[1]=this.halfSize.y,ey.e[2]=this.halfSize.z,this.rotation.extractBasis(ey.u[0],ey.u[1],ey.u[2]),eE.c=e.center,eE.e[0]=e.halfSize.x,eE.e[1]=e.halfSize.y,eE.e[2]=e.halfSize.z,e.rotation.extractBasis(eE.u[0],eE.u[1],eE.u[2]);for(let e=0;e<3;e++)for(let t=0;t<3;t++)eB[e][t]=ey.u[e].dot(eE.u[t]);eI.subVectors(eE.c,ey.c),ex[0]=eI.dot(ey.u[0]),ex[1]=eI.dot(ey.u[1]),ex[2]=eI.dot(ey.u[2]);for(let e=0;e<3;e++)for(let t=0;t<3;t++)eR[e][t]=Math.abs(eB[e][t])+i;for(let e=0;e<3;e++)if(t=ey.e[e],r=eE.e[0]*eR[e][0]+eE.e[1]*eR[e][1]+eE.e[2]*eR[e][2],Math.abs(ex[e])>t+r)return!1;for(let e=0;e<3;e++)if(t=ey.e[0]*eR[0][e]+ey.e[1]*eR[1][e]+ey.e[2]*eR[2][e],r=eE.e[e],Math.abs(ex[0]*eB[0][e]+ex[1]*eB[1][e]+ex[2]*eB[2][e])>t+r)return!1;return t=ey.e[1]*eR[2][0]+ey.e[2]*eR[1][0],r=eE.e[1]*eR[0][2]+eE.e[2]*eR[0][1],!(Math.abs(ex[2]*eB[1][0]-ex[1]*eB[2][0])>t+r)&&(t=ey.e[1]*eR[2][1]+ey.e[2]*eR[1][1],r=eE.e[0]*eR[0][2]+eE.e[2]*eR[0][0],!(Math.abs(ex[2]*eB[1][1]-ex[1]*eB[2][1])>t+r)&&(t=ey.e[1]*eR[2][2]+ey.e[2]*eR[1][2],r=eE.e[0]*eR[0][1]+eE.e[1]*eR[0][0],!(Math.abs(ex[2]*eB[1][2]-ex[1]*eB[2][2])>t+r)&&(t=ey.e[0]*eR[2][0]+ey.e[2]*eR[0][0],r=eE.e[1]*eR[1][2]+eE.e[2]*eR[1][1],!(Math.abs(ex[0]*eB[2][0]-ex[2]*eB[0][0])>t+r)&&(t=ey.e[0]*eR[2][1]+ey.e[2]*eR[0][1],r=eE.e[0]*eR[1][2]+eE.e[2]*eR[1][0],!(Math.abs(ex[0]*eB[2][1]-ex[2]*eB[0][1])>t+r)&&(t=ey.e[0]*eR[2][2]+ey.e[2]*eR[0][2],r=eE.e[0]*eR[1][1]+eE.e[1]*eR[1][0],!(Math.abs(ex[0]*eB[2][2]-ex[2]*eB[0][2])>t+r)&&(t=ey.e[0]*eR[1][0]+ey.e[1]*eR[0][0],r=eE.e[1]*eR[2][2]+eE.e[2]*eR[2][1],!(Math.abs(ex[1]*eB[0][0]-ex[0]*eB[1][0])>t+r)&&(t=ey.e[0]*eR[1][1]+ey.e[1]*eR[0][1],r=eE.e[0]*eR[2][2]+eE.e[2]*eR[2][0],!(Math.abs(ex[1]*eB[0][1]-ex[0]*eB[1][1])>t+r)&&(t=ey.e[0]*eR[1][2]+ey.e[1]*eR[0][2],r=eE.e[0]*eR[2][1]+eE.e[1]*eR[2][0],!(Math.abs(ex[1]*eB[0][2]-ex[0]*eB[1][2])>t+r)))))))))}intersectsPlane(e){this.rotation.extractBasis(eM,eS,eb);let t=this.halfSize.x*Math.abs(e.normal.dot(eM))+this.halfSize.y*Math.abs(e.normal.dot(eS))+this.halfSize.z*Math.abs(e.normal.dot(eb));return Math.abs(e.normal.dot(this.center)-e.constant)<=t}intersectRay(e,t){return(this.getSize(ew),eP.setFromCenterAndSize(eI.set(0,0,0),ew),eD.setFromMatrix3(this.rotation),eD.setPosition(this.center),eN.copy(eD).invert(),eO.copy(e).applyMatrix4(eN),eO.intersectBox(eP,t))?t.applyMatrix4(eD):null}intersectsRay(e){return null!==this.intersectRay(e,eI)}fromBox3(e){return e.getCenter(this.center),e.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this}equals(e){return e.center.equals(this.center)&&e.halfSize.equals(this.halfSize)&&e.rotation.equals(this.rotation)}applyMatrix4(e){let t=e.elements,r=eI.set(t[0],t[1],t[2]).length(),i=eI.set(t[4],t[5],t[6]).length(),n=eI.set(t[8],t[9],t[10]).length();0>e.determinant()&&(r=-r),eF.setFromMatrix4(e);let a=1/r,s=1/i,o=1/n;return eF.elements[0]*=a,eF.elements[1]*=a,eF.elements[2]*=a,eF.elements[3]*=s,eF.elements[4]*=s,eF.elements[5]*=s,eF.elements[6]*=o,eF.elements[7]*=o,eF.elements[8]*=o,this.rotation.multiply(eF),this.halfSize.x*=r,this.halfSize.y*=i,this.halfSize.z*=n,eI.setFromMatrixPosition(e),this.center.add(eI),this}constructor(e=new I.Vector3,t=new I.Vector3,r=new I.Matrix3){this.center=e,this.halfSize=t,this.rotation=r}}let eU=new eL,ek=new I.Vector3,eG=new I.Vector3,eH=new I.Vector3;class eV{clone(){return new eV(this.start.clone(),this.end.clone(),this.radius)}set(e,t,r){this.start.copy(e),this.end.copy(t),this.radius=r}copy(e){this.start.copy(e.start),this.end.copy(e.end),this.radius=e.radius}getCenter(e){return e.copy(this.end).add(this.start).multiplyScalar(.5)}translate(e){this.start.add(e),this.end.add(e)}checkAABBAxis(e,t,r,i,n,a,s,o,l){return(n-e<l||n-r<l)&&(e-a<l||r-a<l)&&(s-t<l||s-i<l)&&(t-o<l||i-o<l)}intersectsBox(e){return this.checkAABBAxis(this.start.x,this.start.y,this.end.x,this.end.y,e.min.x,e.max.x,e.min.y,e.max.y,this.radius)&&this.checkAABBAxis(this.start.x,this.start.z,this.end.x,this.end.z,e.min.x,e.max.x,e.min.z,e.max.z,this.radius)&&this.checkAABBAxis(this.start.y,this.start.z,this.end.y,this.end.z,e.min.y,e.max.y,e.min.z,e.max.z,this.radius)}lineLineMinimumPoints(e,t){let r,i;let n=ek.copy(e.end).sub(e.start),a=eG.copy(t.end).sub(t.start),s=eH.copy(t.start).sub(e.start),o=n.dot(a),l=n.dot(n),c=a.dot(a),u=a.dot(s),h=n.dot(s),d=l*c-o*o;if(1e-10>Math.abs(d)){let e=-u/c,t=(o-u)/c;Math.abs(e-.5)<Math.abs(t-.5)?(r=0,i=e):(r=1,i=t)}else i=((r=(u*o+h*c)/d)*o-u)/c;return i=Math.max(0,Math.min(1,i)),r=Math.max(0,Math.min(1,r)),[n.multiplyScalar(r).add(e.start),a.multiplyScalar(i).add(t.start)]}constructor(e=new I.Vector3(0,0,0),t=new I.Vector3(0,1,0),r=1){this.start=e,this.end=t,this.radius=r}}var eJ=((c=eJ||{})[c.NONE=-1]="NONE",c[c.ROTATE=0]="ROTATE",c[c.DOLLY=1]="DOLLY",c[c.PAN=2]="PAN",c[c.TOUCH_ROTATE=3]="TOUCH_ROTATE",c[c.TOUCH_PAN=4]="TOUCH_PAN",c[c.TOUCH_DOLLY_PAN=5]="TOUCH_DOLLY_PAN",c[c.TOUCH_DOLLY_ROTATE=6]="TOUCH_DOLLY_ROTATE",c);Symbol(),Symbol(),Symbol(),Symbol(),Symbol(),Symbol(),Symbol(),Symbol(),Symbol(),Symbol(),Symbol(),Symbol(),Symbol(),Symbol(),Symbol(),Symbol();class eK{setSize(e,t){}render(e,t,r,i,n){console.error("THREE.Pass: .render() must be implemented in derived pass.")}constructor(){D(this,"enabled",!0),D(this,"needsSwap",!0),D(this,"clear",!1),D(this,"renderToScreen",!1)}}class ej{get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}constructor(e){D(this,"camera",new I.OrthographicCamera(-1,1,1,-1,0,1)),D(this,"geometry",new I.PlaneGeometry(2,2)),D(this,"mesh"),this.mesh=new I.Mesh(this.geometry,e)}}let eW={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texel = texture2D( tDiffuse, vUv );\n	gl_FragColor = opacity * texel;\n}"},ez={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new I.Vector2},cameraProjectionMatrix:{value:new I.Matrix4},cameraInverseProjectionMatrix:{value:new I.Matrix4},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tDepth;\nuniform sampler2D tNoise;\nuniform vec3 kernel[ KERNEL_SIZE ];\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform mat4 cameraProjectionMatrix;\nuniform mat4 cameraInverseProjectionMatrix;\nuniform float kernelRadius;\nuniform float minDistance;\nuniform float maxDistance;\nvarying vec2 vUv;\n#include <packing>\nfloat getDepth( const in vec2 screenPosition ) {\n	return texture2D( tDepth, screenPosition ).x;\n}\nfloat getLinearDepth( const in vec2 screenPosition ) {\n	#if PERSPECTIVE_CAMERA == 1\n		float fragCoordZ = texture2D( tDepth, screenPosition ).x;\n		float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n		return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n	#else\n		return texture2D( tDepth, screenPosition ).x;\n	#endif\n}\nfloat getViewZ( const in float depth ) {\n	#if PERSPECTIVE_CAMERA == 1\n		return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n	#else\n		return orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n	#endif\n}\nvec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {\n	float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n	vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );\n	clipPosition *= clipW; // unprojection.\n	return ( cameraInverseProjectionMatrix * clipPosition ).xyz;\n}\nvec3 getViewNormal( const in vec2 screenPosition ) {\n	return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );\n}\nvoid main() {\n	float depth = getDepth( vUv );\n	float viewZ = getViewZ( depth );\n	vec3 viewPosition = getViewPosition( vUv, depth, viewZ );\n	vec3 viewNormal = getViewNormal( vUv );\n vec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );\n	vec3 random = texture2D( tNoise, vUv * noiseScale ).xyz;\n	vec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );\n	vec3 bitangent = cross( viewNormal, tangent );\n	mat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );\n float occlusion = 0.0;\n for ( int i = 0; i < KERNEL_SIZE; i ++ ) {\n		vec3 sampleVector = kernelMatrix * kernel[ i ];\n		vec3 samplePoint = viewPosition + ( sampleVector * kernelRadius );\n		vec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 );\n		samplePointNDC /= samplePointNDC.w;\n		vec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5;\n		float realDepth = getLinearDepth( samplePointUv );\n		float sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar );\n		float delta = sampleDepth - realDepth;\n		if ( delta > minDistance && delta < maxDistance ) {\n			occlusion += 1.0;\n		}\n	}\n	occlusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );\n	gl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );\n}"},eQ={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDepth;\nuniform float cameraNear;\nuniform float cameraFar;\nvarying vec2 vUv;\n#include <packing>\nfloat getLinearDepth( const in vec2 screenPosition ) {\n	#if PERSPECTIVE_CAMERA == 1\n		float fragCoordZ = texture2D( tDepth, screenPosition ).x;\n		float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n		return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n	#else\n		return texture2D( tDepth, screenPosition ).x;\n	#endif\n}\nvoid main() {\n	float depth = getLinearDepth( vUv );\n	gl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );\n}"},eX={uniforms:{tDiffuse:{value:null},resolution:{value:new I.Vector2}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvarying vec2 vUv;\nvoid main() {\n	vec2 texelSize = ( 1.0 / resolution );\n	float result = 0.0;\n	for ( int i = - 2; i <= 2; i ++ ) {\n		for ( int j = - 2; j <= 2; j ++ ) {\n			vec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;\n			result += texture2D( tDiffuse, vUv + offset ).r;\n		}\n	}\n	gl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );\n}"},eY=class extends eK{dispose(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(e,t){switch(!1===e.capabilities.isWebGL2&&(this.noiseTexture.format=I.LuminanceFormat),e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.overrideVisibility(),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility(),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(e,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.output){case eY.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=I.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case eY.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=I.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case eY.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=I.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case eY.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case eY.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=I.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case eY.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=I.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=I.CustomBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.SSAOPass: Unknown output type.")}}renderPass(e,t,r,i,n){e.getClearColor(this.originalClearColor);let a=e.getClearAlpha(),s=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,null!=i&&(e.setClearColor(i),e.setClearAlpha(n||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=s,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}renderOverride(e,t,r,i,n){e.getClearColor(this.originalClearColor);let a=e.getClearAlpha(),s=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,i=t.clearColor||i,n=t.clearAlpha||n,null!=i&&(e.setClearColor(i),e.setClearAlpha(n||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=s,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}setSize(e,t){this.width=e,this.height=t,this.beautyRenderTarget.setSize(e,t),this.ssaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.ssaoMaterial.uniforms.resolution.value.set(e,t),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(e,t)}generateSampleKernel(){let e=this.kernelSize,t=this.kernel;for(let r=0;r<e;r++){let i=new I.Vector3;i.x=2*Math.random()-1,i.y=2*Math.random()-1,i.z=Math.random(),i.normalize();let n=r/e;n=I.MathUtils.lerp(.1,1,n*n),i.multiplyScalar(n),t.push(i)}}generateRandomKernelRotations(){void 0===ef&&console.error("THREE.SSAOPass: The pass relies on SimplexNoise.");let e=new ef,t=new Float32Array(16);for(let r=0;r<16;r++){let i=2*Math.random()-1,n=2*Math.random()-1;t[r]=e.noise3d(i,n,0)}this.noiseTexture=new I.DataTexture(t,4,4,I.RedFormat,I.FloatType),this.noiseTexture.wrapS=I.RepeatWrapping,this.noiseTexture.wrapT=I.RepeatWrapping,this.noiseTexture.needsUpdate=!0}overrideVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){t.set(e,e.visible),(e.isPoints||e.isLine)&&(e.visible=!1)})}restoreVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){let r=t.get(e);e.visible=r}),t.clear()}constructor(e,t,r,i){super(),this.width=void 0!==r?r:512,this.height=void 0!==i?i:512,this.clear=!0,this.camera=t,this.scene=e,this.kernelRadius=8,this.kernelSize=32,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this._visibilityCache=new Map,this.generateSampleKernel(),this.generateRandomKernelRotations();let n=new I.DepthTexture;n.format=I.DepthStencilFormat,n.type=I.UnsignedInt248Type,this.beautyRenderTarget=new I.WebGLRenderTarget(this.width,this.height),this.normalRenderTarget=new I.WebGLRenderTarget(this.width,this.height,{minFilter:I.NearestFilter,magFilter:I.NearestFilter,depthTexture:n}),this.ssaoRenderTarget=new I.WebGLRenderTarget(this.width,this.height),this.blurRenderTarget=this.ssaoRenderTarget.clone(),void 0===ez&&console.error("THREE.SSAOPass: The pass relies on SSAOShader."),this.ssaoMaterial=new I.ShaderMaterial({defines:Object.assign({},ez.defines),uniforms:I.UniformsUtils.clone(ez.uniforms),vertexShader:ez.vertexShader,fragmentShader:ez.fragmentShader,blending:I.NoBlending}),this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new I.MeshNormalMaterial,this.normalMaterial.blending=I.NoBlending,this.blurMaterial=new I.ShaderMaterial({defines:Object.assign({},eX.defines),uniforms:I.UniformsUtils.clone(eX.uniforms),vertexShader:eX.vertexShader,fragmentShader:eX.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new I.ShaderMaterial({defines:Object.assign({},eQ.defines),uniforms:I.UniformsUtils.clone(eQ.uniforms),vertexShader:eQ.vertexShader,fragmentShader:eQ.fragmentShader,blending:I.NoBlending}),this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new I.ShaderMaterial({uniforms:I.UniformsUtils.clone(eW.uniforms),vertexShader:eW.vertexShader,fragmentShader:eW.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:I.DstColorFactor,blendDst:I.ZeroFactor,blendEquation:I.AddEquation,blendSrcAlpha:I.DstAlphaFactor,blendDstAlpha:I.ZeroFactor,blendEquationAlpha:I.AddEquation}),this.fsQuad=new ej(null),this.originalClearColor=new I.Color}};D(eY,"OUTPUT",{Default:0,SSAO:1,Blur:2,Beauty:3,Depth:4,Normal:5});let eZ={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new I.Color(0)},defaultOpacity:{value:0}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec3 defaultColor;\nuniform float defaultOpacity;\nuniform float luminosityThreshold;\nuniform float smoothWidth;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texel = texture2D( tDiffuse, vUv );\n	vec3 luma = vec3( 0.299, 0.587, 0.114 );\n	float v = dot( texel.xyz, luma );\n	vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n	float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n	gl_FragColor = mix( outputColor, texel, alpha );\n}"},eq=class extends eK{dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.materialCopy.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,t){let r=Math.round(e/2),i=Math.round(t/2);this.renderTargetBright.setSize(r,i);for(let e=0;e<this.nMips;e++)this.renderTargetsHorizontal[e].setSize(r,i),this.renderTargetsVertical[e].setSize(r,i),this.separableBlurMaterials[e].uniforms.texSize.value=new I.Vector2(r,i),r=Math.round(r/2),i=Math.round(i/2)}render(e,t,r,i,n){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();let a=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),n&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let s=this.renderTargetBright;for(let t=0;t<this.nMips;t++)this.fsQuad.material=this.separableBlurMaterials[t],this.separableBlurMaterials[t].uniforms.colorTexture.value=s.texture,this.separableBlurMaterials[t].uniforms.direction.value=eq.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[t]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[t].uniforms.colorTexture.value=this.renderTargetsHorizontal[t].texture,this.separableBlurMaterials[t].uniforms.direction.value=eq.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[t]),e.clear(),this.fsQuad.render(e),s=this.renderTargetsVertical[t];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,n&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?e.setRenderTarget(null):e.setRenderTarget(r),this.fsQuad.render(e),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=a}getSeperableBlurMaterial(e){return new I.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new I.Vector2(.5,.5)},direction:{value:new I.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n				void main() {\n					vUv = uv;\n					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n				}",fragmentShader:"#include <common>\n				varying vec2 vUv;\n				uniform sampler2D colorTexture;\n				uniform vec2 texSize;\n				uniform vec2 direction;\n\n				float gaussianPdf(in float x, in float sigma) {\n					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n				}\n				void main() {\n					vec2 invSize = 1.0 / texSize;\n					float fSigma = float(SIGMA);\n					float weightSum = gaussianPdf(0.0, fSigma);\n					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n						float x = float(i);\n						float w = gaussianPdf(x, fSigma);\n						vec2 uvOffset = direction * invSize * x;\n						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n						diffuseSum += (sample1 + sample2) * w;\n						weightSum += 2.0 * w;\n					}\n					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n				}"})}getCompositeMaterial(e){return new I.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n				void main() {\n					vUv = uv;\n					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n				}",fragmentShader:"varying vec2 vUv;\n				uniform sampler2D blurTexture1;\n				uniform sampler2D blurTexture2;\n				uniform sampler2D blurTexture3;\n				uniform sampler2D blurTexture4;\n				uniform sampler2D blurTexture5;\n				uniform float bloomStrength;\n				uniform float bloomRadius;\n				uniform float bloomFactors[NUM_MIPS];\n				uniform vec3 bloomTintColors[NUM_MIPS];\n\n				float lerpBloomFactor(const in float factor) {\n					float mirrorFactor = 1.2 - factor;\n					return mix(factor, mirrorFactor, bloomRadius);\n				}\n\n				void main() {\n					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n				}"})}constructor(e,t,r,i){super(),this.strength=void 0!==t?t:1,this.radius=r,this.threshold=i,this.resolution=void 0!==e?new I.Vector2(e.x,e.y):new I.Vector2(256,256),this.clearColor=new I.Color(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let n=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new I.WebGLRenderTarget(n,a,{type:I.HalfFloatType}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let e=0;e<this.nMips;e++){let t=new I.WebGLRenderTarget(n,a,{type:I.HalfFloatType});t.texture.name="UnrealBloomPass.h"+e,t.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(t);let r=new I.WebGLRenderTarget(n,a,{type:I.HalfFloatType});r.texture.name="UnrealBloomPass.v"+e,r.texture.generateMipmaps=!1,this.renderTargetsVertical.push(r),n=Math.round(n/2),a=Math.round(a/2)}this.highPassUniforms=I.UniformsUtils.clone(eZ.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new I.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:eZ.vertexShader,fragmentShader:eZ.fragmentShader,defines:{}}),this.separableBlurMaterials=[];let s=[3,5,7,9,11];n=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);for(let e=0;e<this.nMips;e++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(s[e])),this.separableBlurMaterials[e].uniforms.texSize.value=new I.Vector2(n,a),n=Math.round(n/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new I.Vector3(1,1,1),new I.Vector3(1,1,1),new I.Vector3(1,1,1),new I.Vector3(1,1,1),new I.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,this.copyUniforms=I.UniformsUtils.clone(eW.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new I.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:eW.vertexShader,fragmentShader:eW.fragmentShader,blending:I.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new I.Color,this.oldClearAlpha=1,this.basic=new I.MeshBasicMaterial,this.fsQuad=new ej(null)}};D(eq,"BlurDirectionX",new I.Vector2(1,0)),D(eq,"BlurDirectionY",new I.Vector2(0,1));let e$={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new I.Vector2(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new I.Matrix4},cameraInverseProjectionMatrix:{value:new I.Matrix4},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#include <common>\nvarying vec2 vUv;\n#if DIFFUSE_TEXTURE == 1\nuniform sampler2D tDiffuse;\n#endif\nuniform sampler2D tDepth;\n#if NORMAL_TEXTURE == 1\nuniform sampler2D tNormal;\n#endif\nuniform float cameraNear;\nuniform float cameraFar;\nuniform mat4 cameraProjectionMatrix;\nuniform mat4 cameraInverseProjectionMatrix;\nuniform float scale;\nuniform float intensity;\nuniform float bias;\nuniform float kernelRadius;\nuniform float minResolution;\nuniform vec2 size;\nuniform float randomSeed;\n// RGBA depth\n#include <packing>\nvec4 getDefaultColor( const in vec2 screenPosition ) {\n	#if DIFFUSE_TEXTURE == 1\n	return texture2D( tDiffuse, vUv );\n	#else\n	return vec4( 1.0 );\n	#endif\n}\nfloat getDepth( const in vec2 screenPosition ) {\n	#if DEPTH_PACKING == 1\n	return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\n	#else\n	return texture2D( tDepth, screenPosition ).x;\n	#endif\n}\nfloat getViewZ( const in float depth ) {\n	#if PERSPECTIVE_CAMERA == 1\n	return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n	#else\n	return orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n	#endif\n}\nvec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {\n	float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n	vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );\n	clipPosition *= clipW; // unprojection.\n	return ( cameraInverseProjectionMatrix * clipPosition ).xyz;\n}\nvec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {\n	#if NORMAL_TEXTURE == 1\n	return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );\n	#else\n	return normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );\n	#endif\n}\nfloat scaleDividedByCameraFar;\nfloat minResolutionMultipliedByCameraFar;\nfloat getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {\n	vec3 viewDelta = sampleViewPosition - centerViewPosition;\n	float viewDistance = length( viewDelta );\n	float scaledScreenDistance = scaleDividedByCameraFar * viewDistance;\n	return max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );\n}\n// moving costly divides into consts\nconst float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );\nconst float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );\nfloat getAmbientOcclusion( const in vec3 centerViewPosition ) {\n	// precompute some variables require in getOcclusion.\n	scaleDividedByCameraFar = scale / cameraFar;\n	minResolutionMultipliedByCameraFar = minResolution * cameraFar;\n	vec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );\n	// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/\n	float angle = rand( vUv + randomSeed ) * PI2;\n	vec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;\n	vec2 radiusStep = radius;\n	float occlusionSum = 0.0;\n	float weightSum = 0.0;\n	for( int i = 0; i < NUM_SAMPLES; i ++ ) {\n		vec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;\n		radius += radiusStep;\n		angle += ANGLE_STEP;\n		float sampleDepth = getDepth( sampleUv );\n		if( sampleDepth >= ( 1.0 - EPSILON ) ) {\n			continue;\n		}\n		float sampleViewZ = getViewZ( sampleDepth );\n		vec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );\n		occlusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );\n		weightSum += 1.0;\n	}\n	if( weightSum == 0.0 ) discard;\n	return occlusionSum * ( intensity / weightSum );\n}\nvoid main() {\n	float centerDepth = getDepth( vUv );\n	if( centerDepth >= ( 1.0 - EPSILON ) ) {\n		discard;\n	}\n	float centerViewZ = getViewZ( centerDepth );\n	vec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );\n	float ambientOcclusion = getAmbientOcclusion( viewPosition );\n	gl_FragColor = getDefaultColor( vUv );\n	gl_FragColor.xyz *=  1.0 - ambientOcclusion;\n}"},e1={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new I.Vector2(512,512)},sampleUvOffsets:{value:[new I.Vector2(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:"#include <common>\nuniform vec2 size;\nvarying vec2 vUv;\nvarying vec2 vInvSize;\nvoid main() {\n	vUv = uv;\n	vInvSize = 1.0 / size;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#include <common>\n#include <packing>\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform float depthCutoff;\nuniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];\nuniform float sampleWeights[ KERNEL_RADIUS + 1 ];\nvarying vec2 vUv;\nvarying vec2 vInvSize;\nfloat getDepth( const in vec2 screenPosition ) {\n	#if DEPTH_PACKING == 1\n	return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\n	#else\n	return texture2D( tDepth, screenPosition ).x;\n	#endif\n}\nfloat getViewZ( const in float depth ) {\n	#if PERSPECTIVE_CAMERA == 1\n	return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n	#else\n	return orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n	#endif\n}\nvoid main() {\n	float depth = getDepth( vUv );\n	if( depth >= ( 1.0 - EPSILON ) ) {\n		discard;\n	}\n	float centerViewZ = -getViewZ( depth );\n	bool rBreak = false, lBreak = false;\n	float weightSum = sampleWeights[0];\n	vec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;\n	for( int i = 1; i <= KERNEL_RADIUS; i ++ ) {\n		float sampleWeight = sampleWeights[i];\n		vec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;\n		vec2 sampleUv = vUv + sampleUvOffset;\n		float viewZ = -getViewZ( getDepth( sampleUv ) );\n		if( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;\n		if( ! rBreak ) {\n			diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\n			weightSum += sampleWeight;\n		}\n		sampleUv = vUv - sampleUvOffset;\n		viewZ = -getViewZ( getDepth( sampleUv ) );\n		if( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;\n		if( ! lBreak ) {\n			diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\n			weightSum += sampleWeight;\n		}\n	}\n	gl_FragColor = diffuseSum / weightSum;\n}"},e0={createSampleWeights:(e,t)=>{let r=(e,t)=>Math.exp(-(e*e)/(t*t*2))/(Math.sqrt(2*Math.PI)*t),i=[];for(let n=0;n<=e;n++)i.push(r(n,t));return i},createSampleOffsets:(e,t)=>{let r=[];for(let i=0;i<=e;i++)r.push(t.clone().multiplyScalar(i));return r},configure:(e,t,r,i)=>{e.defines.KERNEL_RADIUS=t,e.uniforms.sampleUvOffsets.value=e0.createSampleOffsets(t,i),e.uniforms.sampleWeights.value=e0.createSampleWeights(t,r),e.needsUpdate=!0}};class e2 extends eK{render(e,t,r){if(this.renderToScreen&&(this.materialCopy.blending=I.NoBlending,this.materialCopy.uniforms.tDiffuse.value=r.texture,this.materialCopy.needsUpdate=!0,this.renderPass(e,this.materialCopy,null)),1===this.params.output)return;e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();let i=e.autoClear;e.autoClear=!1,e.setRenderTarget(this.depthRenderTarget),e.clear(),this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;let n=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=n,this.hBlurMaterial.uniforms.depthCutoff.value=n,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),(this.prevStdDev!==this.params.saoBlurStdDev||this.prevNumSamples!==this.params.saoBlurRadius)&&(e0.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new I.Vector2(0,1)),e0.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new I.Vector2(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),e.setClearColor(0),e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.supportsDepthTextureExtension||this.renderOverride(e,this.depthMaterial,this.depthRenderTarget,0,1),this.supportsNormalTexture&&this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(e,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(e,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(e,this.hBlurMaterial,this.saoRenderTarget,16777215,1));let a=this.materialCopy;3===this.params.output?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,a=this.depthCopy):(4===this.params.output?this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture:this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),0===this.params.output?a.blending=I.CustomBlending:a.blending=I.NoBlending,this.renderPass(e,a,this.renderToScreen?null:r),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=i}renderPass(e,t,r,i,n){e.getClearColor(this.originalClearColor);let a=e.getClearAlpha(),s=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,null!=i&&(e.setClearColor(i),e.setClearAlpha(n||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=s,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}renderOverride(e,t,r,i,n){e.getClearColor(this.originalClearColor);let a=e.getClearAlpha(),s=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,i=t.clearColor||i,n=t.clearAlpha||n,null!=i&&(e.setClearColor(i),e.setClearAlpha(n||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=s,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}setSize(e,t){this.beautyRenderTarget.setSize(e,t),this.saoRenderTarget.setSize(e,t),this.blurIntermediateRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.depthRenderTarget.setSize(e,t),this.saoMaterial.uniforms.size.value.set(e,t),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(e,t),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(e,t),this.hBlurMaterial.needsUpdate=!0}dispose(){this.saoRenderTarget.dispose(),this.blurIntermediateRenderTarget.dispose(),this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.depthRenderTarget.dispose(),this.depthMaterial.dispose(),this.normalMaterial.dispose(),this.saoMaterial.dispose(),this.vBlurMaterial.dispose(),this.hBlurMaterial.dispose(),this.materialCopy.dispose(),this.depthCopy.dispose(),this.fsQuad.dispose()}constructor(e,t,r=!1,i=!1,n=new I.Vector2(256,256)){let a;super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.supportsDepthTextureExtension=r,this.supportsNormalTexture=i,this.originalClearColor=new I.Color,this._oldClearColor=new I.Color,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=new I.Vector2(n.x,n.y),this.saoRenderTarget=new I.WebGLRenderTarget(this.resolution.x,this.resolution.y,{type:I.HalfFloatType}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone(),this.beautyRenderTarget=this.saoRenderTarget.clone(),this.normalRenderTarget=new I.WebGLRenderTarget(this.resolution.x,this.resolution.y,{minFilter:I.NearestFilter,magFilter:I.NearestFilter,type:I.HalfFloatType}),this.depthRenderTarget=this.normalRenderTarget.clone(),this.supportsDepthTextureExtension&&((a=new I.DepthTexture).type=I.UnsignedShortType,this.beautyRenderTarget.depthTexture=a,this.beautyRenderTarget.depthBuffer=!0),this.depthMaterial=new I.MeshDepthMaterial,this.depthMaterial.depthPacking=I.RGBADepthPacking,this.depthMaterial.blending=I.NoBlending,this.normalMaterial=new I.MeshNormalMaterial,this.normalMaterial.blending=I.NoBlending,this.saoMaterial=new I.ShaderMaterial({defines:Object.assign({},e$.defines),fragmentShader:e$.fragmentShader,vertexShader:e$.vertexShader,uniforms:I.UniformsUtils.clone(e$.uniforms)}),this.saoMaterial.extensions.derivatives=!0,this.saoMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.saoMaterial.defines.NORMAL_TEXTURE=this.supportsNormalTexture?1:0,this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?a:this.depthRenderTarget.texture,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=I.NoBlending,this.vBlurMaterial=new I.ShaderMaterial({uniforms:I.UniformsUtils.clone(e1.uniforms),defines:Object.assign({},e1.defines),vertexShader:e1.vertexShader,fragmentShader:e1.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?a:this.depthRenderTarget.texture,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=I.NoBlending,this.hBlurMaterial=new I.ShaderMaterial({uniforms:I.UniformsUtils.clone(e1.uniforms),defines:Object.assign({},e1.defines),vertexShader:e1.vertexShader,fragmentShader:e1.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?a:this.depthRenderTarget.texture,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=I.NoBlending,this.materialCopy=new I.ShaderMaterial({uniforms:I.UniformsUtils.clone(eW.uniforms),vertexShader:eW.vertexShader,fragmentShader:eW.fragmentShader,blending:I.NoBlending}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=I.CustomBlending,this.materialCopy.blendSrc=I.DstColorFactor,this.materialCopy.blendDst=I.ZeroFactor,this.materialCopy.blendEquation=I.AddEquation,this.materialCopy.blendSrcAlpha=I.DstAlphaFactor,this.materialCopy.blendDstAlpha=I.ZeroFactor,this.materialCopy.blendEquationAlpha=I.AddEquation,this.depthCopy=new I.ShaderMaterial({uniforms:I.UniformsUtils.clone(eC.uniforms),vertexShader:eC.vertexShader,fragmentShader:eC.fragmentShader,blending:I.NoBlending}),this.fsQuad=new ej(null)}}D(e2,"OUTPUT",{Beauty:1,Default:0,SAO:2,Depth:3,Normal:4});let e9={defines:{MAX_STEP:0,isPerspectiveCamera:!0,isDistanceAttenuation:!0,isFresnel:!0,isInfiniteThick:!1,isSelective:!1},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tMetalness:{value:null},tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new I.Vector2},cameraProjectionMatrix:{value:new I.Matrix4},cameraInverseProjectionMatrix:{value:new I.Matrix4},opacity:{value:.5},maxDistance:{value:180},cameraRange:{value:0},surfDist:{value:.007},thickTolerance:{value:.03}},vertexShader:"\n\n    varying vec2 vUv;\n\n    void main() {\n\n			vUv = uv;\n\n			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }\n\n  ",fragmentShader:"\n		// precision highp float;\n		precision highp sampler2D;\n		varying vec2 vUv;\n		uniform sampler2D tDepth;\n		uniform sampler2D tNormal;\n		uniform sampler2D tMetalness;\n		uniform sampler2D tDiffuse;\n		uniform float cameraRange;\n		uniform vec2 resolution;\n		uniform float opacity;\n		uniform float cameraNear;\n		uniform float cameraFar;\n		uniform float maxDistance;\n		uniform float surfDist;\n		uniform mat4 cameraProjectionMatrix;\n		uniform mat4 cameraInverseProjectionMatrix;\n		uniform float thickTolerance;\n		#include <packing>\n		float pointToLineDistance(vec3 x0, vec3 x1, vec3 x2) {\n			//x0: point, x1: linePointA, x2: linePointB\n			//https://mathworld.wolfram.com/Point-LineDistance3-Dimensional.html\n			return length(cross(x0-x1,x0-x2))/length(x2-x1);\n		}\n		float pointPlaneDistance(vec3 point,vec3 planePoint,vec3 planeNormal){\n			// https://mathworld.wolfram.com/Point-PlaneDistance.html\n			//// https://en.wikipedia.org/wiki/Plane_(geometry)\n			//// http://paulbourke.net/geometry/pointlineplane/\n			float a=planeNormal.x,b=planeNormal.y,c=planeNormal.z;\n			float x0=point.x,y0=point.y,z0=point.z;\n			float x=planePoint.x,y=planePoint.y,z=planePoint.z;\n			float d=-(a*x+b*y+c*z);\n			float distance=(a*x0+b*y0+c*z0+d)/sqrt(a*a+b*b+c*c);\n			return distance;\n		}\n		float getDepth( const in vec2 uv ) {\n			return texture2D( tDepth, uv ).x;\n		}\n		float getViewZ( const in float depth ) {\n			#ifdef isPerspectiveCamera\n				return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n			#else\n				return orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n			#endif\n		}\n		vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {\n			vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc\n			clipPosition *= clipW; //clip\n			return ( cameraInverseProjectionMatrix * clipPosition ).xyz;//view\n		}\n		vec3 getViewNormal( const in vec2 uv ) {\n			return unpackRGBToNormal( texture2D( tNormal, uv ).xyz );\n		}\n		vec2 viewPositionToXY(vec3 viewPosition){\n			vec2 xy;\n			vec4 clip=cameraProjectionMatrix*vec4(viewPosition,1);\n			xy=clip.xy;//clip\n			float clipW=clip.w;\n			xy/=clipW;//NDC\n			xy=(xy+1.)/2.;//uv\n			xy*=resolution;//screen\n			return xy;\n		}\n		void main(){\n			#ifdef isSelective\n				float metalness=texture2D(tMetalness,vUv).r;\n				if(metalness==0.) return;\n			#endif\n\n			float depth = getDepth( vUv );\n			float viewZ = getViewZ( depth );\n			if(-viewZ>=cameraFar) return;\n\n			float clipW = cameraProjectionMatrix[2][3] * viewZ+cameraProjectionMatrix[3][3];\n			vec3 viewPosition=getViewPosition( vUv, depth, clipW );\n\n			vec2 d0=gl_FragCoord.xy;\n			vec2 d1;\n\n			vec3 viewNormal=getViewNormal( vUv );\n\n			#ifdef isPerspectiveCamera\n				vec3 viewIncidenceDir=normalize(viewPosition);\n				vec3 viewReflectDir=reflect(viewIncidenceDir,viewNormal);\n			#else\n				vec3 viewIncidenceDir=vec3(0,0,-1);\n				vec3 viewReflectDir=reflect(viewIncidenceDir,viewNormal);\n			#endif\n\n			float maxReflectRayLen=maxDistance/dot(-viewIncidenceDir,viewNormal);\n			// dot(a,b)==length(a)*length(b)*cos(theta) // https://www.mathsisfun.com/algebra/vectors-dot-product.html\n			// if(a.isNormalized&&b.isNormalized) dot(a,b)==cos(theta)\n			// maxDistance/maxReflectRayLen=cos(theta)\n			// maxDistance/maxReflectRayLen==dot(a,b)\n			// maxReflectRayLen==maxDistance/dot(a,b)\n\n			vec3 d1viewPosition=viewPosition+viewReflectDir*maxReflectRayLen;\n			#ifdef isPerspectiveCamera\n				if(d1viewPosition.z>-cameraNear){\n					//https://tutorial.math.lamar.edu/Classes/CalcIII/EqnsOfLines.aspx\n					float t=(-cameraNear-viewPosition.z)/viewReflectDir.z;\n					d1viewPosition=viewPosition+viewReflectDir*t;\n				}\n			#endif\n			d1=viewPositionToXY(d1viewPosition);\n\n			float totalLen=length(d1-d0);\n			float xLen=d1.x-d0.x;\n			float yLen=d1.y-d0.y;\n			float totalStep=max(abs(xLen),abs(yLen));\n			float xSpan=xLen/totalStep;\n			float ySpan=yLen/totalStep;\n			for(float i=0.;i<MAX_STEP;i++){\n				if(i>=totalStep) break;\n				vec2 xy=vec2(d0.x+i*xSpan,d0.y+i*ySpan);\n				if(xy.x<0.||xy.x>resolution.x||xy.y<0.||xy.y>resolution.y) break;\n				float s=length(xy-d0)/totalLen;\n				vec2 uv=xy/resolution;\n\n				float d = getDepth(uv);\n				float vZ = getViewZ( d );\n				if(-vZ>=cameraFar) continue;\n				float cW = cameraProjectionMatrix[2][3] * vZ+cameraProjectionMatrix[3][3];\n				vec3 vP=getViewPosition( uv, d, cW );\n\n				#ifdef isPerspectiveCamera\n					// https://www.comp.nus.edu.sg/~lowkl/publications/lowk_persp_interp_techrep.pdf\n					float recipVPZ=1./viewPosition.z;\n					float viewReflectRayZ=1./(recipVPZ+s*(1./d1viewPosition.z-recipVPZ));\n					float sD=surfDist*cW;\n				#else\n					float viewReflectRayZ=viewPosition.z+s*(d1viewPosition.z-viewPosition.z);\n					float sD=surfDist;\n				#endif\n				if(viewReflectRayZ-sD>vZ) continue;\n\n				#ifdef isInfiniteThick\n					if(viewReflectRayZ+thickTolerance*clipW<vP.z) break;\n				#endif\n				float away=pointToLineDistance(vP,viewPosition,d1viewPosition);\n\n				float op=opacity;\n\n				if(away<sD){\n					vec3 vN=getViewNormal( uv );\n					if(dot(viewReflectDir,vN)>=0.) continue;\n					float distance=pointPlaneDistance(vP,viewPosition,viewNormal);\n					if(distance>maxDistance) break;\n					#ifdef isDistanceAttenuation\n						float ratio=1.-(distance/maxDistance);\n						float attenuation=ratio*ratio;\n						op=opacity*attenuation;\n					#endif\n					#ifdef isFresnel\n						float fresnel=(dot(viewIncidenceDir,viewReflectDir)+1.)/2.;\n						op*=fresnel;\n					#endif\n					vec4 reflectColor=texture2D(tDiffuse,uv);\n					gl_FragColor.xyz=reflectColor.xyz;\n					gl_FragColor.a=op;\n					break;\n				}\n			}\n		}\n	"},e3={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:"\n\n    varying vec2 vUv;\n\n    void main() {\n\n    	vUv = uv;\n    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }\n\n  ",fragmentShader:"\n\n    uniform sampler2D tDepth;\n\n    uniform float cameraNear;\n    uniform float cameraFar;\n\n    varying vec2 vUv;\n\n    #include <packing>\n\n		float getLinearDepth( const in vec2 uv ) {\n\n			#if PERSPECTIVE_CAMERA == 1\n\n				float fragCoordZ = texture2D( tDepth, uv ).x;\n				float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n				return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n			#else\n\n				return texture2D( tDepth, uv ).x;\n\n			#endif\n\n		}\n\n    void main() {\n\n    	float depth = getLinearDepth( vUv );\n			float d = 1.0 - depth;\n			// d=(d-.999)*1000.;\n    	gl_FragColor = vec4( vec3( d ), 1.0 );\n\n    }\n\n  "},e4={uniforms:{tDiffuse:{value:null},resolution:{value:new I.Vector2},opacity:{value:.5}},vertexShader:"\n\n    varying vec2 vUv;\n\n    void main() {\n\n    	vUv = uv;\n    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }\n\n  ",fragmentShader:"\n\n    uniform sampler2D tDiffuse;\n    uniform vec2 resolution;\n    varying vec2 vUv;\n    void main() {\n			//reverse engineering from PhotoShop blur filter, then change coefficient\n\n    	vec2 texelSize = ( 1.0 / resolution );\n\n			vec4 c=texture2D(tDiffuse,vUv);\n\n			vec2 offset;\n\n			offset=(vec2(-1,0))*texelSize;\n			vec4 cl=texture2D(tDiffuse,vUv+offset);\n\n			offset=(vec2(1,0))*texelSize;\n			vec4 cr=texture2D(tDiffuse,vUv+offset);\n\n			offset=(vec2(0,-1))*texelSize;\n			vec4 cb=texture2D(tDiffuse,vUv+offset);\n\n			offset=(vec2(0,1))*texelSize;\n			vec4 ct=texture2D(tDiffuse,vUv+offset);\n\n			// float coeCenter=.5;\n			// float coeSide=.125;\n			float coeCenter=.2;\n			float coeSide=.2;\n			float a=c.a*coeCenter+cl.a*coeSide+cr.a*coeSide+cb.a*coeSide+ct.a*coeSide;\n			vec3 rgb=(c.rgb*c.a*coeCenter+cl.rgb*cl.a*coeSide+cr.rgb*cr.a*coeSide+cb.rgb*cb.a*coeSide+ct.rgb*ct.a*coeSide)/a;\n			gl_FragColor=vec4(rgb,a);\n\n		}\n	"},e8=class extends eK{dispose(){this.beautyRenderTarget.dispose(),this.prevRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.metalnessRenderTarget.dispose(),this.ssrRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.blurRenderTarget2.dispose(),this.normalMaterial.dispose(),this.metalnessOnMaterial.dispose(),this.metalnessOffMaterial.dispose(),this.blurMaterial.dispose(),this.blurMaterial2.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(e,t){switch(e.setRenderTarget(this.beautyRenderTarget),e.clear(),this.groundReflector&&(this.groundReflector.visible=!1,this.groundReflector.doRender(this.renderer,this.scene,this.camera),this.groundReflector.visible=!0),e.render(this.scene,this.camera),this.groundReflector&&(this.groundReflector.visible=!1),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,0,0),this.selective&&this.renderMetalness(e,this.metalnessOnMaterial,this.metalnessRenderTarget,0,0),this.ssrMaterial.uniforms.opacity.value=this.opacity,this.ssrMaterial.uniforms.maxDistance.value=this.maxDistance,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.renderPass(e,this.ssrMaterial,this.ssrRenderTarget),this.blur&&(this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.renderPass(e,this.blurMaterial2,this.blurRenderTarget2)),this.output){case e8.OUTPUT.Default:this.bouncing?(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=I.NoBlending,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=I.NormalBlending,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture,this.copyMaterial.blending=I.NoBlending):(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=I.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=I.NormalBlending),this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case e8.OUTPUT.SSR:this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=I.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.bouncing&&(this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=I.NoBlending,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=I.NormalBlending,this.renderPass(e,this.copyMaterial,this.prevRenderTarget));break;case e8.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=I.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case e8.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case e8.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=I.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case e8.OUTPUT.Metalness:this.copyMaterial.uniforms.tDiffuse.value=this.metalnessRenderTarget.texture,this.copyMaterial.blending=I.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.SSRPass: Unknown output type.")}}renderPass(e,t,r,i,n){this.originalClearColor.copy(e.getClearColor(this.tempColor));let a=e.getClearAlpha(this.tempColor),s=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,null!=i&&(e.setClearColor(i),e.setClearAlpha(n||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=s,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}renderOverride(e,t,r,i,n){this.originalClearColor.copy(e.getClearColor(this.tempColor));let a=e.getClearAlpha(this.tempColor),s=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,i=t.clearColor||i,n=t.clearAlpha||n,null!=i&&(e.setClearColor(i),e.setClearAlpha(n||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=s,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}renderMetalness(e,t,r,i,n){this.originalClearColor.copy(e.getClearColor(this.tempColor));let a=e.getClearAlpha(this.tempColor),s=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,i=t.clearColor||i,n=t.clearAlpha||n,null!=i&&(e.setClearColor(i),e.setClearAlpha(n||0),e.clear()),this.scene.traverseVisible(e=>{e._SSRPassBackupMaterial=e.material,this._selects.includes(e)?e.material=this.metalnessOnMaterial:e.material=this.metalnessOffMaterial}),e.render(this.scene,this.camera),this.scene.traverseVisible(e=>{e.material=e._SSRPassBackupMaterial}),e.autoClear=s,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}setSize(e,t){this.width=e,this.height=t,this.ssrMaterial.defines.MAX_STEP=Math.sqrt(e*e+t*t),this.ssrMaterial.needsUpdate=!0,this.beautyRenderTarget.setSize(e,t),this.prevRenderTarget.setSize(e,t),this.ssrRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.metalnessRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.blurRenderTarget2.setSize(e,t),this.ssrMaterial.uniforms.resolution.value.set(e,t),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(e,t),this.blurMaterial2.uniforms.resolution.value.set(e,t)}constructor({renderer:e,scene:t,camera:r,width:i,height:n,selects:a,bouncing:s=!1,groundReflector:o}){super(),this.width=void 0!==i?i:512,this.height=void 0!==n?n:512,this.clear=!0,this.renderer=e,this.scene=t,this.camera=r,this.groundReflector=o,this.opacity=e9.uniforms.opacity.value,this.output=0,this.maxDistance=e9.uniforms.maxDistance.value,this.thickness=e9.uniforms.thickness.value,this.tempColor=new I.Color,this._selects=a,this.selective=Array.isArray(this._selects),Object.defineProperty(this,"selects",{get(){return this._selects},set(e){this._selects!==e&&(this._selects=e,Array.isArray(e)?(this.selective=!0,this.ssrMaterial.defines.SELECTIVE=!0):(this.selective=!1,this.ssrMaterial.defines.SELECTIVE=!1),this.ssrMaterial.needsUpdate=!0)}}),this._bouncing=s,Object.defineProperty(this,"bouncing",{get(){return this._bouncing},set(e){this._bouncing!==e&&(this._bouncing=e,e?this.ssrMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture:this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture)}}),this.blur=!0,this._distanceAttenuation=e9.defines.DISTANCE_ATTENUATION,Object.defineProperty(this,"distanceAttenuation",{get(){return this._distanceAttenuation},set(e){this._distanceAttenuation!==e&&(this._distanceAttenuation=e,this.ssrMaterial.defines.DISTANCE_ATTENUATION=e,this.ssrMaterial.needsUpdate=!0)}}),this._fresnel=e9.defines.FRESNEL,Object.defineProperty(this,"fresnel",{get(){return this._fresnel},set(e){this._fresnel!==e&&(this._fresnel=e,this.ssrMaterial.defines.FRESNEL=e,this.ssrMaterial.needsUpdate=!0)}}),this._infiniteThick=e9.defines.INFINITE_THICK,Object.defineProperty(this,"infiniteThick",{get(){return this._infiniteThick},set(e){this._infiniteThick!==e&&(this._infiniteThick=e,this.ssrMaterial.defines.INFINITE_THICK=e,this.ssrMaterial.needsUpdate=!0)}});let l=new I.DepthTexture;l.type=I.UnsignedShortType,l.minFilter=I.NearestFilter,l.magFilter=I.NearestFilter,this.beautyRenderTarget=new I.WebGLRenderTarget(this.width,this.height,{minFilter:I.NearestFilter,magFilter:I.NearestFilter,type:I.HalfFloatType,depthTexture:l,depthBuffer:!0}),this.prevRenderTarget=new I.WebGLRenderTarget(this.width,this.height,{minFilter:I.NearestFilter,magFilter:I.NearestFilter}),this.normalRenderTarget=new I.WebGLRenderTarget(this.width,this.height,{minFilter:I.NearestFilter,magFilter:I.NearestFilter,type:I.HalfFloatType}),this.metalnessRenderTarget=new I.WebGLRenderTarget(this.width,this.height,{minFilter:I.NearestFilter,magFilter:I.NearestFilter,type:I.HalfFloatType}),this.ssrRenderTarget=new I.WebGLRenderTarget(this.width,this.height,{minFilter:I.NearestFilter,magFilter:I.NearestFilter}),this.blurRenderTarget=this.ssrRenderTarget.clone(),this.blurRenderTarget2=this.ssrRenderTarget.clone(),this.ssrMaterial=new I.ShaderMaterial({defines:Object.assign({},e9.defines,{MAX_STEP:Math.sqrt(this.width*this.width+this.height*this.height)}),uniforms:I.UniformsUtils.clone(e9.uniforms),vertexShader:e9.vertexShader,fragmentShader:e9.fragmentShader,blending:I.NoBlending}),this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssrMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssrMaterial.defines.SELECTIVE=this.selective,this.ssrMaterial.needsUpdate=!0,this.ssrMaterial.uniforms.tMetalness.value=this.metalnessRenderTarget.texture,this.ssrMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssrMaterial.uniforms.cameraNear.value=this.camera.near,this.ssrMaterial.uniforms.cameraFar.value=this.camera.far,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.ssrMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new I.MeshNormalMaterial,this.normalMaterial.blending=I.NoBlending,this.metalnessOnMaterial=new I.MeshBasicMaterial({color:"white"}),this.metalnessOffMaterial=new I.MeshBasicMaterial({color:"black"}),this.blurMaterial=new I.ShaderMaterial({defines:Object.assign({},e4.defines),uniforms:I.UniformsUtils.clone(e4.uniforms),vertexShader:e4.vertexShader,fragmentShader:e4.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.blurMaterial2=new I.ShaderMaterial({defines:Object.assign({},e4.defines),uniforms:I.UniformsUtils.clone(e4.uniforms),vertexShader:e4.vertexShader,fragmentShader:e4.fragmentShader}),this.blurMaterial2.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.blurMaterial2.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new I.ShaderMaterial({defines:Object.assign({},e3.defines),uniforms:I.UniformsUtils.clone(e3.uniforms),vertexShader:e3.vertexShader,fragmentShader:e3.fragmentShader,blending:I.NoBlending}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new I.ShaderMaterial({uniforms:I.UniformsUtils.clone(eW.uniforms),vertexShader:eW.vertexShader,fragmentShader:eW.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:I.SrcAlphaFactor,blendDst:I.OneMinusSrcAlphaFactor,blendEquation:I.AddEquation,blendSrcAlpha:I.SrcAlphaFactor,blendDstAlpha:I.OneMinusSrcAlphaFactor,blendEquationAlpha:I.AddEquation}),this.fsQuad=new ej(null),this.originalClearColor=new I.Color}};D(e8,"OUTPUT",{Default:0,SSR:1,Beauty:3,Depth:4,Normal:5,Metalness:7});class e5 extends I.Loader{load(e,t,r,i){let n;let a=this;n=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:I.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);let s=function(t){i?i(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},o=new I.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(r){try{a.parse(r,n,function(r){t(r),a.manager.itemEnd(e)},s)}catch(e){s(e)}},r,s)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i){let n;let a={},s={};if("string"==typeof e)n=JSON.parse(e);else if(e instanceof ArrayBuffer){if(I.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4)))===tA){try{a[e7.KHR_BINARY_GLTF]=new tv(e)}catch(e){i&&i(e);return}n=JSON.parse(a[e7.KHR_BINARY_GLTF].content)}else n=JSON.parse(I.LoaderUtils.decodeText(new Uint8Array(e)))}else n=e;if(void 0===n.asset||n.asset.version[0]<2){i&&i(Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let o=new tk(n,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});o.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){let t=this.pluginCallbacks[e](o);s[t.name]=t,a[t.name]=!0}if(n.extensionsUsed)for(let e=0;e<n.extensionsUsed.length;++e){let t=n.extensionsUsed[e],r=n.extensionsRequired||[];switch(t){case e7.KHR_MATERIALS_UNLIT:a[t]=new tt;break;case e7.KHR_DRACO_MESH_COMPRESSION:a[t]=new tT(n,this.dracoLoader);break;case e7.KHR_TEXTURE_TRANSFORM:a[t]=new tC;break;case e7.KHR_MESH_QUANTIZATION:a[t]=new ty;break;default:r.indexOf(t)>=0&&void 0===s[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}o.setExtensions(a),o.setPlugins(s),o.parse(r,i)}parseAsync(e,t){let r=this;return new Promise(function(i,n){r.parse(e,t,i,n)})}constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new ti(e)}),this.register(function(e){return new th(e)}),this.register(function(e){return new td(e)}),this.register(function(e){return new tf(e)}),this.register(function(e){return new ta(e)}),this.register(function(e){return new ts(e)}),this.register(function(e){return new to(e)}),this.register(function(e){return new tl(e)}),this.register(function(e){return new tr(e)}),this.register(function(e){return new tc(e)}),this.register(function(e){return new tn(e)}),this.register(function(e){return new tu(e)}),this.register(function(e){return new te(e)}),this.register(function(e){return new tp(e)}),this.register(function(e){return new tm(e)})}}function e6(){let e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}let e7={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class te{_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let r=0,i=t.length;r<i;r++){let i=t[r];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){let t;let r=this.parser,i="light:"+e,n=r.cache.get(i);if(n)return n;let a=r.json,s=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e],o=new I.Color(16777215);void 0!==s.color&&o.fromArray(s.color);let l=void 0!==s.range?s.range:0;switch(s.type){case"directional":(t=new I.DirectionalLight(o)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new I.PointLight(o)).distance=l;break;case"spot":(t=new I.SpotLight(o)).distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,t.angle=s.spot.outerConeAngle,t.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return t.position.set(0,0,0),t.decay=2,tN(t,s),void 0!==s.intensity&&(t.intensity=s.intensity),t.name=r.createUniqueName(s.name||"light_"+e),n=Promise.resolve(t),r.cache.add(i,n),n}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){let t=this,r=this.parser,i=r.json.nodes[e],n=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then(function(e){return r._getNodeRef(t.cache,n,e)})}constructor(e){this.parser=e,this.name=e7.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}}class tt{getMaterialType(){return I.MeshBasicMaterial}extendParams(e,t,r){let i=[];e.color=new I.Color(1,1,1),e.opacity=1;let n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){let t=n.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==n.baseColorTexture&&i.push(r.assignTexture(e,"map",n.baseColorTexture,3001))}return Promise.all(i)}constructor(){this.name=e7.KHR_MATERIALS_UNLIT}}class tr{extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}constructor(e){this.parser=e,this.name=e7.KHR_MATERIALS_EMISSIVE_STRENGTH}}class ti{getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&n.push(r.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&n.push(r.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(n.push(r.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){let e=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new I.Vector2(e,e)}return Promise.all(n)}constructor(e){this.parser=e,this.name=e7.KHR_MATERIALS_CLEARCOAT}}class tn{getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return void 0!==a.iridescenceFactor&&(t.iridescence=a.iridescenceFactor),void 0!==a.iridescenceTexture&&n.push(r.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),void 0!==a.iridescenceIor&&(t.iridescenceIOR=a.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==a.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),void 0!==a.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),void 0!==a.iridescenceThicknessTexture&&n.push(r.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(n)}constructor(e){this.parser=e,this.name=e7.KHR_MATERIALS_IRIDESCENCE}}class ta{getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[];t.sheenColor=new I.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;let a=i.extensions[this.name];return void 0!==a.sheenColorFactor&&t.sheenColor.fromArray(a.sheenColorFactor),void 0!==a.sheenRoughnessFactor&&(t.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&n.push(r.assignTexture(t,"sheenColorMap",a.sheenColorTexture,3001)),void 0!==a.sheenRoughnessTexture&&n.push(r.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(n)}constructor(e){this.parser=e,this.name=e7.KHR_MATERIALS_SHEEN}}class ts{getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&n.push(r.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(n)}constructor(e){this.parser=e,this.name=e7.KHR_MATERIALS_TRANSMISSION}}class to{getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&n.push(r.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;let s=a.attenuationColor||[1,1,1];return t.attenuationColor=new I.Color(s[0],s[1],s[2]),Promise.all(n)}constructor(e){this.parser=e,this.name=e7.KHR_MATERIALS_VOLUME}}class tl{getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}constructor(e){this.parser=e,this.name=e7.KHR_MATERIALS_IOR}}class tc{getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&n.push(r.assignTexture(t,"specularIntensityMap",a.specularTexture));let s=a.specularColorFactor||[1,1,1];return t.specularColor=new I.Color(s[0],s[1],s[2]),void 0!==a.specularColorTexture&&n.push(r.assignTexture(t,"specularColorMap",a.specularColorTexture,3001)),Promise.all(n)}constructor(e){this.parser=e,this.name=e7.KHR_MATERIALS_SPECULAR}}class tu{getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return void 0!==a.anisotropyStrength&&(t.anisotropy=a.anisotropyStrength),void 0!==a.anisotropyRotation&&(t.anisotropyRotation=a.anisotropyRotation),void 0!==a.anisotropyTexture&&n.push(r.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(n)}constructor(e){this.parser=e,this.name=e7.KHR_MATERIALS_ANISOTROPY}}class th{loadTexture(e){let t=this.parser,r=t.json,i=r.textures[e];if(!i.extensions||!i.extensions[this.name])return null;let n=i.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(!(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return t.loadTextureImage(e,n.source,a)}constructor(e){this.parser=e,this.name=e7.KHR_TEXTURE_BASISU}}class td{loadTexture(e){let t=this.name,r=this.parser,i=r.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;let a=n.extensions[t],s=i.images[a.source],o=r.textureLoader;if(s.uri){let e=r.options.manager.getHandler(s.uri);null!==e&&(o=e)}return this.detectSupport().then(function(n){if(n)return r.loadTextureImage(e,a.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}constructor(e){this.parser=e,this.name=e7.EXT_TEXTURE_WEBP,this.isSupported=null}}class tf{loadTexture(e){let t=this.name,r=this.parser,i=r.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;let a=n.extensions[t],s=i.images[a.source],o=r.textureLoader;if(s.uri){let e=r.options.manager.getHandler(s.uri);null!==e&&(o=e)}return this.detectSupport().then(function(n){if(n)return r.loadTextureImage(e,a.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}constructor(e){this.parser=e,this.name=e7.EXT_TEXTURE_AVIF,this.isSupported=null}}class tp{loadBufferView(e){let t=this.parser.json,r=t.bufferViews[e];if(!r.extensions||!r.extensions[this.name])return null;{let e=r.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(!(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return i.then(function(t){let r=e.byteOffset||0,i=e.byteLength||0,a=e.count,s=e.byteStride,o=new Uint8Array(t,r,i);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(a,s,o,e.mode,e.filter).then(function(e){return e.buffer}):n.ready.then(function(){let t=new ArrayBuffer(a*s);return n.decodeGltfBuffer(new Uint8Array(t),a,s,o,e.mode,e.filter),t})})}}constructor(e){this.name=e7.EXT_MESHOPT_COMPRESSION,this.parser=e}}class tm{createNodeMesh(e){let t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||void 0===r.mesh)return null;for(let e of t.meshes[r.mesh].primitives)if(e.mode!==tx.TRIANGLES&&e.mode!==tx.TRIANGLE_STRIP&&e.mode!==tx.TRIANGLE_FAN&&void 0!==e.mode)return null;let i=r.extensions[this.name].attributes,n=[],a={};for(let e in i)n.push(this.parser.getDependency("accessor",i[e]).then(t=>(a[e]=t,a[e])));return n.length<1?null:(n.push(this.parser.createNodeMesh(e)),Promise.all(n).then(e=>{let t=e.pop(),r=t.isGroup?t.children:[t],i=e[0].count,n=[];for(let e of r){let t=new I.Matrix4,r=new I.Vector3,s=new I.Quaternion,o=new I.Vector3(1,1,1),l=new I.InstancedMesh(e.geometry,e.material,i);for(let e=0;e<i;e++)a.TRANSLATION&&r.fromBufferAttribute(a.TRANSLATION,e),a.ROTATION&&s.fromBufferAttribute(a.ROTATION,e),a.SCALE&&o.fromBufferAttribute(a.SCALE,e),l.setMatrixAt(e,t.compose(r,s,o));for(let t in a)"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,a[t]);I.Object3D.prototype.copy.call(l,e),this.parser.assignFinalMaterial(l),n.push(l)}return t.isGroup?(t.clear(),t.add(...n),t):n[0]}))}constructor(e){this.name=e7.EXT_MESH_GPU_INSTANCING,this.parser=e}}let tA="glTF",tg={JSON:1313821514,BIN:5130562};class tv{constructor(e){this.name=e7.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,12);if(this.header={magic:I.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==tA)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw Error("THREE.GLTFLoader: Legacy binary file detected.");let r=this.header.length-12,i=new DataView(e,12),n=0;for(;n<r;){let t=i.getUint32(n,!0);n+=4;let r=i.getUint32(n,!0);if(n+=4,r===tg.JSON){let r=new Uint8Array(e,12+n,t);this.content=I.LoaderUtils.decodeText(r)}else if(r===tg.BIN){let r=12+n;this.body=e.slice(r,r+t)}n+=t}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.")}}class tT{decodePrimitive(e,t){let r=this.json,i=this.dracoLoader,n=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,s={},o={},l={};for(let e in a)s[tw[e]||e.toLowerCase()]=a[e];for(let t in e.attributes){let i=tw[t]||t.toLowerCase();if(void 0!==a[t]){let n=r.accessors[e.attributes[t]],a=tM[n.componentType];l[i]=a.name,o[i]=!0===n.normalized}}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(t){i.decodeDracoFile(e,function(e){for(let t in e.attributes){let r=e.attributes[t],i=o[t];void 0!==i&&(r.normalized=i)}t(e)},s,l)})})}constructor(e,t){if(!t)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=e7.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}}class tC{extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}constructor(){this.name=e7.KHR_TEXTURE_TRANSFORM}}class ty{constructor(){this.name=e7.KHR_MESH_QUANTIZATION}}class tE extends I.Interpolant{copySampleValue_(e){let t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i*3+i;for(let e=0;e!==i;e++)t[e]=r[n+e];return t}interpolate_(e,t,r,i){let n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=2*s,l=3*s,c=i-t,u=(r-t)/c,h=u*u,d=h*u,f=e*l,p=f-l,m=-2*d+3*h,A=d-h,g=1-m,v=A-h+u;for(let e=0;e!==s;e++){let t=a[p+e+s],r=a[p+e+o]*c,i=a[f+e+s],l=a[f+e]*c;n[e]=g*t+v*r+m*i+A*l}return n}constructor(e,t,r,i){super(e,t,r,i)}}let tB=new I.Quaternion;class tR extends tE{interpolate_(e,t,r,i){let n=super.interpolate_(e,t,r,i);return tB.fromArray(n).normalize().toArray(n),n}}let tx={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},tM={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},tS={9728:I.NearestFilter,9729:I.LinearFilter,9984:I.NearestMipmapNearestFilter,9985:I.LinearMipmapNearestFilter,9986:I.NearestMipmapLinearFilter,9987:I.LinearMipmapLinearFilter},tb={33071:I.ClampToEdgeWrapping,33648:I.MirroredRepeatWrapping,10497:I.RepeatWrapping},tI={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},tw={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...I.REVISION.replace(/\D+/g,"")>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},t_={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},tF={CUBICSPLINE:void 0,LINEAR:I.InterpolateLinear,STEP:I.InterpolateDiscrete},tP={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function tD(e,t,r){for(let i in r.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=r.extensions[i])}function tN(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function tO(e){let t="",r=Object.keys(e).sort();for(let i=0,n=r.length;i<n;i++)t+=r[i]+":"+e[r[i]]+";";return t}function tL(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}let tU=new I.Matrix4;class tk{setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let r=this,i=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(t){let a={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:r,userData:{}};tD(n,a,i),tN(a,i),Promise.all(r._invokeAll(function(e){return e.afterRoot&&e.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let r=0,i=t.length;r<i;r++){let i=t[r].joints;for(let t=0,r=i.length;t<r;t++)e[i[t]].isBone=!0}for(let t=0,i=e.length;t<i;t++){let i=e[t];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(r[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;let i=r.clone(),n=(e,t)=>{let r=this.associations.get(e);for(let[i,a]of(null!=r&&this.associations.set(t,r),e.children.entries()))n(a,t.children[i])};return n(r,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){let i=e(t[r]);if(i)return i}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let r=[];for(let i=0;i<t.length;i++){let n=e(t[i]);n&&r.push(n)}return r}getDependency(e,t){let r=e+":"+t,i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(!(i=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)})))throw Error("Unknown type: "+e)}this.cache.add(r,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){let r=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(t,i){return r.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[e7.KHR_BINARY_GLTF].body);let i=this.options;return new Promise(function(e,n){r.load(I.LoaderUtils.resolveURL(t.uri,i.path),e,void 0,function(){n(Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){let r=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+r)})}loadAccessor(e){let t=this,r=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){let e=tI[i.type],t=tM[i.componentType],r=!0===i.normalized,n=new t(i.count*e);return Promise.resolve(new I.BufferAttribute(n,e,r))}let n=[];return void 0!==i.bufferView?n.push(this.getDependency("bufferView",i.bufferView)):n.push(null),void 0!==i.sparse&&(n.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(n).then(function(e){let n,a;let s=e[0],o=tI[i.type],l=tM[i.componentType],c=l.BYTES_PER_ELEMENT,u=c*o,h=i.byteOffset||0,d=void 0!==i.bufferView?r.bufferViews[i.bufferView].byteStride:void 0,f=!0===i.normalized;if(d&&d!==u){let e=Math.floor(h/d),r="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count,u=t.cache.get(r);u||(n=new l(s,e*d,i.count*d/c),u=new I.InterleavedBuffer(n,d/c),t.cache.add(r,u)),a=new I.InterleavedBufferAttribute(u,o,h%d/c,f)}else n=null===s?new l(i.count*o):new l(s,h,i.count*o),a=new I.BufferAttribute(n,o,f);if(void 0!==i.sparse){let t=tI.SCALAR,r=tM[i.sparse.indices.componentType],n=i.sparse.indices.byteOffset||0,c=i.sparse.values.byteOffset||0,u=new r(e[1],n,i.sparse.count*t),h=new l(e[2],c,i.sparse.count*o);null!==s&&(a=new I.BufferAttribute(a.array.slice(),a.itemSize,a.normalized));for(let e=0,t=u.length;e<t;e++){let t=u[e];if(a.setX(t,h[e*o]),o>=2&&a.setY(t,h[e*o+1]),o>=3&&a.setZ(t,h[e*o+2]),o>=4&&a.setW(t,h[e*o+3]),o>=5)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a})}loadTexture(e){let t=this.json,r=this.options,i=t.textures[e].source,n=t.images[i],a=this.textureLoader;if(n.uri){let e=r.manager.getHandler(n.uri);null!==e&&(a=e)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,r){let i=this,n=this.json,a=n.textures[e],s=n.images[t],o=(s.uri||s.bufferView)+":"+a.sampler;if(this.textureCache[o])return this.textureCache[o];let l=this.loadImageSource(t,r).then(function(t){t.flipY=!1,t.name=a.name||s.name||"",""===t.name&&"string"==typeof s.uri&&!1===s.uri.startsWith("data:image/")&&(t.name=s.uri);let r=(n.samplers||{})[a.sampler]||{};return t.magFilter=tS[r.magFilter]||I.LinearFilter,t.minFilter=tS[r.minFilter]||I.LinearMipmapLinearFilter,t.wrapS=tb[r.wrapS]||I.RepeatWrapping,t.wrapT=tb[r.wrapT]||I.RepeatWrapping,i.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[o]=l,l}loadImageSource(e,t){let r=this.json,i=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());let n=r.images[e],a=self.URL||self.webkitURL,s=n.uri||"",o=!1;if(void 0!==n.bufferView)s=this.getDependency("bufferView",n.bufferView).then(function(e){o=!0;let t=new Blob([e],{type:n.mimeType});return s=a.createObjectURL(t)});else if(void 0===n.uri)throw Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let l=Promise.resolve(s).then(function(e){return new Promise(function(r,n){let a=r;!0===t.isImageBitmapLoader&&(a=function(e){let t=new I.Texture(e);t.needsUpdate=!0,r(t)}),t.load(I.LoaderUtils.resolveURL(e,i.path),a,void 0,n)})}).then(function(e){var t;return!0===o&&a.revokeObjectURL(s),e.userData.mimeType=n.mimeType||((t=n.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",s),e});return this.sourceCache[e]=l,l}assignTexture(e,t,r,i){let n=this;return this.getDependency("texture",r.index).then(function(a){if(!a)return null;if(void 0!==r.texCoord&&r.texCoord>0&&((a=a.clone()).channel=r.texCoord),n.extensions[e7.KHR_TEXTURE_TRANSFORM]){let e=void 0!==r.extensions?r.extensions[e7.KHR_TEXTURE_TRANSFORM]:void 0;if(e){let t=n.associations.get(a);a=n.extensions[e7.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),n.associations.set(a,t)}}return void 0!==i&&("colorSpace"in a?a.colorSpace=3001===i?"srgb":"srgb-linear":a.encoding=i),e[t]=a,a})}assignFinalMaterial(e){let t=e.geometry,r=e.material,i=void 0===t.attributes.tangent,n=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){let e="PointsMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new I.PointsMaterial,I.Material.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,t.sizeAttenuation=!1,this.cache.add(e,t)),r=t}else if(e.isLine){let e="LineBasicMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new I.LineBasicMaterial,I.Material.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,this.cache.add(e,t)),r=t}if(i||n||a){let e="ClonedMaterial:"+r.uuid+":";i&&(e+="derivative-tangents:"),n&&(e+="vertex-colors:"),a&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),n&&(t.vertexColors=!0),a&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}e.material=r}getMaterialType(){return I.MeshStandardMaterial}loadMaterial(e){let t;let r=this,i=this.json,n=this.extensions,a=i.materials[e],s={},o=a.extensions||{},l=[];if(o[e7.KHR_MATERIALS_UNLIT]){let e=n[e7.KHR_MATERIALS_UNLIT];t=e.getMaterialType(),l.push(e.extendParams(s,a,r))}else{let i=a.pbrMetallicRoughness||{};if(s.color=new I.Color(1,1,1),s.opacity=1,Array.isArray(i.baseColorFactor)){let e=i.baseColorFactor;s.color.fromArray(e),s.opacity=e[3]}void 0!==i.baseColorTexture&&l.push(r.assignTexture(s,"map",i.baseColorTexture,3001)),s.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,s.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(l.push(r.assignTexture(s,"metalnessMap",i.metallicRoughnessTexture)),l.push(r.assignTexture(s,"roughnessMap",i.metallicRoughnessTexture))),t=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,s)})))}!0===a.doubleSided&&(s.side=I.DoubleSide);let c=a.alphaMode||tP.OPAQUE;if(c===tP.BLEND?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,c===tP.MASK&&(s.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&t!==I.MeshBasicMaterial&&(l.push(r.assignTexture(s,"normalMap",a.normalTexture)),s.normalScale=new I.Vector2(1,1),void 0!==a.normalTexture.scale)){let e=a.normalTexture.scale;s.normalScale.set(e,e)}return void 0!==a.occlusionTexture&&t!==I.MeshBasicMaterial&&(l.push(r.assignTexture(s,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(s.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&t!==I.MeshBasicMaterial&&(s.emissive=new I.Color().fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&t!==I.MeshBasicMaterial&&l.push(r.assignTexture(s,"emissiveMap",a.emissiveTexture,3001)),Promise.all(l).then(function(){let i=new t(s);return a.name&&(i.name=a.name),tN(i,a),r.associations.set(i,{materials:e}),a.extensions&&tD(n,i,a),i})}createUniqueName(e){let t=I.PropertyBinding.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){let t=this,r=this.extensions,i=this.primitiveCache,n=[];for(let a=0,s=e.length;a<s;a++){let s=e[a],o=function(e){let t;let r=e.extensions&&e.extensions[e7.KHR_DRACO_MESH_COMPRESSION];if(t=r?"draco:"+r.bufferView+":"+r.indices+":"+tO(r.attributes):e.indices+":"+tO(e.attributes)+":"+e.mode,void 0!==e.targets)for(let r=0,i=e.targets.length;r<i;r++)t+=":"+tO(e.targets[r]);return t}(s),l=i[o];if(l)n.push(l.promise);else{let e;e=s.extensions&&s.extensions[e7.KHR_DRACO_MESH_COMPRESSION]?function(e){return r[e7.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(r){return tG(r,e,t)})}(s):tG(new I.BufferGeometry,s,t),i[o]={primitive:s,promise:e},n.push(e)}}return Promise.all(n)}loadMesh(e){let t=this,r=this.json,i=this.extensions,n=r.meshes[e],a=n.primitives,s=[];for(let e=0,t=a.length;e<t;e++){var o;let t=void 0===a[e].material?(void 0===(o=this.cache).DefaultMaterial&&(o.DefaultMaterial=new I.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:I.FrontSide})),o.DefaultMaterial):this.getDependency("material",a[e].material);s.push(t)}return s.push(t.loadGeometries(a)),Promise.all(s).then(function(r){let s=r.slice(0,r.length-1),o=r[r.length-1],l=[];for(let r=0,c=o.length;r<c;r++){let c;let u=o[r],h=a[r],d=s[r];if(h.mode===tx.TRIANGLES||h.mode===tx.TRIANGLE_STRIP||h.mode===tx.TRIANGLE_FAN||void 0===h.mode)!0===(c=!0===n.isSkinnedMesh?new I.SkinnedMesh(u,d):new I.Mesh(u,d)).isSkinnedMesh&&c.normalizeSkinWeights(),h.mode===tx.TRIANGLE_STRIP?c.geometry=N(c.geometry,I.TriangleStripDrawMode):h.mode===tx.TRIANGLE_FAN&&(c.geometry=N(c.geometry,I.TriangleFanDrawMode));else if(h.mode===tx.LINES)c=new I.LineSegments(u,d);else if(h.mode===tx.LINE_STRIP)c=new I.Line(u,d);else if(h.mode===tx.LINE_LOOP)c=new I.LineLoop(u,d);else if(h.mode===tx.POINTS)c=new I.Points(u,d);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);Object.keys(c.geometry.morphAttributes).length>0&&function(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let r=0,i=t.weights.length;r<i;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){let r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(let t=0,i=r.length;t<i;t++)e.morphTargetDictionary[r[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(c,n),c.name=t.createUniqueName(n.name||"mesh_"+e),tN(c,n),h.extensions&&tD(i,c,h),t.assignFinalMaterial(c),l.push(c)}for(let r=0,i=l.length;r<i;r++)t.associations.set(l[r],{meshes:e,primitives:r});if(1===l.length)return n.extensions&&tD(i,l[0],n),l[0];let c=new I.Group;n.extensions&&tD(i,c,n),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c})}loadCamera(e){let t;let r=this.json.cameras[e],i=r[r.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return"perspective"===r.type?t=new I.PerspectiveCamera(I.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===r.type&&(t=new I.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),tN(t,r),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],r=[];for(let e=0,i=t.joints.length;e<i;e++)r.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?r.push(this.getDependency("accessor",t.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(e){let r=e.pop(),i=[],n=[];for(let a=0,s=e.length;a<s;a++){let s=e[a];if(s){i.push(s);let e=new I.Matrix4;null!==r&&e.fromArray(r.array,16*a),n.push(e)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[a])}return new I.Skeleton(i,n)})}loadAnimation(e){let t=this.json.animations[e],r=t.name?t.name:"animation_"+e,i=[],n=[],a=[],s=[],o=[];for(let e=0,r=t.channels.length;e<r;e++){let r=t.channels[e],l=t.samplers[r.sampler],c=r.target,u=c.node,h=void 0!==t.parameters?t.parameters[l.input]:l.input,d=void 0!==t.parameters?t.parameters[l.output]:l.output;void 0!==c.node&&(i.push(this.getDependency("node",u)),n.push(this.getDependency("accessor",h)),a.push(this.getDependency("accessor",d)),s.push(l),o.push(c))}return Promise.all([Promise.all(i),Promise.all(n),Promise.all(a),Promise.all(s),Promise.all(o)]).then(function(e){let t=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=[];for(let e=0,r=t.length;e<r;e++){let r;let l=t[e],c=i[e],u=n[e],h=a[e],d=s[e];if(void 0===l)continue;switch(l.updateMatrix(),t_[d.path]){case t_.weights:r=I.NumberKeyframeTrack;break;case t_.rotation:r=I.QuaternionKeyframeTrack;break;case t_.position:case t_.scale:default:r=I.VectorKeyframeTrack}let f=l.name?l.name:l.uuid,p=void 0!==h.interpolation?tF[h.interpolation]:I.InterpolateLinear,m=[];t_[d.path]===t_.weights?l.traverse(function(e){e.morphTargetInfluences&&m.push(e.name?e.name:e.uuid)}):m.push(f);let A=u.array;if(u.normalized){let e=tL(A.constructor),t=new Float32Array(A.length);for(let r=0,i=A.length;r<i;r++)t[r]=A[r]*e;A=t}for(let e=0,t=m.length;e<t;e++){let t=new r(m[e]+"."+t_[d.path],c.array,A,p);"CUBICSPLINE"===h.interpolation&&(t.createInterpolant=function(e){return new(this instanceof I.QuaternionKeyframeTrack?tR:tE)(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),o.push(t)}}return new I.AnimationClip(r,void 0,o)})}createNodeMesh(e){let t=this.json,r=this,i=t.nodes[e];return void 0===i.mesh?null:r.getDependency("mesh",i.mesh).then(function(e){let t=r._getNodeRef(r.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,r=i.weights.length;t<r;t++)e.morphTargetInfluences[t]=i.weights[t]}),t})}loadNode(e){let t=this.json.nodes[e],r=this._loadNodeShallow(e),i=[],n=t.children||[];for(let e=0,t=n.length;e<t;e++)i.push(this.getDependency("node",n[e]));let a=void 0===t.skin?Promise.resolve(null):this.getDependency("skin",t.skin);return Promise.all([r,Promise.all(i),a]).then(function(e){let t=e[0],r=e[1],i=e[2];null!==i&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(i,tU)});for(let e=0,i=r.length;e<i;e++)t.add(r[e]);return t})}_loadNodeShallow(e){let t=this.json,r=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];let n=t.nodes[e],a=n.name?i.createUniqueName(n.name):"",s=[],o=i._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return o&&s.push(o),void 0!==n.camera&&s.push(i.getDependency("camera",n.camera).then(function(e){return i._getNodeRef(i.cameraCache,n.camera,e)})),i._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){s.push(e)}),this.nodeCache[e]=Promise.all(s).then(function(t){let s;if((s=!0===n.isBone?new I.Bone:t.length>1?new I.Group:1===t.length?t[0]:new I.Object3D)!==t[0])for(let e=0,r=t.length;e<r;e++)s.add(t[e]);if(n.name&&(s.userData.name=n.name,s.name=a),tN(s,n),n.extensions&&tD(r,s,n),void 0!==n.matrix){let e=new I.Matrix4;e.fromArray(n.matrix),s.applyMatrix4(e)}else void 0!==n.translation&&s.position.fromArray(n.translation),void 0!==n.rotation&&s.quaternion.fromArray(n.rotation),void 0!==n.scale&&s.scale.fromArray(n.scale);return i.associations.has(s)||i.associations.set(s,{}),i.associations.get(s).nodes=e,s}),this.nodeCache[e]}loadScene(e){let t=this.extensions,r=this.json.scenes[e],i=this,n=new I.Group;r.name&&(n.name=i.createUniqueName(r.name)),tN(n,r),r.extensions&&tD(t,n,r);let a=r.nodes||[],s=[];for(let e=0,t=a.length;e<t;e++)s.push(i.getDependency("node",a[e]));return Promise.all(s).then(function(e){for(let t=0,r=e.length;t<r;t++)n.add(e[t]);return i.associations=(e=>{let t=new Map;for(let[e,r]of i.associations)(e instanceof I.Material||e instanceof I.Texture)&&t.set(e,r);return e.traverse(e=>{let r=i.associations.get(e);null!=r&&t.set(e,r)}),t})(n),n})}constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new e6,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,i=!1,n=-1;"undefined"!=typeof navigator&&void 0!==navigator.userAgent&&(r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=(i=navigator.userAgent.indexOf("Firefox")>-1)?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||r||i&&n<98?this.textureLoader=new I.TextureLoader(this.options.manager):this.textureLoader=new I.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new I.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}}function tG(e,t,r){let i=t.attributes,n=[];for(let t in i){let a=tw[t]||t.toLowerCase();a in e.attributes||n.push(function(t,i){return r.getDependency("accessor",t).then(function(t){e.setAttribute(i,t)})}(i[t],a))}if(void 0!==t.indices&&!e.index){let i=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});n.push(i)}return tN(e,t),!function(e,t,r){let i=t.attributes,n=new I.Box3;if(void 0===i.POSITION)return;{let e=r.json.accessors[i.POSITION],t=e.min,a=e.max;if(void 0!==t&&void 0!==a){if(n.set(new I.Vector3(t[0],t[1],t[2]),new I.Vector3(a[0],a[1],a[2])),e.normalized){let t=tL(tM[e.componentType]);n.min.multiplyScalar(t),n.max.multiplyScalar(t)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}let a=t.targets;if(void 0!==a){let e=new I.Vector3,t=new I.Vector3;for(let i=0,n=a.length;i<n;i++){let n=a[i];if(void 0!==n.POSITION){let i=r.json.accessors[n.POSITION],a=i.min,s=i.max;if(void 0!==a&&void 0!==s){if(t.setX(Math.max(Math.abs(a[0]),Math.abs(s[0]))),t.setY(Math.max(Math.abs(a[1]),Math.abs(s[1]))),t.setZ(Math.max(Math.abs(a[2]),Math.abs(s[2]))),i.normalized){let e=tL(tM[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(e)}e.boundingBox=n;let s=new I.Sphere;n.getCenter(s.center),s.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=s}(e,t,r),Promise.all(n).then(function(){return void 0!==t.targets?function(e,t,r){let i=!1,n=!1,a=!1;for(let e=0,r=t.length;e<r;e++){let r=t[e];if(void 0!==r.POSITION&&(i=!0),void 0!==r.NORMAL&&(n=!0),void 0!==r.COLOR_0&&(a=!0),i&&n&&a)break}if(!i&&!n&&!a)return Promise.resolve(e);let s=[],o=[],l=[];for(let c=0,u=t.length;c<u;c++){let u=t[c];if(i){let t=void 0!==u.POSITION?r.getDependency("accessor",u.POSITION):e.attributes.position;s.push(t)}if(n){let t=void 0!==u.NORMAL?r.getDependency("accessor",u.NORMAL):e.attributes.normal;o.push(t)}if(a){let t=void 0!==u.COLOR_0?r.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(l)]).then(function(t){let r=t[0],s=t[1],o=t[2];return i&&(e.morphAttributes.position=r),n&&(e.morphAttributes.normal=s),a&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e})}(e,t.targets,r):e})}let tH=class{static createButton(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=document.createElement("button");function i(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return i(r),r.id="VRButton",r.style.display="none",navigator.xr.isSessionSupported("immersive-vr").then(i=>{i?function(){let i=null;async function n(t){t.addEventListener("end",a),await e.xr.setSession(t),r.textContent="EXIT VR",i=t}function a(){i.removeEventListener("end",a),r.textContent="ENTER VR",i=null}r.style.display="",r.style.cursor="pointer",r.style.left="calc(50% - 50px)",r.style.width="100px",r.textContent="ENTER VR",r.onmouseenter=()=>{r.style.opacity="1.0"},r.onmouseleave=()=>{r.style.opacity="0.5"},r.onclick=()=>{var e;if(null===i){let r=[t.optionalFeatures,"local-floor","bounded-floor","hand-tracking"].flat().filter(Boolean);null==(e=navigator.xr)||e.requestSession("immersive-vr",{...t,optionalFeatures:r}).then(n)}else i.end()}}():(r.style.display="",r.style.cursor="auto",r.style.left="calc(50% - 75px)",r.style.width="150px",r.onmouseenter=null,r.onmouseleave=null,r.onclick=null,r.textContent="VR NOT SUPPORTED"),i&&tH.xrSessionIsGranted&&r.click()}),r;{let e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",i(e),e}}static registerSessionGrantedListener(){"xr"in navigator&&navigator.xr.addEventListener("sessiongranted",()=>{tH.xrSessionIsGranted=!0})}};D(tH,"xrSessionIsGranted",!1);let tV=new I.Matrix4;class tJ{setFromProjectionMatrix(e,t){let r=0===e.elements[11];return tV.copy(e).invert(),this.vertices.near[0].set(1,1,-1),this.vertices.near[1].set(1,-1,-1),this.vertices.near[2].set(-1,-1,-1),this.vertices.near[3].set(-1,1,-1),this.vertices.near.forEach(function(e){e.applyMatrix4(tV)}),this.vertices.far[0].set(1,1,1),this.vertices.far[1].set(1,-1,1),this.vertices.far[2].set(-1,-1,1),this.vertices.far[3].set(-1,1,1),this.vertices.far.forEach(function(e){e.applyMatrix4(tV);let i=Math.abs(e.z);r?e.z*=Math.min(t/i,1):e.multiplyScalar(Math.min(t/i,1))}),this.vertices}split(e,t){for(;e.length>t.length;)t.push(new tJ);t.length=e.length;for(let r=0;r<e.length;r++){let i=t[r];if(0===r)for(let e=0;e<4;e++)i.vertices.near[e].copy(this.vertices.near[e]);else for(let t=0;t<4;t++)i.vertices.near[t].lerpVectors(this.vertices.near[t],this.vertices.far[t],e[r-1]);if(r===e.length-1)for(let e=0;e<4;e++)i.vertices.far[e].copy(this.vertices.far[e]);else for(let t=0;t<4;t++)i.vertices.far[t].lerpVectors(this.vertices.near[t],this.vertices.far[t],e[r])}}toSpace(e,t){for(let r=0;r<4;r++)t.vertices.near[r].copy(this.vertices.near[r]).applyMatrix4(e),t.vertices.far[r].copy(this.vertices.far[r]).applyMatrix4(e)}constructor(e){e=e||{},this.vertices={near:[new I.Vector3,new I.Vector3,new I.Vector3,new I.Vector3],far:[new I.Vector3,new I.Vector3,new I.Vector3,new I.Vector3]},void 0!==e.projectionMatrix&&this.setFromProjectionMatrix(e.projectionMatrix,e.maxFar||1e4)}}class tK{generateShapes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2?arguments[2]:void 0,i=[],n={letterSpacing:0,lineHeight:1,...r},a=function(e,t,r,i){let n=Array.from(e),a=t/r.resolution,s=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*a,o=[],l=0,c=0;for(let e=0;e<n.length;e++){let t=n[e];if("\n"===t)l=0,c-=s*i.lineHeight;else{let e=function(e,t,r,i,n){let a,s,o,l,c,u,h,d;let f=n.glyphs[e]||n.glyphs["?"];if(!f){console.error('THREE.Font: character "'+e+'" does not exists in font family '+n.familyName+".");return}let p=new I.ShapePath;if(f.o){let e=f._cachedOutline||(f._cachedOutline=f.o.split(" "));for(let n=0,f=e.length;n<f;)switch(e[n++]){case"m":a=parseInt(e[n++])*t+r,s=parseInt(e[n++])*t+i,p.moveTo(a,s);break;case"l":a=parseInt(e[n++])*t+r,s=parseInt(e[n++])*t+i,p.lineTo(a,s);break;case"q":o=parseInt(e[n++])*t+r,l=parseInt(e[n++])*t+i,c=parseInt(e[n++])*t+r,u=parseInt(e[n++])*t+i,p.quadraticCurveTo(c,u,o,l);break;case"b":o=parseInt(e[n++])*t+r,l=parseInt(e[n++])*t+i,c=parseInt(e[n++])*t+r,u=parseInt(e[n++])*t+i,h=parseInt(e[n++])*t+r,d=parseInt(e[n++])*t+i,p.bezierCurveTo(c,u,h,d,o,l)}}return{offsetX:f.ha*t,path:p}}(t,a,l,c,r);e&&(l+=e.offsetX+i.letterSpacing,o.push(e.path))}}return o}(e,t,this.data,n);for(let e=0,t=a.length;e<t;e++)Array.prototype.push.apply(i,a[e].toShapes(!1));return i}constructor(e){D(this,"data"),this.data=e}}D(tK,"isFont"),D(tK,"type");class tj extends I.Texture{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=I.NearestFilter,this.minFilter=I.NearestFilter,this.wrapR=I.ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}var tW="object"==typeof global&&global&&global.Object===Object&&global,tz="object"==typeof self&&self&&self.Object===Object&&self,tQ=tW||tz||Function("return this")(),tX=tQ.Symbol,tY=Object.prototype,tZ=tY.hasOwnProperty,tq=tY.toString,t$=tX?tX.toStringTag:void 0,t1=Object.prototype.toString,t0=tX?tX.toStringTag:void 0;function t2(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":t0&&t0 in Object(e)?function(e){var t=tZ.call(e,t$),r=e[t$];try{e[t$]=void 0;var i=!0}catch(e){}var n=tq.call(e);return i&&(t?e[t$]=r:delete e[t$]),n}(e):t1.call(e)}function t9(e){return null!=e&&"object"==typeof e}function t3(e){return"symbol"==typeof e||t9(e)&&"[object Symbol]"==t2(e)}function t4(e,t){for(var r=-1,i=null==e?0:e.length,n=Array(i);++r<i;)n[r]=t(e[r],r,e);return n}var t8=Array.isArray,t5=1/0,t6=tX?tX.prototype:void 0,t7=t6?t6.toString:void 0,re=/\s/,rt=/^\s+/;function rr(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var ri=0/0,rn=/^[-+]0x[0-9a-f]+$/i,ra=/^0b[01]+$/i,rs=/^0o[0-7]+$/i,ro=parseInt,rl=1/0;function rc(e){var t,r=(t=e)?(t=function(e){if("number"==typeof e)return e;if(t3(e))return ri;if(rr(e)){var t,r="function"==typeof e.valueOf?e.valueOf():e;e=rr(r)?r+"":r}if("string"!=typeof e)return 0===e?e:+e;e=(t=e)?t.slice(0,function(e){for(var t=e.length;t--&&re.test(e.charAt(t)););return t}(t)+1).replace(rt,""):t;var i=ra.test(e);return i||rs.test(e)?ro(e.slice(2),i?2:8):rn.test(e)?ri:+e}(t))===rl||t===-rl?(t<0?-1:1)*17976931348623157e292:t==t?t:0:0===t?t:0,i=r%1;return r==r?i?r-i:r:0}function ru(e){return e}function rh(e){if(!rr(e))return!1;var t=t2(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}var rd=tQ["__core-js_shared__"],rf=(u=/[^.]+$/.exec(rd&&rd.keys&&rd.keys.IE_PROTO||""))?"Symbol(src)_1."+u:"",rp=Function.prototype.toString;function rm(e){if(null!=e){try{return rp.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var rA=/^\[object .+?Constructor\]$/,rg=Object.prototype,rv=Function.prototype.toString,rT=rg.hasOwnProperty,rC=RegExp("^"+rv.call(rT).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ry(e,t){var r=null==e?void 0:e[t];return rr(r)&&(!rf||!(rf in r))&&(rh(r)?rC:rA).test(rm(r))?r:void 0}var rE=ry(tQ,"WeakMap"),rB=Object.create,rR=function(){function e(){}return function(t){if(!rr(t))return{};if(rB)return rB(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();function rx(){}var rM=Date.now,rS=function(){try{var e=ry(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),rb=(h=rS?function(e,t){return rS(e,"toString",{configurable:!0,enumerable:!1,value:function(){return t},writable:!0})}:ru,d=0,f=0,function(){var e=rM(),t=16-(e-f);if(f=e,t>0){if(++d>=800)return arguments[0]}else d=0;return h.apply(void 0,arguments)});function rI(e,t){for(var r=-1,i=null==e?0:e.length;++r<i&&!1!==t(e[r],r,e););return e}function rw(e,t,r,i){for(var n=e.length,a=r+(i?1:-1);i?a--:++a<n;)if(t(e[a],a,e))return a;return -1}function r_(e){return e!=e}function rF(e,t,r){return t==t?function(e,t,r){for(var i=r-1,n=e.length;++i<n;)if(e[i]===t)return i;return -1}(e,t,r):rw(e,r_,r)}function rP(e,t){return!!(null==e?0:e.length)&&rF(e,t,0)>-1}var rD=/^(?:0|[1-9]\d*)$/;function rN(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&rD.test(e))&&e>-1&&e%1==0&&e<t}function rO(e,t,r){"__proto__"==t&&rS?rS(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function rL(e,t){return e===t||e!=e&&t!=t}var rU=Object.prototype.hasOwnProperty;function rk(e,t,r){var i=e[t];rU.call(e,t)&&rL(i,r)&&(void 0!==r||t in e)||rO(e,t,r)}function rG(e,t,r,i){var n=!r;r||(r={});for(var a=-1,s=t.length;++a<s;){var o=t[a],l=i?i(r[o],e[o],o,r,e):void 0;void 0===l&&(l=e[o]),n?rO(r,o,l):rk(r,o,l)}return r}var rH=Math.max;function rV(e,t){var r;return rb((r=rH(void 0===(r=t)?e.length-1:r,0),function(){for(var t=arguments,i=-1,n=rH(t.length-r,0),a=Array(n);++i<n;)a[i]=t[r+i];i=-1;for(var s=Array(r+1);++i<r;)s[i]=t[i];return s[r]=ru(a),function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}(e,this,s)}),e+"")}function rJ(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function rK(e){return null!=e&&rJ(e.length)&&!rh(e)}function rj(e,t,r){if(!rr(r))return!1;var i=typeof t;return("number"==i?!!(rK(r)&&rN(t,r.length)):"string"==i&&t in r)&&rL(r[t],e)}var rW=Object.prototype;function rz(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||rW)}function rQ(e){return t9(e)&&"[object Arguments]"==t2(e)}var rX=Object.prototype,rY=rX.hasOwnProperty,rZ=rX.propertyIsEnumerable,rq=rQ(function(){return arguments}())?rQ:function(e){return t9(e)&&rY.call(e,"callee")&&!rZ.call(e,"callee")},r$="object"==typeof exports&&exports&&!exports.nodeType&&exports,r1=r$&&"object"==typeof module&&module&&!module.nodeType&&module,r0=r1&&r1.exports===r$?tQ.Buffer:void 0;let r2=(r0?r0.isBuffer:void 0)||function(){return!1};var r9={};function r3(e){return function(t){return e(t)}}r9["[object Float32Array]"]=r9["[object Float64Array]"]=r9["[object Int8Array]"]=r9["[object Int16Array]"]=r9["[object Int32Array]"]=r9["[object Uint8Array]"]=r9["[object Uint8ClampedArray]"]=r9["[object Uint16Array]"]=r9["[object Uint32Array]"]=!0,r9["[object Arguments]"]=r9["[object Array]"]=r9["[object ArrayBuffer]"]=r9["[object Boolean]"]=r9["[object DataView]"]=r9["[object Date]"]=r9["[object Error]"]=r9["[object Function]"]=r9["[object Map]"]=r9["[object Number]"]=r9["[object Object]"]=r9["[object RegExp]"]=r9["[object Set]"]=r9["[object String]"]=r9["[object WeakMap]"]=!1;var r4="object"==typeof exports&&exports&&!exports.nodeType&&exports,r8=r4&&"object"==typeof module&&module&&!module.nodeType&&module,r5=r8&&r8.exports===r4&&tW.process,r6=function(){try{var e=r8&&r8.require&&r8.require("util").types;if(e)return e;return r5&&r5.binding&&r5.binding("util")}catch(e){}}(),r7=r6&&r6.isTypedArray,ie=r7?r3(r7):function(e){return t9(e)&&rJ(e.length)&&!!r9[t2(e)]},it=Object.prototype.hasOwnProperty;function ir(e,t){var r=t8(e),i=!r&&rq(e),n=!r&&!i&&r2(e),a=!r&&!i&&!n&&ie(e),s=r||i||n||a,o=s?function(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}(e.length,String):[],l=o.length;for(var c in e)(t||it.call(e,c))&&!(s&&("length"==c||n&&("offset"==c||"parent"==c)||a&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||rN(c,l)))&&o.push(c);return o}function ii(e,t){return function(r){return e(t(r))}}var ia=ii(Object.keys,Object),is=Object.prototype.hasOwnProperty;function io(e){if(!rz(e))return ia(e);var t=[];for(var r in Object(e))is.call(e,r)&&"constructor"!=r&&t.push(r);return t}function il(e){return rK(e)?ir(e):io(e)}var ic=Object.prototype.hasOwnProperty,iu=(p=function(e,t){if(rz(t)||rK(t)){rG(t,il(t),e);return}for(var r in t)ic.call(t,r)&&rk(e,r,t[r])},rV(function(e,t){var r=-1,i=t.length,n=i>1?t[i-1]:void 0,a=i>2?t[2]:void 0;for(n=p.length>3&&"function"==typeof n?(i--,n):void 0,a&&rj(t[0],t[1],a)&&(n=i<3?void 0:n,i=1),e=Object(e);++r<i;){var s=t[r];s&&p(e,s,r,n)}return e})),ih=Object.prototype.hasOwnProperty;function id(e){return rK(e)?ir(e,!0):function(e){if(!rr(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=rz(e),r=[];for(var i in e)"constructor"==i&&(t||!ih.call(e,i))||r.push(i);return r}(e)}var ip=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,im=/^\w*$/;function iA(e,t){if(t8(e))return!1;var r=typeof e;return!!("number"==r||"symbol"==r||"boolean"==r||null==e||t3(e))||im.test(e)||!ip.test(e)||null!=t&&e in Object(t)}var ig=ry(Object,"create"),iv=Object.prototype.hasOwnProperty,iT=Object.prototype.hasOwnProperty;function iC(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function iy(e,t){for(var r=e.length;r--;)if(rL(e[r][0],t))return r;return -1}iC.prototype.clear=function(){this.__data__=ig?ig(null):{},this.size=0},iC.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},iC.prototype.get=function(e){var t=this.__data__;if(ig){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return iv.call(t,e)?t[e]:void 0},iC.prototype.has=function(e){var t=this.__data__;return ig?void 0!==t[e]:iT.call(t,e)},iC.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=ig&&void 0===t?"__lodash_hash_undefined__":t,this};var iE=Array.prototype.splice;function iB(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}iB.prototype.clear=function(){this.__data__=[],this.size=0},iB.prototype.delete=function(e){var t=this.__data__,r=iy(t,e);return!(r<0)&&(r==t.length-1?t.pop():iE.call(t,r,1),--this.size,!0)},iB.prototype.get=function(e){var t=this.__data__,r=iy(t,e);return r<0?void 0:t[r][1]},iB.prototype.has=function(e){return iy(this.__data__,e)>-1},iB.prototype.set=function(e,t){var r=this.__data__,i=iy(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this};var iR=ry(tQ,"Map");function ix(e,t){var r,i=e.__data__;return("string"==(r=typeof t)||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t)?i["string"==typeof t?"string":"hash"]:i.map}function iM(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function iS(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw TypeError("Expected a function");var r=function(){var i=arguments,n=t?t.apply(this,i):i[0],a=r.cache;if(a.has(n))return a.get(n);var s=e.apply(this,i);return r.cache=a.set(n,s)||a,s};return r.cache=new(iS.Cache||iM),r}iM.prototype.clear=function(){this.size=0,this.__data__={hash:new iC,map:new(iR||iB),string:new iC}},iM.prototype.delete=function(e){var t=ix(this,e).delete(e);return this.size-=t?1:0,t},iM.prototype.get=function(e){return ix(this,e).get(e)},iM.prototype.has=function(e){return ix(this,e).has(e)},iM.prototype.set=function(e,t){var r=ix(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this},iS.Cache=iM;var ib=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,iI=/\\(\\)?/g,iw=(A=(m=iS(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ib,function(e,r,i,n){t.push(i?n.replace(iI,"$1"):r||e)}),t},function(e){return 500===A.size&&A.clear(),e})).cache,m);function i_(e,t){return t8(e)?e:iA(e,t)?[e]:iw(null==e?"":function e(t){if("string"==typeof t)return t;if(t8(t))return t4(t,e)+"";if(t3(t))return t7?t7.call(t):"";var r=t+"";return"0"==r&&1/t==-t5?"-0":r}(e))}var iF=1/0;function iP(e){if("string"==typeof e||t3(e))return e;var t=e+"";return"0"==t&&1/e==-iF?"-0":t}function iD(e,t){t=i_(t,e);for(var r=0,i=t.length;null!=e&&r<i;)e=e[iP(t[r++])];return r&&r==i?e:void 0}function iN(e,t){for(var r=-1,i=t.length,n=e.length;++r<i;)e[n+r]=t[r];return e}var iO=tX?tX.isConcatSpreadable:void 0;function iL(e){return t8(e)||rq(e)||!!(iO&&e&&e[iO])}function iU(e,t,r,i,n){var a=-1,s=e.length;for(r||(r=iL),n||(n=[]);++a<s;){var o=e[a];t>0&&r(o)?t>1?iU(o,t-1,r,i,n):iN(n,o):i||(n[n.length]=o)}return n}function ik(e){return(null==e?0:e.length)?iU(e,1):[]}var iG=ii(Object.getPrototypeOf,Object);function iH(e,t,r){var i=-1,n=e.length;t<0&&(t=-t>n?0:n+t),(r=r>n?n:r)<0&&(r+=n),n=t>r?0:r-t>>>0,t>>>=0;for(var a=Array(n);++i<n;)a[i]=e[i+t];return a}function iV(e,t,r,i){var n=-1,a=null==e?0:e.length;for(i&&a&&(r=e[++n]);++n<a;)r=t(r,e[n],n,e);return r}function iJ(e){var t=this.__data__=new iB(e);this.size=t.size}iJ.prototype.clear=function(){this.__data__=new iB,this.size=0},iJ.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},iJ.prototype.get=function(e){return this.__data__.get(e)},iJ.prototype.has=function(e){return this.__data__.has(e)},iJ.prototype.set=function(e,t){var r=this.__data__;if(r instanceof iB){var i=r.__data__;if(!iR||i.length<199)return i.push([e,t]),this.size=++r.size,this;r=this.__data__=new iM(i)}return r.set(e,t),this.size=r.size,this};var iK="object"==typeof exports&&exports&&!exports.nodeType&&exports,ij=iK&&"object"==typeof module&&module&&!module.nodeType&&module,iW=ij&&ij.exports===iK?tQ.Buffer:void 0,iz=iW?iW.allocUnsafe:void 0;function iQ(e,t){for(var r=-1,i=null==e?0:e.length,n=0,a=[];++r<i;){var s=e[r];t(s,r,e)&&(a[n++]=s)}return a}function iX(){return[]}var iY=Object.prototype.propertyIsEnumerable,iZ=Object.getOwnPropertySymbols,iq=iZ?function(e){return null==e?[]:iQ(iZ(e=Object(e)),function(t){return iY.call(e,t)})}:iX,i$=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)iN(t,iq(e)),e=iG(e);return t}:iX;function i1(e,t,r){var i=t(e);return t8(e)?i:iN(i,r(e))}function i0(e){return i1(e,il,iq)}function i2(e){return i1(e,id,i$)}var i9=ry(tQ,"DataView"),i3=ry(tQ,"Promise"),i4=ry(tQ,"Set"),i8="[object Map]",i5="[object Promise]",i6="[object Set]",i7="[object WeakMap]",ne="[object DataView]",nt=rm(i9),nr=rm(iR),ni=rm(i3),nn=rm(i4),na=rm(rE),ns=t2;(i9&&ns(new i9(new ArrayBuffer(1)))!=ne||iR&&ns(new iR)!=i8||i3&&ns(i3.resolve())!=i5||i4&&ns(new i4)!=i6||rE&&ns(new rE)!=i7)&&(ns=function(e){var t=t2(e),r="[object Object]"==t?e.constructor:void 0,i=r?rm(r):"";if(i)switch(i){case nt:return ne;case nr:return i8;case ni:return i5;case nn:return i6;case na:return i7}return t});let no=ns;var nl=Object.prototype.hasOwnProperty,nc=tQ.Uint8Array;function nu(e){var t=new e.constructor(e.byteLength);return new nc(t).set(new nc(e)),t}var nh=/\w*$/,nd=tX?tX.prototype:void 0,nf=nd?nd.valueOf:void 0,np=r6&&r6.isMap,nm=np?r3(np):function(e){return t9(e)&&"[object Map]"==no(e)},nA=r6&&r6.isSet,ng=nA?r3(nA):function(e){return t9(e)&&"[object Set]"==no(e)},nv="[object Arguments]",nT="[object Function]",nC="[object Object]",ny={};function nE(e){return function e(t,r,i,n,a,s){var o,l=1&r,c=2&r,u=4&r;if(i&&(o=a?i(t,n,a,s):i(t)),void 0!==o)return o;if(!rr(t))return t;var h=t8(t);if(h){if(d=t.length,f=new t.constructor(d),d&&"string"==typeof t[0]&&nl.call(t,"index")&&(f.index=t.index,f.input=t.input),o=f,!l)return function(e,t){var r=-1,i=e.length;for(t||(t=Array(i));++r<i;)t[r]=e[r];return t}(t,o)}else{var d,f,p,m,A,g,v=no(t),T=v==nT||"[object GeneratorFunction]"==v;if(r2(t))return function(e,t){if(t)return e.slice();var r=e.length,i=iz?iz(r):new e.constructor(r);return e.copy(i),i}(t,l);if(v==nC||v==nv||T&&!a){if(o=c||T?{}:"function"!=typeof t.constructor||rz(t)?{}:rR(iG(t)),!l)return c?(m=(p=o)&&rG(t,id(t),p),rG(t,i$(t),m)):(g=(A=o)&&rG(t,il(t),A),rG(t,iq(t),g))}else{if(!ny[v])return a?t:{};o=function(e,t,r){var i,n,a,s=e.constructor;switch(t){case"[object ArrayBuffer]":return nu(e);case"[object Boolean]":case"[object Date]":return new s(+e);case"[object DataView]":return i=r?nu(e.buffer):e.buffer,new e.constructor(i,e.byteOffset,e.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return n=r?nu(e.buffer):e.buffer,new e.constructor(n,e.byteOffset,e.length);case"[object Map]":case"[object Set]":return new s;case"[object Number]":case"[object String]":return new s(e);case"[object RegExp]":return(a=new e.constructor(e.source,nh.exec(e))).lastIndex=e.lastIndex,a;case"[object Symbol]":return nf?Object(nf.call(e)):{}}}(t,v,l)}}s||(s=new iJ);var C=s.get(t);if(C)return C;s.set(t,o),ng(t)?t.forEach(function(n){o.add(e(n,r,i,n,t,s))}):nm(t)&&t.forEach(function(n,a){o.set(a,e(n,r,i,a,t,s))});var y=u?c?i2:i0:c?id:il,E=h?void 0:y(t);return rI(E||t,function(n,a){E&&(n=t[a=n]),rk(o,a,e(n,r,i,a,t,s))}),o}(e,4)}function nB(e){for(var t=-1,r=null==e?0:e.length,i=0,n=[];++t<r;){var a=e[t];a&&(n[i++]=a)}return n}function nR(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new iM;++t<r;)this.add(e[t])}function nx(e,t){for(var r=-1,i=null==e?0:e.length;++r<i;)if(t(e[r],r,e))return!0;return!1}function nM(e,t){return e.has(t)}function nS(e,t,r,i,n,a){var s=1&r,o=e.length,l=t.length;if(o!=l&&!(s&&l>o))return!1;var c=a.get(e),u=a.get(t);if(c&&u)return c==t&&u==e;var h=-1,d=!0,f=2&r?new nR:void 0;for(a.set(e,t),a.set(t,e);++h<o;){var p=e[h],m=t[h];if(i)var A=s?i(m,p,h,t,e,a):i(p,m,h,e,t,a);if(void 0!==A){if(A)continue;d=!1;break}if(f){if(!nx(t,function(e,t){if(!nM(f,t)&&(p===e||n(p,e,r,i,a)))return f.push(t)})){d=!1;break}}else if(!(p===m||n(p,m,r,i,a))){d=!1;break}}return a.delete(e),a.delete(t),d}function nb(e){var t=-1,r=Array(e.size);return e.forEach(function(e,i){r[++t]=[i,e]}),r}function nI(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}ny[nv]=ny["[object Array]"]=ny["[object ArrayBuffer]"]=ny["[object DataView]"]=ny["[object Boolean]"]=ny["[object Date]"]=ny["[object Float32Array]"]=ny["[object Float64Array]"]=ny["[object Int8Array]"]=ny["[object Int16Array]"]=ny["[object Int32Array]"]=ny["[object Map]"]=ny["[object Number]"]=ny[nC]=ny["[object RegExp]"]=ny["[object Set]"]=ny["[object String]"]=ny["[object Symbol]"]=ny["[object Uint8Array]"]=ny["[object Uint8ClampedArray]"]=ny["[object Uint16Array]"]=ny["[object Uint32Array]"]=!0,ny["[object Error]"]=ny[nT]=ny["[object WeakMap]"]=!1,nR.prototype.add=nR.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},nR.prototype.has=function(e){return this.__data__.has(e)};var nw=tX?tX.prototype:void 0,n_=nw?nw.valueOf:void 0,nF=Object.prototype.hasOwnProperty,nP="[object Arguments]",nD="[object Array]",nN="[object Object]",nO=Object.prototype.hasOwnProperty;function nL(e,t,r,i,n){return e===t||(null!=e&&null!=t&&(t9(e)||t9(t))?function(e,t,r,i,n,a){var s=t8(e),o=t8(t),l=s?nD:no(e),c=o?nD:no(t);l=l==nP?nN:l,c=c==nP?nN:c;var u=l==nN,h=c==nN,d=l==c;if(d&&r2(e)){if(!r2(t))return!1;s=!0,u=!1}if(d&&!u)return a||(a=new iJ),s||ie(e)?nS(e,t,r,i,n,a):function(e,t,r,i,n,a,s){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":if(e.byteLength!=t.byteLength||!a(new nc(e),new nc(t)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return rL(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var o=nb;case"[object Set]":var l=1&i;if(o||(o=nI),e.size!=t.size&&!l)break;var c=s.get(e);if(c)return c==t;i|=2,s.set(e,t);var u=nS(o(e),o(t),i,n,a,s);return s.delete(e),u;case"[object Symbol]":if(n_)return n_.call(e)==n_.call(t)}return!1}(e,t,l,r,i,n,a);if(!(1&r)){var f=u&&nO.call(e,"__wrapped__"),p=h&&nO.call(t,"__wrapped__");if(f||p){var m=f?e.value():e,A=p?t.value():t;return a||(a=new iJ),n(m,A,r,i,a)}}return!!d&&(a||(a=new iJ),function(e,t,r,i,n,a){var s=1&r,o=i0(e),l=o.length;if(l!=i0(t).length&&!s)return!1;for(var c=l;c--;){var u=o[c];if(!(s?u in t:nF.call(t,u)))return!1}var h=a.get(e),d=a.get(t);if(h&&d)return h==t&&d==e;var f=!0;a.set(e,t),a.set(t,e);for(var p=s;++c<l;){var m=e[u=o[c]],A=t[u];if(i)var g=s?i(A,m,u,t,e,a):i(m,A,u,e,t,a);if(!(void 0===g?m===A||n(m,A,r,i,a):g)){f=!1;break}p||(p="constructor"==u)}if(f&&!p){var v=e.constructor,T=t.constructor;v!=T&&"constructor"in e&&"constructor"in t&&!("function"==typeof v&&v instanceof v&&"function"==typeof T&&T instanceof T)&&(f=!1)}return a.delete(e),a.delete(t),f}(e,t,r,i,n,a))}(e,t,r,i,nL,n):e!=e&&t!=t)}function nU(e,t){return function(r){return null!=r&&r[e]===t&&(void 0!==t||e in Object(r))}}function nk(e,t){return null!=e&&t in Object(e)}function nG(e,t,r){t=i_(t,e);for(var i=-1,n=t.length,a=!1;++i<n;){var s=iP(t[i]);if(!(a=null!=e&&r(e,s)))break;e=e[s]}return a||++i!=n?a:!!(n=null==e?0:e.length)&&rJ(n)&&rN(s,n)&&(t8(e)||rq(e))}function nH(e){var t,r,i,n,a;return"function"==typeof e?e:null==e?ru:"object"==typeof e?t8(e)?(t=e[0],r=e[1],iA(t)&&(i=r)==i&&!rr(i)?nU(iP(t),r):function(e){var i,n=void 0===(i=null==e?void 0:iD(e,t))?void 0:i;return void 0===n&&n===r?null!=e&&nG(e,t,nk):nL(r,n,3)}):1==(n=function(e){for(var t=il(e),r=t.length;r--;){var i=t[r],n=e[i];t[r]=[i,n,n==n&&!rr(n)]}return t}(e)).length&&n[0][2]?nU(n[0][0],n[0][1]):function(t){return t===e||function(e,t,r,i){var n=r.length,a=n,s=!i;if(null==e)return!a;for(e=Object(e);n--;){var o=r[n];if(s&&o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++n<a;){var l=(o=r[n])[0],c=e[l],u=o[1];if(s&&o[2]){if(void 0===c&&!(l in e))return!1}else{var h=new iJ;if(i)var d=i(c,u,l,e,t,h);if(!(void 0===d?nL(u,c,3,i,h):d))return!1}}return!0}(t,e,n)}:iA(e)?(a=iP(e),function(e){return null==e?void 0:e[a]}):function(t){return iD(t,e)}}function nV(e,t,r,i){for(var n=-1,a=null==e?0:e.length;++n<a;){var s=e[n];t(i,s,r(s),e)}return i}let nJ=function(e,t,r){for(var i=-1,n=Object(e),a=r(e),s=a.length;s--;){var o=a[++i];if(!1===t(n[o],o,n))break}return e};var nK=function(e,t){if(null==e)return e;if(!rK(e))return e&&nJ(e,t,il);for(var r=e.length,i=g?r:-1,n=Object(e);(g?i--:++i<r)&&!1!==t(n[i],i,n););return e};function nj(e,t,r,i){return nK(e,function(e,n,a){t(i,e,r(e),a)}),i}var nW=Object.prototype,nz=nW.hasOwnProperty,nQ=rV(function(e,t){e=Object(e);var r=-1,i=t.length,n=i>2?t[2]:void 0;for(n&&rj(t[0],t[1],n)&&(i=1);++r<i;)for(var a=t[r],s=id(a),o=-1,l=s.length;++o<l;){var c=s[o],u=e[c];(void 0===u||rL(u,nW[c])&&!nz.call(e,c))&&(e[c]=a[c])}return e});function nX(e){return t9(e)&&rK(e)}function nY(e,t,r){for(var i=-1,n=null==e?0:e.length;++i<n;)if(r(t,e[i]))return!0;return!1}var nZ=rV(function(e,t){return nX(e)?function(e,t,r,i){var n=-1,a=rP,s=!0,o=e.length,l=[],c=t.length;if(!o)return l;r&&(t=t4(t,r3(r))),i?(a=nY,s=!1):t.length>=200&&(a=nM,s=!1,t=new nR(t));e:for(;++n<o;){var u=e[n],h=null==r?u:r(u);if(u=i||0!==u?u:0,s&&h==h){for(var d=c;d--;)if(t[d]===h)continue e;l.push(u)}else a(t,h,i)||l.push(u)}return l}(e,iU(t,1,nX,!0)):[]});function nq(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}function n$(e,t,r){var i=null==e?0:e.length;return i?iH(e,(t=r||void 0===t?1:rc(t))<0?0:t,i):[]}function n1(e,t,r){var i=null==e?0:e.length;return i?iH(e,0,(t=i-(t=r||void 0===t?1:rc(t)))<0?0:t):[]}function n0(e,t){return(t8(e)?rI:nK)(e,"function"==typeof t?t:ru)}function n2(e,t){for(var r=-1,i=null==e?0:e.length;++r<i;)if(!t(e[r],r,e))return!1;return!0}function n9(e,t){var r=!0;return nK(e,function(e,i,n){return r=!!t(e,i,n)}),r}function n3(e,t,r){var i=t8(e)?n2:n9;return r&&rj(e,t,r)&&(t=void 0),i(e,nH(t))}function n4(e,t){var r=[];return nK(e,function(e,i,n){t(e,i,n)&&r.push(e)}),r}function n8(e,t){return(t8(e)?iQ:n4)(e,nH(t))}var n5=Math.max,n6=(v=function(e,t,r){var i=null==e?0:e.length;if(!i)return -1;var n=null==r?0:rc(r);return n<0&&(n=n5(i+n,0)),rw(e,nH(t),n)},function(e,t,r){var i=Object(e);if(!rK(e)){var n=nH(t);e=il(e),t=function(e){return n(i[e],e,i)}}var a=v(e,t,r);return a>-1?i[n?e[a]:a]:void 0});function n7(e){return e&&e.length?e[0]:void 0}function ae(e,t){return(t8(e)?t4:function(e,t){var r=-1,i=rK(e)?Array(e.length):[];return nK(e,function(e,n,a){i[++r]=t(e,n,a)}),i})(e,nH(t))}function at(e,t){return iU(ae(e,t),1)}var ar=Object.prototype.hasOwnProperty,ai=(T=function(e,t,r){ar.call(e,r)?e[r].push(t):rO(e,r,[t])},function(e,t){var r=t8(e)?nV:nj,i=C?C():{};return r(e,T,nH(t),i)}),an=Object.prototype.hasOwnProperty;function aa(e,t){return null!=e&&an.call(e,t)}function as(e,t){return null!=e&&nG(e,t,aa)}function ao(e){return"string"==typeof e||!t8(e)&&t9(e)&&"[object String]"==t2(e)}function al(e){return null==e?[]:t4(il(e),function(t){return e[t]})}var ac=Math.max;function au(e,t,r,i){e=rK(e)?e:al(e),r=r&&!i?rc(r):0;var n=e.length;return r<0&&(r=ac(n+r,0)),ao(e)?r<=n&&e.indexOf(t,r)>-1:!!n&&rF(e,t,r)>-1}var ah=Math.max;function ad(e,t,r){var i=null==e?0:e.length;if(!i)return -1;var n=null==r?0:rc(r);return n<0&&(n=ah(i+n,0)),rF(e,t,n)}var af=Object.prototype.hasOwnProperty;function ap(e){if(null==e)return!0;if(rK(e)&&(t8(e)||"string"==typeof e||"function"==typeof e.splice||r2(e)||ie(e)||rq(e)))return!e.length;var t=no(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(rz(e))return!io(e).length;for(var r in e)if(af.call(e,r))return!1;return!0}var am=r6&&r6.isRegExp,aA=am?r3(am):function(e){return t9(e)&&"[object RegExp]"==t2(e)};function ag(e){return void 0===e}function av(e,t){if(null==e)return{};var r=t4(i2(e),function(e){return[e]});return t=nH(t),function(e,t,r){for(var i=-1,n=t.length,a={};++i<n;){var s=t[i],o=iD(e,s);r(o,s)&&function(e,t,r,i){if(rr(e)){t=i_(t,e);for(var n=-1,a=t.length,s=a-1,o=e;null!=o&&++n<a;){var l=iP(t[n]),c=r;if("__proto__"===l||"constructor"===l||"prototype"===l)break;if(n!=s){var u=o[l];void 0===(c=i?i(u,l,o):void 0)&&(c=rr(u)?u:rN(t[n+1])?[]:{})}rk(o,l,c),o=o[l]}}}(a,i_(s,e),o)}return a}(e,r,function(e,r){return t(e,r[0])})}function aT(e,t,r,i,n){return n(e,function(e,n,a){r=i?(i=!1,e):t(r,e,n,a)}),r}function aC(e,t,r){var i=t8(e)?iV:aT,n=arguments.length<3;return i(e,nH(t),r,n,nK)}function ay(e,t){return(t8(e)?iQ:n4)(e,function(e){if("function"!=typeof e)throw TypeError("Expected a function");return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}(nH(t)))}function aE(e,t){var r;return nK(e,function(e,i,n){return!(r=t(e,i,n))}),!!r}function aB(e,t,r){var i=t8(e)?nx:aE;return r&&rj(e,t,r)&&(t=void 0),i(e,nH(t))}var aR=i4&&1/nI(new i4([,-0]))[1]==1/0?function(e){return new i4(e)}:rx;function ax(e){return e&&e.length?function(e,t,r){var i=-1,n=rP,a=e.length,s=!0,o=[],l=o;if(r)s=!1,n=nY;else if(a>=200){var c=t?null:aR(e);if(c)return nI(c);s=!1,n=nM,l=new nR}else l=t?[]:o;e:for(;++i<a;){var u=e[i],h=t?t(u):u;if(u=r||0!==u?u:0,s&&h==h){for(var d=l.length;d--;)if(l[d]===h)continue e;t&&l.push(h),o.push(u)}else n(l,h,r)||(l!==o&&l.push(h),o.push(u))}return o}(e):[]}function aM(e){console&&console.error&&console.error("Error: ".concat(e))}function aS(e){console&&console.warn&&console.warn("Warning: ".concat(e))}function ab(e){let t=new Date().getTime(),r=e();return{time:new Date().getTime()-t,value:r}}function aI(e){function t(){}t.prototype=e;let r=new t;function i(){return typeof r.bar}return i(),i(),e}class aw{get definition(){return this._definition}set definition(e){this._definition=e}accept(e){e.visit(this),n0(this.definition,t=>{t.accept(e)})}constructor(e){this._definition=e}}class a_ extends aw{set definition(e){}get definition(){return void 0!==this.referencedRule?this.referencedRule.definition:[]}accept(e){e.visit(this)}constructor(e){super([]),this.idx=1,iu(this,av(e,e=>void 0!==e))}}class aF extends aw{constructor(e){super(e.definition),this.orgText="",iu(this,av(e,e=>void 0!==e))}}class aP extends aw{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,iu(this,av(e,e=>void 0!==e))}}class aD extends aw{constructor(e){super(e.definition),this.idx=1,iu(this,av(e,e=>void 0!==e))}}class aN extends aw{constructor(e){super(e.definition),this.idx=1,iu(this,av(e,e=>void 0!==e))}}class aO extends aw{constructor(e){super(e.definition),this.idx=1,iu(this,av(e,e=>void 0!==e))}}class aL extends aw{constructor(e){super(e.definition),this.idx=1,iu(this,av(e,e=>void 0!==e))}}class aU extends aw{constructor(e){super(e.definition),this.idx=1,iu(this,av(e,e=>void 0!==e))}}class ak extends aw{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,iu(this,av(e,e=>void 0!==e))}}class aG{accept(e){e.visit(this)}constructor(e){this.idx=1,iu(this,av(e,e=>void 0!==e))}}class aH{visit(e){switch(e.constructor){case a_:return this.visitNonTerminal(e);case aP:return this.visitAlternative(e);case aD:return this.visitOption(e);case aN:return this.visitRepetitionMandatory(e);case aO:return this.visitRepetitionMandatoryWithSeparator(e);case aU:return this.visitRepetitionWithSeparator(e);case aL:return this.visitRepetition(e);case ak:return this.visitAlternation(e);case aG:return this.visitTerminal(e);case aF:return this.visitRule(e);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function aV(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e instanceof aD||e instanceof aL||e instanceof aU||(e instanceof ak?aB(e.definition,e=>aV(e,t)):!(e instanceof a_&&au(t,e))&&e instanceof aw&&(e instanceof a_&&t.push(e),n3(e.definition,e=>aV(e,t))))}function aJ(e){if(e instanceof a_)return"SUBRULE";if(e instanceof aD)return"OPTION";if(e instanceof ak)return"OR";if(e instanceof aN)return"AT_LEAST_ONE";if(e instanceof aO)return"AT_LEAST_ONE_SEP";if(e instanceof aU)return"MANY_SEP";if(e instanceof aL)return"MANY";else if(e instanceof aG)return"CONSUME";else throw Error("non exhaustive match")}class aK{walk(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];n0(e.definition,(r,i)=>{let n=n$(e.definition,i+1);if(r instanceof a_)this.walkProdRef(r,n,t);else if(r instanceof aG)this.walkTerminal(r,n,t);else if(r instanceof aP)this.walkFlat(r,n,t);else if(r instanceof aD)this.walkOption(r,n,t);else if(r instanceof aN)this.walkAtLeastOne(r,n,t);else if(r instanceof aO)this.walkAtLeastOneSep(r,n,t);else if(r instanceof aU)this.walkManySep(r,n,t);else if(r instanceof aL)this.walkMany(r,n,t);else if(r instanceof ak)this.walkOr(r,n,t);else throw Error("non exhaustive match")})}walkTerminal(e,t,r){}walkProdRef(e,t,r){}walkFlat(e,t,r){let i=t.concat(r);this.walk(e,i)}walkOption(e,t,r){let i=t.concat(r);this.walk(e,i)}walkAtLeastOne(e,t,r){let i=[new aD({definition:e.definition})].concat(t,r);this.walk(e,i)}walkAtLeastOneSep(e,t,r){let i=aj(e,t,r);this.walk(e,i)}walkMany(e,t,r){let i=[new aD({definition:e.definition})].concat(t,r);this.walk(e,i)}walkManySep(e,t,r){let i=aj(e,t,r);this.walk(e,i)}walkOr(e,t,r){let i=t.concat(r);n0(e.definition,e=>{let t=new aP({definition:[e]});this.walk(t,i)})}}function aj(e,t,r){return[new aD({definition:[new aG({terminalType:e.separator})].concat(e.definition)})].concat(t,r)}function aW(e){if(e instanceof a_)return aW(e.referencedRule);if(e instanceof aG)return[e.terminalType];if(e instanceof aP||e instanceof aD||e instanceof aL||e instanceof aN||e instanceof aO||e instanceof aU||e instanceof aG||e instanceof aF)return function(e){let t,r=[],i=e.definition,n=0,a=i.length>n,s=!0;for(;a&&s;)s=aV(t=i[n]),r=r.concat(aW(t)),n+=1,a=i.length>n;return ax(r)}(e);if(e instanceof ak)return ax(ik(ae(e.definition,e=>aW(e))));throw Error("non exhaustive match")}let az="_~IN~_";class aQ extends aK{startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,t,r){}walkProdRef(e,t,r){var i,n;let a=(i=e.referencedRule,n=e.idx,i.name+n+az+this.topProd.name),s=aW(new aP({definition:t.concat(r)}));this.follows[a]=s}constructor(e){super(),this.topProd=e,this.follows={}}}function aX(e){return e.charCodeAt(0)}function aY(e,t){Array.isArray(e)?e.forEach(function(e){t.push(e)}):t.push(e)}function aZ(e,t){if(!0===e[t])throw"duplicate flag "+t;e[t],e[t]=!0}function aq(e){if(void 0===e)throw Error("Internal Error - Should never get here!");return!0}function a$(e){return"Character"===e.type}let a1=[];for(let e=aX("0");e<=aX("9");e++)a1.push(e);let a0=[aX("_")].concat(a1);for(let e=aX("a");e<=aX("z");e++)a0.push(e);for(let e=aX("A");e<=aX("Z");e++)a0.push(e);let a2=[aX(" "),aX("\f"),aX("\n"),aX("\r"),aX("	"),aX("\v"),aX("	"),aX("\xa0"),aX(""),aX(""),aX(""),aX(""),aX(""),aX(""),aX(""),aX(""),aX(""),aX(""),aX(""),aX(""),aX("\u2028"),aX("\u2029"),aX(""),aX(""),aX(""),aX("\uFEFF")],a9=/[0-9a-fA-F]/,a3=/[0-9]/,a4=/[1-9]/;class a8{saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");let t=this.disjunction();this.consumeChar("/");let r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":aZ(r,"global");break;case"i":aZ(r,"ignoreCase");break;case"m":aZ(r,"multiLine");break;case"u":aZ(r,"unicode");break;case"y":aZ(r,"sticky")}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:t,loc:this.loc(0)}}disjunction(){let e=[],t=this.idx;for(e.push(this.alternative());"|"===this.peekChar();)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(t)}}alternative(){let e=[],t=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(t)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){let e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":let t;switch(this.consumeChar("?"),this.popChar()){case"=":t="Lookahead";break;case"!":t="NegativeLookahead"}aq(t);let r=this.disjunction();return this.consumeChar(")"),{type:t,value:r,loc:this.loc(e)}}return function(){throw Error("Internal Error - Should never get here!")}()}quantifier(){let e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this.idx;switch(this.popChar()){case"*":e={atLeast:0,atMost:1/0};break;case"+":e={atLeast:1,atMost:1/0};break;case"?":e={atLeast:0,atMost:1};break;case"{":let i=this.integerIncludingZero();switch(this.popChar()){case"}":e={atLeast:i,atMost:i};break;case",":e=this.isDigit()?{atLeast:i,atMost:this.integerIncludingZero()}:{atLeast:i,atMost:1/0},this.consumeChar("}")}if(!0===t&&void 0===e)return;aq(e)}if((!0!==t||void 0!==e)&&aq(e))return"?"===this.peekChar(0)?(this.consumeChar("?"),e.greedy=!1):e.greedy=!0,e.type="Quantifier",e.loc=this.loc(r),e}atom(){let e;let t=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group()}if(void 0===e&&this.isPatternCharacter()&&(e=this.patternCharacter()),aq(e))return e.loc=this.loc(t),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[aX("\n"),aX("\r"),aX("\u2028"),aX("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e;let t=!1;switch(this.popChar()){case"d":e=a1;break;case"D":e=a1,t=!0;break;case"s":e=a2;break;case"S":e=a2,t=!0;break;case"w":e=a0;break;case"W":e=a0,t=!0}if(aq(e))return{type:"Set",value:e,complement:t}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=aX("\f");break;case"n":e=aX("\n");break;case"r":e=aX("\r");break;case"t":e=aX("	");break;case"v":e=aX("\v")}if(aq(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");let e=this.popChar();if(!1===/[a-zA-Z]/.test(e))throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:aX("\x00")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){return{type:"Character",value:aX(this.popChar())}}classPatternCharacterAtom(){switch(this.peekChar()){case"\n":case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:return{type:"Character",value:aX(this.popChar())}}}characterClass(){let e=[],t=!1;for(this.consumeChar("["),"^"===this.peekChar(0)&&(this.consumeChar("^"),t=!0);this.isClassAtom();){let t=this.classAtom();if(t.type,a$(t)&&this.isRangeDash()){this.consumeChar("-");let r=this.classAtom();if(r.type,a$(r)){if(r.value<t.value)throw Error("Range out of order in character class");e.push({from:t.value,to:r.value})}else aY(t.value,e),e.push(aX("-")),aY(r.value,e)}else aY(t.value,e)}return this.consumeChar("]"),{type:"Set",complement:t,value:e}}classAtom(){switch(this.peekChar()){case"]":case"\n":case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:aX("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;(this.consumeChar("("),"?"===this.peekChar(0))?(this.consumeChar("?"),this.consumeChar(":"),e=!1):this.groupIdx++;let t=this.disjunction();this.consumeChar(")");let r={type:"Group",capturing:e,value:t};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(!1===a4.test(e))throw Error("Expecting a positive integer");for(;a3.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(!1===a3.test(e))throw Error("Expecting an integer");for(;a3.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){let e=this.popChar();switch(e){case"\n":case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:aX(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return"-"===this.peekChar()&&this.isClassAtom(1)}isDigit(){return a3.test(this.peekChar(0))}isClassAtom(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(this.peekChar(e)){case"]":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return"?"===this.peekChar(1)&&("="===this.peekChar(2)||"!"===this.peekChar(2));default:return!1}}isQuantifier(){let e=this.saveState();try{return void 0!==this.quantifier(!0)}catch(e){return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let t="";for(let r=0;r<e;r++){let e=this.popChar();if(!1===a9.test(e))throw Error("Expecting a HexDecimal digits");t+=e}return{type:"Character",value:parseInt(t,16)}}peekChar(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.input[this.idx+e]}popChar(){let e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(void 0!==e&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}constructor(){this.idx=0,this.input="",this.groupIdx=0}}class a5{visitChildren(e){for(let t in e){let r=e[t];e.hasOwnProperty(t)&&(void 0!==r.type?this.visit(r):Array.isArray(r)&&r.forEach(e=>{this.visit(e)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e)}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let a6={},a7=new a8;function se(e){let t=e.toString();if(a6.hasOwnProperty(t))return a6[t];{let e=a7.pattern(t);return a6[t]=e,e}}let st="Complement Sets are not supported for first char optimization",sr='Unable to use "first char" lexer optimizations:\n';function si(e,t,r){let i=sE(e);t[i]=i,!0===r&&function(e,t){let r=String.fromCharCode(e),i=r.toUpperCase();if(i!==r){let e=sE(i.charCodeAt(0));t[e]=e}else{let e=r.toLowerCase();if(e!==r){let r=sE(e.charCodeAt(0));t[r]=r}}}(e,t)}function sn(e,t){return n6(e.value,e=>"number"==typeof e?au(t,e):void 0!==n6(t,t=>e.from<=t&&t<=e.to))}class sa extends a5{visitChildren(e){if(!0!==this.found){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){au(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?void 0===sn(e,this.targetCharCodes)&&(this.found=!0):void 0!==sn(e,this.targetCharCodes)&&(this.found=!0)}constructor(e){super(),this.targetCharCodes=e,this.found=!1}}function ss(e,t){if(!(t instanceof RegExp))return void 0!==n6(t,t=>au(e,t.charCodeAt(0)));{let r=se(t),i=new sa(e);return i.visit(r),i.found}}let so="PATTERN",sl="defaultMode",sc="modes",su="boolean"==typeof RegExp("(?:)").sticky,sh=/[^\\][$]/,sd=/[^\\[][\^]|^\^/;function sf(e){let t=e.ignoreCase?"i":"";return new RegExp("^(?:".concat(e.source,")"),t)}function sp(e){let t=e.ignoreCase?"iy":"y";return new RegExp("".concat(e.source),t)}function sm(e){let t=e.PATTERN;if(aA(t))return!1;if(rh(t)||as(t,"exec"))return!0;if(ao(t))return!1;throw Error("non exhaustive match")}function sA(e){return!!ao(e)&&1===e.length&&e.charCodeAt(0)}let sg={test:function(e){let t=e.length;for(let r=this.lastIndex;r<t;r++){let t=e.charCodeAt(r);if(10===t)return this.lastIndex=r+1,!0;if(13===t)return 10===e.charCodeAt(r+1)?this.lastIndex=r+2:this.lastIndex=r+1,!0}return!1},lastIndex:0};function sv(e,t){if(as(e,"LINE_BREAKS"))return!1;if(aA(e.PATTERN)){try{ss(t,e.PATTERN)}catch(e){return{issue:x.IDENTIFY_TERMINATOR,errMsg:e.message}}return!1}if(ao(e.PATTERN))return!1;if(sm(e))return{issue:x.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}function sT(e){return ae(e,e=>ao(e)?e.charCodeAt(0):e)}function sC(e,t,r){void 0===e[t]?e[t]=[r]:e[t].push(r)}let sy=[];function sE(e){return e<256?e:sy[e]}function sB(e,t){let r=e.tokenTypeIdx;return r===t.tokenTypeIdx||!0===t.isParent&&!0===t.categoryMatchesMap[r]}function sR(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let sx=1,sM={};function sS(e){let t=function(e){let t=nE(e),r=e,i=!0;for(;i;){let e=nZ(r=nB(ik(ae(r,e=>e.CATEGORIES))),t);t=t.concat(e),ap(e)?i=!1:r=e}return t}(e);n0(t,e=>{sb(e)||(sM[sx]=e,e.tokenTypeIdx=sx++),sI(e)&&!t8(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),sI(e)||(e.CATEGORIES=[]),as(e,"categoryMatches")||(e.categoryMatches=[]),as(e,"categoryMatchesMap")||(e.categoryMatchesMap={})}),n0(t,e=>{(function e(t,r){n0(t,e=>{r.categoryMatchesMap[e.tokenTypeIdx]=!0}),n0(r.CATEGORIES,i=>{let n=t.concat(r);au(n,i)||e(n,i)})})([],e)}),n0(t,e=>{e.categoryMatches=[],n0(e.categoryMatchesMap,(t,r)=>{e.categoryMatches.push(sM[r].tokenTypeIdx)})}),n0(t,e=>{e.isParent=e.categoryMatches.length>0})}function sb(e){return as(e,"tokenTypeIdx")}function sI(e){return as(e,"CATEGORIES")}function sw(e){return as(e,"tokenTypeIdx")}(y=x||(x={}))[y.MISSING_PATTERN=0]="MISSING_PATTERN",y[y.INVALID_PATTERN=1]="INVALID_PATTERN",y[y.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",y[y.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",y[y.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",y[y.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",y[y.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",y[y.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",y[y.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",y[y.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",y[y.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",y[y.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",y[y.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",y[y.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",y[y.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",y[y.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",y[y.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",y[y.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE";let s_={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:["\n","\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:{buildUnableToPopLexerModeMessage:e=>"Unable to pop Lexer Mode after encountering Token ->".concat(e.image,"<- The Mode Stack is empty"),buildUnexpectedCharactersMessage:(e,t,r,i,n)=>"unexpected character: ->".concat(e.charAt(t),"<- at offset: ").concat(t,", skipped ").concat(r," characters.")},traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(s_);class sF{tokenize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.defaultMode;if(!ap(this.lexerDefinitionErrors))throw Error("Unable to Tokenize because Errors detected in definition of Lexer:\n"+ae(this.lexerDefinitionErrors,e=>e.message).join("-----------------------\n"));return this.tokenizeInternal(e,t)}tokenizeInternal(e,t){let r,i,n,a,s,o,l,c,u,h,d,f,p,m,A,g,v;let T=e,C=T.length,y=0,E=0,B=Array(this.hasCustom?0:Math.floor(e.length/10)),R=[],x=this.trackStartLines?1:void 0,M=this.trackStartLines?1:void 0,S=function(e){let t={};return n0(il(e),r=>{if(t8(e[r]))t[r]=[];else throw Error("non exhaustive match")}),t}(this.emptyGroups),b=this.trackStartLines,I=this.config.lineTerminatorsPattern,w=0,_=[],F=[],P=[],D=[];function N(){return _}function O(e){let t=F[sE(e)];return void 0===t?D:t}Object.freeze(D);let L=e=>{if(1===P.length&&void 0===e.tokenType.PUSH_MODE){let t=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(e);R.push({offset:e.startOffset,line:e.startLine,column:e.startColumn,length:e.image.length,message:t})}else{P.pop();let e=nq(P);_=this.patternIdxToConfig[e],F=this.charCodeToPatternIdxToConfig[e],w=_.length;let t=this.canModeBeOptimized[e]&&!1===this.config.safeMode;g=F&&t?O:N}};function U(e){P.push(e),F=this.charCodeToPatternIdxToConfig[e],w=(_=this.patternIdxToConfig[e]).length,w=_.length;let t=this.canModeBeOptimized[e]&&!1===this.config.safeMode;g=F&&t?O:N}U.call(this,t);let k=this.config.recoveryEnabled;for(;y<C;){o=null;let t=T.charCodeAt(y),F=g(t),P=F.length;for(r=0;r<P;r++){let i=(v=F[r]).pattern;l=null;let u=v.short;if(!1!==u?t===u&&(o=i):!0===v.isCustom?null!==(A=i.exec(T,y,B,S))?(o=A[0],void 0!==A.payload&&(l=A.payload)):o=null:(this.updateLastIndex(i,y),o=this.match(i,e,y)),null!==o){if(void 0!==(s=v.longerAlt)){let t=s.length;for(n=0;n<t;n++){let t=_[s[n]],r=t.pattern;if(c=null,!0===t.isCustom?null!==(A=r.exec(T,y,B,S))?(a=A[0],void 0!==A.payload&&(c=A.payload)):a=null:(this.updateLastIndex(r,y),a=this.match(r,e,y)),a&&a.length>o.length){o=a,l=c,v=t;break}}}break}}if(null!==o){if(u=o.length,void 0!==(h=v.group)&&(d=v.tokenTypeIdx,f=this.createTokenInstance(o,y,d,v.tokenType,x,M,u),this.handlePayload(f,l),!1===h?E=this.addToken(B,E,f):S[h].push(f)),e=this.chopInput(e,u),y+=u,M=this.computeNewColumn(M,u),!0===b&&!0===v.canLineTerminator){let e,t,r=0;I.lastIndex=0;do!0===(e=I.test(o))&&(t=I.lastIndex-1,r++);while(!0===e);0!==r&&(x+=r,M=u-t,this.updateTokenEndLineColumnLocation(f,h,t,r,x,M,u))}this.handleModes(v,L,U,f)}else{let t=y,r=x,n=M,a=!1===k;for(;!1===a&&y<C;)for(e=this.chopInput(e,1),y++,i=0;i<w;i++){let t=_[i],r=t.pattern,n=t.short;if(!1!==n?T.charCodeAt(y)===n&&(a=!0):!0===t.isCustom?a=null!==r.exec(T,y,B,S):(this.updateLastIndex(r,y),a=null!==r.exec(e)),!0===a)break}if(p=y-t,M=this.computeNewColumn(M,p),m=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(T,t,p,r,n),R.push({offset:t,line:r,column:n,length:p,message:m}),!1===k)break}}return this.hasCustom||(B.length=E),{tokens:B,groups:S,errors:R}}handleModes(e,t,r,i){if(!0===e.pop){let n=e.push;t(i),void 0!==n&&r.call(this,n)}else void 0!==e.push&&r.call(this,e.push)}chopInput(e,t){return e.substring(t)}updateLastIndex(e,t){e.lastIndex=t}updateTokenEndLineColumnLocation(e,t,r,i,n,a,s){let o,l;void 0===t||(l=(o=r===s-1)?-1:0,1===i&&!0===o||(e.endLine=n+l,e.endColumn=a-1+-l))}computeNewColumn(e,t){return e+t}createOffsetOnlyToken(e,t,r,i){return{image:e,startOffset:t,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,t,r,i,n,a){return{image:e,startOffset:t,startLine:n,startColumn:a,tokenTypeIdx:r,tokenType:i}}createFullToken(e,t,r,i,n,a,s){return{image:e,startOffset:t,endOffset:t+s-1,startLine:n,endLine:n,startColumn:a,endColumn:a+s-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,t,r){return e.push(r),t}addTokenUsingMemberAccess(e,t,r){return e[t]=r,++t}handlePayloadNoCustom(e,t){}handlePayloadWithCustom(e,t){null!==t&&(e.payload=t)}matchWithTest(e,t,r){return!0===e.test(t)?t.substring(r,e.lastIndex):null}matchWithExec(e,t){let r=e.exec(t);return null!==r?r[0]:null}constructor(e,t=s_){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(e,t)=>{if(!0!==this.traceInitPerf)return t();{this.traceInitIndent++;let r=Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log("".concat(r,"--> <").concat(e,">"));let{time:i,value:n}=ab(t),a=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&a("".concat(r,"<-- <").concat(e,"> time: ").concat(i,"ms")),this.traceInitIndent--,n}},"boolean"==typeof t)throw Error("The second argument to the Lexer constructor is now an ILexerConfig Object.\na boolean 2nd argument is no longer supported");this.config=iu({},s_,t);let r=this.config.traceInitPerf;!0===r?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):"number"==typeof r&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let r;let i=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===s_.lineTerminatorsPattern)this.config.lineTerminatorsPattern=sg;else if(this.config.lineTerminatorCharacters===s_.lineTerminatorCharacters)throw Error("Error: Missing <lineTerminatorCharacters> property on the Lexer config.\n	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS");if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),t8(e)?r={modes:{defaultMode:nE(e)},defaultMode:sl}:(i=!1,r=nE(e))}),!1===this.config.skipValidations&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(function(e,t,r){let i=[];return as(e,sl)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+sl+"> property in its definition\n",type:x.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),as(e,sc)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+sc+"> property in its definition\n",type:x.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),as(e,sc)&&as(e,sl)&&!as(e.modes,e.defaultMode)&&i.push({message:"A MultiMode Lexer cannot be initialized with a ".concat(sl,": <").concat(e.defaultMode,">which does not exist\n"),type:x.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),as(e,sc)&&n0(e.modes,(e,t)=>{n0(e,(r,n)=>{ag(r)?i.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:<".concat(t,"> at index: <").concat(n,">\n"),type:x.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED}):as(r,"LONGER_ALT")&&n0(t8(r.LONGER_ALT)?r.LONGER_ALT:[r.LONGER_ALT],n=>{ag(n)||au(e,n)||i.push({message:"A MultiMode Lexer cannot be initialized with a longer_alt <".concat(n.name,"> on token <").concat(r.name,"> outside of mode <").concat(t,">\n"),type:x.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})})}),i}(r,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(function(e,t,r){let i=[],n=!1,a=ay(nB(ik(al(e.modes))),e=>e[so]===sF.NA),s=sT(r);return t&&n0(a,e=>{let t=sv(e,s);if(!1!==t){let r={message:function(e,t){if(t.issue===x.IDENTIFY_TERMINATOR)return"Warning: unable to identify line terminator usage in pattern.\n	The problem is in the <".concat(e.name,"> Token Type\n	 Root cause: ").concat(t.errMsg,".\n	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR");if(t.issue===x.CUSTOM_LINE_BREAK)return"Warning: A Custom Token Pattern should specify the <line_breaks> option.\n	The problem is in the <".concat(e.name,"> Token Type\n	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK");throw Error("non exhaustive match")}(e,t),type:t.issue,tokenType:e};i.push(r)}else as(e,"LINE_BREAKS")?!0===e.LINE_BREAKS&&(n=!0):ss(s,e.PATTERN)&&(n=!0)}),t&&!n&&i.push({message:"Warning: No LINE_BREAKS Found.\n	This Lexer has been defined to track line and column information,\n	But none of the Token Types can be identified as matching a line terminator.\n	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS \n	for details.",type:x.NO_LINE_BREAKS_FLAGS}),i}(r,this.trackStartLines,this.config.lineTerminatorCharacters))})),r.modes=r.modes?r.modes:{},n0(r.modes,(e,t)=>{r.modes[t]=ay(e,e=>ag(e))});let n=il(r.modes);if(n0(r.modes,(e,r)=>{this.TRACE_INIT("Mode: <".concat(r,"> processing"),()=>{if(this.modes.push(r),!1===this.config.skipValidations&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(function(e,t){let r=[],i=function(e){let t=n8(e,e=>!as(e,so));return{errors:ae(t,e=>({message:"Token Type: ->"+e.name+"<- missing static 'PATTERN' property",type:x.MISSING_PATTERN,tokenTypes:[e]})),valid:nZ(e,t)}}(e);r=r.concat(i.errors);let n=function(e){let t=n8(e,e=>{let t=e[so];return!aA(t)&&!rh(t)&&!as(t,"exec")&&!ao(t)});return{errors:ae(t,e=>({message:"Token Type: ->"+e.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:x.INVALID_PATTERN,tokenTypes:[e]})),valid:nZ(e,t)}}(i.valid),a=n.valid;return(r=(r=(r=(r=r.concat(n.errors)).concat(function(e){let t=[],r=n8(e,e=>aA(e[so]));return(t=(t=(t=(t=t.concat(function(e){class t extends a5{visitEndAnchor(e){this.found=!0}constructor(){super(...arguments),this.found=!1}}return ae(n8(e,e=>{let r=e.PATTERN;try{let e=se(r),i=new t;return i.visit(e),i.found}catch(e){return sh.test(r.source)}}),e=>({message:"Unexpected RegExp Anchor Error:\n	Token Type: ->"+e.name+"<- static 'PATTERN' cannot contain end of input anchor '$'\n	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.",type:x.EOI_ANCHOR_FOUND,tokenTypes:[e]}))}(r))).concat(function(e){class t extends a5{visitStartAnchor(e){this.found=!0}constructor(){super(...arguments),this.found=!1}}return ae(n8(e,e=>{let r=e.PATTERN;try{let e=se(r),i=new t;return i.visit(e),i.found}catch(e){return sd.test(r.source)}}),e=>({message:"Unexpected RegExp Anchor Error:\n	Token Type: ->"+e.name+"<- static 'PATTERN' cannot contain start of input anchor '^'\n	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.",type:x.SOI_ANCHOR_FOUND,tokenTypes:[e]}))}(r))).concat(ae(n8(r,e=>{let t=e[so];return t instanceof RegExp&&(t.multiline||t.global)}),e=>({message:"Token Type: ->"+e.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:x.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[e]})))).concat(function(e){let t=[],r=ae(e,r=>aC(e,(e,i)=>(r.PATTERN.source!==i.PATTERN.source||au(t,i)||i.PATTERN===sF.NA||(t.push(i),e.push(i)),e),[]));return ae(n8(r=nB(r),e=>e.length>1),e=>{let t=ae(e,e=>e.name),r=n7(e).PATTERN;return{message:"The same RegExp pattern ->".concat(r,"<-has been used in all of the following Token Types: ").concat(t.join(", ")," <-"),type:x.DUPLICATE_PATTERNS_FOUND,tokenTypes:e}})}(r))).concat(ae(n8(r,e=>e.PATTERN.test("")),e=>({message:"Token Type: ->"+e.name+"<- static 'PATTERN' must not match an empty string",type:x.EMPTY_MATCH_PATTERN,tokenTypes:[e]})))}(a))).concat(ae(n8(a,e=>{if(!as(e,"GROUP"))return!1;let t=e.GROUP;return t!==sF.SKIPPED&&t!==sF.NA&&!ao(t)}),e=>({message:"Token Type: ->"+e.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:x.INVALID_GROUP_TYPE_FOUND,tokenTypes:[e]})))).concat(ae(n8(a,e=>void 0!==e.PUSH_MODE&&!au(t,e.PUSH_MODE)),e=>({message:"Token Type: ->".concat(e.name,"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->").concat(e.PUSH_MODE,"<-which does not exist"),type:x.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[e]})))).concat(function(e){let t=[],r=aC(e,(e,t,r)=>{let i=t.PATTERN;return i===sF.NA||(ao(i)?e.push({str:i,idx:r,tokenType:t}):aA(i)&&void 0===n6([".","\\","[","]","|","^","$","(",")","?","*","+","{"],e=>-1!==i.source.indexOf(e))&&e.push({str:i.source,idx:r,tokenType:t})),e},[]);return n0(e,(e,i)=>{n0(r,r=>{let{str:n,idx:a,tokenType:s}=r;if(i<a&&function(e,t){if(aA(t)){let r=t.exec(e);return null!==r&&0===r.index}if(rh(t))return t(e,0,[],{});if(as(t,"exec"))return t.exec(e,0,[],{});if("string"==typeof t)return t===e;throw Error("non exhaustive match")}(n,e.PATTERN)){let r="Token: ->".concat(s.name,"<- can never be matched.\nBecause it appears AFTER the Token Type ->").concat(e.name,"<-in the lexer's definition.\nSee https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE");t.push({message:r,type:x.UNREACHABLE_PATTERN,tokenTypes:[e,s]})}})}),t}(a))}(e,n))}),ap(this.lexerDefinitionErrors)){let i;sS(e),this.TRACE_INIT("analyzeTokenTypes",()=>{i=function(e,t){let r,i,n,a,s,o,l,c,u,h,d,f;let p=(t=nQ(t,{useSticky:su,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r","\n"],tracer:(e,t)=>t()})).tracer;p("initCharCodeToOptimizedIndexMap",()=>{(function(){if(ap(sy)){sy=Array(65536);for(let e=0;e<65536;e++)sy[e]=e>255?255+~~(e/255):e}})()}),p("Reject Lexer.NA",()=>{r=ay(e,e=>e[so]===sF.NA)});let m=!1;p("Transform Patterns",()=>{m=!1,i=ae(r,e=>{let r=e[so];if(aA(r)){let e=r.source;return 1!==e.length||"^"===e||"$"===e||"."===e||r.ignoreCase?2!==e.length||"\\"!==e[0]||au(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],e[1])?t.useSticky?sp(r):sf(r):e[1]:e}if(rh(r))return m=!0,{exec:r};if("object"==typeof r)return m=!0,r;if("string"==typeof r){if(1===r.length)return r;{let e=new RegExp(r.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"));return t.useSticky?sp(e):sf(e)}}throw Error("non exhaustive match")})}),p("misc mapping",()=>{n=ae(r,e=>e.tokenTypeIdx),a=ae(r,e=>{let t=e.GROUP;if(t!==sF.SKIPPED){if(ao(t))return t;if(ag(t))return!1;throw Error("non exhaustive match")}}),s=ae(r,e=>{let t=e.LONGER_ALT;if(t)return t8(t)?ae(t,e=>ad(r,e)):[ad(r,t)]}),o=ae(r,e=>e.PUSH_MODE),l=ae(r,e=>as(e,"POP_MODE"))}),p("Line Terminator Handling",()=>{let e=sT(t.lineTerminatorCharacters);c=ae(r,e=>!1),"onlyOffset"!==t.positionTracking&&(c=ae(r,t=>as(t,"LINE_BREAKS")?!!t.LINE_BREAKS:!1===sv(t,e)&&ss(e,t.PATTERN)))}),p("Misc Mapping #2",()=>{u=ae(r,sm),h=ae(i,sA),d=aC(r,(e,t)=>{let r=t.GROUP;return ao(r)&&r!==sF.SKIPPED&&(e[r]=[]),e},{}),f=ae(i,(e,t)=>({pattern:i[t],longerAlt:s[t],canLineTerminator:c[t],isCustom:u[t],short:h[t],group:a[t],push:o[t],pop:l[t],tokenTypeIdx:n[t],tokenType:r[t]}))});let A=!0,g=[];return t.safeMode||p("First Char Optimization",()=>{g=aC(r,(e,r,i)=>{if("string"==typeof r.PATTERN)sC(e,sE(r.PATTERN.charCodeAt(0)),f[i]);else if(t8(r.START_CHARS_HINT)){let t;n0(r.START_CHARS_HINT,r=>{let n=sE("string"==typeof r?r.charCodeAt(0):r);t!==n&&(t=n,sC(e,n,f[i]))})}else if(aA(r.PATTERN)){if(r.PATTERN.unicode)A=!1,t.ensureOptimizations&&aM("".concat(sr,"	Unable to analyze < ").concat(r.PATTERN.toString()," > pattern.\n	The regexp unicode flag is not currently supported by the regexp-to-ast library.\n	This will disable the lexer's first char optimizations.\n	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE"));else{let n=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let t=se(e);return function e(t,r,i){switch(t.type){case"Disjunction":for(let n=0;n<t.value.length;n++)e(t.value[n],r,i);break;case"Alternative":let n=t.value;for(let t=0;t<n.length;t++){let a=n[t];switch(a.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}switch(a.type){case"Character":si(a.value,r,i);break;case"Set":if(!0===a.complement)throw Error(st);n0(a.value,e=>{if("number"==typeof e)si(e,r,i);else if(!0===i)for(let t=e.from;t<=e.to;t++)si(t,r,i);else{for(let t=e.from;t<=e.to&&t<256;t++)si(t,r,i);if(e.to>=256){let t=e.from>=256?e.from:256,i=e.to,n=sE(t),a=sE(i);for(let e=n;e<=a;e++)r[e]=e}}});break;case"Group":e(a.value,r,i);break;default:throw Error("Non Exhaustive Match")}let s=void 0!==a.quantifier&&0===a.quantifier.atLeast;if("Group"===a.type&&!1===function e(t){let r=t.quantifier;return!!r&&0===r.atLeast||!!t.value&&(t8(t.value)?n3(t.value,e):e(t.value))}(a)||"Group"!==a.type&&!1===s)break}break;default:throw Error("non exhaustive match!")}return al(r)}(t.value,{},t.flags.ignoreCase)}catch(r){if(r.message===st)t&&aS("".concat(sr,"	Unable to optimize: < ").concat(e.toString()," >\n	Complement Sets cannot be automatically optimized.\n	This will disable the lexer's first char optimizations.\n	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details."));else{let r="";t&&(r="\n	This will disable the lexer's first char optimizations.\n	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details."),aM("".concat(sr,"\n	Failed parsing: < ").concat(e.toString()," >\n	Using the @chevrotain/regexp-to-ast library\n	Please open an issue at: https://github.com/chevrotain/chevrotain/issues")+r)}}return[]}(r.PATTERN,t.ensureOptimizations);ap(n)&&(A=!1),n0(n,t=>{sC(e,t,f[i])})}}else t.ensureOptimizations&&aM("".concat(sr,"	TokenType: <").concat(r.name,"> is using a custom token pattern without providing <start_chars_hint> parameter.\n	This will disable the lexer's first char optimizations.\n	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE")),A=!1;return e},[])}),{emptyGroups:d,patternIdxToConfig:f,charCodeToPatternIdxToConfig:g,hasCustom:m,canBeOptimized:A}}(e,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[r]=i.patternIdxToConfig,this.charCodeToPatternIdxToConfig[r]=i.charCodeToPatternIdxToConfig,this.emptyGroups=iu({},this.emptyGroups,i.emptyGroups),this.hasCustom=i.hasCustom||this.hasCustom,this.canModeBeOptimized[r]=i.canBeOptimized}})}),this.defaultMode=r.defaultMode,!ap(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling)throw Error("Errors detected in definition of Lexer:\n"+ae(this.lexerDefinitionErrors,e=>e.message).join("-----------------------\n"));n0(this.lexerDefinitionWarning,e=>{aS(e.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(su?(this.chopInput=ru,this.match=this.matchWithTest):(this.updateLastIndex=rx,this.match=this.matchWithExec),i&&(this.handleModes=rx),!1===this.trackStartLines&&(this.computeNewColumn=ru),!1===this.trackEndLines&&(this.updateTokenEndLineColumnLocation=rx),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error('Invalid <positionTracking> config option: "'.concat(this.config.positionTracking,'"'));this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{let e=aC(this.canModeBeOptimized,(e,t,r)=>(!1===t&&e.push(r),e),[]);if(t.ensureOptimizations&&!ap(e))throw Error("Lexer Modes: < ".concat(e.join(", "),' > cannot be optimized.\n	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.\n	 Or inspect the console log for details on how to resolve these issues.'))}),this.TRACE_INIT("clearRegExpParserCache",()=>{a6={}}),this.TRACE_INIT("toFastProperties",()=>{aI(this)})})}}function sP(e){return sD(e)?e.LABEL:e.name}function sD(e){return ao(e.LABEL)&&""!==e.LABEL}sF.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",sF.NA=/NOT_APPLICABLE/;let sN="categories",sO="label",sL="group",sU="push_mode",sk="pop_mode",sG="longer_alt",sH="line_breaks",sV="start_chars_hint";function sJ(e){let t=e.pattern,r={};if(r.name=e.name,ag(t)||(r.PATTERN=t),as(e,"parent"))throw"The parent property is no longer supported.\nSee: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.";return as(e,sN)&&(r.CATEGORIES=e[sN]),sS([r]),as(e,sO)&&(r.LABEL=e[sO]),as(e,sL)&&(r.GROUP=e[sL]),as(e,sk)&&(r.POP_MODE=e[sk]),as(e,sU)&&(r.PUSH_MODE=e[sU]),as(e,sG)&&(r.LONGER_ALT=e[sG]),as(e,sH)&&(r.LINE_BREAKS=e[sH]),as(e,sV)&&(r.START_CHARS_HINT=e[sV]),r}let sK=sJ({name:"EOF",pattern:sF.NA});function sj(e,t,r,i,n,a,s,o){return{image:t,startOffset:r,endOffset:i,startLine:n,endLine:a,startColumn:s,endColumn:o,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}sS([sK]);let sW={buildMismatchTokenMessage(e){let{expected:t,actual:r,previous:i,ruleName:n}=e,a=sD(t)?"--> ".concat(sP(t)," <--"):"token of type --> ".concat(t.name," <--");return"Expecting ".concat(a," but found --> '").concat(r.image,"' <--")},buildNotAllInputParsedMessage(e){let{firstRedundant:t,ruleName:r}=e;return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage(e){let{expectedPathsPerAlt:t,actual:r,previous:i,customUserDescription:n,ruleName:a}=e,s="Expecting: ",o="\nbut found: '"+n7(r).image+"'";if(n)return s+n+o;{let e=ae(aC(t,(e,t)=>e.concat(t),[]),e=>"[".concat(ae(e,e=>sP(e)).join(", "),"]")),r=ae(e,(e,t)=>"  ".concat(t+1,". ").concat(e));return s+"one of these possible Token sequences:\n".concat(r.join("\n"))+o}},buildEarlyExitMessage(e){let{expectedIterationPaths:t,actual:r,customUserDescription:i,ruleName:n}=e,a="Expecting: ",s="\nbut found: '"+n7(r).image+"'";if(i)return a+i+s;{let e=ae(t,e=>"[".concat(ae(e,e=>sP(e)).join(","),"]"));return a+"expecting at least one iteration which starts with one of these possible Token sequences::\n  <".concat(e.join(" ,"),">")+s}}};Object.freeze(sW);let sz={buildRuleNotFoundError:(e,t)=>"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+"<-\ninside top level rule: ->"+e.name+"<-"},sQ={buildDuplicateFoundError(e,t){let r=e.name,i=n7(t),n=i.idx,a=aJ(i),s=i instanceof aG?i.terminalType.name:i instanceof a_?i.nonTerminalName:"",o=n>0,l="->".concat(a).concat(o?n:"","<- ").concat(s?"with argument: ->".concat(s,"<-"):"","\n                  appears more than once (").concat(t.length," times) in the top level rule: ->").concat(r,"<-.                  \n                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES \n                  ");return(l=l.replace(/[ \t]+/g," ")).replace(/\s\s+/g,"\n")},buildNamespaceConflictError:e=>"Namespace conflict found in grammar.\nThe grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <".concat(e.name,">.\nTo resolve this make sure each Terminal and Non-Terminal names are unique\nThis is easy to accomplish by using the convention that Terminal names start with an uppercase letter\nand Non-Terminal names start with a lower case letter."),buildAlternationPrefixAmbiguityError(e){let t=ae(e.prefixPath,e=>sP(e)).join(", "),r=0===e.alternation.idx?"":e.alternation.idx;return"Ambiguous alternatives: <".concat(e.ambiguityIndices.join(" ,"),"> due to common lookahead prefix\nin <OR").concat(r,"> inside <").concat(e.topLevelRule.name,"> Rule,\n<").concat(t,"> may appears as a prefix path in all these alternatives.\nSee: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX\nFor Further details.")},buildAlternationAmbiguityError(e){let t=ae(e.prefixPath,e=>sP(e)).join(", "),r=0===e.alternation.idx?"":e.alternation.idx;return"Ambiguous Alternatives Detected: <".concat(e.ambiguityIndices.join(" ,"),"> in <OR").concat(r,"> inside <").concat(e.topLevelRule.name,"> Rule,\n<").concat(t,"> may appears as a prefix path in all these alternatives.\n")+"See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES\nFor Further details."},buildEmptyRepetitionError(e){let t=aJ(e.repetition);return 0!==e.repetition.idx&&(t+=e.repetition.idx),"The repetition <".concat(t,"> within Rule <").concat(e.topLevelRule.name,"> can never consume any tokens.\nThis could lead to an infinite loop.")},buildTokenNameError:e=>"deprecated",buildEmptyAlternationError:e=>"Ambiguous empty alternative: <".concat(e.emptyChoiceIdx+1,"> in <OR").concat(e.alternation.idx,"> inside <").concat(e.topLevelRule.name,"> Rule.\nOnly the last alternative may be an empty alternative."),buildTooManyAlternativesError:e=>"An Alternation cannot have more than 256 alternatives:\n<OR".concat(e.alternation.idx,"> inside <").concat(e.topLevelRule.name,"> Rule.\n has ").concat(e.alternation.definition.length+1," alternatives."),buildLeftRecursionError(e){let t=e.topLevelRule.name,r=ae(e.leftRecursionPath,e=>e.name),i="".concat(t," --> ").concat(r.concat([t]).join(" --> "));return"Left Recursion found in grammar.\nrule: <".concat(t,"> can be invoked from itself (directly or indirectly)\nwithout consuming any Tokens. The grammar path that causes this is: \n ").concat(i,"\n To fix this refactor your grammar to remove the left recursion.\nsee: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.")},buildInvalidRuleNameError:e=>"deprecated",buildDuplicateRuleNameError(e){let t;return t=e.topLevelRule instanceof aF?e.topLevelRule.name:e.topLevelRule,"Duplicate definition, rule: ->".concat(t,"<- is already defined in the grammar: ->").concat(e.grammarName,"<-")}};class sX extends aH{resolveRefs(){n0(al(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){let t=this.nameToTopRule[e.nonTerminalName];if(t)e.referencedRule=t;else{let t=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:t,type:b.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}constructor(e,t){super(),this.nameToTopRule=e,this.errMsgProvider=t,this.errors=[]}}class sY extends aK{startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=nE(this.path.ruleStack).reverse(),this.occurrenceStack=nE(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.found||super.walk(e,t)}walkProdRef(e,t,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){let i=t.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){ap(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}constructor(e,t){super(),this.topProd=e,this.path=t,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}}class sZ extends sY{walkTerminal(e,t,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){let e=new aP({definition:t.concat(r)});this.possibleTokTypes=aW(e),this.found=!0}}constructor(e,t){super(e,t),this.path=t,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}}class sq extends aK{startWalking(){return this.walk(this.topRule),this.result}constructor(e,t){super(),this.topRule=e,this.occurrence=t,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}}class s$ extends sq{walkMany(e,t,r){if(e.idx===this.occurrence){let e=n7(t.concat(r));this.result.isEndOfRule=void 0===e,e instanceof aG&&(this.result.token=e.terminalType,this.result.occurrence=e.idx)}else super.walkMany(e,t,r)}}class s1 extends sq{walkManySep(e,t,r){if(e.idx===this.occurrence){let e=n7(t.concat(r));this.result.isEndOfRule=void 0===e,e instanceof aG&&(this.result.token=e.terminalType,this.result.occurrence=e.idx)}else super.walkManySep(e,t,r)}}class s0 extends sq{walkAtLeastOne(e,t,r){if(e.idx===this.occurrence){let e=n7(t.concat(r));this.result.isEndOfRule=void 0===e,e instanceof aG&&(this.result.token=e.terminalType,this.result.occurrence=e.idx)}else super.walkAtLeastOne(e,t,r)}}class s2 extends sq{walkAtLeastOneSep(e,t,r){if(e.idx===this.occurrence){let e=n7(t.concat(r));this.result.isEndOfRule=void 0===e,e instanceof aG&&(this.result.token=e.terminalType,this.result.occurrence=e.idx)}else super.walkAtLeastOneSep(e,t,r)}}function s9(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];r=nE(r);let i=[],n=0;function a(a){let s=s9(a.concat(n$(e,n+1)),t,r);return i.concat(s)}for(;r.length<t&&n<e.length;){let t=e[n];if(t instanceof aP||t instanceof a_)return a(t.definition);if(t instanceof aD)i=a(t.definition);else if(t instanceof aN)return a(t.definition.concat([new aL({definition:t.definition})]));else if(t instanceof aO)return a([new aP({definition:t.definition}),new aL({definition:[new aG({terminalType:t.separator})].concat(t.definition)})]);else if(t instanceof aU)i=a(t.definition.concat([new aL({definition:[new aG({terminalType:t.separator})].concat(t.definition)})]));else if(t instanceof aL)i=a(t.definition.concat([new aL({definition:t.definition})]));else if(t instanceof ak)return n0(t.definition,e=>{!1===ap(e.definition)&&(i=a(e.definition))}),i;else if(t instanceof aG)r.push(t.terminalType);else throw Error("non exhaustive match");n++}return i.push({partialPath:r,suffixDef:n$(e,n)}),i}function s3(e,t,r,i){let n="EXIT_NONE_TERMINAL",a=[n],s="EXIT_ALTERNATIVE",o=!1,l=t.length,c=l-i-1,u=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!ap(h);){let e=h.pop();if(e===s){o&&nq(h).idx<=c&&h.pop();continue}let i=e.def,d=e.idx,f=e.ruleStack,p=e.occurrenceStack;if(ap(i))continue;let m=i[0];if(m===n){let e={idx:d,def:n$(i),ruleStack:n1(f),occurrenceStack:n1(p)};h.push(e)}else if(m instanceof aG){if(d<l-1){let e=d+1;if(r(t[e],m.terminalType)){let t={idx:e,def:n$(i),ruleStack:f,occurrenceStack:p};h.push(t)}}else if(d===l-1)u.push({nextTokenType:m.terminalType,nextTokenOccurrence:m.idx,ruleStack:f,occurrenceStack:p}),o=!0;else throw Error("non exhaustive match")}else if(m instanceof a_){let e=nE(f);e.push(m.nonTerminalName);let t=nE(p);t.push(m.idx);let r={idx:d,def:m.definition.concat(a,n$(i)),ruleStack:e,occurrenceStack:t};h.push(r)}else if(m instanceof aD){let e={idx:d,def:n$(i),ruleStack:f,occurrenceStack:p};h.push(e),h.push(s);let t={idx:d,def:m.definition.concat(n$(i)),ruleStack:f,occurrenceStack:p};h.push(t)}else if(m instanceof aN){let e=new aL({definition:m.definition,idx:m.idx}),t={idx:d,def:m.definition.concat([e],n$(i)),ruleStack:f,occurrenceStack:p};h.push(t)}else if(m instanceof aO){let e=new aL({definition:[new aG({terminalType:m.separator})].concat(m.definition),idx:m.idx}),t={idx:d,def:m.definition.concat([e],n$(i)),ruleStack:f,occurrenceStack:p};h.push(t)}else if(m instanceof aU){let e={idx:d,def:n$(i),ruleStack:f,occurrenceStack:p};h.push(e),h.push(s);let t=new aL({definition:[new aG({terminalType:m.separator})].concat(m.definition),idx:m.idx}),r={idx:d,def:m.definition.concat([t],n$(i)),ruleStack:f,occurrenceStack:p};h.push(r)}else if(m instanceof aL){let e={idx:d,def:n$(i),ruleStack:f,occurrenceStack:p};h.push(e),h.push(s);let t=new aL({definition:m.definition,idx:m.idx}),r={idx:d,def:m.definition.concat([t],n$(i)),ruleStack:f,occurrenceStack:p};h.push(r)}else if(m instanceof ak)for(let e=m.definition.length-1;e>=0;e--){let t={idx:d,def:m.definition[e].definition.concat(n$(i)),ruleStack:f,occurrenceStack:p};h.push(t),h.push(s)}else if(m instanceof aP)h.push({idx:d,def:m.definition.concat(n$(i)),ruleStack:f,occurrenceStack:p});else if(m instanceof aF)h.push(function(e,t,r,i){let n=nE(r);n.push(e.name);let a=nE(i);return a.push(1),{idx:t,def:e.definition,ruleStack:n,occurrenceStack:a}}(m,d,f,p));else throw Error("non exhaustive match")}return u}function s4(e){if(e instanceof aD||"Option"===e)return M.OPTION;if(e instanceof aL||"Repetition"===e)return M.REPETITION;if(e instanceof aN||"RepetitionMandatory"===e)return M.REPETITION_MANDATORY;if(e instanceof aO||"RepetitionMandatoryWithSeparator"===e)return M.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof aU||"RepetitionWithSeparator"===e)return M.REPETITION_WITH_SEPARATOR;if(e instanceof ak||"Alternation"===e)return M.ALTERNATION;throw Error("non exhaustive match")}function s8(e,t,r,i){let n=e.length,a=n3(e,e=>n3(e,e=>1===e.length));if(t)return function(t){let i=ae(t,e=>e.GATE);for(let t=0;t<n;t++){let n=e[t],a=n.length,s=i[t];if(void 0===s||!1!==s.call(this))t:for(let e=0;e<a;e++){let i=n[e],a=i.length;for(let e=0;e<a;e++)if(!1===r(this.LA(e+1),i[e]))continue t;return t}}};if(!a||i)return function(){for(let t=0;t<n;t++){let i=e[t],n=i.length;t:for(let e=0;e<n;e++){let n=i[e],a=n.length;for(let e=0;e<a;e++)if(!1===r(this.LA(e+1),n[e]))continue t;return t}}};{let t=aC(ae(e,e=>ik(e)),(e,t,r)=>(n0(t,t=>{as(e,t.tokenTypeIdx)||(e[t.tokenTypeIdx]=r),n0(t.categoryMatches,t=>{as(e,t)||(e[t]=r)})}),e),{});return function(){return t[this.LA(1).tokenTypeIdx]}}}function s5(e,t,r){let i=n3(e,e=>1===e.length),n=e.length;if(!i||r)return function(){t:for(let r=0;r<n;r++){let i=e[r],n=i.length;for(let e=0;e<n;e++)if(!1===t(this.LA(e+1),i[e]))continue t;return!0}return!1};{let t=ik(e);if(1===t.length&&ap(t[0].categoryMatches)){let e=t[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===e}}{let e=aC(t,(e,t,r)=>(e[t.tokenTypeIdx]=!0,n0(t.categoryMatches,t=>{e[t]=!0}),e),[]);return function(){return!0===e[this.LA(1).tokenTypeIdx]}}}}(E=M||(M={}))[E.OPTION=0]="OPTION",E[E.REPETITION=1]="REPETITION",E[E.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",E[E.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",E[E.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",E[E.ALTERNATION=5]="ALTERNATION";class s6 extends aK{startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,t,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.restDef=r.concat(i),!0)}walkOption(e,t,r){this.checkIsTarget(e,M.OPTION,t,r)||super.walkOption(e,t,r)}walkAtLeastOne(e,t,r){this.checkIsTarget(e,M.REPETITION_MANDATORY,t,r)||super.walkOption(e,t,r)}walkAtLeastOneSep(e,t,r){this.checkIsTarget(e,M.REPETITION_MANDATORY_WITH_SEPARATOR,t,r)||super.walkOption(e,t,r)}walkMany(e,t,r){this.checkIsTarget(e,M.REPETITION,t,r)||super.walkOption(e,t,r)}walkManySep(e,t,r){this.checkIsTarget(e,M.REPETITION_WITH_SEPARATOR,t,r)||super.walkOption(e,t,r)}constructor(e,t,r){super(),this.topProd=e,this.targetOccurrence=t,this.targetProdType=r}}class s7 extends aH{checkIsTarget(e,t){e.idx===this.targetOccurrence&&this.targetProdType===t&&(void 0===this.targetRef||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,M.OPTION)}visitRepetition(e){this.checkIsTarget(e,M.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,M.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,M.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,M.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,M.ALTERNATION)}constructor(e,t,r){super(),this.targetOccurrence=e,this.targetProdType=t,this.targetRef=r,this.result=[]}}function oe(e){let t=Array(e);for(let r=0;r<e;r++)t[r]=[];return t}function ot(e){let t=[""];for(let r=0;r<e.length;r++){let i=e[r],n=[];for(let e=0;e<t.length;e++){let r=t[e];n.push(r+"_"+i.tokenTypeIdx);for(let e=0;e<i.categoryMatches.length;e++){let t="_"+i.categoryMatches[e];n.push(r+t)}}t=n}return t}function or(e,t){let r=ae(e,e=>s9([e],1)),i=oe(r.length),n=ae(r,e=>{let t={};return n0(e,e=>{n0(ot(e.partialPath),e=>{t[e]=!0})}),t}),a=r;for(let e=1;e<=t;e++){let r=a;a=oe(r.length);for(let s=0;s<r.length;s++){let o=r[s];for(let r=0;r<o.length;r++){let l=o[r].partialPath,c=o[r].suffixDef,u=ot(l);if(function(e,t,r){for(let i=0;i<e.length;i++){if(i===r)continue;let n=e[i];for(let e=0;e<t.length;e++)if(!0===n[t[e]])return!1}return!0}(n,u,s)||ap(c)||l.length===t){let e=i[s];if(!1===oa(e,l)){e.push(l);for(let e=0;e<u.length;e++){let t=u[e];n[s][t]=!0}}}else{let t=s9(c,e+1,l);a[s]=a[s].concat(t),n0(t,e=>{n0(ot(e.partialPath),e=>{n[s][e]=!0})})}}}}return i}function oi(e,t,r,i){let n=new s7(e,M.ALTERNATION,i);return t.accept(n),or(n.result,r)}function on(e,t,r,i){let n=new s7(e,r);t.accept(n);let a=n.result,s=new s6(t,e,r).startWalking();return or([new aP({definition:a}),new aP({definition:s})],i)}function oa(e,t){r:for(let r=0;r<e.length;r++){let i=e[r];if(i.length===t.length){for(let e=0;e<i.length;e++){let r=t[e],n=i[e];if(!1==(r===n||void 0!==n.categoryMatchesMap[r.tokenTypeIdx]))continue r}return!0}}return!1}function os(e){return n3(e,e=>n3(e,e=>n3(e,e=>ap(e.categoryMatches))))}function oo(e){return"".concat(aJ(e),"_#_").concat(e.idx,"_#_").concat(ol(e))}function ol(e){return e instanceof aG?e.terminalType.name:e instanceof a_?e.nonTerminalName:""}class oc extends aH{visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}constructor(){super(...arguments),this.allProductions=[]}}class ou extends aH{visitAlternation(e){this.alternations.push(e)}constructor(){super(...arguments),this.alternations=[]}}class oh extends aH{visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}constructor(){super(...arguments),this.allProductions=[]}}let od="MismatchedTokenException",of="NoViableAltException",op="EarlyExitException",om="NotAllInputParsedException",oA=[od,of,op,om];function og(e){return au(oA,e.name)}Object.freeze(oA);class ov extends Error{constructor(e,t){super(e),this.token=t,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class oT extends ov{constructor(e,t,r){super(e,t),this.previousToken=r,this.name=od}}class oC extends ov{constructor(e,t,r){super(e,t),this.previousToken=r,this.name=of}}class oy extends ov{constructor(e,t){super(e,t),this.name=om}}class oE extends ov{constructor(e,t,r){super(e,t),this.previousToken=r,this.name=op}}let oB={},oR="InRuleRecoveryException";class ox extends Error{constructor(e){super(e),this.name=oR}}class oM{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=as(e,"recoveryEnabled")?e.recoveryEnabled:o$.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=oS)}getTokenToInsert(e){let t=sj(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,t,r,i){let n=this.findReSyncTokenType(),a=this.exportLexerState(),s=[],o=!1,l=this.LA(1),c=this.LA(1),u=()=>{let e=this.LA(0),t=new oT(this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:e,ruleName:this.getCurrRuleFullName()}),l,this.LA(0));t.resyncedTokens=n1(s),this.SAVE_ERROR(t)};for(;!o;){if(this.tokenMatcher(c,i)){u();return}if(r.call(this)){u(),e.apply(this,t);return}this.tokenMatcher(c,n)?o=!0:(c=this.SKIP_TOKEN(),this.addToResyncTokens(c,s))}this.importLexerState(a)}shouldInRepetitionRecoveryBeTried(e,t,r){return!(!1===r||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t)))}getFollowsForInRuleRecovery(e,t){let r=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){let e=this.SKIP_TOKEN();return this.consumeToken(),e}throw new ox("sad sad panda")}canPerformInRuleRecovery(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,t){if(!this.canTokenTypeBeInsertedInRecovery(e)||ap(t))return!1;let r=this.LA(1);return void 0!==n6(t,e=>this.tokenMatcher(r,e))}canRecoverWithSingleTokenDeletion(e){return!!this.canTokenTypeBeDeletedInRecovery(e)&&this.tokenMatcher(this.LA(2),e)}isInCurrentRuleReSyncSet(e){let t=this.getCurrFollowKey();return au(this.getFollowSetFromFollowKey(t),e)}findReSyncTokenType(){let e=this.flattenFollowSet(),t=this.LA(1),r=2;for(;;){let i=n6(e,e=>sB(t,e));if(void 0!==i)return i;t=this.LA(r),r++}}getCurrFollowKey(){if(1===this.RULE_STACK.length)return oB;let e=this.getLastExplicitRuleShortName(),t=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:t,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){let e=this.RULE_STACK,t=this.RULE_OCCURRENCE_STACK;return ae(e,(r,i)=>0===i?oB:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:t[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){return ik(ae(this.buildFullFollowKeyStack(),e=>this.getFollowSetFromFollowKey(e)))}getFollowSetFromFollowKey(e){if(e===oB)return[sK];let t=e.ruleName+e.idxInCallingRule+az+e.inRule;return this.resyncFollows[t]}addToResyncTokens(e,t){return this.tokenMatcher(e,sK)||t.push(e),t}reSyncTo(e){let t=[],r=this.LA(1);for(;!1===this.tokenMatcher(r,e);)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,t);return n1(t)}attemptInRepetitionRecovery(e,t,r,i,n,a,s){}getCurrentGrammarPath(e,t){return{ruleStack:this.getHumanReadableRuleStack(),occurrenceStack:nE(this.RULE_OCCURRENCE_STACK),lastTok:e,lastTokOccurrence:t}}getHumanReadableRuleStack(){return ae(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function oS(e,t,r,i,n,a,s){let o=this.getKeyForAutomaticLookahead(i,n),l=this.firstAfterRepMap[o];if(void 0===l){let e=this.getCurrRuleFullName();l=new a(this.getGAstProductions()[e],n).startWalking(),this.firstAfterRepMap[o]=l}let c=l.token,u=l.occurrence,h=l.isEndOfRule;1===this.RULE_STACK.length&&h&&void 0===c&&(c=sK,u=1),void 0!==c&&void 0!==u&&this.shouldInRepetitionRecoveryBeTried(c,u,s)&&this.tryInRepetitionRecovery(e,t,r,c)}class ob{validate(e){let t=this.validateNoLeftRecursion(e.rules);return ap(t)?[...t,...this.validateEmptyOrAlternatives(e.rules),...this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),...this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead)]:t}validateNoLeftRecursion(e){return at(e,e=>(function e(t,r,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=[],s=function e(t){let r=[];if(ap(t))return r;let i=n7(t);if(i instanceof a_)r.push(i.referencedRule);else if(i instanceof aP||i instanceof aD||i instanceof aN||i instanceof aO||i instanceof aU||i instanceof aL)r=r.concat(e(i.definition));else if(i instanceof ak)r=ik(ae(i.definition,t=>e(t.definition)));else if(i instanceof aG);else throw Error("non exhaustive match");let n=aV(i),a=t.length>1;if(!n||!a)return r;{let i=n$(t);return r.concat(e(i))}}(r.definition);if(ap(s))return[];{let r=t.name;au(s,t)&&a.push({message:i.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:n}),type:b.LEFT_RECURSION,ruleName:r});let o=at(nZ(s,n.concat([t])),r=>{let a=nE(n);return a.push(r),e(t,r,i,a)});return a.concat(o)}})(e,e,sQ))}validateEmptyOrAlternatives(e){return at(e,e=>(function(e,t){let r=new ou;return e.accept(r),at(r.alternations,r=>at(n1(r.definition),(i,n)=>ap(s3([i],[],sB,1))?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:r,emptyChoiceIdx:n}),type:b.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:r.idx,alternative:n+1}]:[]))})(e,sQ))}validateAmbiguousAlternationAlternatives(e,t){return at(e,e=>(function(e,t,r){let i=new ou;e.accept(i);let n=i.alternations;return at(n=ay(n,e=>!0===e.ignoreAmbiguities),i=>{let n=oi(i.idx,e,i.maxLookahead||t,i),a=function(e,t,r,i){let n=[];return ae(aC(e,(r,i,a)=>(!0===t.definition[a].ignoreAmbiguities||n0(i,i=>{let s=[a];n0(e,(e,r)=>{a!==r&&oa(e,i)&&!0!==t.definition[r].ignoreAmbiguities&&s.push(r)}),s.length>1&&!oa(n,i)&&(n.push(i),r.push({alts:s,path:i}))}),r),[]),e=>{let n=ae(e.alts,e=>e+1);return{message:i.buildAlternationAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:n,prefixPath:e.path}),type:b.AMBIGUOUS_ALTS,ruleName:r.name,occurrence:t.idx,alternatives:e.alts}})}(n,i,e,r),s=function(e,t,r,i){let n=aC(e,(e,t,r)=>{let i=ae(t,e=>({idx:r,path:e}));return e.concat(i)},[]);return nB(at(n,e=>{if(!0===t.definition[e.idx].ignoreAmbiguities)return[];let a=e.idx,s=e.path;return ae(n8(n,e=>{var r;return!0!==t.definition[e.idx].ignoreAmbiguities&&e.idx<a&&(r=e.path).length<s.length&&n3(r,(e,t)=>{let r=s[t];return e===r||r.categoryMatchesMap[e.tokenTypeIdx]})}),e=>{let n=[e.idx+1,a+1],s=0===t.idx?"":t.idx;return{message:i.buildAlternationPrefixAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:n,prefixPath:e.path}),type:b.AMBIGUOUS_PREFIX_ALTS,ruleName:r.name,occurrence:s,alternatives:n}})}))}(n,i,e,r);return a.concat(s)})})(e,t,sQ))}validateSomeNonEmptyLookaheadPath(e,t){return function(e,t,r){let i=[];return n0(e,e=>{let n=new oh;e.accept(n),n0(n.allProductions,n=>{let a=s4(n),s=n.maxLookahead||t;if(ap(ik(on(n.idx,e,a,s)[0]))){let t=r.buildEmptyRepetitionError({topLevelRule:e,repetition:n});i.push({message:t,type:b.NO_NON_EMPTY_LOOKAHEAD,ruleName:e.name})}})}),i}(e,t,sQ)}buildLookaheadForAlternation(e){return function(e,t,r,i,n,a){let s=oi(e,t,r),o=os(s)?sR:sB;return a(s,i,o,n)}(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,s8)}buildLookaheadForOptional(e){return function(e,t,r,i,n,a){let s=on(e,t,n,r),o=os(s)?sR:sB;return a(s[0],o,i)}(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,s4(e.prodType),s5)}constructor(e){var t;this.maxLookahead=null!==(t=null==e?void 0:e.maxLookahead)&&void 0!==t?t:o$.maxLookahead}}class oI{initLooksAhead(e){this.dynamicTokensEnabled=as(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:o$.dynamicTokensEnabled,this.maxLookahead=as(e,"maxLookahead")?e.maxLookahead:o$.maxLookahead,this.lookaheadStrategy=as(e,"lookaheadStrategy")?e.lookaheadStrategy:new ob({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){n0(e,e=>{this.TRACE_INIT("".concat(e.name," Rule Lookahead"),()=>{let{alternation:t,repetition:r,option:i,repetitionMandatory:n,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:s}=function(e){o_.reset(),e.accept(o_);let t=o_.dslMethods;return o_.reset(),t}(e);n0(t,t=>{let r=0===t.idx?"":t.idx;this.TRACE_INIT("".concat(aJ(t)).concat(r),()=>{var r;let i=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:t.idx,rule:e,maxLookahead:t.maxLookahead||this.maxLookahead,hasPredicates:t.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),n=(r=this.fullRuleNameToShort[e.name],256|t.idx|r);this.setLaFuncCache(n,i)})}),n0(r,t=>{this.computeLookaheadFunc(e,t.idx,768,"Repetition",t.maxLookahead,aJ(t))}),n0(i,t=>{this.computeLookaheadFunc(e,t.idx,512,"Option",t.maxLookahead,aJ(t))}),n0(n,t=>{this.computeLookaheadFunc(e,t.idx,1024,"RepetitionMandatory",t.maxLookahead,aJ(t))}),n0(a,t=>{this.computeLookaheadFunc(e,t.idx,1536,"RepetitionMandatoryWithSeparator",t.maxLookahead,aJ(t))}),n0(s,t=>{this.computeLookaheadFunc(e,t.idx,1280,"RepetitionWithSeparator",t.maxLookahead,aJ(t))})})})}computeLookaheadFunc(e,t,r,i,n,a){this.TRACE_INIT("".concat(a).concat(0===t?"":t),()=>{let a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:t,rule:e,maxLookahead:n||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),s=t|r|this.fullRuleNameToShort[e.name];this.setLaFuncCache(s,a)})}getKeyForAutomaticLookahead(e,t){return t|e|this.getLastExplicitRuleShortName()}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,t){this.lookAheadFuncsCache.set(e,t)}}class ow extends aH{reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}}let o_=new ow;function oF(e,t){!0===isNaN(e.startOffset)?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset==!0&&(e.endOffset=t.endOffset)}function oP(e,t){!0===isNaN(e.startOffset)?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset==!0&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function oD(e,t){Object.defineProperty(e,"name",{enumerable:!1,configurable:!0,writable:!1,value:t})}function oN(e,t){let r=il(e),i=r.length;for(let n=0;n<i;n++){let i=e[r[n]],a=i.length;for(let e=0;e<a;e++){let r=i[e];void 0===r.tokenTypeIdx&&this[r.name](r.children,t)}}}(B=S||(S={}))[B.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",B[B.MISSING_METHOD=1]="MISSING_METHOD";class oO{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=as(e,"nodeLocationTracking")?e.nodeLocationTracking:o$.nodeLocationTracking,this.outputCst){if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=oP,this.setNodeLocationFromNode=oP,this.cstPostRule=rx,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=rx,this.setNodeLocationFromNode=rx,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=oF,this.setNodeLocationFromNode=oF,this.cstPostRule=rx,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=rx,this.setNodeLocationFromNode=rx,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=rx,this.setNodeLocationFromNode=rx,this.cstPostRule=rx,this.setInitialNodeLocation=rx;else throw Error('Invalid <nodeLocationTracking> config option: "'.concat(e.nodeLocationTracking,'"'))}else this.cstInvocationStateUpdate=rx,this.cstFinallyStateUpdate=rx,this.cstPostTerminal=rx,this.cstPostNonTerminal=rx,this.cstPostRule=rx}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){let t=this.LA(1);e.location={startOffset:t.startOffset,startLine:t.startLine,startColumn:t.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){let t={name:e,children:Object.create(null)};this.setInitialNodeLocation(t),this.CST_STACK.push(t)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){let t=this.LA(0),r=e.location;r.startOffset<=t.startOffset==!0?(r.endOffset=t.endOffset,r.endLine=t.endLine,r.endColumn=t.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){let t=this.LA(0),r=e.location;r.startOffset<=t.startOffset==!0?r.endOffset=t.endOffset:r.startOffset=NaN}cstPostTerminal(e,t){let r=this.CST_STACK[this.CST_STACK.length-1];void 0===r.children[e]?r.children[e]=[t]:r.children[e].push(t),this.setNodeLocationFromToken(r.location,t)}cstPostNonTerminal(e,t){let r=this.CST_STACK[this.CST_STACK.length-1];void 0===r.children[t]?r.children[t]=[e]:r.children[t].push(e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(ag(this.baseCstVisitorConstructor)){let e=function(e,t){let r=function(){};return oD(r,e+"BaseSemantics"),r.prototype={visit:function(e,t){if(t8(e)&&(e=e[0]),!ag(e))return this[e.name](e.children,t)},validateVisitor:function(){var e;let r=(e=this,nB(ae(n8(t,t=>!1===rh(e[t])),t=>({msg:"Missing visitor method: <".concat(t,"> on ").concat(e.constructor.name," CST Visitor."),type:S.MISSING_METHOD,methodName:t}))));if(!ap(r)){let e=ae(r,e=>e.msg);throw Error("Errors Detected in CST Visitor <".concat(this.constructor.name,">:\n	").concat(e.join("\n\n").replace(/\n/g,"\n	")))}}},r.prototype.constructor=r,r._RULE_NAMES=t,r}(this.className,il(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(ag(this.baseCstVisitorWithDefaultsConstructor)){let e=function(e,t,r){let i=function(){};oD(i,e+"BaseSemanticsWithDefaults");let n=Object.create(r.prototype);return n0(t,e=>{n[e]=oN}),i.prototype=n,i.prototype.constructor=i,i}(this.className,il(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){let e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){let e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){let e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class oL{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(!0!==this.selfAnalysisDone)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):oq}LA(e){let t=this.currIdx+e;return t<0||this.tokVectorLength<=t?oq:this.tokVector[t]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class oU{ACTION(e){return e.call(this)}consume(e,t,r){return this.consumeInternal(t,e,r)}subrule(e,t,r){return this.subruleInternal(t,e,r)}option(e,t){return this.optionInternal(t,e)}or(e,t){return this.orInternal(t,e)}many(e,t){return this.manyInternal(e,t)}atLeastOne(e,t){return this.atLeastOneInternal(e,t)}CONSUME(e,t){return this.consumeInternal(e,0,t)}CONSUME1(e,t){return this.consumeInternal(e,1,t)}CONSUME2(e,t){return this.consumeInternal(e,2,t)}CONSUME3(e,t){return this.consumeInternal(e,3,t)}CONSUME4(e,t){return this.consumeInternal(e,4,t)}CONSUME5(e,t){return this.consumeInternal(e,5,t)}CONSUME6(e,t){return this.consumeInternal(e,6,t)}CONSUME7(e,t){return this.consumeInternal(e,7,t)}CONSUME8(e,t){return this.consumeInternal(e,8,t)}CONSUME9(e,t){return this.consumeInternal(e,9,t)}SUBRULE(e,t){return this.subruleInternal(e,0,t)}SUBRULE1(e,t){return this.subruleInternal(e,1,t)}SUBRULE2(e,t){return this.subruleInternal(e,2,t)}SUBRULE3(e,t){return this.subruleInternal(e,3,t)}SUBRULE4(e,t){return this.subruleInternal(e,4,t)}SUBRULE5(e,t){return this.subruleInternal(e,5,t)}SUBRULE6(e,t){return this.subruleInternal(e,6,t)}SUBRULE7(e,t){return this.subruleInternal(e,7,t)}SUBRULE8(e,t){return this.subruleInternal(e,8,t)}SUBRULE9(e,t){return this.subruleInternal(e,9,t)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o1;if(au(this.definedRulesNames,e)){let t={message:sQ.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:b.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(t)}this.definedRulesNames.push(e);let i=this.defineRule(e,t,r);return this[e]=i,i}OVERRIDE_RULE(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o1,i=function(e,t,r){let i=[];return au(t,e)||i.push({message:"Invalid rule override, rule: ->".concat(e,"<- cannot be overridden in the grammar: ->").concat(r,"<-as it is not defined in any of the super grammars "),type:b.INVALID_RULE_OVERRIDE,ruleName:e}),i}(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);let n=this.defineRule(e,t,r);return this[e]=n,n}BACKTRACK(e,t){return function(){this.isBackTrackingStack.push(1);let r=this.saveRecogState();try{return e.apply(this,t),!0}catch(e){if(og(e))return!1;throw e}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return ae(al(this.gastProductionsCache),function e(t){function r(t){return ae(t,e)}if(t instanceof a_){let e={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return ao(t.label)&&(e.label=t.label),e}if(t instanceof aP)return{type:"Alternative",definition:r(t.definition)};if(t instanceof aD)return{type:"Option",idx:t.idx,definition:r(t.definition)};if(t instanceof aN)return{type:"RepetitionMandatory",idx:t.idx,definition:r(t.definition)};if(t instanceof aO)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:e(new aG({terminalType:t.separator})),definition:r(t.definition)};if(t instanceof aU)return{type:"RepetitionWithSeparator",idx:t.idx,separator:e(new aG({terminalType:t.separator})),definition:r(t.definition)};if(t instanceof aL)return{type:"Repetition",idx:t.idx,definition:r(t.definition)};else if(t instanceof ak)return{type:"Alternation",idx:t.idx,definition:r(t.definition)};else if(t instanceof aG){var i,n;let e={type:"Terminal",name:t.terminalType.name,label:ao((n=i=t.terminalType).LABEL)&&""!==n.LABEL?i.LABEL:i.name,idx:t.idx};ao(t.label)&&(e.terminalLabel=t.label);let r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(e.pattern=aA(r)?r.source:r),e}else if(t instanceof aF)return{type:"Rule",name:t.name,orgText:t.orgText,definition:r(t.definition)};else throw Error("non exhaustive match")})}}class ok{initRecognizerEngine(e,t){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=sR,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},as(t,"serializedGrammar"))throw Error("The Parser's configuration can no longer contain a <serializedGrammar> property.\n	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0\n	For Further details.");if(t8(e)){if(ap(e))throw Error("A Token Vocabulary cannot be empty.\n	Note that the first argument for the parser constructor\n	is no longer a Token vector (since v4.0).");if("number"==typeof e[0].startOffset)throw Error("The Parser constructor no longer accepts a token vector as the first argument.\n	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0\n	For Further details.")}if(t8(e))this.tokensMap=aC(e,(e,t)=>(e[t.name]=t,e),{});else if(as(e,"modes")&&n3(ik(al(e.modes)),sw)){let t=ax(ik(al(e.modes)));this.tokensMap=aC(t,(e,t)=>(e[t.name]=t,e),{})}else if(rr(e))this.tokensMap=nE(e);else throw Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=sK;let r=n3(as(e,"modes")?ik(al(e.modes)):al(e),e=>ap(e.categoryMatches));this.tokenMatcher=r?sR:sB,sS(al(this.tokensMap))}defineRule(e,t,r){if(this.selfAnalysisDone)throw Error("Grammar rule <".concat(e,"> may not be defined after the 'performSelfAnalysis' method has been called'\nMake sure that all grammar rule definitions are done before 'performSelfAnalysis' is called."));let i=as(r,"resyncEnabled")?r.resyncEnabled:o1.resyncEnabled,n=as(r,"recoveryValueFunc")?r.recoveryValueFunc:o1.recoveryValueFunc,a=this.ruleShortNameIdx<<12;return this.ruleShortNameIdx++,this.shortRuleNameToFull[a]=e,this.fullRuleNameToShort[e]=a,Object.assign(!0===this.outputCst?function(){for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];try{this.ruleInvocationStateUpdate(a,e,this.subruleIdx),t.apply(this,s);let r=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(r),r}catch(e){return this.invokeRuleCatch(e,i,n)}finally{this.ruleFinallyStateUpdate()}}:function(){for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];try{return this.ruleInvocationStateUpdate(a,e,this.subruleIdx),t.apply(this,s)}catch(e){return this.invokeRuleCatch(e,i,n)}finally{this.ruleFinallyStateUpdate()}},{ruleName:e,originalGrammarAction:t})}invokeRuleCatch(e,t,r){let i=1===this.RULE_STACK.length,n=t&&!this.isBackTracking()&&this.recoveryEnabled;if(og(e)){if(n){let t=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(t)){if(e.resyncedTokens=this.reSyncTo(t),!this.outputCst)return r(e);{let e=this.CST_STACK[this.CST_STACK.length-1];return e.recoveredNode=!0,e}}if(this.outputCst){let t=this.CST_STACK[this.CST_STACK.length-1];t.recoveredNode=!0,e.partialCstResult=t}throw e}if(i)return this.moveToTerminatedState(),r(e)}throw e}optionInternal(e,t){let r=this.getKeyForAutomaticLookahead(512,t);return this.optionInternalLogic(e,t,r)}optionInternalLogic(e,t,r){let i,n=this.getLaFuncFromCache(r);if("function"!=typeof e){i=e.DEF;let t=e.GATE;if(void 0!==t){let e=n;n=()=>t.call(this)&&e.call(this)}}else i=e;if(!0===n.call(this))return i.call(this)}atLeastOneInternal(e,t){let r=this.getKeyForAutomaticLookahead(1024,e);return this.atLeastOneInternalLogic(e,t,r)}atLeastOneInternalLogic(e,t,r){let i,n=this.getLaFuncFromCache(r);if("function"!=typeof t){i=t.DEF;let e=t.GATE;if(void 0!==e){let t=n;n=()=>e.call(this)&&t.call(this)}}else i=t;if(!0===n.call(this)){let e=this.doSingleRepetition(i);for(;!0===n.call(this)&&!0===e;)e=this.doSingleRepetition(i)}else throw this.raiseEarlyExitException(e,M.REPETITION_MANDATORY,t.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],n,1024,e,s0)}atLeastOneSepFirstInternal(e,t){let r=this.getKeyForAutomaticLookahead(1536,e);this.atLeastOneSepFirstInternalLogic(e,t,r)}atLeastOneSepFirstInternalLogic(e,t,r){let i=t.DEF,n=t.SEP;if(!0===this.getLaFuncFromCache(r).call(this)){i.call(this);let t=()=>this.tokenMatcher(this.LA(1),n);for(;!0===this.tokenMatcher(this.LA(1),n);)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,t,i,s2],t,1536,e,s2)}else throw this.raiseEarlyExitException(e,M.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG)}manyInternal(e,t){let r=this.getKeyForAutomaticLookahead(768,e);return this.manyInternalLogic(e,t,r)}manyInternalLogic(e,t,r){let i,n=this.getLaFuncFromCache(r);if("function"!=typeof t){i=t.DEF;let e=t.GATE;if(void 0!==e){let t=n;n=()=>e.call(this)&&t.call(this)}}else i=t;let a=!0;for(;!0===n.call(this)&&!0===a;)a=this.doSingleRepetition(i);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],n,768,e,s$,a)}manySepFirstInternal(e,t){let r=this.getKeyForAutomaticLookahead(1280,e);this.manySepFirstInternalLogic(e,t,r)}manySepFirstInternalLogic(e,t,r){let i=t.DEF,n=t.SEP;if(!0===this.getLaFuncFromCache(r).call(this)){i.call(this);let t=()=>this.tokenMatcher(this.LA(1),n);for(;!0===this.tokenMatcher(this.LA(1),n);)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,t,i,s1],t,1280,e,s1)}}repetitionSepSecondInternal(e,t,r,i,n){for(;r();)this.CONSUME(t),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,r,i,n],r,1536,e,n)}doSingleRepetition(e){let t=this.getLexerPosition();return e.call(this),this.getLexerPosition()>t}orInternal(e,t){let r=this.getKeyForAutomaticLookahead(256,t),i=t8(e)?e:e.DEF,n=this.getLaFuncFromCache(r).call(this,i);if(void 0!==n)return i[n].ALT.call(this);this.raiseNoAltException(t,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),0===this.RULE_STACK.length&&!1===this.isAtEndOfInput()){let e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new oy(t,e))}}subruleInternal(e,t,r){let i;try{let n=void 0!==r?r.ARGS:void 0;return this.subruleIdx=t,i=e.apply(this,n),this.cstPostNonTerminal(i,void 0!==r&&void 0!==r.LABEL?r.LABEL:e.ruleName),i}catch(t){throw this.subruleInternalError(t,r,e.ruleName)}}subruleInternalError(e,t,r){throw og(e)&&void 0!==e.partialCstResult&&(this.cstPostNonTerminal(e.partialCstResult,void 0!==t&&void 0!==t.LABEL?t.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,t,r){let i;try{let t=this.LA(1);!0===this.tokenMatcher(t,e)?(this.consumeToken(),i=t):this.consumeInternalError(e,t,r)}catch(r){i=this.consumeInternalRecovery(e,t,r)}return this.cstPostTerminal(void 0!==r&&void 0!==r.LABEL?r.LABEL:e.name,i),i}consumeInternalError(e,t,r){let i;let n=this.LA(0);throw i=void 0!==r&&r.ERR_MSG?r.ERR_MSG:this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new oT(i,t,n))}consumeInternalRecovery(e,t,r){if(this.recoveryEnabled&&"MismatchedTokenException"===r.name&&!this.isBackTracking()){let i=this.getFollowsForInRuleRecovery(e,t);try{return this.tryInRuleRecovery(e,i)}catch(e){if(e.name===oR)throw r;throw e}}else throw r}saveRecogState(){let e=this.errors,t=nE(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,t,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t)}isBackTracking(){return 0!==this.isBackTrackingStack.length}getCurrRuleFullName(){let e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),sK)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class oG{initErrorHandler(e){this._errors=[],this.errorMessageProvider=as(e,"errorMessageProvider")?e.errorMessageProvider:o$.errorMessageProvider}SAVE_ERROR(e){if(og(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:nE(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return nE(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,t,r){let i=this.getCurrRuleFullName(),n=on(e,this.getGAstProductions()[i],t,this.maxLookahead)[0],a=[];for(let e=1;e<=this.maxLookahead;e++)a.push(this.LA(e));let s=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:n,actual:a,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new oE(s,this.LA(1),this.LA(0)))}raiseNoAltException(e,t){let r=this.getCurrRuleFullName(),i=oi(e,this.getGAstProductions()[r],this.maxLookahead),n=[];for(let e=1;e<=this.maxLookahead;e++)n.push(this.LA(e));let a=this.LA(0),s=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:i,actual:n,previous:a,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new oC(s,this.LA(1),a))}}class oH{initContentAssist(){}computeContentAssist(e,t){let r=this.gastProductionsCache[e];if(ag(r))throw Error("Rule ->".concat(e,"<- does not exist in this grammar."));return s3([r],t,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){let t=n7(e.ruleStack);return new sZ(this.getGAstProductions()[t],e).startWalking()}}let oV={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(oV);let oJ=sJ({name:"RECORDING_PHASE_TOKEN",pattern:sF.NA});sS([oJ]);let oK=sj(oJ,"This IToken indicates the Parser is in Recording Phase\n	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details",-1,-1,-1,-1,-1,-1);Object.freeze(oK);let oj={name:"This CSTNode indicates the Parser is in Recording Phase\n	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details",children:{}};class oW{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){let t=e>0?e:"";this["CONSUME".concat(t)]=function(t,r){return this.consumeInternalRecord(t,e,r)},this["SUBRULE".concat(t)]=function(t,r){return this.subruleInternalRecord(t,e,r)},this["OPTION".concat(t)]=function(t){return this.optionInternalRecord(t,e)},this["OR".concat(t)]=function(t){return this.orInternalRecord(t,e)},this["MANY".concat(t)]=function(t){this.manyInternalRecord(e,t)},this["MANY_SEP".concat(t)]=function(t){this.manySepFirstInternalRecord(e,t)},this["AT_LEAST_ONE".concat(t)]=function(t){this.atLeastOneInternalRecord(e,t)},this["AT_LEAST_ONE_SEP".concat(t)]=function(t){this.atLeastOneSepFirstInternalRecord(e,t)}}this.consume=function(e,t,r){return this.consumeInternalRecord(t,e,r)},this.subrule=function(e,t,r){return this.subruleInternalRecord(t,e,r)},this.option=function(e,t){return this.optionInternalRecord(t,e)},this.or=function(e,t){return this.orInternalRecord(t,e)},this.many=function(e,t){this.manyInternalRecord(e,t)},this.atLeastOne=function(e,t){this.atLeastOneInternalRecord(e,t)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{for(let e=0;e<10;e++){let t=e>0?e:"";delete this["CONSUME".concat(t)],delete this["SUBRULE".concat(t)],delete this["OPTION".concat(t)],delete this["OR".concat(t)],delete this["MANY".concat(t)],delete this["MANY_SEP".concat(t)],delete this["AT_LEAST_ONE".concat(t)],delete this["AT_LEAST_ONE_SEP".concat(t)]}delete this.consume,delete this.subrule,delete this.option,delete this.or,delete this.many,delete this.atLeastOne,delete this.ACTION,delete this.BACKTRACK,delete this.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,t){return()=>!0}LA_RECORD(e){return oq}topLevelRuleRecord(e,t){try{let r=new aF({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),t.call(this),this.recordingProdStack.pop(),r}catch(e){if(!0!==e.KNOWN_RECORDER_ERROR)try{e.message=e.message+'\n	 This error was thrown during the "grammar recording phase" For more info see:\n	https://chevrotain.io/docs/guide/internals.html#grammar-recording'}catch(e){}throw e}}optionInternalRecord(e,t){return oz.call(this,aD,e,t)}atLeastOneInternalRecord(e,t){oz.call(this,aN,t,e)}atLeastOneSepFirstInternalRecord(e,t){oz.call(this,aO,t,e,!0)}manyInternalRecord(e,t){oz.call(this,aL,t,e)}manySepFirstInternalRecord(e,t){oz.call(this,aU,t,e,!0)}orInternalRecord(e,t){return oQ.call(this,e,t)}subruleInternalRecord(e,t,r){if(oY(t),!e||!1===as(e,"ruleName")){let r=Error("<SUBRULE".concat(oX(t),"> argument is invalid expecting a Parser method reference but got: <").concat(JSON.stringify(e),">\n inside top level rule: <").concat(this.recordingProdStack[0].name,">"));throw r.KNOWN_RECORDER_ERROR=!0,r}let i=nq(this.recordingProdStack),n=new a_({idx:t,nonTerminalName:e.ruleName,label:null==r?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(n),this.outputCst?oj:oV}consumeInternalRecord(e,t,r){if(oY(t),!sb(e)){let r=Error("<CONSUME".concat(oX(t),"> argument is invalid expecting a TokenType reference but got: <").concat(JSON.stringify(e),">\n inside top level rule: <").concat(this.recordingProdStack[0].name,">"));throw r.KNOWN_RECORDER_ERROR=!0,r}let i=nq(this.recordingProdStack),n=new aG({idx:t,terminalType:e,label:null==r?void 0:r.LABEL});return i.definition.push(n),oK}}function oz(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];oY(r);let n=nq(this.recordingProdStack),a=rh(t)?t:t.DEF,s=new e({definition:[],idx:r});return i&&(s.separator=t.SEP),as(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(s),a.call(this),n.definition.push(s),this.recordingProdStack.pop(),oV}function oQ(e,t){oY(t);let r=nq(this.recordingProdStack),i=!1===t8(e),n=!1===i?e:e.DEF,a=new ak({definition:[],idx:t,ignoreAmbiguities:i&&!0===e.IGNORE_AMBIGUITIES});as(e,"MAX_LOOKAHEAD")&&(a.maxLookahead=e.MAX_LOOKAHEAD);let s=aB(n,e=>rh(e.GATE));return a.hasPredicates=s,r.definition.push(a),n0(n,e=>{let t=new aP({definition:[]});a.definition.push(t),as(e,"IGNORE_AMBIGUITIES")?t.ignoreAmbiguities=e.IGNORE_AMBIGUITIES:as(e,"GATE")&&(t.ignoreAmbiguities=!0),this.recordingProdStack.push(t),e.ALT.call(this),this.recordingProdStack.pop()}),oV}function oX(e){return 0===e?"":"".concat(e)}function oY(e){if(e<0||e>255){let t=Error("Invalid DSL Method idx value: <".concat(e,">\n	Idx value must be a none negative value smaller than ").concat(256));throw t.KNOWN_RECORDER_ERROR=!0,t}}class oZ{initPerformanceTracer(e){if(as(e,"traceInitPerf")){let t=e.traceInitPerf,r="number"==typeof t;this.traceInitMaxIdent=r?t:1/0,this.traceInitPerf=r?t>0:t}else this.traceInitMaxIdent=0,this.traceInitPerf=o$.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,t){if(!0!==this.traceInitPerf)return t();{this.traceInitIndent++;let r=Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log("".concat(r,"--> <").concat(e,">"));let{time:i,value:n}=ab(t),a=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&a("".concat(r,"<-- <").concat(e,"> time: ").concat(i,"ms")),this.traceInitIndent--,n}}}let oq=sj(sK,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(oq);let o$=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:sW,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),o1=Object.freeze({recoveryValueFunc:()=>void 0,resyncEnabled:!0});(R=b||(b={}))[R.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",R[R.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",R[R.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",R[R.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",R[R.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",R[R.LEFT_RECURSION=5]="LEFT_RECURSION",R[R.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",R[R.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",R[R.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",R[R.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",R[R.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",R[R.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",R[R.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",R[R.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION";class o0{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;let t=this.className;this.TRACE_INIT("toFastProps",()=>{aI(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),n0(this.definedRulesNames,e=>{let t;let r=this[e].originalGrammarAction;this.TRACE_INIT("".concat(e," Rule"),()=>{t=this.topLevelRuleRecord(e,r)}),this.gastProductionsCache[e]=t})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=function(e){let t=nQ(e,{errMsgProvider:sz}),r={};return n0(e.rules,e=>{r[e.name]=e}),function(e,t){let r=new sX(e,t);return r.resolveRefs(),r.errors}(r,t.errMsgProvider)}({rules:al(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(ap(r)&&!1===this.skipValidations){var e,i;let r=function(e,t,r,i){let n=at(e,e=>(function(e,t){let r=new oc;return e.accept(r),ae(al(av(ai(r.allProductions,oo),e=>e.length>1)),r=>{let i=n7(r),n=t.buildDuplicateFoundError(e,r),a=aJ(i),s={message:n,type:b.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:a,occurrence:i.idx},o=ol(i);return o&&(s.parameter=o),s})})(e,r)),a=function(e,t,r){let i=[],n=ae(t,e=>e.name);return n0(e,e=>{let t=e.name;if(au(n,t)){let n=r.buildNamespaceConflictError(e);i.push({message:n,type:b.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:t})}}),i}(e,t,r),s=at(e,e=>(function(e,t){let r=new ou;return e.accept(r),at(r.alternations,r=>r.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:r}),type:b.TOO_MANY_ALTS,ruleName:e.name,occurrence:r.idx}]:[])})(e,r)),o=at(e,t=>(function(e,t,r,i){let n=[];if(aC(t,(t,r)=>r.name===e.name?t+1:t,0)>1){let t=i.buildDuplicateRuleNameError({topLevelRule:e,grammarName:r});n.push({message:t,type:b.DUPLICATE_RULE_NAME,ruleName:e.name})}return n})(t,e,i,r));return n.concat(a,s,o)}((e=nQ(e={rules:al(this.gastProductionsCache),tokenTypes:al(this.tokensMap),errMsgProvider:sQ,grammarName:t},{errMsgProvider:sQ})).rules,e.tokenTypes,e.errMsgProvider,e.grammarName),n=ae((i={lookaheadStrategy:this.lookaheadStrategy,rules:al(this.gastProductionsCache),tokenTypes:al(this.tokensMap),grammarName:t}).lookaheadStrategy.validate({rules:i.rules,tokenTypes:i.tokenTypes,grammarName:i.grammarName}),e=>Object.assign({type:b.CUSTOM_LOOKAHEAD_VALIDATION},e));this.definitionErrors=this.definitionErrors.concat(r,n)}}),ap(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{let e=function(e){let t={};return n0(e,e=>{iu(t,new aQ(e).startWalking())}),t}(al(this.gastProductionsCache));this.resyncFollows=e}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var e,t;null===(t=(e=this.lookaheadStrategy).initialize)||void 0===t||t.call(e,{rules:al(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(al(this.gastProductionsCache))})),!o0.DEFER_DEFINITION_ERRORS_HANDLING&&!ap(this.definitionErrors))throw e=ae(this.definitionErrors,e=>e.message),Error("Parser Definition Errors detected:\n ".concat(e.join("\n-------------------------------\n")))})}constructor(e,t){if(this.definitionErrors=[],this.selfAnalysisDone=!1,this.initErrorHandler(t),this.initLexerAdapter(),this.initLooksAhead(t),this.initRecognizerEngine(e,t),this.initRecoverable(t),this.initTreeBuilder(t),this.initContentAssist(),this.initGastRecorder(t),this.initPerformanceTracer(t),as(t,"ignoredIssues"))throw Error("The <ignoredIssues> IParserConfig property has been deprecated.\n	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.\n	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES\n	For further details.");this.skipValidations=as(t,"skipValidations")?t.skipValidations:o$.skipValidations}}o0.DEFER_DEFINITION_ERRORS_HANDLING=!1,function(e,t){t.forEach(t=>{let r=t.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if("constructor"===i)return;let n=Object.getOwnPropertyDescriptor(r,i);n&&(n.get||n.set)?Object.defineProperty(e.prototype,i,n):e.prototype[i]=t.prototype[i]})})}(o0,[oM,oI,oO,oL,ok,oU,oG,oH,oW,oZ]);class o2{_initWorker(e){if(!this.workers[e]){let t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return -1}_onMessage(e,t){let r=this.workersResolve[e];if(r&&r(t),this.queue.length){let{resolve:t,msg:r,transfer:i}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(r,i)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(r=>{let i=this._getIdleWorker();-1!==i?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=r,this.workers[i].postMessage(e,t)):this.queue.push({resolve:r,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}}class o9 extends I.CompressedTexture{constructor(e,t,r,i,n,a){super(e,t,r,n,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=I.ClampToEdgeWrapping}}let o3=new WeakMap,o4=0,o8=class extends I.Loader{setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){let e=new I.FileLoader(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);let t=e.loadAsync("basis_transcoder.js"),r=new I.FileLoader(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);let i=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,i]).then(e=>{let[t,r]=e,i=o8.BasisWorker.toString(),n=["/* constants */","let _EngineFormat = "+JSON.stringify(o8.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(o8.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(o8.BasisFormat),"/* basis_transcoder.js */",t,"/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n])),this.transcoderBinary=r,this.workerPool.setWorkerCreator(()=>{let e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e})}),o4>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),o4++}return this.transcoderPending}load(e,t,r,i){if(null===this.workerConfig)throw Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");let n=new I.FileLoader(this.manager);n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials),n.load(e,e=>{if(o3.has(e))return o3.get(e).promise.then(t).catch(i);this._createTexture(e).then(e=>t?t(e):null).catch(i)},r,i)}_createTextureFrom(e,t){let{mipmaps:r,width:i,height:n,format:a,type:s,error:o,dfdTransferFn:l,dfdFlags:c}=e;if("error"===s)return Promise.reject(o);let u=t.layerCount>1?new o9(r,i,n,t.layerCount,a,I.UnsignedByteType):new I.CompressedTexture(r,i,n,a,I.UnsignedByteType);return u.minFilter=1===r.length?I.LinearFilter:I.LinearMipmapLinearFilter,u.magFilter=I.LinearFilter,u.generateMipmaps=!1,u.needsUpdate=!0,"colorSpace"in u?u.colorSpace=l===w.FVZ?"srgb":"srgb-linear":u.encoding=l===w.FVZ?3001:3e3,u.premultiplyAlpha=!!(c&w.qHj),u}async _createTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(0,w.ij3)(new Uint8Array(e));if(r.vkFormat!==w.kXg)return le(r);let i=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:t},[e])).then(e=>this._createTextureFrom(e.data,r));return o3.set(e,{promise:i}),i}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),o4--,this}constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new o2,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}};D(o8,"BasisFormat",{ETC1S:0,UASTC_4x4:1}),D(o8,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16}),D(o8,"EngineFormat",{RGBAFormat:I.RGBAFormat,RGBA_ASTC_4x4_Format:I.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:I.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:I.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:I.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:I.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:I.RGB_ETC1_Format,RGB_ETC2_Format:I.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:I.RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:I.RGB_S3TC_DXT1_Format}),D(o8,"BasisWorker",function(){let e,t,r;let i=_EngineFormat,n=_TranscoderFormat,a=_BasisFormat;self.addEventListener("message",function(s){let u=s.data;switch(u.type){case"init":var h;e=u.config,h=u.transcoderBinary,t=new Promise(e=>{r={wasmBinary:h,onRuntimeInitialized:e},BASIS(r)}).then(()=>{r.initializeBasis(),void 0===r.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":t.then(()=>{try{let{width:t,height:s,hasAlpha:h,mipmaps:d,format:f,dfdTransferFn:p,dfdFlags:m}=function(t){let s=new r.KTX2File(new Uint8Array(t));function u(){s.close(),s.delete()}if(!s.isValid())throw u(),Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");let h=s.isUASTC()?a.UASTC_4x4:a.ETC1S,d=s.getWidth(),f=s.getHeight(),p=s.getLayers()||1,m=s.getLevels(),A=s.getHasAlpha(),g=s.getDFDTransferFunc(),v=s.getDFDFlags(),{transcoderFormat:T,engineFormat:C}=function(t,r,s,u){let h;let d=t===a.ETC1S?o:l;for(let i=0;i<d.length;i++){let n=d[i];if(e[n.if]&&n.basisFormat.includes(t)&&(!u||!(n.transcoderFormat.length<2))&&(!n.needsPowerOfTwo||c(r)&&c(s)))return{transcoderFormat:n.transcoderFormat[u?1:0],engineFormat:n.engineFormat[u?1:0]}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:n.RGBA32,engineFormat:i.RGBAFormat}}(h,d,f,A);if(!d||!f||!m)throw u(),Error("THREE.KTX2Loader:	Invalid texture");if(!s.startTranscoding())throw u(),Error("THREE.KTX2Loader: .startTranscoding failed");let y=[];for(let e=0;e<m;e++){let t,r;let i=[];for(let n=0;n<p;n++){let a=s.getImageLevelInfo(e,n,0);t=a.origWidth<4?a.origWidth:a.width,r=a.origHeight<4?a.origHeight:a.height;let o=new Uint8Array(s.getImageTranscodedSizeInBytes(e,n,0,T));if(!s.transcodeImage(o,e,n,0,T,0,-1,-1))throw u(),Error("THREE.KTX2Loader: .transcodeImage failed.");i.push(o)}y.push({data:function(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r].byteLength;let r=new Uint8Array(t),i=0;for(let t=0;t<e.length;t++){let n=e[t];r.set(n,i),i+=n.byteLength}return r}(i),width:t,height:r})}return u(),{width:d,height:f,hasAlpha:A,mipmaps:y,format:C,dfdTransferFn:g,dfdFlags:v}}(u.buffer),A=[];for(let e=0;e<d.length;++e)A.push(d[e].data.buffer);self.postMessage({type:"transcode",id:u.id,width:t,height:s,hasAlpha:h,mipmaps:d,format:f,dfdTransferFn:p,dfdFlags:m},A)}catch(e){console.error(e),self.postMessage({type:"error",id:u.id,error:e.message})}})}});let s=[{if:"astcSupported",basisFormat:[a.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],o=s.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),l=s.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function c(e){return e<=2||(e&e-1)==0&&0!==e}});let o5={[w.qfi]:I.RGBAFormat,[w.IgZ]:I.RGBAFormat,[w.MCP]:I.RGBAFormat,[w.OmG]:I.RGBAFormat,[w.bWS]:I.RGFormat,[w.LR2]:I.RGFormat,[w.gJS]:I.RGFormat,[w.IJq]:I.RGFormat,[w.eQx]:I.RedFormat,[w.wOb]:I.RedFormat,[w.e1Y]:I.RedFormat,[w.tLr]:I.RedFormat},o6={[w.qfi]:I.FloatType,[w.IgZ]:I.HalfFloatType,[w.MCP]:I.UnsignedByteType,[w.OmG]:I.UnsignedByteType,[w.bWS]:I.FloatType,[w.LR2]:I.HalfFloatType,[w.gJS]:I.UnsignedByteType,[w.IJq]:I.UnsignedByteType,[w.eQx]:I.FloatType,[w.wOb]:I.HalfFloatType,[w.e1Y]:I.UnsignedByteType,[w.tLr]:I.UnsignedByteType},o7={[w.OmG]:3001,[w.IJq]:3001,[w.e1Y]:3001};async function le(e){let t,r;let{vkFormat:i,pixelWidth:n,pixelHeight:a,pixelDepth:s}=e;if(void 0===o5[i])throw Error("THREE.KTX2Loader: Unsupported vkFormat.");let l=e.levels[0];if(e.supercompressionScheme===w.Oi)t=l.levelData;else if(e.supercompressionScheme===w.c6w)o||(o=new Promise(async e=>{let t=new _.L;await t.init(),e(t)})),t=(await o).decode(l.levelData,l.uncompressedByteLength);else throw Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");r=o6[i]===I.FloatType?new Float32Array(t.buffer,t.byteOffset,t.byteLength/Float32Array.BYTES_PER_ELEMENT):o6[i]===I.HalfFloatType?new Uint16Array(t.buffer,t.byteOffset,t.byteLength/Uint16Array.BYTES_PER_ELEMENT):t;let c=0===s?new I.DataTexture(r,n,a):new tj(r,n,a,s);return c.type=o6[i],c.format=o5[i],c.encoding=o7[i]||3e3,c.needsUpdate=!0,Promise.resolve(c)}let lt=new WeakMap,lr=class extends I.Loader{setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}load(e,t,r,i){let n=new I.FileLoader(this.manager);n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);let a=new I.CompressedTexture;return n.load(e,e=>{if(lt.has(e))return lt.get(e).promise.then(t).catch(i);this._createTexture([e]).then(function(e){a.copy(e),a.needsUpdate=!0,t&&t(a)}).catch(i)},r,i),a}parseInternalAsync(e){let{levels:t}=e,r=new Set;for(let e=0;e<t.length;e++)r.add(t[e].data.buffer);return this._createTexture(Array.from(r),{...e,lowLevel:!0})}_createTexture(e){let t,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=0;for(let t=0;t<e.length;t++)n+=e[t].byteLength;let a=this._allocateWorker(n).then(n=>(t=n,r=this.workerNextTaskID++,new Promise((n,a)=>{t._callbacks[r]={resolve:n,reject:a},t.postMessage({type:"transcode",id:r,buffers:e,taskConfig:i},e)}))).then(e=>{let{mipmaps:t,width:r,height:i,format:n}=e,a=new I.CompressedTexture(t,r,i,n,I.UnsignedByteType);return a.minFilter=1===t.length?I.LinearFilter:I.LinearMipmapLinearFilter,a.magFilter=I.LinearFilter,a.generateMipmaps=!1,a.needsUpdate=!0,a});return a.catch(()=>!0).then(()=>{t&&r&&(t._taskLoad-=n,delete t._callbacks[r])}),lt.set(e[0],{promise:a}),a}_initTranscoder(){if(!this.transcoderPending){let e=new I.FileLoader(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);let t=new Promise((t,r)=>{e.load("basis_transcoder.js",t,void 0,r)}),r=new I.FileLoader(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);let i=new Promise((e,t)=>{r.load("basis_transcoder.wasm",e,void 0,t)});this.transcoderPending=Promise.all([t,i]).then(e=>{let[t,r]=e,i=lr.BasisWorker.toString(),n=["/* constants */","let _EngineFormat = "+JSON.stringify(lr.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(lr.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(lr.BasisFormat),"/* basis_transcoder.js */",t,"/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n])),this.transcoderBinary=r})}return this.transcoderPending}_allocateWorker(e){return this._initTranscoder().then(()=>{if(this.workerPool.length<this.workerLimit){let e=new Worker(this.workerSourceURL);e._callbacks={},e._taskLoad=0,e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:this.transcoderBinary}),e.onmessage=function(t){let r=t.data;switch(r.type){case"transcode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.BasisTextureLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});let t=this.workerPool[this.workerPool.length-1];return t._taskLoad+=e,t})}dispose(){for(let e=0;e<this.workerPool.length;e++)this.workerPool[e].terminate();return this.workerPool.length=0,this}constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig=null}};D(lr,"BasisFormat",{ETC1S:0,UASTC_4x4:1}),D(lr,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16}),D(lr,"EngineFormat",{RGBAFormat:I.RGBAFormat,RGBA_ASTC_4x4_Format:I.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:I.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:I.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:I.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:I.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:I.RGB_ETC1_Format,RGB_ETC2_Format:I.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:I.RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:I.RGB_S3TC_DXT1_Format}),D(lr,"BasisWorker",function(){let e,t,r;let i=_EngineFormat,n=_TranscoderFormat,a=_BasisFormat;onmessage=function(i){let n=i.data;switch(n.type){case"init":var s;e=n.config,s=n.transcoderBinary,t=new Promise(e=>{r={wasmBinary:s,onRuntimeInitialized:e},BASIS(r)}).then(()=>{r.initializeBasis()});break;case"transcode":t.then(()=>{try{let{width:e,height:t,hasAlpha:i,mipmaps:s,format:o}=n.taskConfig.lowLevel?function(e){let{basisFormat:t,width:i,height:n,hasAlpha:s}=e,{transcoderFormat:o,engineFormat:l}=c(t,i,n,s),p=r.getBytesPerBlockOrPixel(o);u(r.isFormatSupported(o),"THREE.BasisTextureLoader: Unsupported format.");let m=[];if(t===a.ETC1S){let t=new r.LowLevelETC1SImageTranscoder,{endpointCount:i,endpointsData:n,selectorCount:a,selectorsData:l,tablesData:c}=e.globalData;try{let r;r=t.decodePalettes(i,n,a,l),u(r,"THREE.BasisTextureLoader: decodePalettes() failed."),r=t.decodeTables(c),u(r,"THREE.BasisTextureLoader: decodeTables() failed.");for(let i=0;i<e.levels.length;i++){let n=e.levels[i],a=e.globalData.imageDescs[i],l=f(o,n.width,n.height),c=new Uint8Array(l);r=t.transcodeImage(o,c,l/p,n.data,h(o,n.width),d(o,n.height),n.width,n.height,n.index,a.rgbSliceByteOffset,a.rgbSliceByteLength,a.alphaSliceByteOffset,a.alphaSliceByteLength,a.imageFlags,s,!1,0,0),u(r,"THREE.BasisTextureLoader: transcodeImage() failed for level "+n.index+"."),m.push({data:c,width:n.width,height:n.height})}}finally{t.delete()}}else for(let t=0;t<e.levels.length;t++){let i=e.levels[t],n=f(o,i.width,i.height),a=new Uint8Array(n);u(r.transcodeUASTCImage(o,a,n/p,i.data,h(o,i.width),d(o,i.height),i.width,i.height,i.index,0,i.data.byteLength,0,s,!1,0,0,-1,-1),"THREE.BasisTextureLoader: transcodeUASTCImage() failed for level "+i.index+"."),m.push({data:a,width:i.width,height:i.height})}return{width:i,height:n,hasAlpha:s,mipmaps:m,format:l}}(n.taskConfig):function(e){let t=new r.BasisFile(new Uint8Array(e)),i=t.isUASTC()?a.UASTC_4x4:a.ETC1S,n=t.getImageWidth(0,0),s=t.getImageHeight(0,0),o=t.getNumLevels(0),l=t.getHasAlpha();function u(){t.close(),t.delete()}let{transcoderFormat:h,engineFormat:d}=c(i,n,s,l);if(!n||!s||!o)throw u(),Error("THREE.BasisTextureLoader:	Invalid texture");if(!t.startTranscoding())throw u(),Error("THREE.BasisTextureLoader: .startTranscoding failed");let f=[];for(let e=0;e<o;e++){let r=t.getImageWidth(0,e),i=t.getImageHeight(0,e),n=new Uint8Array(t.getImageTranscodedSizeInBytes(0,e,h));if(!t.transcodeImage(n,0,e,h,0,l))throw u(),Error("THREE.BasisTextureLoader: .transcodeImage failed.");f.push({data:n,width:r,height:i})}return u(),{width:n,height:s,hasAlpha:l,mipmaps:f,format:d}}(n.buffers[0]),l=[];for(let e=0;e<s.length;++e)l.push(s[e].data.buffer);self.postMessage({type:"transcode",id:n.id,width:e,height:t,hasAlpha:i,mipmaps:s,format:o},l)}catch(e){console.error(e),self.postMessage({type:"error",id:n.id,error:e.message})}})}};let s=[{if:"astcSupported",basisFormat:[a.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC1],engineFormat:[i.RGB_ETC1_Format,i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],o=s.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),l=s.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function c(t,r,s,c){let u;let h=t===a.ETC1S?o:l;for(let i=0;i<h.length;i++){let n=h[i];if(e[n.if]&&n.basisFormat.includes(t)&&(!n.needsPowerOfTwo||p(r)&&p(s)))return{transcoderFormat:n.transcoderFormat[c?1:0],engineFormat:n.engineFormat[c?1:0]}}return console.warn("THREE.BasisTextureLoader: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:n.RGBA32,engineFormat:i.RGBAFormat}}function u(e,t){if(!e)throw Error(t)}function h(e,t){return Math.ceil(t/r.getFormatBlockWidth(e))}function d(e,t){return Math.ceil(t/r.getFormatBlockHeight(e))}function f(e,t,i){let a=r.getBytesPerBlockOrPixel(e);return r.formatIsUncompressed(e)?t*i*a:e===n.PVRTC1_4_RGB||e===n.PVRTC1_4_RGBA?(Math.max(8,t+3&-4)*Math.max(8,i+3&-4)*4+7)/8:h(e,t)*d(e,i)*a}function p(e){return e<=2||(e&e-1)==0&&0!==e}});let li=new WeakMap;class ln extends I.Loader{setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,i){let n=new I.FileLoader(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,e=>{let r={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,r).then(t).catch(i)},r,i)}decodeDracoFile(e,t,r,i){let n={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,n).then(t)}decodeGeometry(e,t){let r;for(let e in t.attributeTypes){let r=t.attributeTypes[e];void 0!==r.BYTES_PER_ELEMENT&&(t.attributeTypes[e]=r.name)}let i=JSON.stringify(t);if(li.has(e)){let t=li.get(e);if(t.key===i)return t.promise;if(0===e.byteLength)throw Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n=this.workerNextTaskID++,a=e.byteLength,s=this._getWorker(n,a).then(i=>(r=i,new Promise((i,a)=>{r._callbacks[n]={resolve:i,reject:a},r.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return s.catch(()=>!0).then(()=>{r&&n&&this._releaseTask(r,n)}),li.set(e,{key:i,promise:s}),s}_createGeometry(e){let t=new I.BufferGeometry;e.index&&t.setIndex(new I.BufferAttribute(e.index.array,1));for(let r=0;r<e.attributes.length;r++){let i=e.attributes[r],n=i.name,a=i.array,s=i.itemSize;t.setAttribute(n,new I.BufferAttribute(a,s))}return t}_loadLibrary(e,t){let r=new I.FileLoader(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise((t,i)=>{r.load(e,t,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{let r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);let i=la.toString(),n=["/* draco decoder */",r,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){let r=t.data;switch(r.type){case"decode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});let r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}}function la(){let e,t;onmessage=function(r){let i=r.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise(function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)});break;case"decode":let n=i.buffer,a=i.taskConfig;t.then(e=>{let t=e.draco,r=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(n),n.byteLength);try{let e=function(e,t,r,i){let n,a;let s=i.attributeIDs,o=i.attributeTypes,l=t.GetEncodedGeometryType(r);if(l===e.TRIANGULAR_MESH)n=new e.Mesh,a=t.DecodeBufferToMesh(r,n);else if(l===e.POINT_CLOUD)n=new e.PointCloud,a=t.DecodeBufferToPointCloud(r,n);else throw Error("THREE.DRACOLoader: Unexpected geometry type.");if(!a.ok()||0===n.ptr)throw Error("THREE.DRACOLoader: Decoding failed: "+a.error_msg());let c={index:null,attributes:[]};for(let r in s){let a,l;let u=self[o[r]];if(i.useUniqueIDs)l=s[r],a=t.GetAttributeByUniqueId(n,l);else{if(-1===(l=t.GetAttributeId(n,e[s[r]])))continue;a=t.GetAttribute(n,l)}c.attributes.push(function(e,t,r,i,n,a){let s=a.num_components(),o=r.num_points()*s,l=o*n.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,n),u=e._malloc(l);t.GetAttributeDataArrayForAllPoints(r,a,c,l,u);let h=new n(e.HEAPF32.buffer,u,o).slice();return e._free(u),{name:i,array:h,itemSize:s}}(e,t,n,r,u,a))}return l===e.TRIANGULAR_MESH&&(c.index=function(e,t,r){let i=3*r.num_faces(),n=4*i,a=e._malloc(n);t.GetTrianglesUInt32Array(r,n,a);let s=new Uint32Array(e.HEAPF32.buffer,a,i).slice();return e._free(a),{array:s,itemSize:1}}(e,t,n)),e.destroy(n),c}(t,r,s,a),n=e.attributes.map(e=>e.array.buffer);e.index&&n.push(e.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:e},n)}catch(e){console.error(e),self.postMessage({type:"error",id:i.id,error:e.message})}finally{t.destroy(s),t.destroy(r)}})}}}Float32Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array;let ls=()=>{let e;if(l)return l;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),r=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if("object"!=typeof WebAssembly)return{supported:!1};let i="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";WebAssembly.validate(t)&&(i="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");let n=WebAssembly.instantiate(function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;++r){let i=e.charCodeAt(r);t[r]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let i=0;for(let n=0;n<e.length;++n)t[i++]=t[n]<60?r[t[n]]:(t[n]-60)*64+t[++n];return t.buffer.slice(0,i)}(i),{}).then(t=>{(e=t.instance).exports.__wasm_call_ctors()});function a(t,r,i,n,a,s){let o=e.exports.sbrk,l=i+3&-4,c=o(l*n),u=o(a.length),h=new Uint8Array(e.exports.memory.buffer);h.set(a,u);let d=t(c,i,n,u,a.length);if(0===d&&s&&s(c,l,n),r.set(h.subarray(c,c+i*n)),o(c-o(0)),0!==d)throw Error("Malformed buffer data: ".concat(d))}let s={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},o={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return l={ready:n,supported:!0,decodeVertexBuffer(t,r,i,n,o){a(e.exports.meshopt_decodeVertexBuffer,t,r,i,n,e.exports[s[o]])},decodeIndexBuffer(t,r,i,n){a(e.exports.meshopt_decodeIndexBuffer,t,r,i,n)},decodeIndexSequence(t,r,i,n){a(e.exports.meshopt_decodeIndexSequence,t,r,i,n)},decodeGltfBuffer(t,r,i,n,l,c){a(e.exports[o[l]],t,r,i,n,e.exports[s[c]])}}}}}]);